{"version":3,"sources":["webpack://PostItModeler/webpack/universalModuleDefinition","webpack://PostItModeler/./node_modules/ids/dist/index.esm.js","webpack://PostItModeler/./node_modules/min-dash/dist/index.esm.js","webpack://PostItModeler/./node_modules/min-dom/dist/index.esm.js","webpack://PostItModeler/./node_modules/tiny-svg/dist/index.esm.js","webpack://PostItModeler/./node_modules/didi/dist/index.esm.js","webpack://PostItModeler/./node_modules/diagram-js/lib/draw/BaseRenderer.js","webpack://PostItModeler/./node_modules/diagram-js/lib/util/RenderUtil.js","webpack://PostItModeler/./node_modules/diagram-js/lib/util/Elements.js","webpack://PostItModeler/./node_modules/diagram-js/lib/draw/DefaultRenderer.js","webpack://PostItModeler/./node_modules/diagram-js/lib/draw/index.js","webpack://PostItModeler/./node_modules/diagram-js/lib/draw/Styles.js","webpack://PostItModeler/./node_modules/diagram-js/lib/util/Collections.js","webpack://PostItModeler/./node_modules/diagram-js/lib/core/Canvas.js","webpack://PostItModeler/./node_modules/diagram-js/lib/core/ElementRegistry.js","webpack://PostItModeler/./node_modules/diagram-js/lib/model/index.js","webpack://PostItModeler/./node_modules/diagram-js/lib/core/ElementFactory.js","webpack://PostItModeler/./node_modules/diagram-js/lib/core/EventBus.js","webpack://PostItModeler/./node_modules/diagram-js/lib/util/GraphicsUtil.js","webpack://PostItModeler/./node_modules/diagram-js/lib/util/SvgTransformUtil.js","webpack://PostItModeler/./node_modules/diagram-js/lib/core/GraphicsFactory.js","webpack://PostItModeler/./node_modules/diagram-js/lib/core/index.js","webpack://PostItModeler/./node_modules/diagram-js/lib/Diagram.js","webpack://PostItModeler/./node_modules/moddle/dist/index.esm.js","webpack://PostItModeler/./node_modules/saxen/dist/index.esm.js","webpack://PostItModeler/./node_modules/moddle-xml/dist/index.esm.js","webpack://PostItModeler/./lib/moddle/Moddle.js","webpack://PostItModeler/./lib/moddle/index.js","webpack://PostItModeler/./lib/import/Util.js","webpack://PostItModeler/./lib/import/PostitTreeWalker.js","webpack://PostItModeler/./lib/util/PoweredByUtil.js","webpack://PostItModeler/./lib/BaseViewer.js","webpack://PostItModeler/./lib/import/Importer.js","webpack://PostItModeler/./lib/BaseModeler.js","webpack://PostItModeler/./lib/util/ModelUtil.js","webpack://PostItModeler/./lib/features/modeling/util/ModelingUtil.js","webpack://PostItModeler/./lib/features/label-editing/LabelUtil.js","webpack://PostItModeler/./lib/draw/PostitRendererUtil.js","webpack://PostItModeler/./lib/draw/PostitRenderer.js","webpack://PostItModeler/./node_modules/diagram-js/lib/util/Text.js","webpack://PostItModeler/./lib/draw/TextRenderer.js","webpack://PostItModeler/./lib/draw/PathMap.js","webpack://PostItModeler/./lib/draw/index.js","webpack://PostItModeler/./node_modules/diagram-js/lib/i18n/translate/index.js","webpack://PostItModeler/./node_modules/diagram-js/lib/i18n/translate/translate.js","webpack://PostItModeler/./lib/util/LabelUtil.js","webpack://PostItModeler/./lib/import/PostitImporter.js","webpack://PostItModeler/./lib/import/index.js","webpack://PostItModeler/./lib/core/index.js","webpack://PostItModeler/./node_modules/diagram-js/lib/util/Event.js","webpack://PostItModeler/./node_modules/diagram-js/lib/util/Mouse.js","webpack://PostItModeler/./node_modules/diagram-js/lib/util/Platform.js","webpack://PostItModeler/./node_modules/diagram-js/lib/features/interaction-events/InteractionEvents.js","webpack://PostItModeler/./node_modules/diagram-js/lib/features/interaction-events/index.js","webpack://PostItModeler/./node_modules/diagram-js/lib/features/outline/Outline.js","webpack://PostItModeler/./node_modules/diagram-js/lib/features/outline/index.js","webpack://PostItModeler/./node_modules/diagram-js/lib/features/selection/Selection.js","webpack://PostItModeler/./node_modules/diagram-js/lib/features/selection/SelectionVisuals.js","webpack://PostItModeler/./node_modules/diagram-js/lib/features/selection/SelectionBehavior.js","webpack://PostItModeler/./node_modules/diagram-js/lib/features/selection/index.js","webpack://PostItModeler/./node_modules/diagram-js/lib/util/IdGenerator.js","webpack://PostItModeler/./node_modules/diagram-js/lib/features/overlays/Overlays.js","webpack://PostItModeler/./node_modules/diagram-js/lib/features/overlays/index.js","webpack://PostItModeler/./lib/Viewer.js","webpack://PostItModeler/./node_modules/diagram-js/lib/features/keyboard/KeyboardUtil.js","webpack://PostItModeler/./node_modules/diagram-js/lib/features/keyboard/Keyboard.js","webpack://PostItModeler/./node_modules/diagram-js/lib/features/keyboard/KeyboardBindings.js","webpack://PostItModeler/./node_modules/diagram-js/lib/features/keyboard/index.js","webpack://PostItModeler/./node_modules/diagram-js/lib/navigation/keyboard-move/KeyboardMove.js","webpack://PostItModeler/./node_modules/diagram-js/lib/navigation/keyboard-move/index.js","webpack://PostItModeler/./node_modules/diagram-js/lib/util/Cursor.js","webpack://PostItModeler/./node_modules/diagram-js/lib/util/ClickTrap.js","webpack://PostItModeler/./node_modules/diagram-js/lib/util/PositionUtil.js","webpack://PostItModeler/./node_modules/diagram-js/lib/navigation/movecanvas/MoveCanvas.js","webpack://PostItModeler/./node_modules/diagram-js/lib/navigation/movecanvas/index.js","webpack://PostItModeler/./node_modules/diagram-js/lib/util/Math.js","webpack://PostItModeler/./node_modules/diagram-js/lib/navigation/zoomscroll/ZoomUtil.js","webpack://PostItModeler/./node_modules/diagram-js/lib/navigation/zoomscroll/ZoomScroll.js","webpack://PostItModeler/./node_modules/diagram-js/lib/navigation/zoomscroll/index.js","webpack://PostItModeler/./lib/NavigatedViewer.js","webpack://PostItModeler/./node_modules/diagram-js/lib/features/touch/TouchInteractionEvents.js","webpack://PostItModeler/./node_modules/diagram-js/lib/features/touch/TouchFix.js","webpack://PostItModeler/./node_modules/diagram-js/lib/features/touch/index.js","webpack://PostItModeler/./node_modules/diagram-js/lib/navigation/touch/index.js","webpack://PostItModeler/./node_modules/diagram-js/lib/features/align-elements/AlignElements.js","webpack://PostItModeler/./node_modules/diagram-js/lib/features/align-elements/index.js","webpack://PostItModeler/./node_modules/diagram-js/lib/features/hover-fix/HoverFix.js","webpack://PostItModeler/./node_modules/diagram-js/lib/features/hover-fix/index.js","webpack://PostItModeler/./node_modules/diagram-js/lib/features/dragging/Dragging.js","webpack://PostItModeler/./node_modules/diagram-js/lib/features/dragging/index.js","webpack://PostItModeler/./node_modules/diagram-js/lib/features/auto-scroll/AutoScroll.js","webpack://PostItModeler/./node_modules/diagram-js/lib/features/auto-scroll/index.js","webpack://PostItModeler/./node_modules/diagram-js/lib/features/rules/Rules.js","webpack://PostItModeler/./node_modules/diagram-js/lib/features/rules/index.js","webpack://PostItModeler/./node_modules/diagram-js/lib/util/Geometry.js","webpack://PostItModeler/./node_modules/diagram-js/lib/util/LineIntersection.js","webpack://PostItModeler/./node_modules/diagram-js/lib/features/bendpoints/BendpointUtil.js","webpack://PostItModeler/./node_modules/diagram-js/lib/features/bendpoints/Bendpoints.js","webpack://PostItModeler/./node_modules/diagram-js/lib/layout/LayoutUtil.js","webpack://PostItModeler/./node_modules/diagram-js/lib/features/bendpoints/BendpointMove.js","webpack://PostItModeler/./node_modules/diagram-js/lib/features/bendpoints/BendpointMovePreview.js","webpack://PostItModeler/./node_modules/diagram-js/lib/features/bendpoints/ConnectionSegmentMove.js","webpack://PostItModeler/./node_modules/diagram-js/lib/features/snapping/SnapUtil.js","webpack://PostItModeler/./node_modules/diagram-js/lib/features/bendpoints/BendpointSnapping.js","webpack://PostItModeler/./node_modules/diagram-js/lib/features/bendpoints/index.js","webpack://PostItModeler/./lib/util/ColorUtil.js","webpack://PostItModeler/./lib/features/canvas-create/CanvasCreate.js","webpack://PostItModeler/./node_modules/diagram-js-direct-editing/lib/TextBox.js","webpack://PostItModeler/./node_modules/diagram-js-direct-editing/lib/DirectEditing.js","webpack://PostItModeler/./node_modules/diagram-js-direct-editing/index.js","webpack://PostItModeler/./lib/features/canvas-create/index.js","webpack://PostItModeler/./node_modules/diagram-js/lib/features/connect/Connect.js","webpack://PostItModeler/./node_modules/diagram-js/lib/features/connect/ConnectPreview.js","webpack://PostItModeler/./node_modules/diagram-js/lib/features/connect/index.js","webpack://PostItModeler/./node_modules/diagram-js/lib/features/connection-preview/ConnectionPreview.js","webpack://PostItModeler/./node_modules/diagram-js/lib/features/connection-preview/index.js","webpack://PostItModeler/./node_modules/diagram-js/lib/features/context-pad/ContextPad.js","webpack://PostItModeler/./node_modules/diagram-js/lib/features/context-pad/index.js","webpack://PostItModeler/./node_modules/diagram-js/lib/features/preview-support/PreviewSupport.js","webpack://PostItModeler/./node_modules/diagram-js/lib/features/preview-support/index.js","webpack://PostItModeler/./node_modules/diagram-js/lib/features/create/Create.js","webpack://PostItModeler/./node_modules/diagram-js/lib/features/create/CreatePreview.js","webpack://PostItModeler/./node_modules/diagram-js/lib/features/create/index.js","webpack://PostItModeler/./node_modules/diagram-js/lib/features/popup-menu/PopupMenu.js","webpack://PostItModeler/./node_modules/diagram-js/lib/features/popup-menu/index.js","webpack://PostItModeler/./node_modules/diagram-js/lib/features/clipboard/Clipboard.js","webpack://PostItModeler/./node_modules/diagram-js/lib/features/clipboard/index.js","webpack://PostItModeler/./node_modules/diagram-js/lib/features/mouse/Mouse.js","webpack://PostItModeler/./node_modules/diagram-js/lib/features/mouse/index.js","webpack://PostItModeler/./node_modules/diagram-js/lib/features/copy-paste/CopyPaste.js","webpack://PostItModeler/./node_modules/diagram-js/lib/features/copy-paste/index.js","webpack://PostItModeler/./lib/features/copy-paste/PostitCopyPaste.js","webpack://PostItModeler/./lib/features/copy-paste/ModdleCopy.js","webpack://PostItModeler/./lib/features/copy-paste/index.js","webpack://PostItModeler/./node_modules/diagram-js/lib/features/replace/Replace.js","webpack://PostItModeler/./node_modules/diagram-js/lib/features/replace/index.js","webpack://PostItModeler/./lib/features/replace/PostitReplace.js","webpack://PostItModeler/./lib/features/replace/index.js","webpack://PostItModeler/./lib/features/popup-menu/ReplaceMenuProvider.js","webpack://PostItModeler/./lib/features/popup-menu/index.js","webpack://PostItModeler/./lib/features/context-pad/ContextPadProvider.js","webpack://PostItModeler/./lib/features/context-pad/index.js","webpack://PostItModeler/./node_modules/diagram-js/lib/features/editor-actions/EditorActions.js","webpack://PostItModeler/./node_modules/diagram-js/lib/features/editor-actions/index.js","webpack://PostItModeler/./lib/features/editor-actions/PostitEditorActions.js","webpack://PostItModeler/./lib/features/editor-actions/index.js","webpack://PostItModeler/./lib/util/FileUtil.js","webpack://PostItModeler/./lib/util/ScreenUtil.js","webpack://PostItModeler/./lib/features/image-selection/ImageSelection.js","webpack://PostItModeler/./lib/features/image-selection/index.js","webpack://PostItModeler/./lib/features/keyboard/PostitKeyboardBindings.js","webpack://PostItModeler/./lib/features/keyboard/index.js","webpack://PostItModeler/./node_modules/diagram-js/lib/features/keyboard-move-selection/KeyboardMoveSelection.js","webpack://PostItModeler/./node_modules/diagram-js/lib/features/keyboard-move-selection/index.js","webpack://PostItModeler/./node_modules/diagram-js/lib/features/change-support/ChangeSupport.js","webpack://PostItModeler/./node_modules/diagram-js/lib/features/change-support/index.js","webpack://PostItModeler/./node_modules/diagram-js/lib/features/resize/ResizeUtil.js","webpack://PostItModeler/./node_modules/diagram-js/lib/features/resize/Resize.js","webpack://PostItModeler/./node_modules/diagram-js/lib/features/resize/ResizePreview.js","webpack://PostItModeler/./node_modules/diagram-js/lib/features/resize/ResizeHandles.js","webpack://PostItModeler/./node_modules/diagram-js/lib/features/resize/index.js","webpack://PostItModeler/./lib/features/label-editing/LabelEditingProvider.js","webpack://PostItModeler/./lib/features/label-editing/LabelEditingPreview.js","webpack://PostItModeler/./lib/features/label-editing/index.js","webpack://PostItModeler/./node_modules/diagram-js/lib/command/CommandInterceptor.js","webpack://PostItModeler/./lib/features/modeling/behavior/AdaptiveLabelPositioningBehavior.js","webpack://PostItModeler/./lib/features/modeling/behavior/AppendBehavior.js","webpack://PostItModeler/./lib/features/modeling/behavior/FixHoverBehavior.js","webpack://PostItModeler/./lib/features/modeling/behavior/util/LineIntersect.js","webpack://PostItModeler/./lib/features/modeling/behavior/ImportDockingFix.js","webpack://PostItModeler/./lib/features/modeling/behavior/util/GeometricUtil.js","webpack://PostItModeler/./lib/features/modeling/behavior/util/LineAttachmentUtil.js","webpack://PostItModeler/./lib/features/modeling/behavior/util/LabelLayoutUtil.js","webpack://PostItModeler/./node_modules/diagram-js/lib/util/AttachUtil.js","webpack://PostItModeler/./lib/features/modeling/behavior/LabelBehavior.js","webpack://PostItModeler/./lib/features/modeling/behavior/ReplaceElementBehaviour.js","webpack://PostItModeler/./lib/features/modeling/behavior/UnclaimIdBehavior.js","webpack://PostItModeler/./lib/features/modeling/behavior/CreateBoardElementBehavior.js","webpack://PostItModeler/./lib/features/modeling/behavior/EmptyTextBoxBehavior.js","webpack://PostItModeler/./lib/features/modeling/behavior/index.js","webpack://PostItModeler/./node_modules/diagram-js/lib/features/rules/RuleProvider.js","webpack://PostItModeler/./lib/features/rules/PostitRules.js","webpack://PostItModeler/./lib/features/rules/index.js","webpack://PostItModeler/./lib/features/di-ordering/PostitDiOrdering.js","webpack://PostItModeler/./lib/features/di-ordering/index.js","webpack://PostItModeler/./node_modules/diagram-js/lib/features/ordering/OrderingProvider.js","webpack://PostItModeler/./lib/features/ordering/PostitOrderingProvider.js","webpack://PostItModeler/./lib/features/ordering/index.js","webpack://PostItModeler/./node_modules/diagram-js/lib/command/CommandStack.js","webpack://PostItModeler/./node_modules/diagram-js/lib/command/index.js","webpack://PostItModeler/./node_modules/diagram-js/lib/features/tooltips/Tooltips.js","webpack://PostItModeler/./node_modules/diagram-js/lib/features/tooltips/index.js","webpack://PostItModeler/./node_modules/diagram-js/lib/util/Removal.js","webpack://PostItModeler/./node_modules/diagram-js/lib/features/label-support/LabelSupport.js","webpack://PostItModeler/./node_modules/diagram-js/lib/features/label-support/index.js","webpack://PostItModeler/./node_modules/diagram-js/lib/features/attach-support/AttachSupport.js","webpack://PostItModeler/./node_modules/diagram-js/lib/features/attach-support/index.js","webpack://PostItModeler/./node_modules/diagram-js/lib/features/tool-manager/ToolManager.js","webpack://PostItModeler/./node_modules/diagram-js/lib/features/tool-manager/index.js","webpack://PostItModeler/./node_modules/diagram-js/lib/features/space-tool/SpaceUtil.js","webpack://PostItModeler/./node_modules/diagram-js/lib/features/space-tool/SpaceTool.js","webpack://PostItModeler/./node_modules/diagram-js/lib/features/space-tool/SpaceToolPreview.js","webpack://PostItModeler/./node_modules/diagram-js/lib/features/space-tool/index.js","webpack://PostItModeler/./lib/features/modeling/PostitFactory.js","webpack://PostItModeler/./lib/features/modeling/PostitUpdater.js","webpack://PostItModeler/./lib/features/modeling/ElementFactory.js","webpack://PostItModeler/./node_modules/diagram-js/lib/features/modeling/cmd/AlignElementsHandler.js","webpack://PostItModeler/./node_modules/diagram-js/lib/features/modeling/cmd/AppendShapeHandler.js","webpack://PostItModeler/./node_modules/diagram-js/lib/features/modeling/cmd/CreateConnectionHandler.js","webpack://PostItModeler/./node_modules/diagram-js/lib/features/modeling/cmd/CreateElementsHandler.js","webpack://PostItModeler/./node_modules/diagram-js/lib/features/modeling/cmd/CreateShapeHandler.js","webpack://PostItModeler/./node_modules/diagram-js/lib/features/modeling/cmd/CreateLabelHandler.js","webpack://PostItModeler/./node_modules/diagram-js/lib/features/modeling/cmd/DeleteConnectionHandler.js","webpack://PostItModeler/./node_modules/diagram-js/lib/features/modeling/cmd/DeleteElementsHandler.js","webpack://PostItModeler/./node_modules/diagram-js/lib/features/modeling/cmd/DeleteShapeHandler.js","webpack://PostItModeler/./node_modules/diagram-js/lib/features/modeling/cmd/DistributeElementsHandler.js","webpack://PostItModeler/./node_modules/diagram-js/lib/features/modeling/cmd/LayoutConnectionHandler.js","webpack://PostItModeler/./node_modules/diagram-js/lib/features/modeling/cmd/MoveConnectionHandler.js","webpack://PostItModeler/./node_modules/diagram-js/lib/features/modeling/cmd/helper/AnchorsHelper.js","webpack://PostItModeler/./node_modules/diagram-js/lib/features/modeling/cmd/helper/MoveClosure.js","webpack://PostItModeler/./node_modules/diagram-js/lib/features/modeling/cmd/helper/MoveHelper.js","webpack://PostItModeler/./node_modules/diagram-js/lib/features/modeling/cmd/MoveElementsHandler.js","webpack://PostItModeler/./node_modules/diagram-js/lib/features/modeling/cmd/MoveShapeHandler.js","webpack://PostItModeler/./node_modules/diagram-js/lib/features/modeling/cmd/ReconnectConnectionHandler.js","webpack://PostItModeler/./node_modules/diagram-js/lib/features/modeling/cmd/ReplaceShapeHandler.js","webpack://PostItModeler/./node_modules/diagram-js/lib/features/modeling/cmd/ResizeShapeHandler.js","webpack://PostItModeler/./node_modules/diagram-js/lib/features/modeling/cmd/SpaceToolHandler.js","webpack://PostItModeler/./node_modules/diagram-js/lib/features/modeling/cmd/ToggleShapeCollapseHandler.js","webpack://PostItModeler/./node_modules/diagram-js/lib/features/modeling/cmd/UpdateAttachmentHandler.js","webpack://PostItModeler/./node_modules/diagram-js/lib/features/modeling/cmd/UpdateWaypointsHandler.js","webpack://PostItModeler/./node_modules/diagram-js/lib/features/modeling/Modeling.js","webpack://PostItModeler/./lib/features/modeling/cmd/UpdatePropertiesHandler.js","webpack://PostItModeler/./lib/features/modeling/cmd/UpdateCanvasRootHandler.js","webpack://PostItModeler/./lib/features/modeling/cmd/IdClaimHandler.js","webpack://PostItModeler/./lib/features/modeling/cmd/SetColorHandler.js","webpack://PostItModeler/./lib/features/label-editing/cmd/UpdateLabelHandler.js","webpack://PostItModeler/./lib/features/modeling/Modeling.js","webpack://PostItModeler/./node_modules/diagram-js/lib/layout/BaseLayouter.js","webpack://PostItModeler/./node_modules/diagram-js/lib/layout/CroppingConnectionDocking.js","webpack://PostItModeler/./lib/features/modeling/index.js","webpack://PostItModeler/./node_modules/diagram-js/lib/features/move/Move.js","webpack://PostItModeler/./node_modules/diagram-js/lib/features/move/MovePreview.js","webpack://PostItModeler/./node_modules/diagram-js/lib/features/move/index.js","webpack://PostItModeler/./node_modules/diagram-js/lib/features/palette/Palette.js","webpack://PostItModeler/./node_modules/diagram-js/lib/features/palette/index.js","webpack://PostItModeler/./node_modules/diagram-js/lib/features/lasso-tool/LassoTool.js","webpack://PostItModeler/./node_modules/diagram-js/lib/features/lasso-tool/index.js","webpack://PostItModeler/./node_modules/diagram-js/lib/features/hand-tool/HandTool.js","webpack://PostItModeler/./node_modules/diagram-js/lib/features/hand-tool/index.js","webpack://PostItModeler/./lib/features/palette/PaletteProvider.js","webpack://PostItModeler/./lib/features/palette/index.js","webpack://PostItModeler/./lib/features/replace-preview/PostitReplacePreview.js","webpack://PostItModeler/./lib/features/replace-preview/index.js","webpack://PostItModeler/./node_modules/diagram-js/lib/features/snapping/SnapContext.js","webpack://PostItModeler/./node_modules/diagram-js/lib/features/snapping/CreateMoveSnapping.js","webpack://PostItModeler/./lib/features/snapping/PostitCreateMoveSnapping.js","webpack://PostItModeler/./node_modules/diagram-js/lib/features/snapping/ResizeSnapping.js","webpack://PostItModeler/./node_modules/diagram-js/lib/features/snapping/Snapping.js","webpack://PostItModeler/./node_modules/diagram-js/lib/features/snapping/index.js","webpack://PostItModeler/./lib/features/snapping/index.js","webpack://PostItModeler/./lib/Modeler.js","webpack://PostItModeler/./lib/index.js","webpack://PostItModeler/./node_modules/css.escape/css.escape.js","webpack://PostItModeler/./node_modules/hammerjs/hammer.js","webpack://PostItModeler/./node_modules/inherits/inherits_browser.js","webpack://PostItModeler/./node_modules/object-refs/index.js","webpack://PostItModeler/./node_modules/object-refs/lib/collection.js","webpack://PostItModeler/./node_modules/object-refs/lib/refs.js","webpack://PostItModeler/./node_modules/path-intersection/intersect.js","webpack://PostItModeler/webpack/bootstrap","webpack://PostItModeler/webpack/runtime/compat get default export","webpack://PostItModeler/webpack/runtime/define property getters","webpack://PostItModeler/webpack/runtime/global","webpack://PostItModeler/webpack/runtime/hasOwnProperty shorthand","webpack://PostItModeler/webpack/runtime/make namespace object","webpack://PostItModeler/webpack/startup"],"names":["root","factory","exports","module","define","amd","self","hat_1","fn","hat","bits","base","undefined","digits","Math","log","pow","i","Infinity","rem","floor","res","random","toString","b","parsed","parseInt","rack","expandBy","data","iters","Error","id","Object","hasOwnProperty","call","hats","get","set","value","createCommonjsModule","Ids","seed","this","_seed","length","prototype","next","element","nextPrefixed","prefix","assigned","claim","unclaim","clear","flatten","arr","Array","concat","apply","nativeToString","nativeHasOwnProperty","isUndefined","obj","isDefined","isNil","isArray","isObject","isNumber","isFunction","tag","isString","has","target","key","find","collection","matcher","match","toMatcher","forEach","val","filter","result","push","iterator","convertKey","toNum","identity","reduce","idx","matches","map","keys","size","values","groupBy","extractor","grouped","arguments","toExtractor","discriminator","group","uniqueBy","_len","collections","_key","c","unionBy","sortBy","sorted","disc","entry","d","v","splice","e","matchPattern","pattern","el","arg","Number","debounce","timeout","timer","lastArgs","lastThis","lastNow","fire","now","Date","scheduledDiff","schedule","setTimeout","args","bind","_extends","assign","source","others","pick","properties","prop","omit","indexOf","attr","name","getAttribute","removeAttribute","setAttribute","indexof","re","ClassList","nodeType","list","classList","childNodes","removeChild","add","array","className","join","remove","removeMatching","test","toggle","force","replace","split","shift","contains","proto","Element","vendor","matchesSelector","webkitMatchesSelector","mozMatchesSelector","msMatchesSelector","oMatchesSelector","selector","nodes","parentNode","querySelectorAll","closest","checkYourSelf","currentElem","document","DOCUMENT_NODE","DOCUMENT_FRAGMENT_NODE","bugTestDiv","window","addEventListener","unbind","removeEventListener","componentEvent","type","capture","forceCaptureEvents","delegate","srcElement","delegateTarget","domify","html","doc","TypeError","m","exec","createTextNode","createElement","innerHTML","lastChild","wrap","_default","depth","suffix","firstChild","fragment","createDocumentFragment","appendChild","innerHTMLBug","getElementsByTagName","legend","tr","col","query","querySelector","appendTo","ownerDocument","importNode","ensureImported","append","node","td","th","option","optgroup","thead","tbody","colgroup","caption","tfoot","polyline","ellipse","polygon","circle","text","line","path","rect","g","CSS_PROPERTIES","hyphenated","toLowerCase","String","style","setAttributeNS","getAttributeNS","attrs","names","setAttributes","index","defined","o","classes","parent","child","clone","cloneNode","baseVal","ns","SVG_START","svg","unwrap","substring","parser","DOMParser","async","parseFromString","parseDocument","charAt","createElementNS","extend","object","props","k","matrix","createSVGTransformFromMatrix","createSVGTransform","TEXT_ENTITIES","ATTR_ENTITIES","ENTITY_REPLACEMENT","str","entity","serialize","output","len","attrMap","attrNode","textContent","tagName","hasAttributes","attributes","item","hasChildNodes","nodeValue","innerSVG","nodeName","isFragment","documentElement","slice","message","nextSibling","wrapMatrix","transformList","transform","SVGMatrix","transforms","t","appendItem","setTransforms","consolidate","CLASS_PATTERN","hasOwnProp","annotate","pop","$inject","CONSTRUCTOR_ARGS","FN_ARGS","FN_ARG","parseAnnotations","isClass","trim","Module","providers","Injector","modules","strict","currentlyResolving","error","_providers","create","instances","_instances","injector","msg","stack","parts","pivot","fnDef","locals","dependencies","dep","instantiate","Type","def","Function","invoke","func","context","createPrivateInjectorFactory","privateChildInjector","factoryMap","arrayUnwrap","provider","__exports__","clonedModule","privateInjector","__modules__","getFromPrivateInjector","createChild","forceNewInstances","cacheIdx","privateChildInjectorFactory","fromParentModule","matchedScopes","privateInjectorsCache","privateChildInjectors","privateChildFactories","$scope","scope","unshift","BaseRenderer","eventBus","renderPriority","on","evt","visuals","gfx","canRender","drawShape","drawConnection","getShapePath","getConnectionPath","elements","toSVGPoints","points","p","x","y","createLine","getParents","getParent","unique","canAdd","eachElement","s","selfAndAllChildren","allowDuplicates","maxDepth","processedChildren","children","selfAndChildren","getBBox","stopRecursion","minX","minY","maxX","maxY","bbox","waypoints","height","width","getType","isFrameElement","isFrame","copyObject","src1","src2","DefaultRenderer","styles","CONNECTION_STYLE","strokeWidth","stroke","SHAPE_STYLE","fill","FRAME_STYLE","strokeDasharray","connection","shape","point","connectionPath","original","__init__","defaultRenderer","defaultTraits","strokeOpacity","pointerEvents","cls","traits","additionalAttrs","computeStyle","custom","defaultStyles","currentIdx","round","number","resolution","ensurePx","createGroup","childIndex","insertBefore","REQUIRED_MODEL_ATTRS","Canvas","config","graphicsFactory","elementRegistry","_eventBus","_elementRegistry","_graphicsFactory","_init","setCTM","mstr","a","f","container","_container","options","body","position","overflow","createContainer","_svg","viewport","_viewport","_layers","deferUpdate","_viewboxChanged","_cachedViewbox","_destroy","_clear","emit","_rootElement","getAll","setRootElement","_removeElement","getDefaultLayer","getLayer","layer","_createLayer","getContainer","_updateMarker","marker","_elements","secondaryGfx","addMarker","removeMarker","hasMarker","getGraphics","toggleMarker","getRootElement","override","_ensureValid","currentRoot","requiredAttrs","_setParent","parentIndex","_addElement","update","addShape","addConnection","removeShape","removeConnection","secondary","_changeViewbox","changeFn","viewbox","box","innerBox","scale","outerBox","getSize","min","createSVGMatrix","translate","createMatrix","inner","outer","scroll","delta","getCTM","dx","dy","multiply","zoom","newScale","center","_fitViewport","_setZoom","newViewbox","vbox","max","originalPoint","currentMatrix","scaleMatrix","newMatrix","createSVGPoint","currentScale","matrixTransform","inverse","clientWidth","clientHeight","getAbsoluteBBox","resized","ELEMENT_ID","ElementRegistry","_validateId","updateId","newId","filtered","parentRefs","enumerable","labelRefs","attacherRefs","outgoingRefs","incomingRefs","Base","defineProperty","writable","labels","newLabel","label","Shape","Root","Label","Connection","types","ElementFactory","_uid","createRoot","createLabel","createShape","createConnection","EventBus","_listeners","InternalEvent","getVisual","setTranslate","GraphicsFactory","newNode","siblingNode","events","priority","callback","that","actualCallback","_addListener","once","event","wrappedCallback","__isTomb","off","_removeListener","createEvent","init","firstListener","returnValue","originalType","_invokeListeners","defaultPrevented","handleError","listener","cancelBubble","_invokeListener","invokeFunction","stopPropagation","preventDefault","console","newListener","previousListener","_getListeners","_setListeners","nextListener","listenerCallback","_getChildrenContainer","childrenGfx","getChildren","visual","_createContainer","outerGfx","updateContainments","reverse","hidden","__depends__","canvas","elementFactory","Diagram","bootstrapModules","components","hasModule","visit","addModule","bootstrap","createInjector","Factory","model","destroy","$model","createType","descriptor","isMany","default","defineModel","defineDescriptor","ModdleElement","hasType","$instanceOf","BUILTINS","Boolean","Integer","Real","TYPE_CONVERTERS","parseFloat","coerceType","converter","isBuiltIn","isSimple","parseName","defaultPrefix","localName","DescriptorBuilder","nameNs","allTypes","allTypesByName","propertiesByName","Registry","packages","packageMap","typeMap","registerPackage","ensureAvailable","pkg","identifierKey","Properties","property","isReference","configurable","Moddle","registry","typeCache","build","addProperty","validate","addNamedProperty","replaceProperty","oldProperty","newProperty","oldNameNs","rename","isId","setIdProperty","isBody","setBodyProperty","redefineProperty","targetPropertyName","nsPrefix","attrName","redefinedProperty","redefines","propsByName","assertNotDefined","removeNamedProperty","bodyProperty","idProperty","propertyName","definedProperty","definedBy","hasProperty","addTrait","inherited","typesByName","typeName","replaces","getPackage","uriOrPrefix","getPackages","pkgMap","registerType","uri","superClass","extends","meta","propertyNs","extendsName","extended","definePackage","mapTypes","nsName","trait","traverseTrait","traverseSuper","parentNs","getEffectiveDescriptor","builder","$pkg","getPropertyDescriptor","$attrs","cache","createAny","nsUri","$type","isGeneric","getElementDescriptor","$descriptor","getTypeDescriptor","fromCharCode","ENTITY_PATTERN","ENTITY_MAPPING","replaceEntities","_","z","decodeEntities","toUpperCase","XSI_TYPE","NON_WHITESPACE_OUTSIDE_ROOT_NODE","missingNamespaceForPrefix","getter","getFn","cloneNsMatrix","nsMatrix","uriPrefix","noopGetContext","throwFunc","err","Parser","onText","onOpenTag","onCloseTag","onCDATA","onWarning","onComment","onQuestion","onAttention","nsUriToPrefix","proxy","onError","getContext","maybeNS","isNamespace","returnError","parseStop","handleWarning","cb","nsMap","_nsUriToPrefix","xml","_nsMatrix","q","w","xmlns","elementName","_elementName","elementProxy","cachedAttrs","nsMatrixStack","buildNsMatrix","nodeStack","anonymousNsCount","tagStart","tagEnd","j","attrsString","attrsStart","getAttrs","nsUriPrefix","hasNewMatrix","newalias","alias","skipAttr","defaultAlias","attrList","l","seenAttrs","parseAttr","charCodeAt","substr","splitsRe","column","startOfLine","endOfLine","isNaN","parse","hasLowerCaseAlias","tagAlias","DEFAULT_NS_MAP","serializeFormat","serializeAsType","aliasToName","aliasNs","getModdleDescriptor","Context","elementsById","references","warnings","addReference","reference","addElement","addWarning","warning","BaseHandler","NoopHandler","BodyHandler","ReferenceHandler","ValueHandler","propertyDesc","BaseElementHandler","ElementHandler","RootElementHandler","GenericElementHandler","Reader","lax","handleEnd","handleText","handleNode","createReference","handleChild","propNameNs","instance","getPropertyForNode","elementTypeName","elementType","isAttr","typePrefix","prefixedToName","normalizeXsiTypeName","effectiveType","isVirtual","isAttribute","valueHandler","referenceHandler","handler","childHandler","newElement","$parent","originalName","$children","$body","fromXML","done","rootHandler","createStack","ctx","PREAMBLE_START_PATTERN","ENCODING_PATTERN","UTF_8_PATTERN","handleCData","peek","uriMap","decodeStr","selfClosing","decodedAttrs","handleOpen","question","encoding","Promise","resolve","reject","r","resolveReferences","rootElement","ESCAPE_ATTR_CHARS","ESCAPE_CHARS","Namespaces","prefixMap","used","wellknown","byUri","isWellknown","mapPrefix","uriByPrefix","getNSKey","logUsed","nsKey","getUsed","inherits","ctor","superCtor","super_","constructor","ESCAPE_ATTR_MAP","'","ESCAPE_MAP","charPattern","replaceMap","ReferenceSerializer","BodySerializer","ValueSerializer","ElementSerializer","propertyDescriptor","TypeSerializer","SavingWriter","write","FormatingWriter","out","format","indent","appendNewLine","appendIndent","unindent","Writer","preamble","toXML","tree","writer","internalWriter","formatingWriter","serializeTo","PostitModdle","serializeValue","escape","search","otherAttrs","elementDescriptor","parseGeneric","parseNsAttributes","nsPropertyTagName","nsTagName","addTagName","getSerializableProperties","parseAttributes","parseContainments","parseGenericAttributes","string","getElementNs","logNamespaceUsed","getPropertyNs","isLocalNs","nsAttributeName","effectiveNs","getNamespaces","parseNsAttribute","logNamespace","actualNs","genericAttrs","nonNsAttr","addAttribute","warn","asType","asProperty","serializeAsProperty","serializer","local","parentNamespaces","namespaces","existing","newPrefix","wellknownUri","serializeAttributes","getNsAttrs","firstBody","typeNs","xmlStr","reader","postit","postitDi","dc","additionalPackages","elementToString","diRefs","is","PostitTreeWalker","handledElements","deferred","logError","handled","registerDi","di","boardElement","handlePlaneElement","planeElement","handleDeferred","handleDefinitions","definitions","rootBoard","rootBoards","diagram","plane","handleBoard","rootElements","findDisplayCandidate","board","boardElements","visitIfDi","handleBoardElements","BPMNIO_IMG","encodeURIComponent","css","lightbox","LIGHTBOX_MARKUP","BaseViewer","linkElement","DEFAULT_OPTIONS","_moddle","_createModdle","addWarningsToError","warningsAry","importXML","_emit","then","parseWarnings","importDefinitions","allWarnings","catch","checkValidationError","_setDefinitions","open","rootBoardOrId","_definitions","rootBord","err1","boardId","findRootBoard","err2","importer","parentShape","render","importPostitDiagram","saveXML","saveSVG","contentNode","defsNode","contents","defs","getModules","_modules","getDefinitions","bo","businessObject","attachTo","detach","jquery","moddle","baseModules","additionalModules","diagramModules","postitjs","diagramOptions","ensureUnit","_moddleExtensions","moddleExtensions","BaseModeler","_collectIds","ids","getBusinessObject","isAny","getLabelAttr","semantic","getLabel","getDi","getFillColor","defaultColor","getColor","getStrokeColor","color","PostitRenderer","pathMap","textRenderer","defaultFillColor","defaultStrokeColor","drawRect","parentGfx","offset","rx","ry","renderLabel","createText","renderEmbeddedLabel","align","fontSize","getSemantic","padding","handlers","fillOpacity","cx","cy","drawCircle","textSize","getImageSource","href","fitBox","getExternalStyle","renderExternalLabel","_drawPath","h","DEFAULT_LABEL_SIZE","getTextBBox","fakeText","textBBox","emptyLine","layoutNext","lines","maxWidth","originalLine","fitLine","fit","shortenLine","remainder","shortenedLine","maxLength","part","shortenedParts","last","semanticShorten","Text","_config","TextRenderer","defaultStyle","fontFamily","fontWeight","lineHeight","externalStyle","textUtil","getExternalLabelBounds","bounds","layoutedDimensions","getDimensions","ceil","getDefaultStyle","layoutText","dimensions","helperSvg","horizontal","vertical","parseAlign","top","left","right","bottom","parsePadding","getLineHeight","layouted","helperText","getElementById","totalHeight","sum","maxLineWidth","textElement","tspan","tokenRegex","objNotationRegex","postitRenderer","heightElements","widthElements","getRawPath","pathId","getScaledPath","param","mx","my","rawPath","abspos","containerWidth","containerHeight","coordinates","heightRatio","yScaleFactor","widthRatio","xScaleFactor","heightIndex","widthIndex","all","quote","quotedName","isFunc","replacer","template","replacements","isLabelExternal","hasExternalLabel","isLabel","getExternalLabelMid","labelTarget","elementData","notYetDrawn","refSemantic","referenced","PostitImporter","_canvas","_elementFactory","_translate","_textRenderer","parentElement","collapsed","addLabel","_attachBoundary","boundarySemantic","boundaryElement","hostSemantic","attachedToRef","host","attachers","mid","_getEnd","side","_getElement","_getSource","_getTarget","postitImporter","__stopPropagation","getOriginal","originalEvent","srcEvent","immediate","toPoint","pointers","touches","clientX","clientY","isButton","button","isPrimaryButton","hasPrimaryModifier","navigator","platform","metaKey","ctrlKey","hasSecondaryModifier","shiftKey","allowAll","allowPrimaryAndAuxiliary","isAuxiliaryButton","InteractionEvents","localEventName","ignoredFilters","isIgnored","mouseHandler","bindings","click","contextmenu","dblclick","mousedown","mousemove","mouseover","mouseout","mouseup","registerEvent","localEvent","ignoredFilter","$delegate","unregisterEvent","createDefaultHit","updateDefaultHit","STROKE_HIT_STYLE","createHitStyle","CLICK_STROKE_HIT_STYLE","HIT_TYPES","classNames","applyStyle","hit","appendHit","removeHits","boxType","createWaypointsHit","createBoxHit","updateLine","triggerMouseEvent","eventName","targetElement","interactionEvents","Outline","OUTLINE_STYLE","createOutline","outline","updateShapeOutline","updateConnectionOutline","Selection","_selectedElements","deselect","select","selectedElements","oldSelection","newSelection","isSelected","MARKER_HOVER","MARKER_SELECTED","SelectionVisuals","selection","_multiSelectionBox","SelectionBehavior","canExecute","autoSelect","hints","isShown","hover","previousSelection","selectedShape","isMultiSelect","selectionVisuals","selectionBehavior","IdGenerator","_counter","_prefix","Overlays","_ids","_overlayDefaults","show","defaults","_overlays","_overlayContainers","_overlayRoot","setPosition","setVisible","visible","display","setTransform","_getOverlayContainer","overlays","overlay","_addOverlay","htmlContainer","hide","_updateOverlayContainer","_updateOverlay","_createOverlayContainer","_updateRoot","raw","overlayContainer","_updateOverlayVisibilty","minZoom","maxZoom","_updateOverlayScale","minScale","maxScale","shouldScale","_updateOverlaysVisibilty","Viewer","isCmd","altKey","isKey","keyCode","isShift","KEYDOWN_EVENT","Keyboard","_keydownHandler","_keyupHandler","_fire","bindTo","_keyHandler","contentEditable","keyEvent","_node","getBinding","addListener","removeListener","hasModifier","KEYS_COPY","KEYS_PASTE","KEYS_REDO","KEYS_UNDO","KeyboardBindings","keyboard","editorActions","registerBindings","action","isRegistered","trigger","keyboardBindings","DEFAULT_CONFIG","moveSpeed","moveSpeedAccelerated","KeyboardMove","direction","speed","moveCanvas","opts","actualSpeed","sqrt","keyboardMove","CURSOR_CLS_PATTERN","mode","unset","install","trap","MoveCanvas","handleMove","start","dragging","handleStart","isActive","log10","getStepSize","range","steps","minLinearRange","maxLinearRange","abs","sign","n","RANGE","ZoomScroll","_enabled","_handleWheel","_totalDelta","_scale","enabled","reset","stepSize","NUM_STEPS","_zoom","isZoom","isHorizontalScroll","factor","deltaMode","elementRect","getBoundingClientRect","deltaY","deltaX","stepZoom","currentLinearZoomLevel","newLinearZoomLevel","newLogZoomLevel","newEnabled","handleWheel","oldEnabled","zoomScroll","NavigatedViewer","_navigationModules","mouseEvents","service","stopEvent","stopImmediatePropagation","createTouchRecognizer","allowMouse","recognizer","inputClass","recognizers","domEvents","tap","pan","threshold","press","pinch","doubleTap","taps","requireFailure","session","stopped","stop","state","curRecognizer","TouchInteractionEvents","move","contextPad","palette","getGfx","MouseEvent","elementFromPoint","hoverGfx","padRecognizer","pad","startGrab","lx","ly","end","startGrabCanvas","ratio","newZoom","initEvents","TouchFix","addBBoxMarker","markerStyle","class","rect1","rect2","touchInteractionEvents","touchFix","sortTopOrMiddle","sortLeftOrCenter","ALIGNMENT_SORTING","middle","AlignElements","modeling","_modeling","_getOrientationDetails","axis","dimension","_isType","_alignmentPosition","sortedElements","centeredElements","firstElement","lastElement","orientation","alignment","centers","hasSharedCenters","first","getMiddleOrTop","filteredElements","alignElements","HoverFix","_findTargetGfx","ensureHover","hoverFix","DRAG_ACTIVE_CLS","Dragging","defaultOptions","trapClick","toLocalPoint","globalPosition","clientRect","dragContext","payload","isTouch","activate","displacement","globalStart","globalCurrent","globalDelta","localStart","localCurrent","localDelta","active","cancel","keepSelection","cursor","cleanup","checkCancel","which","trapClickAndEnd","untrap","trapTouch","restore","previousContext","wasActive","endDrag","existingSelection","restoreSelection","relativeTo","TouchEvent","isTouchEvent","manual","autoActivate","setOptions","AutoScroll","_opts","scrollThresholdIn","scrollThresholdOut","scrollRepeatTimeout","scrollStep","_toBorderPoint","startScroll","stopScroll","diff","_scrolling","clearTimeout","autoScroll","Rules","_commandStack","allowed","commandStack","rules","pointDistance","pointsOnLine","accuracy","dist","pointsAligned","firstPoint","pointsAlignedHorizontally","pointsAlignedVertically","getMidPoint","getConnectionIntersection","bendpoint","getBendpointIntersection","segments","intersections","circlePath","segment2","getPathIntersection","getApproxIntersection","toCanvasCoordinates","addBendpoint","groupGfx","addSegmentDragger","segmentStart","segmentEnd","draggerGfx","hitWidth","segmentLengthXAxis","segmentLengthYAxis","calculateSegmentMoveRegion","calculateHitWidth","angle","rotate","setRotate","createParallelDragger","segmentLength","Bendpoints","bendpointMove","connectionSegmentMove","bindInteractionEvents","getBendpointsContainer","getSegmentDragger","createBendpoints","createSegmentDraggers","segmentDraggerGfx","addHandles","updateHandles","clearSegmentDraggers","clearBendpoints","bendpointsGfx","intersection","floating","updateFloatingBendpointPosition","draggerVisual","relativePosition","getDraggerVisual","updateSegmentDraggerPosition","treshold","p0","p1","aligned","xDelta","yDelta","isIntersectionMiddle","relevantSegment","calculateIntersectionThreshold","activateBendpointMove","primary","bendpointContainer","roundPoint","asTRBL","asBounds","trbl","getMid","getOrientation","rectOrientation","referenceOrientation","getElementLineIntersection","elementPath","linePath","cropStart","distance","t2","RECONNECT_START","RECONNECT_END","UPDATE_WAYPOINTS","BendpointMove","_injector","bendpointIndex","insert","command","connectionGfx","newWaypoints","docking","cropWaypoints","updateWaypoints","previousPoint","nextPoint","filterRedundantWaypoints","isReverse","reconnect","connectionDocking","getCroppedWaypoints","MARKER_OK","MARKER_NOT_OK","MARKER_CONNECT_HOVER","MARKER_CONNECT_UPDATING","MARKER_ELEMENT_HIDDEN","BendpointMovePreview","connectionPreview","drawPreviewHints","connectionStart","connectionEnd","noCropping","noLayout","drawPreview","cleanUp","axisAdd","axisSet","flipAxis","getDocking","referenceElement","moveAxis","referenceMid","inverseAxis","ConnectionSegmentMove","cropConnection","croppedWaypoints","oldWaypoints","redrawConnection","dragPosition","segmentStartIndex","segmentEndIndex","originalWaypoints","sourceToSegmentOrientation","targetToSegmentOrientation","newSegmentStart","newSegmentEnd","waypointCount","segmentOffset","maxValue","minValue","draggerPosition","updateDragger","newSegmentStartIndex","segmentMove","defaultValue","isSnapped","snapped","setSnapped","previousValue","BendpointSnapping","snapTo","sx","sy","snapPoints","referenceWaypoints","getConnectionSegmentSnaps","getBendpointSnaps","hoverMid","bendpoints","bendpointMovePreview","bendpointSnapping","GREEN","PINK","ICE_BLUE","BLUE","ORANGE","YELLOW","BLACK","DEFAULT_SHAPE","CanvasCreate","directEditing","lastCreatedShape","eventPoint","_getNewShapePosition","newShape","createPostitElement","_createShapeOnCanvas","_saveLastCreatedShape","TextBox","content","keyHandler","resizeHandler","autoResize","handlePaste","DirectEditing","_textbox","_handleKey","_handleResize","parentStyle","maxHeight","minWidth","minHeight","backgroundColor","border","boxSizing","wordWrap","textAlign","contentStyle","centerVertically","innerText","resizable","setSelection","clipboardData","getData","insertText","hasResized","execCommand","_insertTextIE","nodeList","getSelection","startContainer","endContainer","startOffset","endOffset","commonAncestorContainer","childNodesArray","Node","TEXT_NODE","isTextNode","containerTextContent","textNode","startContainerChildIndex","endContainerChildIndex","childNode","scrollHeight","offsetHeight","resizeHandle","startX","startY","startWidth","startHeight","onMouseMove","newWidth","newHeight","onMouseUp","borderTop","borderRight","borderBottom","borderLeft","getValue","getRangeAt","createRange","selectNodeContents","setStart","setEnd","removeAllRanges","addRange","registerProvider","_active","close","complete","containerBounds","previousBounds","newBounds","$textbox","newText","charCode","canvasCreate","Connect","canConnect","connect","ConnectPreview","startPosition","connectPreview","ConnectionPreview","_connectionDocking","_layouter","returnValues","connectionPreviewGfx","getConnection","noNoop","createConnectionPreviewGfx","firstArgument","JSON","stringify","layoutConnection","drawNoopPreview","createNoopConnection","sourcePath","targetPath","ensureConnectionAttrs","entrySelector","ContextPad","_overlaysConfig","_current","isOpen","current","getEntries","_getProviders","entries","entriesOrUpdater","getContextPadEntries","_updateAndOpen","getPad","grouping","control","addClasses","title","imageUrl","overlaysConfig","_overlayId","MARKER_TYPES","NODES_CAN_HAVE_MARKER","PreviewSupport","_styles","_clonedMarkers","clonedMarker","addDragger","dragger","_cloneMarkers","addFrame","frame","canHaveMarker","markerType","getMarker","_cloneMarker","markerId","clonedMarkerId","previewSupport","MARKER_ATTACH","MARKER_NEW_PARENT","PREFIX","Create","setMarker","ensureConstraints","isConnection","attach","isSingleShape","connectionTarget","targetParent","targetAttach","canCreate","appendShape","createElements","waypoint","createConstraints","CreatePreview","dragGroup","createDragGroup","createPreview","DATA_REF","CLOSE_EVENTS","PopupMenu","isEmpty","providerId","_getEntries","headerEntries","_getHeaderEntries","hasEntries","hasHeaderEntries","_createEntries","_attachContainer","_bindAutoClose","_unbindAutoClose","entryId","_getEntry","getPopupMenuEntries","getPopupMenuHeaderEntries","getHeaderEntries","visibility","_updateScale","_assureIsInbounds","scaleConfig","containerX","offsetLeft","containerY","offsetTop","scrollWidth","overAxis","cursorPosition","entriesContainer","entryContainer","_createEntry","entryClasses","disabled","popupMenu","Clipboard","_data","clipboard","Mouse","setLastMoveEvent","mousemoveEvent","_lastMoveEvent","_lastMouseEvent","getLastMoveEvent","initMouseEvent","createMoveEvent","mouse","CopyPaste","_create","_clipboard","_mouse","_rules","isAttacher","copyWaypoint","copyWaypoints","createElementsBehavior","removeElement","copy","createTree","paste","_createElements","_paste","branch","hasRelations","elementsData","addElementData","foundElementData","removeElementData","_index","incoming","outgoing","canCopy","copyPaste","copyProperties","PostitCopyPaste","postitFactory","moddleCopy","oldBusinessObject","newBusinessObject","copyElement","DISALLOWED_PROPERTIES","ModdleCopy","_postitFactory","propertyNames","parentDescriptor","getPropertyNames","keepDefaultProperties","sourceElement","canCopyProperties","sourceProperty","copiedProperty","copyProperty","childProperties","childProperty","postitCopyPaste","Replace","replaceElement","oldElement","newElementData","centerX","centerY","replaceShape","CUSTOM_PROPERTIES","PostitReplace","a2","elementProps","newElementProps","copyProps","postitReplace","ReplaceMenuProvider","_popupMenu","_postitReplace","register","replaceOptions","menuEntries","definition","_createMenuEntry","actionName","replaceMenuProvider","ContextPadProvider","imageSelection","_contextPad","_imageSelection","autoPlace","_autoPlace","actions","removeElements","setColor","createColoringEntries","deleteAllowed","createDeleteEntry","contextPadProvider","NOT_REGISTERED_ERROR","EditorActions","_actions","_registerDefaultActions","keyboardMoveSelection","undo","redo","removableElements","moveSelection","accelerated","_registerAction","unregister","getActions","PostitEditorActions","spaceTool","lassoTool","handTool","distributeElements","searchPad","currentSelection","boundingBox","moveElements","imageProcessor","ev","file","FileReader","onloadend","readAsDataURL","fileToDataURL","getMousePosition","pageX","pageY","scrollLeft","scrollTop","ImageSelection","selectImage","IMAGE_SELECTION_MARKUP","_getParentContainer","mousePosition","inputField","submitButton","imageUploadTextError","imageUploadTextUpload","imageUploadTextList","imageUploadReader","modal","filesToUpload","uploadTextListHeight","focus","canvasDefaultClick","mousePos","removeImageSelectionModal","updateImageSource","updateProperties","uploadDisplayText","uploadResultObj","files","errors","uploadResult","fileItems","fileReader","getElementsByClassName","uploadedFilesCount","esvent","PostitKeyboardBindings","LEFT","RIGHT","DOWN","KEY_TO_DIRECTION","ArrowLeft","Left","ArrowUp","Up","ArrowRight","Right","ArrowDown","Down","DIRECTIONS_DELTA","up","down","KeyboardMoveSelection","shapes","ChangeSupport","changeSupport","applyConstraints","resizeConstraints","asPadding","mayBePadding","isBBoxChild","Resize","_dragging","minBounds","computeMinResizeBox","resizeBounds","currentBounds","currentTrbl","canResize","boundsChanged","resizeShape","getReferencePoint","referencePoint","getCursor","contextOrDirection","minDimensions","childrenBounds","currentBox","minBox","childrenBox","shapeOrChildren","addPadding","computeChildrenBBox","childrenBoxPadding","MARKER_RESIZING","MARKER_RESIZE_NOT_OK","ResizePreview","directions","ResizeHandles","resize","_resize","removeResizers","addResizer","makeDraggable","startResize","_createResizer","resizersParent","_getResizersParent","getHandleOffset","CLS_RESIZER","amount","setScale","createResizer","resizer","resizePreview","resizeHandles","LabelEditingProvider","activateDirectEdit","getEditingBBox","externalFontSize","externalLineHeight","defaultFontSize","defaultLineHeight","paddingTop","paddingBottom","paddingLeft","paddingRight","externalLabelMid","absoluteBBox","updateLabel","MARKER_HIDDEN","MARKER_LABEL_HIDDEN","LabelEditingPreview","activeProvider","labelEditingProvider","labelEditingPreview","CommandInterceptor","hook","handlerFn","fullEvent","unwrapEvent","ALIGNMENTS","AdaptiveLabelPositioningBehavior","checkLabelAdjustment","optimalPosition","labelMid","labelOrientation","getApproximateOrientation","takenAlignments","elementMid","getTakenConnectionAlignments","takenHostAlignments","freeAlignments","hostElement","hostOrientation","getTakenHostAlignments","getOptimalPosition","newLabelMid","elementTrbl","moveShape","adjustLabelPosition","postExecuted","AppendBehavior","preExecute","FixHoverBehavior","lineIntersect","l1s","l1e","l2s","l2e","denominator","ImportDockingFix","adjustDocking","startPoint","centerIntersect","elementTop","elementLeft","verticalIntersect","horizontalIntersect","getDistance","p2","vectorLength","getAngle","atan","perpendicularFoot","bd","system","lambda","solveLambaSystem","getDistancePointLine","pfPoint","getDistancePointPoint","point1","point2","sq","getCircleSegmentIntersections","s1","s2","cc","cr","baX","baY","caX","caY","pBy2","tmpSqrt","abScalingFactor1","abScalingFactor2","i1","fenced","isPointInSegment","rangeStart","rangeEnd","EQUAL_THRESHOLD","pointsEqual","relativePositionMidWaypoint","distanceSegment1","getLine","getNewAttachPoint","oldBounds","oldCenter","newCenter","oldDelta","newDelta","getNewAttachShapeDelta","shapeCenter","shapeDelta","oldCenterDelta","stickyPositionDelta","oldShapeCenter","oldTRBL","newTRBL","isHorizontallyMoved","isVerticallyMoved","isMoved","oldOrientation","getStickyPositionDelta","newCenterDelta","newShapeCenter","DEFAULT_LABEL_DIMENSIONS","LabelBehavior","postExecute","labelCenter","labelDimensions","unsetLabel","labelBehavior","labelAdjustment","startChanged","endChanged","labelPosition","getLabelMid","attachment","segmentStartDistance","segmentEndDistance","attachmentPosition","attachmentDistance","closestAttachmentDistance","closestAttachment","segmentIndex","relativeLocation","getAttachment","oldLabelLineIndex","newLabelLineIndex","oldSegmentStartIndex","newIndex","findNewLabelLineStartIndex","l2","a1","foot","lengthToFoot","oldLabelLine","newLabelLine","oldFoot","relativeFootPosition","angleDelta","oldBendpointIndex","oldBendpoint","newBendpoint","vector","newFoot","newLabelVector","cos","sin","getLabelAdjustment","getVisibleLabelAdjustment","oldShape","getReferencePointDelta","getNearestLine","ReplaceElementBehaviour","postitRules","_selection","newParent","newHost","closure","topLevel","topLevelElements","canReplace","replaceElements","unclaimId","UnclaimIdBehavior","shapeBo","rootElementBo","CreateBoardElementBehavior","execute","EmptyTextBoxBehavior","newElements","replacement","newElementType","oldElementId","adaptiveLabelPositioningBehavior","appendBehavior","fixHoverBehavior","importDockingFix","replaceElementBehaviour","unclaimIdBehavior","createBoardElementBehavior","emptyTextBoxBehavior","RuleProvider","PostitRules","isGroup","canDrop","canAttach","canMove","every","possibleParent","parents","addRule","PostitDiOrdering","diElements","rootDi","postitDiOrdering","OrderingProvider","ordering","getOrdering","newParentIndex","PostitOrderingProvider","orders","order","level","getOrder","computeOrder","elementOrder","containers","actualParent","findActualParent","currentIndex","insertIndex","findIndex","postitOrderingProvider","CommandStack","_handlerMap","_stack","_stackIdx","_currentExecution","dirty","_pushAction","_internalExecute","_popAction","_getHandler","_getUndoAction","_internalUndo","_getRedoAction","_setHandler","registerHandler","handlerCls","canUndo","canRedo","_atomicDo","revert","_markDirty","_revertedAction","qualifier","_createId","execution","atomic","_executedAction","baseAction","stackIdx","tooltipSelector","Tooltips","_tooltipDefaults","_tooltips","_tooltipRoot","tooltip","_addTooltip","removeTimer","tooltipRoot","_updateTooltip","_updateTooltipVisibilty","tooltips","saveClear","removeFn","LabelSupport","movePreview","validatedShapes","removeLabels","preExecuted","enclosedElements","enclosedLabels","addAll","nested","labelTargetIndex","labelSupport","AttachSupport","getAttachers","removeAttached","attacher","updateAttachment","attachSupport","ToolManager","_tools","registerTool","tools","bindEvents","tool","setActive","eventsToRegister","reactivate","isPaletteClick","toolManager","AXIS_TO_DIMENSION","CURSOR_CROSSHAIR","DIRECTION_TO_TRBL","DIRECTION_TO_OPPOSITE","SpaceTool","_toolManager","activateMakeSpace","initialized","movingShapes","resizingShapes","makeSpace","activateSelection","spaceToolConstraints","createSpace","getDirection","calculateAdjustments","resizingShape","minOrMax","nonMovingResizingChildrenBBox","movingChildrenBBox","resizingShapeBBox","nonMovingResizingChildren","movingChildren","resizingShapeMinDimensions","getSpaceToolConstraints","shapeStart","shapeEnd","mouseEvent","MARKER_DRAGGING","SpaceToolPreview","addPreviewGfx","space","crosshairGroup","pathX","pathY","spaceLayer","movingConnections","sourceIsMoving","targetIsMoving","sourceIsResizing","targetIsResizing","frameGroup","frames","initialBounds","spaceToolPreview","PositFactory","_model","PostitUpdater","updateRoot","oldRoot","updateParent","updateBounds","executed","ifPostit","oldParent","reverted","AppendShapeHandler","CreateConnectionHandler","layouter","_needsId","_ensureId","createDiLabel","createDiBounds","createDiShape","createDiPlane","parentBusinessObject","parentDi","updateSemanticParent","updateDiParent","_getLabel","planeElements","visualParent","containment","diChildren","baseCreate","attributeNames","attributeName","applyAttribute","applyAttributes","_getDefaultSize","CreateElementsHandler","createShapeHints","CreateShapeHandler","CreateLabelHandler","positionOrBounds","originalExecute","ensureValidDimensions","originalRevert","DeleteConnectionHandler","DeleteElementsHandler","DeleteShapeHandler","DistributeElements","oldParentIndex","OFF_AXIS","LayoutConnectionHandler","MoveConnectionHandler","getResizedSourceAnchor","safeGetWaypoints","waypointsInsideNewBounds","getWaypointsInsideBounds","oldAnchor","getResizedTargetAnchor","getMovedSourceAnchor","moveDelta","subtract","getMovedTargetAnchor","isInsideBounds","MoveClosure","allShapes","allConnections","enclosedConnections","MoveHelper","MoveElementsHandler","_helper","MoveShapeHandler","ReconnectConnectionHandler","ReplaceShapeHandler","ResizeShapeHandler","SpaceToolHandler","getAxisFromDirection","shouldMoveWaypoint","relevantAxis","ToggleShapeCollapseHandler","getElementsVisibilityRecursive","setHiddenRecursive","newHidden","restoreVisibilityRecursive","lastState","UpdateAttachmentHandler","removeAttacher","addAttacher","UpdateWaypointsHandler","Modeling","registerHandlers","groups","updateRange","lastIdx","rangeDiff","margin","spaceInBetween","firstGroup","lastGroupIdx","lastGroup","groupsSize","refElem","refCenter","centerElement","groupIdx","prevGroup","isTopLevel","handleConnection","getClosure","moveRecursive","moveClosure","primaryShape","keepParent","recurse","layout","sourceMoved","targetMoved","moveConnection","moveChildren","getNewParent","newSource","newTarget","dockingOrPoints","oldSource","oldTarget","layoutConnectionHints","newData","canReconnect","reconnectEnd","reconnectStart","dockingPoint","moveShapes","getBounds","resizeShapes","updateConnectionWaypoints","waypointsUpdatingConnections","getWaypointsUpdatingConnections","connections","affectedShapes","layoutHints","oldChildrenVisibility","oldHost","attacherIdx","getHandlers","connectionParent","toggleCollapse","NULL_DIMENSIONS","UpdatePropertiesHandler","isIdChange","setProperties","setDiProperties","changed","unwrappedProps","referencePropertyNames","unwrapBusinessObjects","oldProperties","getProperties","newLabelBounds","UpdateCanvasRootHandler","IdClaimHandler","newRoot","newRootBusinessObject","oldRootBusinessObject","postitDefinitions","diPlane","claiming","DEFAULT_COLOR","SetColorHandler","UpdateLabelHandler","setText","setLabel","oldLabel","_postitRules","BaseLayouter","dockingToPoint","actual","CroppingConnectionDocking","claimId","moddleElement","sourceDocking","getDockingPoint","targetDocking","dockStart","dockingIdx","_getIntersection","takeFirst","_getShapePath","_getConnectionPath","_getGfx","postitUpdater","MoveEvents","removeNested","isAttach","MovePreview","getAllDraggedElements","dragShapes","allDraggedElements","visuallyDraggedShapes","differentParents","PALETTE_OPEN_CLS","Palette","updateToolHighlight","_update","_diagramInitialized","_rebuild","addPaletteEntries","getPaletteEntries","parentContainer","HTML_MARKUP","TOGGLE_SELECTOR","_layoutChanged","_toggleState","twoColumn","_needsCollapse","_entries","separator","availableHeight","isActiveTool","_activeTool","_toolsContainer","toolClasses","LASSO_TOOL_CURSOR","LassoTool","SVGElement","activateLasso","toBBox","getEnclosedElements","HAND_CURSOR","HandTool","activateMove","isSpace","activateHand","PaletteProvider","_palette","_spaceTool","_lassoTool","_handTool","createAction","createListener","shortType","dragstart","createImage","paletteProvider","PostitReplacePreview","visualReplacements","tempShape","replaceVisual","originalGfx","restoreVisual","postitReplacePreview","SnapContext","_targets","_snapOrigins","_snapLocations","_defaultSnaps","SnapPoints","defaultSnaps","_snapValues","CreateMoveSnapping","snapping","initSnap","snapContext","pointsForTarget","addSnapTargetPoints","snap","PostitCreateMoveSnapping","ResizeSnapping","isHorizontal","isVertical","getSnapOrigin","snapOrigin","Snapping","_asyncHide","snapLocation","setSnapOrigin","initialValue","addDefaultSnap","snapValues","getSnapLocations","setSnapLocations","snapLocations","targetId","initDefaults","tolerance","snappingValues","snapValue","shapeMid","shapeTopLeft","shapeBottomRight","getSnapTargets","snapTarget","topLeft","location","snapCurrent","locationSnapping","originValue","showSnapLine","axisSnapping","_createLine","_createSnapLines","_snapLines","getSnapLine","snapLine","createMoveSnapping","resizeSnapping","Modeler","createDiagram","_interactionModules","_modelingModules","CSS","cssEscape","codeUnit","firstCodeUnit","exportName","VENDOR_PREFIXES","TEST_ELEMENT","setTimeoutContext","bindFn","invokeArrayArg","each","deprecate","method","deprecationMessage","nextKey","dest","src","merge","inherit","childP","baseP","_super","boolOrFn","ifUndefined","val1","val2","addEventListeners","splitStr","removeEventListeners","hasParent","inStr","inArray","findByKey","toArray","uniqueArray","sort","results","prefixed","camelProp","_uniqueId","getWindowForElement","defaultView","parentWindow","SUPPORT_TOUCH","SUPPORT_POINTER_EVENTS","SUPPORT_ONLY_TOUCH","userAgent","INPUT_TYPE_TOUCH","INPUT_TYPE_MOUSE","PROPS_XY","PROPS_CLIENT_XY","Input","manager","inputTarget","domHandler","enable","inputHandler","eventType","input","pointersLen","changedPointersLen","changedPointers","isFirst","isFinal","pointersLength","firstInput","simpleCloneInputData","firstMultiple","offsetCenter","getCenter","timeStamp","deltaTime","offsetDelta","prevDelta","prevInput","computeDeltaXY","offsetDirection","overallVelocity","getVelocity","overallVelocityX","overallVelocityY","rotation","getRotation","maxPointers","velocity","velocityX","velocityY","lastInterval","computeIntervalInputData","computeInputData","recognize","atan2","PI","evEl","evTarget","evWin","MOUSE_INPUT_MAP","MOUSE_ELEMENT_EVENTS","MOUSE_WINDOW_EVENTS","MouseInput","pressed","pointerType","POINTER_INPUT_MAP","pointerdown","pointermove","pointerup","pointercancel","pointerout","IE10_POINTER_TYPE_ENUM","2","3","4","5","POINTER_ELEMENT_EVENTS","POINTER_WINDOW_EVENTS","PointerEventInput","store","MSPointerEvent","PointerEvent","removePointer","eventTypeNormalized","storeIndex","pointerId","SINGLE_TOUCH_INPUT_MAP","touchstart","touchmove","touchend","touchcancel","SINGLE_TOUCH_TARGET_EVENTS","SINGLE_TOUCH_WINDOW_EVENTS","SingleTouchInput","started","normalizeSingleTouches","changedTouches","TOUCH_INPUT_MAP","TOUCH_TARGET_EVENTS","TouchInput","targetIds","getTouches","allTouches","identifier","targetTouches","changedTargetTouches","touch","TouchMouseInput","primaryTouch","lastTouches","recordTouches","eventData","setLastTouch","lastTouch","lts","isSyntheticEvent","inputEvent","inputData","isMouse","sourceCapabilities","firesTouchEvents","PREFIXED_TOUCH_ACTION","NATIVE_TOUCH_ACTION","TOUCH_ACTION_COMPUTE","TOUCH_ACTION_AUTO","TOUCH_ACTION_MANIPULATION","TOUCH_ACTION_NONE","TOUCH_ACTION_PAN_X","TOUCH_ACTION_PAN_Y","TOUCH_ACTION_MAP","touchMap","cssSupports","supports","getTouchActionProps","TouchAction","compute","touchAction","getTouchAction","hasPanX","hasPanY","cleanTouchActions","preventDefaults","prevented","hasNone","isTapPointer","isTapMovement","isTapTouchTime","DIRECTION_LEFT","DIRECTION_UP","preventSrc","STATE_FAILED","Recognizer","simultaneous","requireFail","stateStr","directionStr","getRecognizerByNameIfManager","otherRecognizer","AttrRecognizer","PanRecognizer","pX","pY","PinchRecognizer","PressRecognizer","_timer","_input","RotateRecognizer","SwipeRecognizer","TapRecognizer","pTime","pCenter","count","Hammer","preset","Manager","oldCssProps","toggleCssProps","recognizeWith","cssProps","dropRecognizeWith","dropRequireFailure","hasRequireFailures","canRecognizeWith","additionalEvent","tryEmit","canEmit","inputDataClone","process","attrTest","optionPointers","isRecognized","isValid","DIRECTION_HORIZONTAL","directionTest","hasMoved","inOut","time","validPointers","validMovement","validTime","interval","posThreshold","validTouchTime","failTimeout","validInterval","validMultiTap","tapCount","VERSION","userSelect","touchSelect","touchCallout","contentZooming","userDrag","tapHighlightColor","gestureEvent","initEvent","gesture","dispatchEvent","triggerDomEvent","INPUT_START","INPUT_MOVE","INPUT_END","INPUT_CANCEL","STATE_POSSIBLE","STATE_BEGAN","STATE_CHANGED","STATE_ENDED","STATE_RECOGNIZED","STATE_CANCELLED","DIRECTION_NONE","DIRECTION_RIGHT","DIRECTION_DOWN","DIRECTION_VERTICAL","DIRECTION_ALL","Tap","Pan","Swipe","Pinch","Rotate","Press","TempCtor","Collection","refs","inverseProperty","isExtended","__refs_collection","defineCollectionProperty","ref","Refs","_value","old","ensureRefsCollection","ensureBound","p2s","toFloat","math","mmin","mmax","pathCommand","pathValues","repush","ii","paths","ps","sleep","rectBBox","x2","y2","pathToString","pathClone","pathArray","findDotsAtSegment","p1x","p1y","c1x","c1y","c2x","c2y","p2x","p2y","t1","t13","t12","t3","fixError","bezierBBox","curveBBox","x0","y0","x1","y1","isPointInsideBBox","base3","p3","p4","bezlen","x3","y3","x4","y4","z2","Tvalues","Cvalues","ct","xbase","ybase","comb","intersectLines","ny","px","py","px2","toFixed","py2","findBezierIntersections","bez1","bez2","justCount","bbox1","bbox2","l1","n1","isLine","n2","dots1","dots2","xy","di1","dj","dj1","ci","cj","pathToAbsolute","pth","pathString","paramCounts","params","parsePathString","pa0","pa","jj","kk","bez","lineToCurve","qubicToCurve","ax","ay","_13","_23","arcToCurve","large_arc_flag","sweep_flag","recursive","_120","rad","newf","f1","f2","rx2","ry2","asin","df","f2old","x2old","y2old","c1","c2","tan","hx","hy","m1","m2","m3","m4","newres","b2ac","sqrtb2ac","tvalues","mt","jlen","pathToCurve","curve","curvedPath","bx","by","X","Y","qx","qy","processPath","nx","T","Q","fixArc","pp","pi","pathCommands","pfirst","seg","seglen","path1","path2","x1m","y1m","x2m","y2m","pj","intr","segment1","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","__webpack_modules__","__esModule","globalThis","Symbol","toStringTag"],"mappings":"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","file":"postit.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"PostItModeler\"] = factory();\n\telse\n\t\troot[\"PostItModeler\"] = factory();\n})(self, function() {\nreturn ","function createCommonjsModule(fn, module) {\n\treturn module = { exports: {} }, fn(module, module.exports), module.exports;\n}\n\nvar hat_1 = createCommonjsModule(function (module) {\nvar hat = module.exports = function (bits, base) {\n    if (!base) base = 16;\n    if (bits === undefined) bits = 128;\n    if (bits <= 0) return '0';\n    \n    var digits = Math.log(Math.pow(2, bits)) / Math.log(base);\n    for (var i = 2; digits === Infinity; i *= 2) {\n        digits = Math.log(Math.pow(2, bits / i)) / Math.log(base) * i;\n    }\n    \n    var rem = digits - Math.floor(digits);\n    \n    var res = '';\n    \n    for (var i = 0; i < Math.floor(digits); i++) {\n        var x = Math.floor(Math.random() * base).toString(base);\n        res = x + res;\n    }\n    \n    if (rem) {\n        var b = Math.pow(base, rem);\n        var x = Math.floor(Math.random() * b).toString(base);\n        res = x + res;\n    }\n    \n    var parsed = parseInt(res, base);\n    if (parsed !== Infinity && parsed >= Math.pow(2, bits)) {\n        return hat(bits, base)\n    }\n    else return res;\n};\n\nhat.rack = function (bits, base, expandBy) {\n    var fn = function (data) {\n        var iters = 0;\n        do {\n            if (iters ++ > 10) {\n                if (expandBy) bits += expandBy;\n                else throw new Error('too many ID collisions, use more bits')\n            }\n            \n            var id = hat(bits, base);\n        } while (Object.hasOwnProperty.call(hats, id));\n        \n        hats[id] = data;\n        return id;\n    };\n    var hats = fn.hats = {};\n    \n    fn.get = function (id) {\n        return fn.hats[id];\n    };\n    \n    fn.set = function (id, value) {\n        fn.hats[id] = value;\n        return fn;\n    };\n    \n    fn.bits = bits || 128;\n    fn.base = base || 16;\n    return fn;\n};\n});\n\n/**\n * Create a new id generator / cache instance.\n *\n * You may optionally provide a seed that is used internally.\n *\n * @param {Seed} seed\n */\n\nfunction Ids(seed) {\n  if (!(this instanceof Ids)) {\n    return new Ids(seed);\n  }\n\n  seed = seed || [128, 36, 1];\n  this._seed = seed.length ? hat_1.rack(seed[0], seed[1], seed[2]) : seed;\n}\n/**\n * Generate a next id.\n *\n * @param {Object} [element] element to bind the id to\n *\n * @return {String} id\n */\n\nIds.prototype.next = function (element) {\n  return this._seed(element || true);\n};\n/**\n * Generate a next id with a given prefix.\n *\n * @param {Object} [element] element to bind the id to\n *\n * @return {String} id\n */\n\n\nIds.prototype.nextPrefixed = function (prefix, element) {\n  var id;\n\n  do {\n    id = prefix + this.next(true);\n  } while (this.assigned(id)); // claim {prefix}{random}\n\n\n  this.claim(id, element); // return\n\n  return id;\n};\n/**\n * Manually claim an existing id.\n *\n * @param {String} id\n * @param {String} [element] element the id is claimed by\n */\n\n\nIds.prototype.claim = function (id, element) {\n  this._seed.set(id, element || true);\n};\n/**\n * Returns true if the given id has already been assigned.\n *\n * @param  {String} id\n * @return {Boolean}\n */\n\n\nIds.prototype.assigned = function (id) {\n  return this._seed.get(id) || false;\n};\n/**\n * Unclaim an id.\n *\n * @param  {String} id the id to unclaim\n */\n\n\nIds.prototype.unclaim = function (id) {\n  delete this._seed.hats[id];\n};\n/**\n * Clear all claimed ids.\n */\n\n\nIds.prototype.clear = function () {\n  var hats = this._seed.hats,\n      id;\n\n  for (id in hats) {\n    this.unclaim(id);\n  }\n};\n\nexport default Ids;\n//# sourceMappingURL=index.esm.js.map\n","/**\n * Flatten array, one level deep.\n *\n * @param {Array<?>} arr\n *\n * @return {Array<?>}\n */\nfunction flatten(arr) {\n  return Array.prototype.concat.apply([], arr);\n}\n\nvar nativeToString = Object.prototype.toString;\nvar nativeHasOwnProperty = Object.prototype.hasOwnProperty;\nfunction isUndefined(obj) {\n  return obj === undefined;\n}\nfunction isDefined(obj) {\n  return obj !== undefined;\n}\nfunction isNil(obj) {\n  return obj == null;\n}\nfunction isArray(obj) {\n  return nativeToString.call(obj) === '[object Array]';\n}\nfunction isObject(obj) {\n  return nativeToString.call(obj) === '[object Object]';\n}\nfunction isNumber(obj) {\n  return nativeToString.call(obj) === '[object Number]';\n}\nfunction isFunction(obj) {\n  var tag = nativeToString.call(obj);\n  return tag === '[object Function]' || tag === '[object AsyncFunction]' || tag === '[object GeneratorFunction]' || tag === '[object AsyncGeneratorFunction]' || tag === '[object Proxy]';\n}\nfunction isString(obj) {\n  return nativeToString.call(obj) === '[object String]';\n}\n/**\n * Ensure collection is an array.\n *\n * @param {Object} obj\n */\n\nfunction ensureArray(obj) {\n  if (isArray(obj)) {\n    return;\n  }\n\n  throw new Error('must supply array');\n}\n/**\n * Return true, if target owns a property with the given key.\n *\n * @param {Object} target\n * @param {String} key\n *\n * @return {Boolean}\n */\n\nfunction has(target, key) {\n  return nativeHasOwnProperty.call(target, key);\n}\n\n/**\n * Find element in collection.\n *\n * @param  {Array|Object} collection\n * @param  {Function|Object} matcher\n *\n * @return {Object}\n */\n\nfunction find(collection, matcher) {\n  matcher = toMatcher(matcher);\n  var match;\n  forEach(collection, function (val, key) {\n    if (matcher(val, key)) {\n      match = val;\n      return false;\n    }\n  });\n  return match;\n}\n/**\n * Find element index in collection.\n *\n * @param  {Array|Object} collection\n * @param  {Function} matcher\n *\n * @return {Object}\n */\n\nfunction findIndex(collection, matcher) {\n  matcher = toMatcher(matcher);\n  var idx = isArray(collection) ? -1 : undefined;\n  forEach(collection, function (val, key) {\n    if (matcher(val, key)) {\n      idx = key;\n      return false;\n    }\n  });\n  return idx;\n}\n/**\n * Find element in collection.\n *\n * @param  {Array|Object} collection\n * @param  {Function} matcher\n *\n * @return {Array} result\n */\n\nfunction filter(collection, matcher) {\n  var result = [];\n  forEach(collection, function (val, key) {\n    if (matcher(val, key)) {\n      result.push(val);\n    }\n  });\n  return result;\n}\n/**\n * Iterate over collection; returning something\n * (non-undefined) will stop iteration.\n *\n * @param  {Array|Object} collection\n * @param  {Function} iterator\n *\n * @return {Object} return result that stopped the iteration\n */\n\nfunction forEach(collection, iterator) {\n  var val, result;\n\n  if (isUndefined(collection)) {\n    return;\n  }\n\n  var convertKey = isArray(collection) ? toNum : identity;\n\n  for (var key in collection) {\n    if (has(collection, key)) {\n      val = collection[key];\n      result = iterator(val, convertKey(key));\n\n      if (result === false) {\n        return val;\n      }\n    }\n  }\n}\n/**\n * Return collection without element.\n *\n * @param  {Array} arr\n * @param  {Function} matcher\n *\n * @return {Array}\n */\n\nfunction without(arr, matcher) {\n  if (isUndefined(arr)) {\n    return [];\n  }\n\n  ensureArray(arr);\n  matcher = toMatcher(matcher);\n  return arr.filter(function (el, idx) {\n    return !matcher(el, idx);\n  });\n}\n/**\n * Reduce collection, returning a single result.\n *\n * @param  {Object|Array} collection\n * @param  {Function} iterator\n * @param  {Any} result\n *\n * @return {Any} result returned from last iterator\n */\n\nfunction reduce(collection, iterator, result) {\n  forEach(collection, function (value, idx) {\n    result = iterator(result, value, idx);\n  });\n  return result;\n}\n/**\n * Return true if every element in the collection\n * matches the criteria.\n *\n * @param  {Object|Array} collection\n * @param  {Function} matcher\n *\n * @return {Boolean}\n */\n\nfunction every(collection, matcher) {\n  return !!reduce(collection, function (matches, val, key) {\n    return matches && matcher(val, key);\n  }, true);\n}\n/**\n * Return true if some elements in the collection\n * match the criteria.\n *\n * @param  {Object|Array} collection\n * @param  {Function} matcher\n *\n * @return {Boolean}\n */\n\nfunction some(collection, matcher) {\n  return !!find(collection, matcher);\n}\n/**\n * Transform a collection into another collection\n * by piping each member through the given fn.\n *\n * @param  {Object|Array}   collection\n * @param  {Function} fn\n *\n * @return {Array} transformed collection\n */\n\nfunction map(collection, fn) {\n  var result = [];\n  forEach(collection, function (val, key) {\n    result.push(fn(val, key));\n  });\n  return result;\n}\n/**\n * Get the collections keys.\n *\n * @param  {Object|Array} collection\n *\n * @return {Array}\n */\n\nfunction keys(collection) {\n  return collection && Object.keys(collection) || [];\n}\n/**\n * Shorthand for `keys(o).length`.\n *\n * @param  {Object|Array} collection\n *\n * @return {Number}\n */\n\nfunction size(collection) {\n  return keys(collection).length;\n}\n/**\n * Get the values in the collection.\n *\n * @param  {Object|Array} collection\n *\n * @return {Array}\n */\n\nfunction values(collection) {\n  return map(collection, function (val) {\n    return val;\n  });\n}\n/**\n * Group collection members by attribute.\n *\n * @param  {Object|Array} collection\n * @param  {Function} extractor\n *\n * @return {Object} map with { attrValue => [ a, b, c ] }\n */\n\nfunction groupBy(collection, extractor) {\n  var grouped = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n  extractor = toExtractor(extractor);\n  forEach(collection, function (val) {\n    var discriminator = extractor(val) || '_';\n    var group = grouped[discriminator];\n\n    if (!group) {\n      group = grouped[discriminator] = [];\n    }\n\n    group.push(val);\n  });\n  return grouped;\n}\nfunction uniqueBy(extractor) {\n  extractor = toExtractor(extractor);\n  var grouped = {};\n\n  for (var _len = arguments.length, collections = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n    collections[_key - 1] = arguments[_key];\n  }\n\n  forEach(collections, function (c) {\n    return groupBy(c, extractor, grouped);\n  });\n  var result = map(grouped, function (val, key) {\n    return val[0];\n  });\n  return result;\n}\nvar unionBy = uniqueBy;\n/**\n * Sort collection by criteria.\n *\n * @param  {Object|Array} collection\n * @param  {String|Function} extractor\n *\n * @return {Array}\n */\n\nfunction sortBy(collection, extractor) {\n  extractor = toExtractor(extractor);\n  var sorted = [];\n  forEach(collection, function (value, key) {\n    var disc = extractor(value, key);\n    var entry = {\n      d: disc,\n      v: value\n    };\n\n    for (var idx = 0; idx < sorted.length; idx++) {\n      var d = sorted[idx].d;\n\n      if (disc < d) {\n        sorted.splice(idx, 0, entry);\n        return;\n      }\n    } // not inserted, append (!)\n\n\n    sorted.push(entry);\n  });\n  return map(sorted, function (e) {\n    return e.v;\n  });\n}\n/**\n * Create an object pattern matcher.\n *\n * @example\n *\n * const matcher = matchPattern({ id: 1 });\n *\n * var element = find(elements, matcher);\n *\n * @param  {Object} pattern\n *\n * @return {Function} matcherFn\n */\n\nfunction matchPattern(pattern) {\n  return function (el) {\n    return every(pattern, function (val, key) {\n      return el[key] === val;\n    });\n  };\n}\n\nfunction toExtractor(extractor) {\n  return isFunction(extractor) ? extractor : function (e) {\n    return e[extractor];\n  };\n}\n\nfunction toMatcher(matcher) {\n  return isFunction(matcher) ? matcher : function (e) {\n    return e === matcher;\n  };\n}\n\nfunction identity(arg) {\n  return arg;\n}\n\nfunction toNum(arg) {\n  return Number(arg);\n}\n\n/**\n * Debounce fn, calling it only once if\n * the given time elapsed between calls.\n *\n * @param  {Function} fn\n * @param  {Number} timeout\n *\n * @return {Function} debounced function\n */\nfunction debounce(fn, timeout) {\n  var timer;\n  var lastArgs;\n  var lastThis;\n  var lastNow;\n\n  function fire() {\n    var now = Date.now();\n    var scheduledDiff = lastNow + timeout - now;\n\n    if (scheduledDiff > 0) {\n      return schedule(scheduledDiff);\n    }\n\n    fn.apply(lastThis, lastArgs);\n    timer = lastNow = lastArgs = lastThis = undefined;\n  }\n\n  function schedule(timeout) {\n    timer = setTimeout(fire, timeout);\n  }\n\n  return function () {\n    lastNow = Date.now();\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    lastArgs = args;\n    lastThis = this; // ensure an execution is scheduled\n\n    if (!timer) {\n      schedule(timeout);\n    }\n  };\n}\n/**\n * Throttle fn, calling at most once\n * in the given interval.\n *\n * @param  {Function} fn\n * @param  {Number} interval\n *\n * @return {Function} throttled function\n */\n\nfunction throttle(fn, interval) {\n  var throttling = false;\n  return function () {\n    if (throttling) {\n      return;\n    }\n\n    fn.apply(void 0, arguments);\n    throttling = true;\n    setTimeout(function () {\n      throttling = false;\n    }, interval);\n  };\n}\n/**\n * Bind function against target <this>.\n *\n * @param  {Function} fn\n * @param  {Object}   target\n *\n * @return {Function} bound function\n */\n\nfunction bind(fn, target) {\n  return fn.bind(target);\n}\n\nfunction _extends() {\n  _extends = Object.assign || function (target) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i];\n\n      for (var key in source) {\n        if (Object.prototype.hasOwnProperty.call(source, key)) {\n          target[key] = source[key];\n        }\n      }\n    }\n\n    return target;\n  };\n\n  return _extends.apply(this, arguments);\n}\n\n/**\n * Convenience wrapper for `Object.assign`.\n *\n * @param {Object} target\n * @param {...Object} others\n *\n * @return {Object} the target\n */\n\nfunction assign(target) {\n  for (var _len = arguments.length, others = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n    others[_key - 1] = arguments[_key];\n  }\n\n  return _extends.apply(void 0, [target].concat(others));\n}\n/**\n * Sets a nested property of a given object to the specified value.\n *\n * This mutates the object and returns it.\n *\n * @param {Object} target The target of the set operation.\n * @param {(string|number)[]} path The path to the nested value.\n * @param {any} value The value to set.\n */\n\nfunction set(target, path, value) {\n  var currentTarget = target;\n  forEach(path, function (key, idx) {\n    if (key === '__proto__') {\n      throw new Error('illegal key: __proto__');\n    }\n\n    var nextKey = path[idx + 1];\n    var nextTarget = currentTarget[key];\n\n    if (isDefined(nextKey) && isNil(nextTarget)) {\n      nextTarget = currentTarget[key] = isNaN(+nextKey) ? {} : [];\n    }\n\n    if (isUndefined(nextKey)) {\n      if (isUndefined(value)) {\n        delete currentTarget[key];\n      } else {\n        currentTarget[key] = value;\n      }\n    } else {\n      currentTarget = nextTarget;\n    }\n  });\n  return target;\n}\n/**\n * Gets a nested property of a given object.\n *\n * @param {Object} target The target of the get operation.\n * @param {(string|number)[]} path The path to the nested value.\n * @param {any} [defaultValue] The value to return if no value exists.\n */\n\nfunction get(target, path, defaultValue) {\n  var currentTarget = target;\n  forEach(path, function (key) {\n    // accessing nil property yields <undefined>\n    if (isNil(currentTarget)) {\n      currentTarget = undefined;\n      return false;\n    }\n\n    currentTarget = currentTarget[key];\n  });\n  return isUndefined(currentTarget) ? defaultValue : currentTarget;\n}\n/**\n * Pick given properties from the target object.\n *\n * @param {Object} target\n * @param {Array} properties\n *\n * @return {Object} target\n */\n\nfunction pick(target, properties) {\n  var result = {};\n  var obj = Object(target);\n  forEach(properties, function (prop) {\n    if (prop in obj) {\n      result[prop] = target[prop];\n    }\n  });\n  return result;\n}\n/**\n * Pick all target properties, excluding the given ones.\n *\n * @param {Object} target\n * @param {Array} properties\n *\n * @return {Object} target\n */\n\nfunction omit(target, properties) {\n  var result = {};\n  var obj = Object(target);\n  forEach(obj, function (prop, key) {\n    if (properties.indexOf(key) === -1) {\n      result[key] = prop;\n    }\n  });\n  return result;\n}\n/**\n * Recursively merge `...sources` into given target.\n *\n * Does support merging objects; does not support merging arrays.\n *\n * @param {Object} target\n * @param {...Object} sources\n *\n * @return {Object} the target\n */\n\nfunction merge(target) {\n  for (var _len2 = arguments.length, sources = new Array(_len2 > 1 ? _len2 - 1 : 0), _key2 = 1; _key2 < _len2; _key2++) {\n    sources[_key2 - 1] = arguments[_key2];\n  }\n\n  if (!sources.length) {\n    return target;\n  }\n\n  forEach(sources, function (source) {\n    // skip non-obj sources, i.e. null\n    if (!source || !isObject(source)) {\n      return;\n    }\n\n    forEach(source, function (sourceVal, key) {\n      if (key === '__proto__') {\n        return;\n      }\n\n      var targetVal = target[key];\n\n      if (isObject(sourceVal)) {\n        if (!isObject(targetVal)) {\n          // override target[key] with object\n          targetVal = {};\n        }\n\n        target[key] = merge(targetVal, sourceVal);\n      } else {\n        target[key] = sourceVal;\n      }\n    });\n  });\n  return target;\n}\n\nexport { assign, bind, debounce, ensureArray, every, filter, find, findIndex, flatten, forEach, get, groupBy, has, isArray, isDefined, isFunction, isNil, isNumber, isObject, isString, isUndefined, keys, map, matchPattern, merge, omit, pick, reduce, set, size, some, sortBy, throttle, unionBy, uniqueBy, values, without };\n","/**\n * Set attribute `name` to `val`, or get attr `name`.\n *\n * @param {Element} el\n * @param {String} name\n * @param {String} [val]\n * @api public\n */\nfunction attr(el, name, val) {\n  // get\n  if (arguments.length == 2) {\n    return el.getAttribute(name);\n  }\n\n  // remove\n  if (val === null) {\n    return el.removeAttribute(name);\n  }\n\n  // set\n  el.setAttribute(name, val);\n\n  return el;\n}\n\nvar indexOf = [].indexOf;\n\nvar indexof = function(arr, obj){\n  if (indexOf) return arr.indexOf(obj);\n  for (var i = 0; i < arr.length; ++i) {\n    if (arr[i] === obj) return i;\n  }\n  return -1;\n};\n\n/**\n * Taken from https://github.com/component/classes\n *\n * Without the component bits.\n */\n\n/**\n * Whitespace regexp.\n */\n\nvar re = /\\s+/;\n\n/**\n * toString reference.\n */\n\nvar toString = Object.prototype.toString;\n\n/**\n * Wrap `el` in a `ClassList`.\n *\n * @param {Element} el\n * @return {ClassList}\n * @api public\n */\n\nfunction classes(el) {\n  return new ClassList(el);\n}\n\n/**\n * Initialize a new ClassList for `el`.\n *\n * @param {Element} el\n * @api private\n */\n\nfunction ClassList(el) {\n  if (!el || !el.nodeType) {\n    throw new Error('A DOM element reference is required');\n  }\n  this.el = el;\n  this.list = el.classList;\n}\n\n/**\n * Add class `name` if not already present.\n *\n * @param {String} name\n * @return {ClassList}\n * @api public\n */\n\nClassList.prototype.add = function (name) {\n  // classList\n  if (this.list) {\n    this.list.add(name);\n    return this;\n  }\n\n  // fallback\n  var arr = this.array();\n  var i = indexof(arr, name);\n  if (!~i) arr.push(name);\n  this.el.className = arr.join(' ');\n  return this;\n};\n\n/**\n * Remove class `name` when present, or\n * pass a regular expression to remove\n * any which match.\n *\n * @param {String|RegExp} name\n * @return {ClassList}\n * @api public\n */\n\nClassList.prototype.remove = function (name) {\n  if ('[object RegExp]' == toString.call(name)) {\n    return this.removeMatching(name);\n  }\n\n  // classList\n  if (this.list) {\n    this.list.remove(name);\n    return this;\n  }\n\n  // fallback\n  var arr = this.array();\n  var i = indexof(arr, name);\n  if (~i) arr.splice(i, 1);\n  this.el.className = arr.join(' ');\n  return this;\n};\n\n/**\n * Remove all classes matching `re`.\n *\n * @param {RegExp} re\n * @return {ClassList}\n * @api private\n */\n\nClassList.prototype.removeMatching = function (re) {\n  var arr = this.array();\n  for (var i = 0; i < arr.length; i++) {\n    if (re.test(arr[i])) {\n      this.remove(arr[i]);\n    }\n  }\n  return this;\n};\n\n/**\n * Toggle class `name`, can force state via `force`.\n *\n * For browsers that support classList, but do not support `force` yet,\n * the mistake will be detected and corrected.\n *\n * @param {String} name\n * @param {Boolean} force\n * @return {ClassList}\n * @api public\n */\n\nClassList.prototype.toggle = function (name, force) {\n  // classList\n  if (this.list) {\n    if ('undefined' !== typeof force) {\n      if (force !== this.list.toggle(name, force)) {\n        this.list.toggle(name); // toggle again to correct\n      }\n    } else {\n      this.list.toggle(name);\n    }\n    return this;\n  }\n\n  // fallback\n  if ('undefined' !== typeof force) {\n    if (!force) {\n      this.remove(name);\n    } else {\n      this.add(name);\n    }\n  } else {\n    if (this.has(name)) {\n      this.remove(name);\n    } else {\n      this.add(name);\n    }\n  }\n\n  return this;\n};\n\n/**\n * Return an array of classes.\n *\n * @return {Array}\n * @api public\n */\n\nClassList.prototype.array = function () {\n  var className = this.el.getAttribute('class') || '';\n  var str = className.replace(/^\\s+|\\s+$/g, '');\n  var arr = str.split(re);\n  if ('' === arr[0]) arr.shift();\n  return arr;\n};\n\n/**\n * Check if class `name` is present.\n *\n * @param {String} name\n * @return {ClassList}\n * @api public\n */\n\nClassList.prototype.has = ClassList.prototype.contains = function (name) {\n  return this.list ? this.list.contains(name) : !!~indexof(this.array(), name);\n};\n\n/**\n * Remove all children from the given element.\n */\nfunction clear(el) {\n\n  var c;\n\n  while (el.childNodes.length) {\n    c = el.childNodes[0];\n    el.removeChild(c);\n  }\n\n  return el;\n}\n\nvar proto = typeof Element !== 'undefined' ? Element.prototype : {};\nvar vendor = proto.matches\n  || proto.matchesSelector\n  || proto.webkitMatchesSelector\n  || proto.mozMatchesSelector\n  || proto.msMatchesSelector\n  || proto.oMatchesSelector;\n\nvar matchesSelector = match;\n\n/**\n * Match `el` to `selector`.\n *\n * @param {Element} el\n * @param {String} selector\n * @return {Boolean}\n * @api public\n */\n\nfunction match(el, selector) {\n  if (!el || el.nodeType !== 1) return false;\n  if (vendor) return vendor.call(el, selector);\n  var nodes = el.parentNode.querySelectorAll(selector);\n  for (var i = 0; i < nodes.length; i++) {\n    if (nodes[i] == el) return true;\n  }\n  return false;\n}\n\n/**\n * Closest\n *\n * @param {Element} el\n * @param {String} selector\n * @param {Boolean} checkYourSelf (optional)\n */\nfunction closest (element, selector, checkYourSelf) {\n  var currentElem = checkYourSelf ? element : element.parentNode;\n\n  while (currentElem && currentElem.nodeType !== document.DOCUMENT_NODE && currentElem.nodeType !== document.DOCUMENT_FRAGMENT_NODE) {\n\n    if (matchesSelector(currentElem, selector)) {\n      return currentElem;\n    }\n\n    currentElem = currentElem.parentNode;\n  }\n\n  return matchesSelector(currentElem, selector) ? currentElem : null;\n}\n\nvar bind = window.addEventListener ? 'addEventListener' : 'attachEvent',\n    unbind = window.removeEventListener ? 'removeEventListener' : 'detachEvent',\n    prefix = bind !== 'addEventListener' ? 'on' : '';\n\n/**\n * Bind `el` event `type` to `fn`.\n *\n * @param {Element} el\n * @param {String} type\n * @param {Function} fn\n * @param {Boolean} capture\n * @return {Function}\n * @api public\n */\n\nvar bind_1 = function(el, type, fn, capture){\n  el[bind](prefix + type, fn, capture || false);\n  return fn;\n};\n\n/**\n * Unbind `el` event `type`'s callback `fn`.\n *\n * @param {Element} el\n * @param {String} type\n * @param {Function} fn\n * @param {Boolean} capture\n * @return {Function}\n * @api public\n */\n\nvar unbind_1 = function(el, type, fn, capture){\n  el[unbind](prefix + type, fn, capture || false);\n  return fn;\n};\n\nvar componentEvent = {\n\tbind: bind_1,\n\tunbind: unbind_1\n};\n\n/**\n * Module dependencies.\n */\n\n/**\n * Delegate event `type` to `selector`\n * and invoke `fn(e)`. A callback function\n * is returned which may be passed to `.unbind()`.\n *\n * @param {Element} el\n * @param {String} selector\n * @param {String} type\n * @param {Function} fn\n * @param {Boolean} capture\n * @return {Function}\n * @api public\n */\n\n// Some events don't bubble, so we want to bind to the capture phase instead\n// when delegating.\nvar forceCaptureEvents = ['focus', 'blur'];\n\nfunction bind$1(el, selector, type, fn, capture) {\n  if (forceCaptureEvents.indexOf(type) !== -1) {\n    capture = true;\n  }\n\n  return componentEvent.bind(el, type, function (e) {\n    var target = e.target || e.srcElement;\n    e.delegateTarget = closest(target, selector, true, el);\n    if (e.delegateTarget) {\n      fn.call(el, e);\n    }\n  }, capture);\n}\n\n/**\n * Unbind event `type`'s callback `fn`.\n *\n * @param {Element} el\n * @param {String} type\n * @param {Function} fn\n * @param {Boolean} capture\n * @api public\n */\nfunction unbind$1(el, type, fn, capture) {\n  if (forceCaptureEvents.indexOf(type) !== -1) {\n    capture = true;\n  }\n\n  return componentEvent.unbind(el, type, fn, capture);\n}\n\nvar delegate = {\n  bind: bind$1,\n  unbind: unbind$1\n};\n\n/**\n * Expose `parse`.\n */\n\nvar domify = parse;\n\n/**\n * Tests for browser support.\n */\n\nvar innerHTMLBug = false;\nvar bugTestDiv;\nif (typeof document !== 'undefined') {\n  bugTestDiv = document.createElement('div');\n  // Setup\n  bugTestDiv.innerHTML = '  <link/><table></table><a href=\"/a\">a</a><input type=\"checkbox\"/>';\n  // Make sure that link elements get serialized correctly by innerHTML\n  // This requires a wrapper element in IE\n  innerHTMLBug = !bugTestDiv.getElementsByTagName('link').length;\n  bugTestDiv = undefined;\n}\n\n/**\n * Wrap map from jquery.\n */\n\nvar map = {\n  legend: [1, '<fieldset>', '</fieldset>'],\n  tr: [2, '<table><tbody>', '</tbody></table>'],\n  col: [2, '<table><tbody></tbody><colgroup>', '</colgroup></table>'],\n  // for script/link/style tags to work in IE6-8, you have to wrap\n  // in a div with a non-whitespace character in front, ha!\n  _default: innerHTMLBug ? [1, 'X<div>', '</div>'] : [0, '', '']\n};\n\nmap.td =\nmap.th = [3, '<table><tbody><tr>', '</tr></tbody></table>'];\n\nmap.option =\nmap.optgroup = [1, '<select multiple=\"multiple\">', '</select>'];\n\nmap.thead =\nmap.tbody =\nmap.colgroup =\nmap.caption =\nmap.tfoot = [1, '<table>', '</table>'];\n\nmap.polyline =\nmap.ellipse =\nmap.polygon =\nmap.circle =\nmap.text =\nmap.line =\nmap.path =\nmap.rect =\nmap.g = [1, '<svg xmlns=\"http://www.w3.org/2000/svg\" version=\"1.1\">','</svg>'];\n\n/**\n * Parse `html` and return a DOM Node instance, which could be a TextNode,\n * HTML DOM Node of some kind (<div> for example), or a DocumentFragment\n * instance, depending on the contents of the `html` string.\n *\n * @param {String} html - HTML string to \"domify\"\n * @param {Document} doc - The `document` instance to create the Node for\n * @return {DOMNode} the TextNode, DOM Node, or DocumentFragment instance\n * @api private\n */\n\nfunction parse(html, doc) {\n  if ('string' != typeof html) throw new TypeError('String expected');\n\n  // default to the global `document` object\n  if (!doc) doc = document;\n\n  // tag name\n  var m = /<([\\w:]+)/.exec(html);\n  if (!m) return doc.createTextNode(html);\n\n  html = html.replace(/^\\s+|\\s+$/g, ''); // Remove leading/trailing whitespace\n\n  var tag = m[1];\n\n  // body support\n  if (tag == 'body') {\n    var el = doc.createElement('html');\n    el.innerHTML = html;\n    return el.removeChild(el.lastChild);\n  }\n\n  // wrap map\n  var wrap = map[tag] || map._default;\n  var depth = wrap[0];\n  var prefix = wrap[1];\n  var suffix = wrap[2];\n  var el = doc.createElement('div');\n  el.innerHTML = prefix + html + suffix;\n  while (depth--) el = el.lastChild;\n\n  // one element\n  if (el.firstChild == el.lastChild) {\n    return el.removeChild(el.firstChild);\n  }\n\n  // several elements\n  var fragment = doc.createDocumentFragment();\n  while (el.firstChild) {\n    fragment.appendChild(el.removeChild(el.firstChild));\n  }\n\n  return fragment;\n}\n\nfunction query(selector, el) {\n  el = el || document;\n\n  return el.querySelector(selector);\n}\n\nfunction all(selector, el) {\n  el = el || document;\n\n  return el.querySelectorAll(selector);\n}\n\nfunction remove(el) {\n  el.parentNode && el.parentNode.removeChild(el);\n}\n\nexport { attr, classes, clear, closest, delegate, domify, componentEvent as event, matchesSelector as matches, query, all as queryAll, remove };\n","function ensureImported(element, target) {\n\n  if (element.ownerDocument !== target.ownerDocument) {\n    try {\n      // may fail on webkit\n      return target.ownerDocument.importNode(element, true);\n    } catch (e) {\n      // ignore\n    }\n  }\n\n  return element;\n}\n\n/**\n * appendTo utility\n */\n\n/**\n * Append a node to a target element and return the appended node.\n *\n * @param  {SVGElement} element\n * @param  {SVGElement} target\n *\n * @return {SVGElement} the appended node\n */\nfunction appendTo(element, target) {\n  return target.appendChild(ensureImported(element, target));\n}\n\n/**\n * append utility\n */\n\n/**\n * Append a node to an element\n *\n * @param  {SVGElement} element\n * @param  {SVGElement} node\n *\n * @return {SVGElement} the element\n */\nfunction append(target, node) {\n  appendTo(node, target);\n  return target;\n}\n\n/**\n * attribute accessor utility\n */\n\nvar LENGTH_ATTR = 2;\n\nvar CSS_PROPERTIES = {\n  'alignment-baseline': 1,\n  'baseline-shift': 1,\n  'clip': 1,\n  'clip-path': 1,\n  'clip-rule': 1,\n  'color': 1,\n  'color-interpolation': 1,\n  'color-interpolation-filters': 1,\n  'color-profile': 1,\n  'color-rendering': 1,\n  'cursor': 1,\n  'direction': 1,\n  'display': 1,\n  'dominant-baseline': 1,\n  'enable-background': 1,\n  'fill': 1,\n  'fill-opacity': 1,\n  'fill-rule': 1,\n  'filter': 1,\n  'flood-color': 1,\n  'flood-opacity': 1,\n  'font': 1,\n  'font-family': 1,\n  'font-size': LENGTH_ATTR,\n  'font-size-adjust': 1,\n  'font-stretch': 1,\n  'font-style': 1,\n  'font-variant': 1,\n  'font-weight': 1,\n  'glyph-orientation-horizontal': 1,\n  'glyph-orientation-vertical': 1,\n  'image-rendering': 1,\n  'kerning': 1,\n  'letter-spacing': 1,\n  'lighting-color': 1,\n  'marker': 1,\n  'marker-end': 1,\n  'marker-mid': 1,\n  'marker-start': 1,\n  'mask': 1,\n  'opacity': 1,\n  'overflow': 1,\n  'pointer-events': 1,\n  'shape-rendering': 1,\n  'stop-color': 1,\n  'stop-opacity': 1,\n  'stroke': 1,\n  'stroke-dasharray': 1,\n  'stroke-dashoffset': 1,\n  'stroke-linecap': 1,\n  'stroke-linejoin': 1,\n  'stroke-miterlimit': 1,\n  'stroke-opacity': 1,\n  'stroke-width': LENGTH_ATTR,\n  'text-anchor': 1,\n  'text-decoration': 1,\n  'text-rendering': 1,\n  'unicode-bidi': 1,\n  'visibility': 1,\n  'word-spacing': 1,\n  'writing-mode': 1\n};\n\n\nfunction getAttribute(node, name) {\n  if (CSS_PROPERTIES[name]) {\n    return node.style[name];\n  } else {\n    return node.getAttributeNS(null, name);\n  }\n}\n\nfunction setAttribute(node, name, value) {\n  var hyphenated = name.replace(/([a-z])([A-Z])/g, '$1-$2').toLowerCase();\n\n  var type = CSS_PROPERTIES[hyphenated];\n\n  if (type) {\n    // append pixel unit, unless present\n    if (type === LENGTH_ATTR && typeof value === 'number') {\n      value = String(value) + 'px';\n    }\n\n    node.style[hyphenated] = value;\n  } else {\n    node.setAttributeNS(null, name, value);\n  }\n}\n\nfunction setAttributes(node, attrs) {\n\n  var names = Object.keys(attrs), i, name;\n\n  for (i = 0, name; (name = names[i]); i++) {\n    setAttribute(node, name, attrs[name]);\n  }\n}\n\n/**\n * Gets or sets raw attributes on a node.\n *\n * @param  {SVGElement} node\n * @param  {Object} [attrs]\n * @param  {String} [name]\n * @param  {String} [value]\n *\n * @return {String}\n */\nfunction attr(node, name, value) {\n  if (typeof name === 'string') {\n    if (value !== undefined) {\n      setAttribute(node, name, value);\n    } else {\n      return getAttribute(node, name);\n    }\n  } else {\n    setAttributes(node, name);\n  }\n\n  return node;\n}\n\n/**\r\n * Clear utility\r\n */\r\nfunction index(arr, obj) {\r\n  if (arr.indexOf) {\r\n    return arr.indexOf(obj);\r\n  }\r\n\r\n\r\n  for (var i = 0; i < arr.length; ++i) {\r\n    if (arr[i] === obj) {\r\n      return i;\r\n    }\r\n  }\r\n\r\n  return -1;\r\n}\r\n\r\nvar re = /\\s+/;\r\n\r\nvar toString = Object.prototype.toString;\r\n\r\nfunction defined(o) {\r\n  return typeof o !== 'undefined';\r\n}\r\n\r\n/**\r\n * Wrap `el` in a `ClassList`.\r\n *\r\n * @param {Element} el\r\n * @return {ClassList}\r\n * @api public\r\n */\r\n\r\nfunction classes(el) {\r\n  return new ClassList(el);\r\n}\r\n\r\nfunction ClassList(el) {\r\n  if (!el || !el.nodeType) {\r\n    throw new Error('A DOM element reference is required');\r\n  }\r\n  this.el = el;\r\n  this.list = el.classList;\r\n}\r\n\r\n/**\r\n * Add class `name` if not already present.\r\n *\r\n * @param {String} name\r\n * @return {ClassList}\r\n * @api public\r\n */\r\n\r\nClassList.prototype.add = function(name) {\r\n\r\n  // classList\r\n  if (this.list) {\r\n    this.list.add(name);\r\n    return this;\r\n  }\r\n\r\n  // fallback\r\n  var arr = this.array();\r\n  var i = index(arr, name);\r\n  if (!~i) {\r\n    arr.push(name);\r\n  }\r\n\r\n  if (defined(this.el.className.baseVal)) {\r\n    this.el.className.baseVal = arr.join(' ');\r\n  } else {\r\n    this.el.className = arr.join(' ');\r\n  }\r\n\r\n  return this;\r\n};\r\n\r\n/**\r\n * Remove class `name` when present, or\r\n * pass a regular expression to remove\r\n * any which match.\r\n *\r\n * @param {String|RegExp} name\r\n * @return {ClassList}\r\n * @api public\r\n */\r\n\r\nClassList.prototype.remove = function(name) {\r\n  if ('[object RegExp]' === toString.call(name)) {\r\n    return this.removeMatching(name);\r\n  }\r\n\r\n  // classList\r\n  if (this.list) {\r\n    this.list.remove(name);\r\n    return this;\r\n  }\r\n\r\n  // fallback\r\n  var arr = this.array();\r\n  var i = index(arr, name);\r\n  if (~i) {\r\n    arr.splice(i, 1);\r\n  }\r\n  this.el.className.baseVal = arr.join(' ');\r\n  return this;\r\n};\r\n\r\n/**\r\n * Remove all classes matching `re`.\r\n *\r\n * @param {RegExp} re\r\n * @return {ClassList}\r\n * @api private\r\n */\r\n\r\nClassList.prototype.removeMatching = function(re) {\r\n  var arr = this.array();\r\n  for (var i = 0; i < arr.length; i++) {\r\n    if (re.test(arr[i])) {\r\n      this.remove(arr[i]);\r\n    }\r\n  }\r\n  return this;\r\n};\r\n\r\n/**\r\n * Toggle class `name`, can force state via `force`.\r\n *\r\n * For browsers that support classList, but do not support `force` yet,\r\n * the mistake will be detected and corrected.\r\n *\r\n * @param {String} name\r\n * @param {Boolean} force\r\n * @return {ClassList}\r\n * @api public\r\n */\r\n\r\nClassList.prototype.toggle = function(name, force) {\r\n  // classList\r\n  if (this.list) {\r\n    if (defined(force)) {\r\n      if (force !== this.list.toggle(name, force)) {\r\n        this.list.toggle(name); // toggle again to correct\r\n      }\r\n    } else {\r\n      this.list.toggle(name);\r\n    }\r\n    return this;\r\n  }\r\n\r\n  // fallback\r\n  if (defined(force)) {\r\n    if (!force) {\r\n      this.remove(name);\r\n    } else {\r\n      this.add(name);\r\n    }\r\n  } else {\r\n    if (this.has(name)) {\r\n      this.remove(name);\r\n    } else {\r\n      this.add(name);\r\n    }\r\n  }\r\n\r\n  return this;\r\n};\r\n\r\n/**\r\n * Return an array of classes.\r\n *\r\n * @return {Array}\r\n * @api public\r\n */\r\n\r\nClassList.prototype.array = function() {\r\n  var className = this.el.getAttribute('class') || '';\r\n  var str = className.replace(/^\\s+|\\s+$/g, '');\r\n  var arr = str.split(re);\r\n  if ('' === arr[0]) {\r\n    arr.shift();\r\n  }\r\n  return arr;\r\n};\r\n\r\n/**\r\n * Check if class `name` is present.\r\n *\r\n * @param {String} name\r\n * @return {ClassList}\r\n * @api public\r\n */\r\n\r\nClassList.prototype.has =\r\nClassList.prototype.contains = function(name) {\r\n  return (\r\n    this.list ?\r\n      this.list.contains(name) :\r\n      !! ~index(this.array(), name)\r\n  );\r\n};\n\nfunction remove(element) {\n  var parent = element.parentNode;\n\n  if (parent) {\n    parent.removeChild(element);\n  }\n\n  return element;\n}\n\n/**\n * Clear utility\n */\n\n/**\n * Removes all children from the given element\n *\n * @param  {DOMElement} element\n * @return {DOMElement} the element (for chaining)\n */\nfunction clear(element) {\n  var child;\n\n  while ((child = element.firstChild)) {\n    remove(child);\n  }\n\n  return element;\n}\n\nfunction clone(element) {\n  return element.cloneNode(true);\n}\n\nvar ns = {\n  svg: 'http://www.w3.org/2000/svg'\n};\n\n/**\n * DOM parsing utility\n */\n\nvar SVG_START = '<svg xmlns=\"' + ns.svg + '\"';\n\nfunction parse(svg) {\n\n  var unwrap = false;\n\n  // ensure we import a valid svg document\n  if (svg.substring(0, 4) === '<svg') {\n    if (svg.indexOf(ns.svg) === -1) {\n      svg = SVG_START + svg.substring(4);\n    }\n  } else {\n    // namespace svg\n    svg = SVG_START + '>' + svg + '</svg>';\n    unwrap = true;\n  }\n\n  var parsed = parseDocument(svg);\n\n  if (!unwrap) {\n    return parsed;\n  }\n\n  var fragment = document.createDocumentFragment();\n\n  var parent = parsed.firstChild;\n\n  while (parent.firstChild) {\n    fragment.appendChild(parent.firstChild);\n  }\n\n  return fragment;\n}\n\nfunction parseDocument(svg) {\n\n  var parser;\n\n  // parse\n  parser = new DOMParser();\n  parser.async = false;\n\n  return parser.parseFromString(svg, 'text/xml');\n}\n\n/**\n * Create utility for SVG elements\n */\n\n\n/**\n * Create a specific type from name or SVG markup.\n *\n * @param {String} name the name or markup of the element\n * @param {Object} [attrs] attributes to set on the element\n *\n * @returns {SVGElement}\n */\nfunction create(name, attrs) {\n  var element;\n\n  if (name.charAt(0) === '<') {\n    element = parse(name).firstChild;\n    element = document.importNode(element, true);\n  } else {\n    element = document.createElementNS(ns.svg, name);\n  }\n\n  if (attrs) {\n    attr(element, attrs);\n  }\n\n  return element;\n}\n\n/**\n * Events handling utility\n */\n\nfunction on(node, event, listener, useCapture) {\n  node.addEventListener(event, listener, useCapture);\n}\n\nfunction off(node, event, listener, useCapture) {\n  node.removeEventListener(event, listener, useCapture);\n}\n\n/**\n * Geometry helpers\n */\n\n// fake node used to instantiate svg geometry elements\nvar node = create('svg');\n\nfunction extend(object, props) {\n  var i, k, keys = Object.keys(props);\n\n  for (i = 0; (k = keys[i]); i++) {\n    object[k] = props[k];\n  }\n\n  return object;\n}\n\n\nfunction createPoint(x, y) {\n  var point = node.createSVGPoint();\n\n  switch (arguments.length) {\n  case 0:\n    return point;\n  case 2:\n    x = {\n      x: x,\n      y: y\n    };\n    break;\n  }\n\n  return extend(point, x);\n}\n\n/**\n * Create matrix via args.\n *\n * @example\n *\n * createMatrix({ a: 1, b: 1 });\n * createMatrix();\n * createMatrix(1, 2, 0, 0, 30, 20);\n *\n * @return {SVGMatrix}\n */\nfunction createMatrix(a, b, c, d, e, f) {\n  var matrix = node.createSVGMatrix();\n\n  switch (arguments.length) {\n  case 0:\n    return matrix;\n  case 1:\n    return extend(matrix, a);\n  case 6:\n    return extend(matrix, {\n      a: a,\n      b: b,\n      c: c,\n      d: d,\n      e: e,\n      f: f\n    });\n  }\n}\n\nfunction createTransform(matrix) {\n  if (matrix) {\n    return node.createSVGTransformFromMatrix(matrix);\n  } else {\n    return node.createSVGTransform();\n  }\n}\n\n/**\n * Serialization util\n */\n\nvar TEXT_ENTITIES = /([&<>]{1})/g;\nvar ATTR_ENTITIES = /([\\n\\r\"]{1})/g;\n\nvar ENTITY_REPLACEMENT = {\n  '&': '&amp;',\n  '<': '&lt;',\n  '>': '&gt;',\n  '\"': '\\''\n};\n\nfunction escape(str, pattern) {\n\n  function replaceFn(match, entity) {\n    return ENTITY_REPLACEMENT[entity] || entity;\n  }\n\n  return str.replace(pattern, replaceFn);\n}\n\nfunction serialize(node, output) {\n\n  var i, len, attrMap, attrNode, childNodes;\n\n  switch (node.nodeType) {\n  // TEXT\n  case 3:\n    // replace special XML characters\n    output.push(escape(node.textContent, TEXT_ENTITIES));\n    break;\n\n  // ELEMENT\n  case 1:\n    output.push('<', node.tagName);\n\n    if (node.hasAttributes()) {\n      attrMap = node.attributes;\n      for (i = 0, len = attrMap.length; i < len; ++i) {\n        attrNode = attrMap.item(i);\n        output.push(' ', attrNode.name, '=\"', escape(attrNode.value, ATTR_ENTITIES), '\"');\n      }\n    }\n\n    if (node.hasChildNodes()) {\n      output.push('>');\n      childNodes = node.childNodes;\n      for (i = 0, len = childNodes.length; i < len; ++i) {\n        serialize(childNodes.item(i), output);\n      }\n      output.push('</', node.tagName, '>');\n    } else {\n      output.push('/>');\n    }\n    break;\n\n  // COMMENT\n  case 8:\n    output.push('<!--', escape(node.nodeValue, TEXT_ENTITIES), '-->');\n    break;\n\n  // CDATA\n  case 4:\n    output.push('<![CDATA[', node.nodeValue, ']]>');\n    break;\n\n  default:\n    throw new Error('unable to handle node ' + node.nodeType);\n  }\n\n  return output;\n}\n\n/**\n * innerHTML like functionality for SVG elements.\n * based on innerSVG (https://code.google.com/p/innersvg)\n */\n\n\nfunction set(element, svg) {\n\n  var parsed = parse(svg);\n\n  // clear element contents\n  clear(element);\n\n  if (!svg) {\n    return;\n  }\n\n  if (!isFragment(parsed)) {\n    // extract <svg> from parsed document\n    parsed = parsed.documentElement;\n  }\n\n  var nodes = slice(parsed.childNodes);\n\n  // import + append each node\n  for (var i = 0; i < nodes.length; i++) {\n    appendTo(nodes[i], element);\n  }\n\n}\n\nfunction get(element) {\n  var child = element.firstChild,\n      output = [];\n\n  while (child) {\n    serialize(child, output);\n    child = child.nextSibling;\n  }\n\n  return output.join('');\n}\n\nfunction isFragment(node) {\n  return node.nodeName === '#document-fragment';\n}\n\nfunction innerSVG(element, svg) {\n\n  if (svg !== undefined) {\n\n    try {\n      set(element, svg);\n    } catch (e) {\n      throw new Error('error parsing SVG: ' + e.message);\n    }\n\n    return element;\n  } else {\n    return get(element);\n  }\n}\n\n\nfunction slice(arr) {\n  return Array.prototype.slice.call(arr);\n}\n\n/**\n * Selection utilities\n */\n\nfunction select(node, selector) {\n  return node.querySelector(selector);\n}\n\nfunction selectAll(node, selector) {\n  var nodes = node.querySelectorAll(selector);\n\n  return [].map.call(nodes, function(element) {\n    return element;\n  });\n}\n\n/**\n * prependTo utility\n */\n\n/**\n * Prepend a node to a target element and return the prepended node.\n *\n * @param  {SVGElement} node\n * @param  {SVGElement} target\n *\n * @return {SVGElement} the prepended node\n */\nfunction prependTo(node, target) {\n  return target.insertBefore(ensureImported(node, target), target.firstChild || null);\n}\n\n/**\n * prepend utility\n */\n\n/**\n * Prepend a node to a target element\n *\n * @param  {SVGElement} target\n * @param  {SVGElement} node\n *\n * @return {SVGElement} the target element\n */\nfunction prepend(target, node) {\n  prependTo(node, target);\n  return target;\n}\n\n/**\n * Replace utility\n */\n\nfunction replace(element, replacement) {\n  element.parentNode.replaceChild(ensureImported(replacement, element), element);\n  return replacement;\n}\n\n/**\n * transform accessor utility\n */\n\nfunction wrapMatrix(transformList, transform) {\n  if (transform instanceof SVGMatrix) {\n    return transformList.createSVGTransformFromMatrix(transform);\n  }\n\n  return transform;\n}\n\n\nfunction setTransforms(transformList, transforms) {\n  var i, t;\n\n  transformList.clear();\n\n  for (i = 0; (t = transforms[i]); i++) {\n    transformList.appendItem(wrapMatrix(transformList, t));\n  }\n}\n\n/**\n * Get or set the transforms on the given node.\n *\n * @param {SVGElement} node\n * @param  {SVGTransform|SVGMatrix|Array<SVGTransform|SVGMatrix>} [transforms]\n *\n * @return {SVGTransform} the consolidated transform\n */\nfunction transform(node, transforms) {\n  var transformList = node.transform.baseVal;\n\n  if (transforms) {\n\n    if (!Array.isArray(transforms)) {\n      transforms = [ transforms ];\n    }\n\n    setTransforms(transformList, transforms);\n  }\n\n  return transformList.consolidate();\n}\n\nexport { append, appendTo, attr, classes, clear, clone, create, innerSVG, prepend, prependTo, remove, replace, transform, on, off, createPoint, createMatrix, createTransform, select, selectAll };\n","var CLASS_PATTERN = /^class /;\n\nfunction isClass(fn) {\n  return CLASS_PATTERN.test(fn.toString());\n}\n\nfunction isArray(obj) {\n  return Object.prototype.toString.call(obj) === '[object Array]';\n}\n\nfunction hasOwnProp(obj, prop) {\n  return Object.prototype.hasOwnProperty.call(obj, prop);\n}\n\nfunction annotate() {\n  var args = Array.prototype.slice.call(arguments);\n\n  if (args.length === 1 && isArray(args[0])) {\n    args = args[0];\n  }\n\n  var fn = args.pop();\n\n  fn.$inject = args;\n\n  return fn;\n}\n\n\n// Current limitations:\n// - can't put into \"function arg\" comments\n// function /* (no parenthesis like this) */ (){}\n// function abc( /* xx (no parenthesis like this) */ a, b) {}\n//\n// Just put the comment before function or inside:\n// /* (((this is fine))) */ function(a, b) {}\n// function abc(a) { /* (((this is fine))) */}\n//\n// - can't reliably auto-annotate constructor; we'll match the\n// first constructor(...) pattern found which may be the one\n// of a nested class, too.\n\nvar CONSTRUCTOR_ARGS = /constructor\\s*[^(]*\\(\\s*([^)]*)\\)/m;\nvar FN_ARGS = /^(?:async )?(?:function\\s*)?[^(]*\\(\\s*([^)]*)\\)/m;\nvar FN_ARG = /\\/\\*([^*]*)\\*\\//m;\n\nfunction parseAnnotations(fn) {\n\n  if (typeof fn !== 'function') {\n    throw new Error('Cannot annotate \"' + fn + '\". Expected a function!');\n  }\n\n  var match = fn.toString().match(isClass(fn) ? CONSTRUCTOR_ARGS : FN_ARGS);\n\n  // may parse class without constructor\n  if (!match) {\n    return [];\n  }\n\n  return match[1] && match[1].split(',').map(function(arg) {\n    match = arg.match(FN_ARG);\n    return match ? match[1].trim() : arg.trim();\n  }) || [];\n}\n\nfunction Module() {\n  var providers = [];\n\n  this.factory = function(name, factory) {\n    providers.push([name, 'factory', factory]);\n    return this;\n  };\n\n  this.value = function(name, value) {\n    providers.push([name, 'value', value]);\n    return this;\n  };\n\n  this.type = function(name, type) {\n    providers.push([name, 'type', type]);\n    return this;\n  };\n\n  this.forEach = function(iterator) {\n    providers.forEach(iterator);\n  };\n\n}\n\nfunction Injector(modules, parent) {\n  parent = parent || {\n    get: function(name, strict) {\n      currentlyResolving.push(name);\n\n      if (strict === false) {\n        return null;\n      } else {\n        throw error('No provider for \"' + name + '\"!');\n      }\n    }\n  };\n\n  var currentlyResolving = [];\n  var providers = this._providers = Object.create(parent._providers || null);\n  var instances = this._instances = Object.create(null);\n\n  var self = instances.injector = this;\n\n  var error = function(msg) {\n    var stack = currentlyResolving.join(' -> ');\n    currentlyResolving.length = 0;\n    return new Error(stack ? msg + ' (Resolving: ' + stack + ')' : msg);\n  };\n\n  /**\n   * Return a named service.\n   *\n   * @param {String} name\n   * @param {Boolean} [strict=true] if false, resolve missing services to null\n   *\n   * @return {Object}\n   */\n  var get = function(name, strict) {\n    if (!providers[name] && name.indexOf('.') !== -1) {\n      var parts = name.split('.');\n      var pivot = get(parts.shift());\n\n      while (parts.length) {\n        pivot = pivot[parts.shift()];\n      }\n\n      return pivot;\n    }\n\n    if (hasOwnProp(instances, name)) {\n      return instances[name];\n    }\n\n    if (hasOwnProp(providers, name)) {\n      if (currentlyResolving.indexOf(name) !== -1) {\n        currentlyResolving.push(name);\n        throw error('Cannot resolve circular dependency!');\n      }\n\n      currentlyResolving.push(name);\n      instances[name] = providers[name][0](providers[name][1]);\n      currentlyResolving.pop();\n\n      return instances[name];\n    }\n\n    return parent.get(name, strict);\n  };\n\n  var fnDef = function(fn, locals) {\n\n    if (typeof locals === 'undefined') {\n      locals = {};\n    }\n\n    if (typeof fn !== 'function') {\n      if (isArray(fn)) {\n        fn = annotate(fn.slice());\n      } else {\n        throw new Error('Cannot invoke \"' + fn + '\". Expected a function!');\n      }\n    }\n\n    var inject = fn.$inject || parseAnnotations(fn);\n    var dependencies = inject.map(function(dep) {\n      if (hasOwnProp(locals, dep)) {\n        return locals[dep];\n      } else {\n        return get(dep);\n      }\n    });\n\n    return {\n      fn: fn,\n      dependencies: dependencies\n    };\n  };\n\n  var instantiate = function(Type) {\n    var def = fnDef(Type);\n\n    var fn = def.fn,\n        dependencies = def.dependencies;\n\n    // instantiate var args constructor\n    var Constructor = Function.prototype.bind.apply(fn, [ null ].concat(dependencies));\n\n    return new Constructor();\n  };\n\n  var invoke = function(func, context, locals) {\n    var def = fnDef(func, locals);\n\n    var fn = def.fn,\n        dependencies = def.dependencies;\n\n    return fn.apply(context, dependencies);\n  };\n\n\n  var createPrivateInjectorFactory = function(privateChildInjector) {\n    return annotate(function(key) {\n      return privateChildInjector.get(key);\n    });\n  };\n\n  var createChild = function(modules, forceNewInstances) {\n    if (forceNewInstances && forceNewInstances.length) {\n      var fromParentModule = Object.create(null);\n      var matchedScopes = Object.create(null);\n\n      var privateInjectorsCache = [];\n      var privateChildInjectors = [];\n      var privateChildFactories = [];\n\n      var provider;\n      var cacheIdx;\n      var privateChildInjector;\n      var privateChildInjectorFactory;\n      for (var name in providers) {\n        provider = providers[name];\n\n        if (forceNewInstances.indexOf(name) !== -1) {\n          if (provider[2] === 'private') {\n            cacheIdx = privateInjectorsCache.indexOf(provider[3]);\n            if (cacheIdx === -1) {\n              privateChildInjector = provider[3].createChild([], forceNewInstances);\n              privateChildInjectorFactory = createPrivateInjectorFactory(privateChildInjector);\n              privateInjectorsCache.push(provider[3]);\n              privateChildInjectors.push(privateChildInjector);\n              privateChildFactories.push(privateChildInjectorFactory);\n              fromParentModule[name] = [privateChildInjectorFactory, name, 'private', privateChildInjector];\n            } else {\n              fromParentModule[name] = [privateChildFactories[cacheIdx], name, 'private', privateChildInjectors[cacheIdx]];\n            }\n          } else {\n            fromParentModule[name] = [provider[2], provider[1]];\n          }\n          matchedScopes[name] = true;\n        }\n\n        if ((provider[2] === 'factory' || provider[2] === 'type') && provider[1].$scope) {\n          /* jshint -W083 */\n          forceNewInstances.forEach(function(scope) {\n            if (provider[1].$scope.indexOf(scope) !== -1) {\n              fromParentModule[name] = [provider[2], provider[1]];\n              matchedScopes[scope] = true;\n            }\n          });\n        }\n      }\n\n      forceNewInstances.forEach(function(scope) {\n        if (!matchedScopes[scope]) {\n          throw new Error('No provider for \"' + scope + '\". Cannot use provider from the parent!');\n        }\n      });\n\n      modules.unshift(fromParentModule);\n    }\n\n    return new Injector(modules, self);\n  };\n\n  var factoryMap = {\n    factory: invoke,\n    type: instantiate,\n    value: function(value) {\n      return value;\n    }\n  };\n\n  modules.forEach(function(module) {\n\n    function arrayUnwrap(type, value) {\n      if (type !== 'value' && isArray(value)) {\n        value = annotate(value.slice());\n      }\n\n      return value;\n    }\n\n    // TODO(vojta): handle wrong inputs (modules)\n    if (module instanceof Module) {\n      module.forEach(function(provider) {\n        var name = provider[0];\n        var type = provider[1];\n        var value = provider[2];\n\n        providers[name] = [factoryMap[type], arrayUnwrap(type, value), type];\n      });\n    } else if (typeof module === 'object') {\n      if (module.__exports__) {\n        var clonedModule = Object.keys(module).reduce(function(m, key) {\n          if (key.substring(0, 2) !== '__') {\n            m[key] = module[key];\n          }\n          return m;\n        }, Object.create(null));\n\n        var privateInjector = new Injector((module.__modules__ || []).concat([clonedModule]), self);\n        var getFromPrivateInjector = annotate(function(key) {\n          return privateInjector.get(key);\n        });\n        module.__exports__.forEach(function(key) {\n          providers[key] = [getFromPrivateInjector, key, 'private', privateInjector];\n        });\n      } else {\n        Object.keys(module).forEach(function(name) {\n          if (module[name][2] === 'private') {\n            providers[name] = module[name];\n            return;\n          }\n\n          var type = module[name][0];\n          var value = module[name][1];\n\n          providers[name] = [factoryMap[type], arrayUnwrap(type, value), type];\n        });\n      }\n    }\n  });\n\n  // public API\n  this.get = get;\n  this.invoke = invoke;\n  this.instantiate = instantiate;\n  this.createChild = createChild;\n}\n\nexport { annotate, parseAnnotations, Module, Injector };\n","var DEFAULT_RENDER_PRIORITY = 1000;\n\n/**\n * The base implementation of shape and connection renderers.\n *\n * @param {EventBus} eventBus\n * @param {number} [renderPriority=1000]\n */\nexport default function BaseRenderer(eventBus, renderPriority) {\n  var self = this;\n\n  renderPriority = renderPriority || DEFAULT_RENDER_PRIORITY;\n\n  eventBus.on([ 'render.shape', 'render.connection' ], renderPriority, function(evt, context) {\n    var type = evt.type,\n        element = context.element,\n        visuals = context.gfx;\n\n    if (self.canRender(element)) {\n      if (type === 'render.shape') {\n        return self.drawShape(visuals, element);\n      } else {\n        return self.drawConnection(visuals, element);\n      }\n    }\n  });\n\n  eventBus.on([ 'render.getShapePath', 'render.getConnectionPath'], renderPriority, function(evt, element) {\n    if (self.canRender(element)) {\n      if (evt.type === 'render.getShapePath') {\n        return self.getShapePath(element);\n      } else {\n        return self.getConnectionPath(element);\n      }\n    }\n  });\n}\n\n/**\n * Should check whether *this* renderer can render\n * the element/connection.\n *\n * @param {element} element\n *\n * @returns {boolean}\n */\nBaseRenderer.prototype.canRender = function() {};\n\n/**\n * Provides the shape's snap svg element to be drawn on the `canvas`.\n *\n * @param {djs.Graphics} visuals\n * @param {Shape} shape\n *\n * @returns {Snap.svg} [returns a Snap.svg paper element ]\n */\nBaseRenderer.prototype.drawShape = function() {};\n\n/**\n * Provides the shape's snap svg element to be drawn on the `canvas`.\n *\n * @param {djs.Graphics} visuals\n * @param {Connection} connection\n *\n * @returns {Snap.svg} [returns a Snap.svg paper element ]\n */\nBaseRenderer.prototype.drawConnection = function() {};\n\n/**\n * Gets the SVG path of a shape that represents it's visual bounds.\n *\n * @param {Shape} shape\n *\n * @return {string} svg path\n */\nBaseRenderer.prototype.getShapePath = function() {};\n\n/**\n * Gets the SVG path of a connection that represents it's visual bounds.\n *\n * @param {Connection} connection\n *\n * @return {string} svg path\n */\nBaseRenderer.prototype.getConnectionPath = function() {};\n","import {\n  attr as svgAttr,\n  create as svgCreate\n} from 'tiny-svg';\n\n\nexport function componentsToPath(elements) {\n  return elements.join(',').replace(/,?([A-z]),?/g, '$1');\n}\n\nexport function toSVGPoints(points) {\n  var result = '';\n\n  for (var i = 0, p; (p = points[i]); i++) {\n    result += p.x + ',' + p.y + ' ';\n  }\n\n  return result;\n}\n\nexport function createLine(points, attrs) {\n\n  var line = svgCreate('polyline');\n  svgAttr(line, { points: toSVGPoints(points) });\n\n  if (attrs) {\n    svgAttr(line, attrs);\n  }\n\n  return line;\n}\n\nexport function updateLine(gfx, points) {\n  svgAttr(gfx, { points: toSVGPoints(points) });\n\n  return gfx;\n}\n","import {\n  assign,\n  filter,\n  find,\n  isArray,\n  isNumber,\n  isObject,\n  isUndefined,\n  groupBy,\n  forEach\n} from 'min-dash';\n\n\n/**\n * Get parent elements.\n *\n * @param {Array<djs.model.base>} elements\n *\n * @returns {Array<djs.model.Base>}\n */\nexport function getParents(elements) {\n\n  // find elements that are not children of any other elements\n  return filter(elements, function(element) {\n    return !find(elements, function(e) {\n      return e !== element && getParent(element, e);\n    });\n  });\n}\n\n\nfunction getParent(element, parent) {\n  if (!parent) {\n    return;\n  }\n\n  if (element === parent) {\n    return parent;\n  }\n\n  if (!element.parent) {\n    return;\n  }\n\n  return getParent(element.parent, parent);\n}\n\n\n/**\n * Adds an element to a collection and returns true if the\n * element was added.\n *\n * @param {Array<Object>} elements\n * @param {Object} e\n * @param {boolean} unique\n */\nexport function add(elements, e, unique) {\n  var canAdd = !unique || elements.indexOf(e) === -1;\n\n  if (canAdd) {\n    elements.push(e);\n  }\n\n  return canAdd;\n}\n\n\n/**\n * Iterate over each element in a collection, calling the iterator function `fn`\n * with (element, index, recursionDepth).\n *\n * Recurse into all elements that are returned by `fn`.\n *\n * @param  {Object|Array<Object>} elements\n * @param  {Function} fn iterator function called with (element, index, recursionDepth)\n * @param  {number} [depth] maximum recursion depth\n */\nexport function eachElement(elements, fn, depth) {\n\n  depth = depth || 0;\n\n  if (!isArray(elements)) {\n    elements = [ elements ];\n  }\n\n  forEach(elements, function(s, i) {\n    var filter = fn(s, i, depth);\n\n    if (isArray(filter) && filter.length) {\n      eachElement(filter, fn, depth + 1);\n    }\n  });\n}\n\n\n/**\n * Collects self + child elements up to a given depth from a list of elements.\n *\n * @param  {djs.model.Base|Array<djs.model.Base>} elements the elements to select the children from\n * @param  {boolean} unique whether to return a unique result set (no duplicates)\n * @param  {number} maxDepth the depth to search through or -1 for infinite\n *\n * @return {Array<djs.model.Base>} found elements\n */\nexport function selfAndChildren(elements, unique, maxDepth) {\n  var result = [],\n      processedChildren = [];\n\n  eachElement(elements, function(element, i, depth) {\n    add(result, element, unique);\n\n    var children = element.children;\n\n    // max traversal depth not reached yet\n    if (maxDepth === -1 || depth < maxDepth) {\n\n      // children exist && children not yet processed\n      if (children && add(processedChildren, children, unique)) {\n        return children;\n      }\n    }\n  });\n\n  return result;\n}\n\n/**\n * Return self + direct children for a number of elements\n *\n * @param  {Array<djs.model.Base>} elements to query\n * @param  {boolean} allowDuplicates to allow duplicates in the result set\n *\n * @return {Array<djs.model.Base>} the collected elements\n */\nexport function selfAndDirectChildren(elements, allowDuplicates) {\n  return selfAndChildren(elements, !allowDuplicates, 1);\n}\n\n\n/**\n * Return self + ALL children for a number of elements\n *\n * @param  {Array<djs.model.Base>} elements to query\n * @param  {boolean} allowDuplicates to allow duplicates in the result set\n *\n * @return {Array<djs.model.Base>} the collected elements\n */\nexport function selfAndAllChildren(elements, allowDuplicates) {\n  return selfAndChildren(elements, !allowDuplicates, -1);\n}\n\n\n/**\n * Gets the the closure for all selected elements,\n * their enclosed children and connections.\n *\n * @param {Array<djs.model.Base>} elements\n * @param {boolean} [isTopLevel=true]\n * @param {Object} [existingClosure]\n *\n * @return {Object} newClosure\n */\nexport function getClosure(elements, isTopLevel, closure) {\n\n  if (isUndefined(isTopLevel)) {\n    isTopLevel = true;\n  }\n\n  if (isObject(isTopLevel)) {\n    closure = isTopLevel;\n    isTopLevel = true;\n  }\n\n\n  closure = closure || {};\n\n  var allShapes = copyObject(closure.allShapes),\n      allConnections = copyObject(closure.allConnections),\n      enclosedElements = copyObject(closure.enclosedElements),\n      enclosedConnections = copyObject(closure.enclosedConnections);\n\n  var topLevel = copyObject(\n    closure.topLevel,\n    isTopLevel && groupBy(elements, function(e) { return e.id; })\n  );\n\n\n  function handleConnection(c) {\n    if (topLevel[c.source.id] && topLevel[c.target.id]) {\n      topLevel[c.id] = [ c ];\n    }\n\n    // not enclosed as a child, but maybe logically\n    // (connecting two moved elements?)\n    if (allShapes[c.source.id] && allShapes[c.target.id]) {\n      enclosedConnections[c.id] = enclosedElements[c.id] = c;\n    }\n\n    allConnections[c.id] = c;\n  }\n\n  function handleElement(element) {\n\n    enclosedElements[element.id] = element;\n\n    if (element.waypoints) {\n\n      // remember connection\n      enclosedConnections[element.id] = allConnections[element.id] = element;\n    } else {\n\n      // remember shape\n      allShapes[element.id] = element;\n\n      // remember all connections\n      forEach(element.incoming, handleConnection);\n\n      forEach(element.outgoing, handleConnection);\n\n      // recurse into children\n      return element.children;\n    }\n  }\n\n  eachElement(elements, handleElement);\n\n  return {\n    allShapes: allShapes,\n    allConnections: allConnections,\n    topLevel: topLevel,\n    enclosedConnections: enclosedConnections,\n    enclosedElements: enclosedElements\n  };\n}\n\n/**\n * Returns the surrounding bbox for all elements in\n * the array or the element primitive.\n *\n * @param {Array<djs.model.Shape>|djs.model.Shape} elements\n * @param {boolean} stopRecursion\n */\nexport function getBBox(elements, stopRecursion) {\n\n  stopRecursion = !!stopRecursion;\n  if (!isArray(elements)) {\n    elements = [elements];\n  }\n\n  var minX,\n      minY,\n      maxX,\n      maxY;\n\n  forEach(elements, function(element) {\n\n    // If element is a connection the bbox must be computed first\n    var bbox = element;\n    if (element.waypoints && !stopRecursion) {\n      bbox = getBBox(element.waypoints, true);\n    }\n\n    var x = bbox.x,\n        y = bbox.y,\n        height = bbox.height || 0,\n        width = bbox.width || 0;\n\n    if (x < minX || minX === undefined) {\n      minX = x;\n    }\n    if (y < minY || minY === undefined) {\n      minY = y;\n    }\n\n    if ((x + width) > maxX || maxX === undefined) {\n      maxX = x + width;\n    }\n    if ((y + height) > maxY || maxY === undefined) {\n      maxY = y + height;\n    }\n  });\n\n  return {\n    x: minX,\n    y: minY,\n    height: maxY - minY,\n    width: maxX - minX\n  };\n}\n\n\n/**\n * Returns all elements that are enclosed from the bounding box.\n *\n *   * If bbox.(width|height) is not specified the method returns\n *     all elements with element.x/y > bbox.x/y\n *   * If only bbox.x or bbox.y is specified, method return all elements with\n *     e.x > bbox.x or e.y > bbox.y\n *\n * @param {Array<djs.model.Shape>} elements List of Elements to search through\n * @param {djs.model.Shape} bbox the enclosing bbox.\n *\n * @return {Array<djs.model.Shape>} enclosed elements\n */\nexport function getEnclosedElements(elements, bbox) {\n\n  var filteredElements = {};\n\n  forEach(elements, function(element) {\n\n    var e = element;\n\n    if (e.waypoints) {\n      e = getBBox(e);\n    }\n\n    if (!isNumber(bbox.y) && (e.x > bbox.x)) {\n      filteredElements[element.id] = element;\n    }\n    if (!isNumber(bbox.x) && (e.y > bbox.y)) {\n      filteredElements[element.id] = element;\n    }\n    if (e.x > bbox.x && e.y > bbox.y) {\n      if (isNumber(bbox.width) && isNumber(bbox.height) &&\n          e.width + e.x < bbox.width + bbox.x &&\n          e.height + e.y < bbox.height + bbox.y) {\n\n        filteredElements[element.id] = element;\n      } else if (!isNumber(bbox.width) || !isNumber(bbox.height)) {\n        filteredElements[element.id] = element;\n      }\n    }\n  });\n\n  return filteredElements;\n}\n\n\nexport function getType(element) {\n\n  if ('waypoints' in element) {\n    return 'connection';\n  }\n\n  if ('x' in element) {\n    return 'shape';\n  }\n\n  return 'root';\n}\n\nexport function isFrameElement(element) {\n\n  return !!(element && element.isFrame);\n}\n\n// helpers ///////////////////////////////\n\nfunction copyObject(src1, src2) {\n  return assign({}, src1 || {}, src2 || {});\n}","import inherits from 'inherits';\n\nimport BaseRenderer from './BaseRenderer';\n\nimport {\n  componentsToPath,\n  createLine\n} from '../util/RenderUtil';\n\nimport {\n  append as svgAppend,\n  attr as svgAttr,\n  create as svgCreate\n} from 'tiny-svg';\n\nimport {\n  isFrameElement\n} from '../util/Elements';\n\n// apply default renderer with lowest possible priority\n// so that it only kicks in if noone else could render\nvar DEFAULT_RENDER_PRIORITY = 1;\n\n/**\n * The default renderer used for shapes and connections.\n *\n * @param {EventBus} eventBus\n * @param {Styles} styles\n */\nexport default function DefaultRenderer(eventBus, styles) {\n\n  //\n  BaseRenderer.call(this, eventBus, DEFAULT_RENDER_PRIORITY);\n\n  this.CONNECTION_STYLE = styles.style([ 'no-fill' ], { strokeWidth: 5, stroke: 'fuchsia' });\n  this.SHAPE_STYLE = styles.style({ fill: 'white', stroke: 'fuchsia', strokeWidth: 2 });\n  this.FRAME_STYLE = styles.style([ 'no-fill' ], { stroke: 'fuchsia', strokeDasharray: 4, strokeWidth: 2 });\n}\n\ninherits(DefaultRenderer, BaseRenderer);\n\n\nDefaultRenderer.prototype.canRender = function() {\n  return true;\n};\n\nDefaultRenderer.prototype.drawShape = function drawShape(visuals, element) {\n  var rect = svgCreate('rect');\n\n  svgAttr(rect, {\n    x: 0,\n    y: 0,\n    width: element.width || 0,\n    height: element.height || 0\n  });\n\n  if (isFrameElement(element)) {\n    svgAttr(rect, this.FRAME_STYLE);\n  } else {\n    svgAttr(rect, this.SHAPE_STYLE);\n  }\n\n  svgAppend(visuals, rect);\n\n  return rect;\n};\n\nDefaultRenderer.prototype.drawConnection = function drawConnection(visuals, connection) {\n\n  var line = createLine(connection.waypoints, this.CONNECTION_STYLE);\n  svgAppend(visuals, line);\n\n  return line;\n};\n\nDefaultRenderer.prototype.getShapePath = function getShapePath(shape) {\n\n  var x = shape.x,\n      y = shape.y,\n      width = shape.width,\n      height = shape.height;\n\n  var shapePath = [\n    ['M', x, y],\n    ['l', width, 0],\n    ['l', 0, height],\n    ['l', -width, 0],\n    ['z']\n  ];\n\n  return componentsToPath(shapePath);\n};\n\nDefaultRenderer.prototype.getConnectionPath = function getConnectionPath(connection) {\n  var waypoints = connection.waypoints;\n\n  var idx, point, connectionPath = [];\n\n  for (idx = 0; (point = waypoints[idx]); idx++) {\n\n    // take invisible docking into account\n    // when creating the path\n    point = point.original || point;\n\n    connectionPath.push([ idx === 0 ? 'M' : 'L', point.x, point.y ]);\n  }\n\n  return componentsToPath(connectionPath);\n};\n\n\nDefaultRenderer.$inject = [ 'eventBus', 'styles' ];\n","import DefaultRenderer from './DefaultRenderer';\nimport Styles from './Styles';\n\nexport default {\n  __init__: [ 'defaultRenderer' ],\n  defaultRenderer: [ 'type', DefaultRenderer ],\n  styles: [ 'type', Styles ]\n};\n","import {\n  isArray,\n  assign,\n  reduce\n} from 'min-dash';\n\n\n/**\n * A component that manages shape styles\n */\nexport default function Styles() {\n\n  var defaultTraits = {\n\n    'no-fill': {\n      fill: 'none'\n    },\n    'no-border': {\n      strokeOpacity: 0.0\n    },\n    'no-events': {\n      pointerEvents: 'none'\n    }\n  };\n\n  var self = this;\n\n  /**\n   * Builds a style definition from a className, a list of traits and an object of additional attributes.\n   *\n   * @param  {string} className\n   * @param  {Array<string>} traits\n   * @param  {Object} additionalAttrs\n   *\n   * @return {Object} the style defintion\n   */\n  this.cls = function(className, traits, additionalAttrs) {\n    var attrs = this.style(traits, additionalAttrs);\n\n    return assign(attrs, { 'class': className });\n  };\n\n  /**\n   * Builds a style definition from a list of traits and an object of additional attributes.\n   *\n   * @param  {Array<string>} traits\n   * @param  {Object} additionalAttrs\n   *\n   * @return {Object} the style defintion\n   */\n  this.style = function(traits, additionalAttrs) {\n\n    if (!isArray(traits) && !additionalAttrs) {\n      additionalAttrs = traits;\n      traits = [];\n    }\n\n    var attrs = reduce(traits, function(attrs, t) {\n      return assign(attrs, defaultTraits[t] || {});\n    }, {});\n\n    return additionalAttrs ? assign(attrs, additionalAttrs) : attrs;\n  };\n\n  this.computeStyle = function(custom, traits, defaultStyles) {\n    if (!isArray(traits)) {\n      defaultStyles = traits;\n      traits = [];\n    }\n\n    return self.style(traits || [], assign({}, defaultStyles, custom || {}));\n  };\n}\n","/**\n * Failsafe remove an element from a collection\n *\n * @param  {Array<Object>} [collection]\n * @param  {Object} [element]\n *\n * @return {number} the previous index of the element\n */\nexport function remove(collection, element) {\n\n  if (!collection || !element) {\n    return -1;\n  }\n\n  var idx = collection.indexOf(element);\n\n  if (idx !== -1) {\n    collection.splice(idx, 1);\n  }\n\n  return idx;\n}\n\n/**\n * Fail save add an element to the given connection, ensuring\n * it does not yet exist.\n *\n * @param {Array<Object>} collection\n * @param {Object} element\n * @param {number} idx\n */\nexport function add(collection, element, idx) {\n\n  if (!collection || !element) {\n    return;\n  }\n\n  if (typeof idx !== 'number') {\n    idx = -1;\n  }\n\n  var currentIdx = collection.indexOf(element);\n\n  if (currentIdx !== -1) {\n\n    if (currentIdx === idx) {\n\n      // nothing to do, position has not changed\n      return;\n    } else {\n\n      if (idx !== -1) {\n\n        // remove from current position\n        collection.splice(currentIdx, 1);\n      } else {\n\n        // already exists in collection\n        return;\n      }\n    }\n  }\n\n  if (idx !== -1) {\n\n    // insert at specified position\n    collection.splice(idx, 0, element);\n  } else {\n\n    // push to end\n    collection.push(element);\n  }\n}\n\n\n/**\n * Fail save get the index of an element in a collection.\n *\n * @param {Array<Object>} collection\n * @param {Object} element\n *\n * @return {number} the index or -1 if collection or element do\n *                  not exist or the element is not contained.\n */\nexport function indexOf(collection, element) {\n\n  if (!collection || !element) {\n    return -1;\n  }\n\n  return collection.indexOf(element);\n}\n","import {\n  isNumber,\n  assign,\n  forEach,\n  every,\n  debounce,\n  bind,\n  reduce\n} from 'min-dash';\n\nimport {\n  add as collectionAdd,\n  remove as collectionRemove\n} from '../util/Collections';\n\nimport {\n  getType\n} from '../util/Elements';\n\nimport {\n  append as svgAppend,\n  attr as svgAttr,\n  classes as svgClasses,\n  create as svgCreate,\n  transform as svgTransform\n} from 'tiny-svg';\n\nimport { createMatrix as createMatrix } from 'tiny-svg';\n\n\nfunction round(number, resolution) {\n  return Math.round(number * resolution) / resolution;\n}\n\nfunction ensurePx(number) {\n  return isNumber(number) ? number + 'px' : number;\n}\n\n/**\n * Creates a HTML container element for a SVG element with\n * the given configuration\n *\n * @param  {Object} options\n * @return {HTMLElement} the container element\n */\nfunction createContainer(options) {\n\n  options = assign({}, { width: '100%', height: '100%' }, options);\n\n  var container = options.container || document.body;\n\n  // create a <div> around the svg element with the respective size\n  // this way we can always get the correct container size\n  // (this is impossible for <svg> elements at the moment)\n  var parent = document.createElement('div');\n  parent.setAttribute('class', 'djs-container');\n\n  assign(parent.style, {\n    position: 'relative',\n    overflow: 'hidden',\n    width: ensurePx(options.width),\n    height: ensurePx(options.height)\n  });\n\n  container.appendChild(parent);\n\n  return parent;\n}\n\nfunction createGroup(parent, cls, childIndex) {\n  var group = svgCreate('g');\n  svgClasses(group).add(cls);\n\n  var index = childIndex !== undefined ? childIndex : parent.childNodes.length - 1;\n\n  // must ensure second argument is node or _null_\n  // cf. https://developer.mozilla.org/en-US/docs/Web/API/Node/insertBefore\n  parent.insertBefore(group, parent.childNodes[index] || null);\n\n  return group;\n}\n\nvar BASE_LAYER = 'base';\n\n\nvar REQUIRED_MODEL_ATTRS = {\n  shape: [ 'x', 'y', 'width', 'height' ],\n  connection: [ 'waypoints' ]\n};\n\n/**\n * The main drawing canvas.\n *\n * @class\n * @constructor\n *\n * @emits Canvas#canvas.init\n *\n * @param {Object} config\n * @param {EventBus} eventBus\n * @param {GraphicsFactory} graphicsFactory\n * @param {ElementRegistry} elementRegistry\n */\nexport default function Canvas(config, eventBus, graphicsFactory, elementRegistry) {\n\n  this._eventBus = eventBus;\n  this._elementRegistry = elementRegistry;\n  this._graphicsFactory = graphicsFactory;\n\n  this._init(config || {});\n}\n\nCanvas.$inject = [\n  'config.canvas',\n  'eventBus',\n  'graphicsFactory',\n  'elementRegistry'\n];\n\n\nCanvas.prototype._init = function(config) {\n\n  var eventBus = this._eventBus;\n\n  // Creates a <svg> element that is wrapped into a <div>.\n  // This way we are always able to correctly figure out the size of the svg element\n  // by querying the parent node.\n  //\n  // (It is not possible to get the size of a svg element cross browser @ 2014-04-01)\n  //\n  // <div class=\"djs-container\" style=\"width: {desired-width}, height: {desired-height}\">\n  //   <svg width=\"100%\" height=\"100%\">\n  //    ...\n  //   </svg>\n  // </div>\n\n  // html container\n  var container = this._container = createContainer(config);\n\n  var svg = this._svg = svgCreate('svg');\n  svgAttr(svg, { width: '100%', height: '100%' });\n\n  svgAppend(container, svg);\n\n  var viewport = this._viewport = createGroup(svg, 'viewport');\n\n  this._layers = {};\n\n  // debounce canvas.viewbox.changed events\n  // for smoother diagram interaction\n  if (config.deferUpdate !== false) {\n    this._viewboxChanged = debounce(bind(this._viewboxChanged, this), 300);\n  }\n\n  eventBus.on('diagram.init', function() {\n\n    /**\n     * An event indicating that the canvas is ready to be drawn on.\n     *\n     * @memberOf Canvas\n     *\n     * @event canvas.init\n     *\n     * @type {Object}\n     * @property {SVGElement} svg the created svg element\n     * @property {SVGElement} viewport the direct parent of diagram elements and shapes\n     */\n    eventBus.fire('canvas.init', {\n      svg: svg,\n      viewport: viewport\n    });\n\n  }, this);\n\n  // reset viewbox on shape changes to\n  // recompute the viewbox\n  eventBus.on([\n    'shape.added',\n    'connection.added',\n    'shape.removed',\n    'connection.removed',\n    'elements.changed'\n  ], function() {\n    delete this._cachedViewbox;\n  }, this);\n\n  eventBus.on('diagram.destroy', 500, this._destroy, this);\n  eventBus.on('diagram.clear', 500, this._clear, this);\n};\n\nCanvas.prototype._destroy = function(emit) {\n  this._eventBus.fire('canvas.destroy', {\n    svg: this._svg,\n    viewport: this._viewport\n  });\n\n  var parent = this._container.parentNode;\n\n  if (parent) {\n    parent.removeChild(this._container);\n  }\n\n  delete this._svg;\n  delete this._container;\n  delete this._layers;\n  delete this._rootElement;\n  delete this._viewport;\n};\n\nCanvas.prototype._clear = function() {\n\n  var self = this;\n\n  var allElements = this._elementRegistry.getAll();\n\n  // remove all elements\n  allElements.forEach(function(element) {\n    var type = getType(element);\n\n    if (type === 'root') {\n      self.setRootElement(null, true);\n    } else {\n      self._removeElement(element, type);\n    }\n  });\n\n  // force recomputation of view box\n  delete this._cachedViewbox;\n};\n\n/**\n * Returns the default layer on which\n * all elements are drawn.\n *\n * @returns {SVGElement}\n */\nCanvas.prototype.getDefaultLayer = function() {\n  return this.getLayer(BASE_LAYER, 0);\n};\n\n/**\n * Returns a layer that is used to draw elements\n * or annotations on it.\n *\n * Non-existing layers retrieved through this method\n * will be created. During creation, the optional index\n * may be used to create layers below or above existing layers.\n * A layer with a certain index is always created above all\n * existing layers with the same index.\n *\n * @param {string} name\n * @param {number} index\n *\n * @returns {SVGElement}\n */\nCanvas.prototype.getLayer = function(name, index) {\n\n  if (!name) {\n    throw new Error('must specify a name');\n  }\n\n  var layer = this._layers[name];\n\n  if (!layer) {\n    layer = this._layers[name] = this._createLayer(name, index);\n  }\n\n  // throw an error if layer creation / retrival is\n  // requested on different index\n  if (typeof index !== 'undefined' && layer.index !== index) {\n    throw new Error('layer <' + name + '> already created at index <' + index + '>');\n  }\n\n  return layer.group;\n};\n\n/**\n * Creates a given layer and returns it.\n *\n * @param {string} name\n * @param {number} [index=0]\n *\n * @return {Object} layer descriptor with { index, group: SVGGroup }\n */\nCanvas.prototype._createLayer = function(name, index) {\n\n  if (!index) {\n    index = 0;\n  }\n\n  var childIndex = reduce(this._layers, function(childIndex, layer) {\n    if (index >= layer.index) {\n      childIndex++;\n    }\n\n    return childIndex;\n  }, 0);\n\n  return {\n    group: createGroup(this._viewport, 'layer-' + name, childIndex),\n    index: index\n  };\n\n};\n\n/**\n * Returns the html element that encloses the\n * drawing canvas.\n *\n * @return {DOMNode}\n */\nCanvas.prototype.getContainer = function() {\n  return this._container;\n};\n\n\n// markers //////////////////////\n\nCanvas.prototype._updateMarker = function(element, marker, add) {\n  var container;\n\n  if (!element.id) {\n    element = this._elementRegistry.get(element);\n  }\n\n  // we need to access all\n  container = this._elementRegistry._elements[element.id];\n\n  if (!container) {\n    return;\n  }\n\n  forEach([ container.gfx, container.secondaryGfx ], function(gfx) {\n    if (gfx) {\n\n      // invoke either addClass or removeClass based on mode\n      if (add) {\n        svgClasses(gfx).add(marker);\n      } else {\n        svgClasses(gfx).remove(marker);\n      }\n    }\n  });\n\n  /**\n   * An event indicating that a marker has been updated for an element\n   *\n   * @event element.marker.update\n   * @type {Object}\n   * @property {djs.model.Element} element the shape\n   * @property {Object} gfx the graphical representation of the shape\n   * @property {string} marker\n   * @property {boolean} add true if the marker was added, false if it got removed\n   */\n  this._eventBus.fire('element.marker.update', { element: element, gfx: container.gfx, marker: marker, add: !!add });\n};\n\n\n/**\n * Adds a marker to an element (basically a css class).\n *\n * Fires the element.marker.update event, making it possible to\n * integrate extension into the marker life-cycle, too.\n *\n * @example\n * canvas.addMarker('foo', 'some-marker');\n *\n * var fooGfx = canvas.getGraphics('foo');\n *\n * fooGfx; // <g class=\"... some-marker\"> ... </g>\n *\n * @param {string|djs.model.Base} element\n * @param {string} marker\n */\nCanvas.prototype.addMarker = function(element, marker) {\n  this._updateMarker(element, marker, true);\n};\n\n\n/**\n * Remove a marker from an element.\n *\n * Fires the element.marker.update event, making it possible to\n * integrate extension into the marker life-cycle, too.\n *\n * @param  {string|djs.model.Base} element\n * @param  {string} marker\n */\nCanvas.prototype.removeMarker = function(element, marker) {\n  this._updateMarker(element, marker, false);\n};\n\n/**\n * Check the existence of a marker on element.\n *\n * @param  {string|djs.model.Base} element\n * @param  {string} marker\n */\nCanvas.prototype.hasMarker = function(element, marker) {\n  if (!element.id) {\n    element = this._elementRegistry.get(element);\n  }\n\n  var gfx = this.getGraphics(element);\n\n  return svgClasses(gfx).has(marker);\n};\n\n/**\n * Toggles a marker on an element.\n *\n * Fires the element.marker.update event, making it possible to\n * integrate extension into the marker life-cycle, too.\n *\n * @param  {string|djs.model.Base} element\n * @param  {string} marker\n */\nCanvas.prototype.toggleMarker = function(element, marker) {\n  if (this.hasMarker(element, marker)) {\n    this.removeMarker(element, marker);\n  } else {\n    this.addMarker(element, marker);\n  }\n};\n\nCanvas.prototype.getRootElement = function() {\n  if (!this._rootElement) {\n    this.setRootElement({ id: '__implicitroot', children: [] });\n  }\n\n  return this._rootElement;\n};\n\n\n\n// root element handling //////////////////////\n\n/**\n * Sets a given element as the new root element for the canvas\n * and returns the new root element.\n *\n * @param {Object|djs.model.Root} element\n * @param {boolean} [override] whether to override the current root element, if any\n *\n * @return {Object|djs.model.Root} new root element\n */\nCanvas.prototype.setRootElement = function(element, override) {\n\n  if (element) {\n    this._ensureValid('root', element);\n  }\n\n  var currentRoot = this._rootElement,\n      elementRegistry = this._elementRegistry,\n      eventBus = this._eventBus;\n\n  if (currentRoot) {\n    if (!override) {\n      throw new Error('rootElement already set, need to specify override');\n    }\n\n    // simulate element remove event sequence\n    eventBus.fire('root.remove', { element: currentRoot });\n    eventBus.fire('root.removed', { element: currentRoot });\n\n    elementRegistry.remove(currentRoot);\n  }\n\n  if (element) {\n    var gfx = this.getDefaultLayer();\n\n    // resemble element add event sequence\n    eventBus.fire('root.add', { element: element });\n\n    elementRegistry.add(element, gfx, this._svg);\n\n    eventBus.fire('root.added', { element: element, gfx: gfx });\n  }\n\n  this._rootElement = element;\n\n  return element;\n};\n\n\n\n// add functionality //////////////////////\n\nCanvas.prototype._ensureValid = function(type, element) {\n  if (!element.id) {\n    throw new Error('element must have an id');\n  }\n\n  if (this._elementRegistry.get(element.id)) {\n    throw new Error('element with id ' + element.id + ' already exists');\n  }\n\n  var requiredAttrs = REQUIRED_MODEL_ATTRS[type];\n\n  var valid = every(requiredAttrs, function(attr) {\n    return typeof element[attr] !== 'undefined';\n  });\n\n  if (!valid) {\n    throw new Error(\n      'must supply { ' + requiredAttrs.join(', ') + ' } with ' + type);\n  }\n};\n\nCanvas.prototype._setParent = function(element, parent, parentIndex) {\n  collectionAdd(parent.children, element, parentIndex);\n  element.parent = parent;\n};\n\n/**\n * Adds an element to the canvas.\n *\n * This wires the parent <-> child relationship between the element and\n * a explicitly specified parent or an implicit root element.\n *\n * During add it emits the events\n *\n *  * <{type}.add> (element, parent)\n *  * <{type}.added> (element, gfx)\n *\n * Extensions may hook into these events to perform their magic.\n *\n * @param {string} type\n * @param {Object|djs.model.Base} element\n * @param {Object|djs.model.Base} [parent]\n * @param {number} [parentIndex]\n *\n * @return {Object|djs.model.Base} the added element\n */\nCanvas.prototype._addElement = function(type, element, parent, parentIndex) {\n\n  parent = parent || this.getRootElement();\n\n  var eventBus = this._eventBus,\n      graphicsFactory = this._graphicsFactory;\n\n  this._ensureValid(type, element);\n\n  eventBus.fire(type + '.add', { element: element, parent: parent });\n\n  this._setParent(element, parent, parentIndex);\n\n  // create graphics\n  var gfx = graphicsFactory.create(type, element, parentIndex);\n\n  this._elementRegistry.add(element, gfx);\n\n  // update its visual\n  graphicsFactory.update(type, element, gfx);\n\n  eventBus.fire(type + '.added', { element: element, gfx: gfx });\n\n  return element;\n};\n\n/**\n * Adds a shape to the canvas\n *\n * @param {Object|djs.model.Shape} shape to add to the diagram\n * @param {djs.model.Base} [parent]\n * @param {number} [parentIndex]\n *\n * @return {djs.model.Shape} the added shape\n */\nCanvas.prototype.addShape = function(shape, parent, parentIndex) {\n  return this._addElement('shape', shape, parent, parentIndex);\n};\n\n/**\n * Adds a connection to the canvas\n *\n * @param {Object|djs.model.Connection} connection to add to the diagram\n * @param {djs.model.Base} [parent]\n * @param {number} [parentIndex]\n *\n * @return {djs.model.Connection} the added connection\n */\nCanvas.prototype.addConnection = function(connection, parent, parentIndex) {\n  return this._addElement('connection', connection, parent, parentIndex);\n};\n\n\n/**\n * Internal remove element\n */\nCanvas.prototype._removeElement = function(element, type) {\n\n  var elementRegistry = this._elementRegistry,\n      graphicsFactory = this._graphicsFactory,\n      eventBus = this._eventBus;\n\n  element = elementRegistry.get(element.id || element);\n\n  if (!element) {\n\n    // element was removed already\n    return;\n  }\n\n  eventBus.fire(type + '.remove', { element: element });\n\n  graphicsFactory.remove(element);\n\n  // unset parent <-> child relationship\n  collectionRemove(element.parent && element.parent.children, element);\n  element.parent = null;\n\n  eventBus.fire(type + '.removed', { element: element });\n\n  elementRegistry.remove(element);\n\n  return element;\n};\n\n\n/**\n * Removes a shape from the canvas\n *\n * @param {string|djs.model.Shape} shape or shape id to be removed\n *\n * @return {djs.model.Shape} the removed shape\n */\nCanvas.prototype.removeShape = function(shape) {\n\n  /**\n   * An event indicating that a shape is about to be removed from the canvas.\n   *\n   * @memberOf Canvas\n   *\n   * @event shape.remove\n   * @type {Object}\n   * @property {djs.model.Shape} element the shape descriptor\n   * @property {Object} gfx the graphical representation of the shape\n   */\n\n  /**\n   * An event indicating that a shape has been removed from the canvas.\n   *\n   * @memberOf Canvas\n   *\n   * @event shape.removed\n   * @type {Object}\n   * @property {djs.model.Shape} element the shape descriptor\n   * @property {Object} gfx the graphical representation of the shape\n   */\n  return this._removeElement(shape, 'shape');\n};\n\n\n/**\n * Removes a connection from the canvas\n *\n * @param {string|djs.model.Connection} connection or connection id to be removed\n *\n * @return {djs.model.Connection} the removed connection\n */\nCanvas.prototype.removeConnection = function(connection) {\n\n  /**\n   * An event indicating that a connection is about to be removed from the canvas.\n   *\n   * @memberOf Canvas\n   *\n   * @event connection.remove\n   * @type {Object}\n   * @property {djs.model.Connection} element the connection descriptor\n   * @property {Object} gfx the graphical representation of the connection\n   */\n\n  /**\n   * An event indicating that a connection has been removed from the canvas.\n   *\n   * @memberOf Canvas\n   *\n   * @event connection.removed\n   * @type {Object}\n   * @property {djs.model.Connection} element the connection descriptor\n   * @property {Object} gfx the graphical representation of the connection\n   */\n  return this._removeElement(connection, 'connection');\n};\n\n\n/**\n * Return the graphical object underlaying a certain diagram element\n *\n * @param {string|djs.model.Base} element descriptor of the element\n * @param {boolean} [secondary=false] whether to return the secondary connected element\n *\n * @return {SVGElement}\n */\nCanvas.prototype.getGraphics = function(element, secondary) {\n  return this._elementRegistry.getGraphics(element, secondary);\n};\n\n\n/**\n * Perform a viewbox update via a given change function.\n *\n * @param {Function} changeFn\n */\nCanvas.prototype._changeViewbox = function(changeFn) {\n\n  // notify others of the upcoming viewbox change\n  this._eventBus.fire('canvas.viewbox.changing');\n\n  // perform actual change\n  changeFn.apply(this);\n\n  // reset the cached viewbox so that\n  // a new get operation on viewbox or zoom\n  // triggers a viewbox re-computation\n  this._cachedViewbox = null;\n\n  // notify others of the change; this step\n  // may or may not be debounced\n  this._viewboxChanged();\n};\n\nCanvas.prototype._viewboxChanged = function() {\n  this._eventBus.fire('canvas.viewbox.changed', { viewbox: this.viewbox() });\n};\n\n\n/**\n * Gets or sets the view box of the canvas, i.e. the\n * area that is currently displayed.\n *\n * The getter may return a cached viewbox (if it is currently\n * changing). To force a recomputation, pass `false` as the first argument.\n *\n * @example\n *\n * canvas.viewbox({ x: 100, y: 100, width: 500, height: 500 })\n *\n * // sets the visible area of the diagram to (100|100) -> (600|100)\n * // and and scales it according to the diagram width\n *\n * var viewbox = canvas.viewbox(); // pass `false` to force recomputing the box.\n *\n * console.log(viewbox);\n * // {\n * //   inner: Dimensions,\n * //   outer: Dimensions,\n * //   scale,\n * //   x, y,\n * //   width, height\n * // }\n *\n * // if the current diagram is zoomed and scrolled, you may reset it to the\n * // default zoom via this method, too:\n *\n * var zoomedAndScrolledViewbox = canvas.viewbox();\n *\n * canvas.viewbox({\n *   x: 0,\n *   y: 0,\n *   width: zoomedAndScrolledViewbox.outer.width,\n *   height: zoomedAndScrolledViewbox.outer.height\n * });\n *\n * @param  {Object} [box] the new view box to set\n * @param  {number} box.x the top left X coordinate of the canvas visible in view box\n * @param  {number} box.y the top left Y coordinate of the canvas visible in view box\n * @param  {number} box.width the visible width\n * @param  {number} box.height\n *\n * @return {Object} the current view box\n */\nCanvas.prototype.viewbox = function(box) {\n\n  if (box === undefined && this._cachedViewbox) {\n    return this._cachedViewbox;\n  }\n\n  var viewport = this._viewport,\n      innerBox,\n      outerBox = this.getSize(),\n      matrix,\n      transform,\n      scale,\n      x, y;\n\n  if (!box) {\n\n    // compute the inner box based on the\n    // diagrams default layer. This allows us to exclude\n    // external components, such as overlays\n    innerBox = this.getDefaultLayer().getBBox();\n\n    transform = svgTransform(viewport);\n    matrix = transform ? transform.matrix : createMatrix();\n    scale = round(matrix.a, 1000);\n\n    x = round(-matrix.e || 0, 1000);\n    y = round(-matrix.f || 0, 1000);\n\n    box = this._cachedViewbox = {\n      x: x ? x / scale : 0,\n      y: y ? y / scale : 0,\n      width: outerBox.width / scale,\n      height: outerBox.height / scale,\n      scale: scale,\n      inner: {\n        width: innerBox.width,\n        height: innerBox.height,\n        x: innerBox.x,\n        y: innerBox.y\n      },\n      outer: outerBox\n    };\n\n    return box;\n  } else {\n\n    this._changeViewbox(function() {\n      scale = Math.min(outerBox.width / box.width, outerBox.height / box.height);\n\n      var matrix = this._svg.createSVGMatrix()\n        .scale(scale)\n        .translate(-box.x, -box.y);\n\n      svgTransform(viewport, matrix);\n    });\n  }\n\n  return box;\n};\n\n\n/**\n * Gets or sets the scroll of the canvas.\n *\n * @param {Object} [delta] the new scroll to apply.\n *\n * @param {number} [delta.dx]\n * @param {number} [delta.dy]\n */\nCanvas.prototype.scroll = function(delta) {\n\n  var node = this._viewport;\n  var matrix = node.getCTM();\n\n  if (delta) {\n    this._changeViewbox(function() {\n      delta = assign({ dx: 0, dy: 0 }, delta || {});\n\n      matrix = this._svg.createSVGMatrix().translate(delta.dx, delta.dy).multiply(matrix);\n\n      setCTM(node, matrix);\n    });\n  }\n\n  return { x: matrix.e, y: matrix.f };\n};\n\n\n/**\n * Gets or sets the current zoom of the canvas, optionally zooming\n * to the specified position.\n *\n * The getter may return a cached zoom level. Call it with `false` as\n * the first argument to force recomputation of the current level.\n *\n * @param {string|number} [newScale] the new zoom level, either a number, i.e. 0.9,\n *                                   or `fit-viewport` to adjust the size to fit the current viewport\n * @param {string|Point} [center] the reference point { x: .., y: ..} to zoom to, 'auto' to zoom into mid or null\n *\n * @return {number} the current scale\n */\nCanvas.prototype.zoom = function(newScale, center) {\n\n  if (!newScale) {\n    return this.viewbox(newScale).scale;\n  }\n\n  if (newScale === 'fit-viewport') {\n    return this._fitViewport(center);\n  }\n\n  var outer,\n      matrix;\n\n  this._changeViewbox(function() {\n\n    if (typeof center !== 'object') {\n      outer = this.viewbox().outer;\n\n      center = {\n        x: outer.width / 2,\n        y: outer.height / 2\n      };\n    }\n\n    matrix = this._setZoom(newScale, center);\n  });\n\n  return round(matrix.a, 1000);\n};\n\nfunction setCTM(node, m) {\n  var mstr = 'matrix(' + m.a + ',' + m.b + ',' + m.c + ',' + m.d + ',' + m.e + ',' + m.f + ')';\n  node.setAttribute('transform', mstr);\n}\n\nCanvas.prototype._fitViewport = function(center) {\n\n  var vbox = this.viewbox(),\n      outer = vbox.outer,\n      inner = vbox.inner,\n      newScale,\n      newViewbox;\n\n  // display the complete diagram without zooming in.\n  // instead of relying on internal zoom, we perform a\n  // hard reset on the canvas viewbox to realize this\n  //\n  // if diagram does not need to be zoomed in, we focus it around\n  // the diagram origin instead\n\n  if (inner.x >= 0 &&\n      inner.y >= 0 &&\n      inner.x + inner.width <= outer.width &&\n      inner.y + inner.height <= outer.height &&\n      !center) {\n\n    newViewbox = {\n      x: 0,\n      y: 0,\n      width: Math.max(inner.width + inner.x, outer.width),\n      height: Math.max(inner.height + inner.y, outer.height)\n    };\n  } else {\n\n    newScale = Math.min(1, outer.width / inner.width, outer.height / inner.height);\n    newViewbox = {\n      x: inner.x + (center ? inner.width / 2 - outer.width / newScale / 2 : 0),\n      y: inner.y + (center ? inner.height / 2 - outer.height / newScale / 2 : 0),\n      width: outer.width / newScale,\n      height: outer.height / newScale\n    };\n  }\n\n  this.viewbox(newViewbox);\n\n  return this.viewbox(false).scale;\n};\n\n\nCanvas.prototype._setZoom = function(scale, center) {\n\n  var svg = this._svg,\n      viewport = this._viewport;\n\n  var matrix = svg.createSVGMatrix();\n  var point = svg.createSVGPoint();\n\n  var centerPoint,\n      originalPoint,\n      currentMatrix,\n      scaleMatrix,\n      newMatrix;\n\n  currentMatrix = viewport.getCTM();\n\n  var currentScale = currentMatrix.a;\n\n  if (center) {\n    centerPoint = assign(point, center);\n\n    // revert applied viewport transformations\n    originalPoint = centerPoint.matrixTransform(currentMatrix.inverse());\n\n    // create scale matrix\n    scaleMatrix = matrix\n      .translate(originalPoint.x, originalPoint.y)\n      .scale(1 / currentScale * scale)\n      .translate(-originalPoint.x, -originalPoint.y);\n\n    newMatrix = currentMatrix.multiply(scaleMatrix);\n  } else {\n    newMatrix = matrix.scale(scale);\n  }\n\n  setCTM(this._viewport, newMatrix);\n\n  return newMatrix;\n};\n\n\n/**\n * Returns the size of the canvas\n *\n * @return {Dimensions}\n */\nCanvas.prototype.getSize = function() {\n  return {\n    width: this._container.clientWidth,\n    height: this._container.clientHeight\n  };\n};\n\n\n/**\n * Return the absolute bounding box for the given element\n *\n * The absolute bounding box may be used to display overlays in the\n * callers (browser) coordinate system rather than the zoomed in/out\n * canvas coordinates.\n *\n * @param  {ElementDescriptor} element\n * @return {Bounds} the absolute bounding box\n */\nCanvas.prototype.getAbsoluteBBox = function(element) {\n  var vbox = this.viewbox();\n  var bbox;\n\n  // connection\n  // use svg bbox\n  if (element.waypoints) {\n    var gfx = this.getGraphics(element);\n\n    bbox = gfx.getBBox();\n  }\n\n  // shapes\n  // use data\n  else {\n    bbox = element;\n  }\n\n  var x = bbox.x * vbox.scale - vbox.x * vbox.scale;\n  var y = bbox.y * vbox.scale - vbox.y * vbox.scale;\n\n  var width = bbox.width * vbox.scale;\n  var height = bbox.height * vbox.scale;\n\n  return {\n    x: x,\n    y: y,\n    width: width,\n    height: height\n  };\n};\n\n/**\n * Fires an event in order other modules can react to the\n * canvas resizing\n */\nCanvas.prototype.resized = function() {\n\n  // force recomputation of view box\n  delete this._cachedViewbox;\n\n  this._eventBus.fire('canvas.resized');\n};\n","var ELEMENT_ID = 'data-element-id';\n\nimport { attr as svgAttr } from 'tiny-svg';\n\n\n/**\n * @class\n *\n * A registry that keeps track of all shapes in the diagram.\n */\nexport default function ElementRegistry(eventBus) {\n  this._elements = {};\n\n  this._eventBus = eventBus;\n}\n\nElementRegistry.$inject = [ 'eventBus' ];\n\n/**\n * Register a pair of (element, gfx, (secondaryGfx)).\n *\n * @param {djs.model.Base} element\n * @param {SVGElement} gfx\n * @param {SVGElement} [secondaryGfx] optional other element to register, too\n */\nElementRegistry.prototype.add = function(element, gfx, secondaryGfx) {\n\n  var id = element.id;\n\n  this._validateId(id);\n\n  // associate dom node with element\n  svgAttr(gfx, ELEMENT_ID, id);\n\n  if (secondaryGfx) {\n    svgAttr(secondaryGfx, ELEMENT_ID, id);\n  }\n\n  this._elements[id] = { element: element, gfx: gfx, secondaryGfx: secondaryGfx };\n};\n\n/**\n * Removes an element from the registry.\n *\n * @param {djs.model.Base} element\n */\nElementRegistry.prototype.remove = function(element) {\n  var elements = this._elements,\n      id = element.id || element,\n      container = id && elements[id];\n\n  if (container) {\n\n    // unset element id on gfx\n    svgAttr(container.gfx, ELEMENT_ID, '');\n\n    if (container.secondaryGfx) {\n      svgAttr(container.secondaryGfx, ELEMENT_ID, '');\n    }\n\n    delete elements[id];\n  }\n};\n\n/**\n * Update the id of an element\n *\n * @param {djs.model.Base} element\n * @param {string} newId\n */\nElementRegistry.prototype.updateId = function(element, newId) {\n\n  this._validateId(newId);\n\n  if (typeof element === 'string') {\n    element = this.get(element);\n  }\n\n  this._eventBus.fire('element.updateId', {\n    element: element,\n    newId: newId\n  });\n\n  var gfx = this.getGraphics(element),\n      secondaryGfx = this.getGraphics(element, true);\n\n  this.remove(element);\n\n  element.id = newId;\n\n  this.add(element, gfx, secondaryGfx);\n};\n\n/**\n * Return the model element for a given id or graphics.\n *\n * @example\n *\n * elementRegistry.get('SomeElementId_1');\n * elementRegistry.get(gfx);\n *\n *\n * @param {string|SVGElement} filter for selecting the element\n *\n * @return {djs.model.Base}\n */\nElementRegistry.prototype.get = function(filter) {\n  var id;\n\n  if (typeof filter === 'string') {\n    id = filter;\n  } else {\n    id = filter && svgAttr(filter, ELEMENT_ID);\n  }\n\n  var container = this._elements[id];\n  return container && container.element;\n};\n\n/**\n * Return all elements that match a given filter function.\n *\n * @param {Function} fn\n *\n * @return {Array<djs.model.Base>}\n */\nElementRegistry.prototype.filter = function(fn) {\n\n  var filtered = [];\n\n  this.forEach(function(element, gfx) {\n    if (fn(element, gfx)) {\n      filtered.push(element);\n    }\n  });\n\n  return filtered;\n};\n\n/**\n * Return the first element that satisfies the provided testing function.\n *\n * @param {Function} fn\n *\n * @return {djs.model.Base}\n */\nElementRegistry.prototype.find = function(fn) {\n  var map = this._elements,\n      keys = Object.keys(map);\n\n  for (var i = 0; i < keys.length; i++) {\n    var id = keys[i],\n        container = map[id],\n        element = container.element,\n        gfx = container.gfx;\n\n    if (fn(element, gfx)) {\n      return element;\n    }\n  }\n};\n\n/**\n * Return all rendered model elements.\n *\n * @return {Array<djs.model.Base>}\n */\nElementRegistry.prototype.getAll = function() {\n  return this.filter(function(e) { return e; });\n};\n\n/**\n * Iterate over all diagram elements.\n *\n * @param {Function} fn\n */\nElementRegistry.prototype.forEach = function(fn) {\n\n  var map = this._elements;\n\n  Object.keys(map).forEach(function(id) {\n    var container = map[id],\n        element = container.element,\n        gfx = container.gfx;\n\n    return fn(element, gfx);\n  });\n};\n\n/**\n * Return the graphical representation of an element or its id.\n *\n * @example\n * elementRegistry.getGraphics('SomeElementId_1');\n * elementRegistry.getGraphics(rootElement); // <g ...>\n *\n * elementRegistry.getGraphics(rootElement, true); // <svg ...>\n *\n *\n * @param {string|djs.model.Base} filter\n * @param {boolean} [secondary=false] whether to return the secondary connected element\n *\n * @return {SVGElement}\n */\nElementRegistry.prototype.getGraphics = function(filter, secondary) {\n  var id = filter.id || filter;\n\n  var container = this._elements[id];\n  return container && (secondary ? container.secondaryGfx : container.gfx);\n};\n\n/**\n * Validate the suitability of the given id and signals a problem\n * with an exception.\n *\n * @param {string} id\n *\n * @throws {Error} if id is empty or already assigned\n */\nElementRegistry.prototype._validateId = function(id) {\n  if (!id) {\n    throw new Error('element must have an id');\n  }\n\n  if (this._elements[id]) {\n    throw new Error('element with id ' + id + ' already added');\n  }\n};\n","import { assign } from 'min-dash';\nimport inherits from 'inherits';\n\nimport Refs from 'object-refs';\n\nvar parentRefs = new Refs({ name: 'children', enumerable: true, collection: true }, { name: 'parent' }),\n    labelRefs = new Refs({ name: 'labels', enumerable: true, collection: true }, { name: 'labelTarget' }),\n    attacherRefs = new Refs({ name: 'attachers', collection: true }, { name: 'host' }),\n    outgoingRefs = new Refs({ name: 'outgoing', collection: true }, { name: 'source' }),\n    incomingRefs = new Refs({ name: 'incoming', collection: true }, { name: 'target' });\n\n/**\n * @namespace djs.model\n */\n\n/**\n * @memberOf djs.model\n */\n\n/**\n * The basic graphical representation\n *\n * @class\n *\n * @abstract\n */\nexport function Base() {\n\n  /**\n   * The object that backs up the shape\n   *\n   * @name Base#businessObject\n   * @type Object\n   */\n  Object.defineProperty(this, 'businessObject', {\n    writable: true\n  });\n\n\n  /**\n   * Single label support, will mapped to multi label array\n   *\n   * @name Base#label\n   * @type Object\n   */\n  Object.defineProperty(this, 'label', {\n    get: function() {\n      return this.labels[0];\n    },\n    set: function(newLabel) {\n\n      var label = this.label,\n          labels = this.labels;\n\n      if (!newLabel && label) {\n        labels.remove(label);\n      } else {\n        labels.add(newLabel, 0);\n      }\n    }\n  });\n\n  /**\n   * The parent shape\n   *\n   * @name Base#parent\n   * @type Shape\n   */\n  parentRefs.bind(this, 'parent');\n\n  /**\n   * The list of labels\n   *\n   * @name Base#labels\n   * @type Label\n   */\n  labelRefs.bind(this, 'labels');\n\n  /**\n   * The list of outgoing connections\n   *\n   * @name Base#outgoing\n   * @type Array<Connection>\n   */\n  outgoingRefs.bind(this, 'outgoing');\n\n  /**\n   * The list of incoming connections\n   *\n   * @name Base#incoming\n   * @type Array<Connection>\n   */\n  incomingRefs.bind(this, 'incoming');\n}\n\n\n/**\n * A graphical object\n *\n * @class\n * @constructor\n *\n * @extends Base\n */\nexport function Shape() {\n  Base.call(this);\n\n  /**\n   * Indicates frame shapes\n   *\n   * @name Shape#isFrame\n   * @type boolean\n   */\n\n  /**\n   * The list of children\n   *\n   * @name Shape#children\n   * @type Array<Base>\n   */\n  parentRefs.bind(this, 'children');\n\n  /**\n   * @name Shape#host\n   * @type Shape\n   */\n  attacherRefs.bind(this, 'host');\n\n  /**\n   * @name Shape#attachers\n   * @type Shape\n   */\n  attacherRefs.bind(this, 'attachers');\n}\n\ninherits(Shape, Base);\n\n\n/**\n * A root graphical object\n *\n * @class\n * @constructor\n *\n * @extends Shape\n */\nexport function Root() {\n  Shape.call(this);\n}\n\ninherits(Root, Shape);\n\n\n/**\n * A label for an element\n *\n * @class\n * @constructor\n *\n * @extends Shape\n */\nexport function Label() {\n  Shape.call(this);\n\n  /**\n   * The labeled element\n   *\n   * @name Label#labelTarget\n   * @type Base\n   */\n  labelRefs.bind(this, 'labelTarget');\n}\n\ninherits(Label, Shape);\n\n\n/**\n * A connection between two elements\n *\n * @class\n * @constructor\n *\n * @extends Base\n */\nexport function Connection() {\n  Base.call(this);\n\n  /**\n   * The element this connection originates from\n   *\n   * @name Connection#source\n   * @type Base\n   */\n  outgoingRefs.bind(this, 'source');\n\n  /**\n   * The element this connection points to\n   *\n   * @name Connection#target\n   * @type Base\n   */\n  incomingRefs.bind(this, 'target');\n}\n\ninherits(Connection, Base);\n\n\nvar types = {\n  connection: Connection,\n  shape: Shape,\n  label: Label,\n  root: Root\n};\n\n/**\n * Creates a new model element of the specified type\n *\n * @method create\n *\n * @example\n *\n * var shape1 = Model.create('shape', { x: 10, y: 10, width: 100, height: 100 });\n * var shape2 = Model.create('shape', { x: 210, y: 210, width: 100, height: 100 });\n *\n * var connection = Model.create('connection', { waypoints: [ { x: 110, y: 55 }, {x: 210, y: 55 } ] });\n *\n * @param  {string} type lower-cased model name\n * @param  {Object} attrs attributes to initialize the new model instance with\n *\n * @return {Base} the new model instance\n */\nexport function create(type, attrs) {\n  var Type = types[type];\n  if (!Type) {\n    throw new Error('unknown type: <' + type + '>');\n  }\n  return assign(new Type(), attrs);\n}","import {\n  create\n} from '../model';\n\nimport { assign } from 'min-dash';\n\n/**\n * A factory for diagram-js shapes\n */\nexport default function ElementFactory() {\n  this._uid = 12;\n}\n\n\nElementFactory.prototype.createRoot = function(attrs) {\n  return this.create('root', attrs);\n};\n\nElementFactory.prototype.createLabel = function(attrs) {\n  return this.create('label', attrs);\n};\n\nElementFactory.prototype.createShape = function(attrs) {\n  return this.create('shape', attrs);\n};\n\nElementFactory.prototype.createConnection = function(attrs) {\n  return this.create('connection', attrs);\n};\n\n/**\n * Create a model element with the given type and\n * a number of pre-set attributes.\n *\n * @param  {string} type\n * @param  {Object} attrs\n * @return {djs.model.Base} the newly created model instance\n */\nElementFactory.prototype.create = function(type, attrs) {\n\n  attrs = assign({}, attrs || {});\n\n  if (!attrs.id) {\n    attrs.id = type + '_' + (this._uid++);\n  }\n\n  return create(type, attrs);\n};","import {\n  isFunction,\n  isArray,\n  isNumber,\n  bind,\n  assign\n} from 'min-dash';\n\nvar FN_REF = '__fn';\n\nvar DEFAULT_PRIORITY = 1000;\n\nvar slice = Array.prototype.slice;\n\n/**\n * A general purpose event bus.\n *\n * This component is used to communicate across a diagram instance.\n * Other parts of a diagram can use it to listen to and broadcast events.\n *\n *\n * ## Registering for Events\n *\n * The event bus provides the {@link EventBus#on} and {@link EventBus#once}\n * methods to register for events. {@link EventBus#off} can be used to\n * remove event registrations. Listeners receive an instance of {@link Event}\n * as the first argument. It allows them to hook into the event execution.\n *\n * ```javascript\n *\n * // listen for event\n * eventBus.on('foo', function(event) {\n *\n *   // access event type\n *   event.type; // 'foo'\n *\n *   // stop propagation to other listeners\n *   event.stopPropagation();\n *\n *   // prevent event default\n *   event.preventDefault();\n * });\n *\n * // listen for event with custom payload\n * eventBus.on('bar', function(event, payload) {\n *   console.log(payload);\n * });\n *\n * // listen for event returning value\n * eventBus.on('foobar', function(event) {\n *\n *   // stop event propagation + prevent default\n *   return false;\n *\n *   // stop event propagation + return custom result\n *   return {\n *     complex: 'listening result'\n *   };\n * });\n *\n *\n * // listen with custom priority (default=1000, higher is better)\n * eventBus.on('priorityfoo', 1500, function(event) {\n *   console.log('invoked first!');\n * });\n *\n *\n * // listen for event and pass the context (`this`)\n * eventBus.on('foobar', function(event) {\n *   this.foo();\n * }, this);\n * ```\n *\n *\n * ## Emitting Events\n *\n * Events can be emitted via the event bus using {@link EventBus#fire}.\n *\n * ```javascript\n *\n * // false indicates that the default action\n * // was prevented by listeners\n * if (eventBus.fire('foo') === false) {\n *   console.log('default has been prevented!');\n * };\n *\n *\n * // custom args + return value listener\n * eventBus.on('sum', function(event, a, b) {\n *   return a + b;\n * });\n *\n * // you can pass custom arguments + retrieve result values.\n * var sum = eventBus.fire('sum', 1, 2);\n * console.log(sum); // 3\n * ```\n */\nexport default function EventBus() {\n  this._listeners = {};\n\n  // cleanup on destroy on lowest priority to allow\n  // message passing until the bitter end\n  this.on('diagram.destroy', 1, this._destroy, this);\n}\n\n\n/**\n * Register an event listener for events with the given name.\n *\n * The callback will be invoked with `event, ...additionalArguments`\n * that have been passed to {@link EventBus#fire}.\n *\n * Returning false from a listener will prevent the events default action\n * (if any is specified). To stop an event from being processed further in\n * other listeners execute {@link Event#stopPropagation}.\n *\n * Returning anything but `undefined` from a listener will stop the listener propagation.\n *\n * @param {string|Array<string>} events\n * @param {number} [priority=1000] the priority in which this listener is called, larger is higher\n * @param {Function} callback\n * @param {Object} [that] Pass context (`this`) to the callback\n */\nEventBus.prototype.on = function(events, priority, callback, that) {\n\n  events = isArray(events) ? events : [ events ];\n\n  if (isFunction(priority)) {\n    that = callback;\n    callback = priority;\n    priority = DEFAULT_PRIORITY;\n  }\n\n  if (!isNumber(priority)) {\n    throw new Error('priority must be a number');\n  }\n\n  var actualCallback = callback;\n\n  if (that) {\n    actualCallback = bind(callback, that);\n\n    // make sure we remember and are able to remove\n    // bound callbacks via {@link #off} using the original\n    // callback\n    actualCallback[FN_REF] = callback[FN_REF] || callback;\n  }\n\n  var self = this;\n\n  events.forEach(function(e) {\n    self._addListener(e, {\n      priority: priority,\n      callback: actualCallback,\n      next: null\n    });\n  });\n};\n\n\n/**\n * Register an event listener that is executed only once.\n *\n * @param {string} event the event name to register for\n * @param {number} [priority=1000] the priority in which this listener is called, larger is higher\n * @param {Function} callback the callback to execute\n * @param {Object} [that] Pass context (`this`) to the callback\n */\nEventBus.prototype.once = function(event, priority, callback, that) {\n  var self = this;\n\n  if (isFunction(priority)) {\n    that = callback;\n    callback = priority;\n    priority = DEFAULT_PRIORITY;\n  }\n\n  if (!isNumber(priority)) {\n    throw new Error('priority must be a number');\n  }\n\n  function wrappedCallback() {\n    wrappedCallback.__isTomb = true;\n\n    var result = callback.apply(that, arguments);\n\n    self.off(event, wrappedCallback);\n\n    return result;\n  }\n\n  // make sure we remember and are able to remove\n  // bound callbacks via {@link #off} using the original\n  // callback\n  wrappedCallback[FN_REF] = callback;\n\n  this.on(event, priority, wrappedCallback);\n};\n\n\n/**\n * Removes event listeners by event and callback.\n *\n * If no callback is given, all listeners for a given event name are being removed.\n *\n * @param {string|Array<string>} events\n * @param {Function} [callback]\n */\nEventBus.prototype.off = function(events, callback) {\n\n  events = isArray(events) ? events : [ events ];\n\n  var self = this;\n\n  events.forEach(function(event) {\n    self._removeListener(event, callback);\n  });\n\n};\n\n\n/**\n * Create an EventBus event.\n *\n * @param {Object} data\n *\n * @return {Object} event, recognized by the eventBus\n */\nEventBus.prototype.createEvent = function(data) {\n  var event = new InternalEvent();\n\n  event.init(data);\n\n  return event;\n};\n\n\n/**\n * Fires a named event.\n *\n * @example\n *\n * // fire event by name\n * events.fire('foo');\n *\n * // fire event object with nested type\n * var event = { type: 'foo' };\n * events.fire(event);\n *\n * // fire event with explicit type\n * var event = { x: 10, y: 20 };\n * events.fire('element.moved', event);\n *\n * // pass additional arguments to the event\n * events.on('foo', function(event, bar) {\n *   alert(bar);\n * });\n *\n * events.fire({ type: 'foo' }, 'I am bar!');\n *\n * @param {string} [name] the optional event name\n * @param {Object} [event] the event object\n * @param {...Object} additional arguments to be passed to the callback functions\n *\n * @return {boolean} the events return value, if specified or false if the\n *                   default action was prevented by listeners\n */\nEventBus.prototype.fire = function(type, data) {\n  var event,\n      firstListener,\n      returnValue,\n      args;\n\n  args = slice.call(arguments);\n\n  if (typeof type === 'object') {\n    data = type;\n    type = data.type;\n  }\n\n  if (!type) {\n    throw new Error('no event type specified');\n  }\n\n  firstListener = this._listeners[type];\n\n  if (!firstListener) {\n    return;\n  }\n\n  // we make sure we fire instances of our home made\n  // events here. We wrap them only once, though\n  if (data instanceof InternalEvent) {\n\n    // we are fine, we alread have an event\n    event = data;\n  } else {\n    event = this.createEvent(data);\n  }\n\n  // ensure we pass the event as the first parameter\n  args[0] = event;\n\n  // original event type (in case we delegate)\n  var originalType = event.type;\n\n  // update event type before delegation\n  if (type !== originalType) {\n    event.type = type;\n  }\n\n  try {\n    returnValue = this._invokeListeners(event, args, firstListener);\n  } finally {\n\n    // reset event type after delegation\n    if (type !== originalType) {\n      event.type = originalType;\n    }\n  }\n\n  // set the return value to false if the event default\n  // got prevented and no other return value exists\n  if (returnValue === undefined && event.defaultPrevented) {\n    returnValue = false;\n  }\n\n  return returnValue;\n};\n\n\nEventBus.prototype.handleError = function(error) {\n  return this.fire('error', { error: error }) === false;\n};\n\n\nEventBus.prototype._destroy = function() {\n  this._listeners = {};\n};\n\nEventBus.prototype._invokeListeners = function(event, args, listener) {\n\n  var returnValue;\n\n  while (listener) {\n\n    // handle stopped propagation\n    if (event.cancelBubble) {\n      break;\n    }\n\n    returnValue = this._invokeListener(event, args, listener);\n\n    listener = listener.next;\n  }\n\n  return returnValue;\n};\n\nEventBus.prototype._invokeListener = function(event, args, listener) {\n\n  var returnValue;\n\n  if (listener.callback.__isTomb) {\n    return returnValue;\n  }\n\n  try {\n\n    // returning false prevents the default action\n    returnValue = invokeFunction(listener.callback, args);\n\n    // stop propagation on return value\n    if (returnValue !== undefined) {\n      event.returnValue = returnValue;\n      event.stopPropagation();\n    }\n\n    // prevent default on return false\n    if (returnValue === false) {\n      event.preventDefault();\n    }\n  } catch (e) {\n    if (!this.handleError(e)) {\n      console.error('unhandled error in event listener');\n      console.error(e.stack);\n\n      throw e;\n    }\n  }\n\n  return returnValue;\n};\n\n/*\n * Add new listener with a certain priority to the list\n * of listeners (for the given event).\n *\n * The semantics of listener registration / listener execution are\n * first register, first serve: New listeners will always be inserted\n * after existing listeners with the same priority.\n *\n * Example: Inserting two listeners with priority 1000 and 1300\n *\n *    * before: [ 1500, 1500, 1000, 1000 ]\n *    * after: [ 1500, 1500, (new=1300), 1000, 1000, (new=1000) ]\n *\n * @param {string} event\n * @param {Object} listener { priority, callback }\n */\nEventBus.prototype._addListener = function(event, newListener) {\n\n  var listener = this._getListeners(event),\n      previousListener;\n\n  // no prior listeners\n  if (!listener) {\n    this._setListeners(event, newListener);\n\n    return;\n  }\n\n  // ensure we order listeners by priority from\n  // 0 (high) to n > 0 (low)\n  while (listener) {\n\n    if (listener.priority < newListener.priority) {\n\n      newListener.next = listener;\n\n      if (previousListener) {\n        previousListener.next = newListener;\n      } else {\n        this._setListeners(event, newListener);\n      }\n\n      return;\n    }\n\n    previousListener = listener;\n    listener = listener.next;\n  }\n\n  // add new listener to back\n  previousListener.next = newListener;\n};\n\n\nEventBus.prototype._getListeners = function(name) {\n  return this._listeners[name];\n};\n\nEventBus.prototype._setListeners = function(name, listener) {\n  this._listeners[name] = listener;\n};\n\nEventBus.prototype._removeListener = function(event, callback) {\n\n  var listener = this._getListeners(event),\n      nextListener,\n      previousListener,\n      listenerCallback;\n\n  if (!callback) {\n\n    // clear listeners\n    this._setListeners(event, null);\n\n    return;\n  }\n\n  while (listener) {\n\n    nextListener = listener.next;\n\n    listenerCallback = listener.callback;\n\n    if (listenerCallback === callback || listenerCallback[FN_REF] === callback) {\n      if (previousListener) {\n        previousListener.next = nextListener;\n      } else {\n\n        // new first listener\n        this._setListeners(event, nextListener);\n      }\n    }\n\n    previousListener = listener;\n    listener = nextListener;\n  }\n};\n\n/**\n * A event that is emitted via the event bus.\n */\nfunction InternalEvent() { }\n\nInternalEvent.prototype.stopPropagation = function() {\n  this.cancelBubble = true;\n};\n\nInternalEvent.prototype.preventDefault = function() {\n  this.defaultPrevented = true;\n};\n\nInternalEvent.prototype.init = function(data) {\n  assign(this, data || {});\n};\n\n\n/**\n * Invoke function. Be fast...\n *\n * @param {Function} fn\n * @param {Array<Object>} args\n *\n * @return {Any}\n */\nfunction invokeFunction(fn, args) {\n  return fn.apply(null, args);\n}\n","/**\n * SVGs for elements are generated by the {@link GraphicsFactory}.\n *\n * This utility gives quick access to the important semantic\n * parts of an element.\n */\n\n/**\n * Returns the visual part of a diagram element\n *\n * @param {Snap<SVGElement>} gfx\n *\n * @return {Snap<SVGElement>}\n */\nexport function getVisual(gfx) {\n  return gfx.childNodes[0];\n}\n\n/**\n * Returns the children for a given diagram element.\n *\n * @param {Snap<SVGElement>} gfx\n * @return {Snap<SVGElement>}\n */\nexport function getChildren(gfx) {\n  return gfx.parentNode.childNodes[1];\n}","import {\r\n  transform as svgTransform,\r\n  createTransform\r\n} from 'tiny-svg';\r\n\r\n\r\n/**\r\n * @param {<SVGElement>} element\r\n * @param {number} x\r\n * @param {number} y\r\n * @param {number} angle\r\n * @param {number} amount\r\n */\r\nexport function transform(gfx, x, y, angle, amount) {\r\n  var translate = createTransform();\r\n  translate.setTranslate(x, y);\r\n\r\n  var rotate = createTransform();\r\n  rotate.setRotate(angle || 0, 0, 0);\r\n\r\n  var scale = createTransform();\r\n  scale.setScale(amount || 1, amount || 1);\r\n\r\n  svgTransform(gfx, [ translate, rotate, scale ]);\r\n}\r\n\r\n\r\n/**\r\n * @param {SVGElement} element\r\n * @param {number} x\r\n * @param {number} y\r\n */\r\nexport function translate(gfx, x, y) {\r\n  var translate = createTransform();\r\n  translate.setTranslate(x, y);\r\n\r\n  svgTransform(gfx, translate);\r\n}\r\n\r\n\r\n/**\r\n * @param {SVGElement} element\r\n * @param {number} angle\r\n */\r\nexport function rotate(gfx, angle) {\r\n  var rotate = createTransform();\r\n  rotate.setRotate(angle, 0, 0);\r\n\r\n  svgTransform(gfx, rotate);\r\n}\r\n\r\n\r\n/**\r\n * @param {SVGElement} element\r\n * @param {number} amount\r\n */\r\nexport function scale(gfx, amount) {\r\n  var scale = createTransform();\r\n  scale.setScale(amount, amount);\r\n\r\n  svgTransform(gfx, scale);\r\n}","import {\n  forEach,\n  reduce\n} from 'min-dash';\n\nimport {\n  getChildren,\n  getVisual\n} from '../util/GraphicsUtil';\n\nimport { translate } from '../util/SvgTransformUtil';\n\nimport { clear as domClear } from 'min-dom';\n\nimport {\n  append as svgAppend,\n  attr as svgAttr,\n  classes as svgClasses,\n  create as svgCreate,\n  remove as svgRemove\n} from 'tiny-svg';\n\nimport {\n  isFrameElement\n} from '../util/Elements';\n\n/**\n * A factory that creates graphical elements\n *\n * @param {EventBus} eventBus\n * @param {ElementRegistry} elementRegistry\n */\nexport default function GraphicsFactory(eventBus, elementRegistry) {\n  this._eventBus = eventBus;\n  this._elementRegistry = elementRegistry;\n}\n\nGraphicsFactory.$inject = [ 'eventBus' , 'elementRegistry' ];\n\n\nGraphicsFactory.prototype._getChildrenContainer = function(element) {\n\n  var gfx = this._elementRegistry.getGraphics(element);\n\n  var childrenGfx;\n\n  // root element\n  if (!element.parent) {\n    childrenGfx = gfx;\n  } else {\n    childrenGfx = getChildren(gfx);\n    if (!childrenGfx) {\n      childrenGfx = svgCreate('g');\n      svgClasses(childrenGfx).add('djs-children');\n\n      svgAppend(gfx.parentNode, childrenGfx);\n    }\n  }\n\n  return childrenGfx;\n};\n\n/**\n * Clears the graphical representation of the element and returns the\n * cleared visual (the <g class=\"djs-visual\" /> element).\n */\nGraphicsFactory.prototype._clear = function(gfx) {\n  var visual = getVisual(gfx);\n\n  domClear(visual);\n\n  return visual;\n};\n\n/**\n * Creates a gfx container for shapes and connections\n *\n * The layout is as follows:\n *\n * <g class=\"djs-group\">\n *\n *   <!-- the gfx -->\n *   <g class=\"djs-element djs-(shape|connection|frame)\">\n *     <g class=\"djs-visual\">\n *       <!-- the renderer draws in here -->\n *     </g>\n *\n *     <!-- extensions (overlays, click box, ...) goes here\n *   </g>\n *\n *   <!-- the gfx child nodes -->\n *   <g class=\"djs-children\"></g>\n * </g>\n *\n * @param {string} type the type of the element, i.e. shape | connection\n * @param {SVGElement} [childrenGfx]\n * @param {number} [parentIndex] position to create container in parent\n * @param {boolean} [isFrame] is frame element\n *\n * @return {SVGElement}\n */\nGraphicsFactory.prototype._createContainer = function(\n    type, childrenGfx, parentIndex, isFrame\n) {\n  var outerGfx = svgCreate('g');\n  svgClasses(outerGfx).add('djs-group');\n\n  // insert node at position\n  if (typeof parentIndex !== 'undefined') {\n    prependTo(outerGfx, childrenGfx, childrenGfx.childNodes[parentIndex]);\n  } else {\n    svgAppend(childrenGfx, outerGfx);\n  }\n\n  var gfx = svgCreate('g');\n  svgClasses(gfx).add('djs-element');\n  svgClasses(gfx).add('djs-' + type);\n\n  if (isFrame) {\n    svgClasses(gfx).add('djs-frame');\n  }\n\n  svgAppend(outerGfx, gfx);\n\n  // create visual\n  var visual = svgCreate('g');\n  svgClasses(visual).add('djs-visual');\n\n  svgAppend(gfx, visual);\n\n  return gfx;\n};\n\nGraphicsFactory.prototype.create = function(type, element, parentIndex) {\n  var childrenGfx = this._getChildrenContainer(element.parent);\n  return this._createContainer(type, childrenGfx, parentIndex, isFrameElement(element));\n};\n\nGraphicsFactory.prototype.updateContainments = function(elements) {\n\n  var self = this,\n      elementRegistry = this._elementRegistry,\n      parents;\n\n  parents = reduce(elements, function(map, e) {\n\n    if (e.parent) {\n      map[e.parent.id] = e.parent;\n    }\n\n    return map;\n  }, {});\n\n  // update all parents of changed and reorganized their children\n  // in the correct order (as indicated in our model)\n  forEach(parents, function(parent) {\n\n    var children = parent.children;\n\n    if (!children) {\n      return;\n    }\n\n    var childrenGfx = self._getChildrenContainer(parent);\n\n    forEach(children.slice().reverse(), function(child) {\n      var childGfx = elementRegistry.getGraphics(child);\n\n      prependTo(childGfx.parentNode, childrenGfx);\n    });\n  });\n};\n\nGraphicsFactory.prototype.drawShape = function(visual, element) {\n  var eventBus = this._eventBus;\n\n  return eventBus.fire('render.shape', { gfx: visual, element: element });\n};\n\nGraphicsFactory.prototype.getShapePath = function(element) {\n  var eventBus = this._eventBus;\n\n  return eventBus.fire('render.getShapePath', element);\n};\n\nGraphicsFactory.prototype.drawConnection = function(visual, element) {\n  var eventBus = this._eventBus;\n\n  return eventBus.fire('render.connection', { gfx: visual, element: element });\n};\n\nGraphicsFactory.prototype.getConnectionPath = function(waypoints) {\n  var eventBus = this._eventBus;\n\n  return eventBus.fire('render.getConnectionPath', waypoints);\n};\n\nGraphicsFactory.prototype.update = function(type, element, gfx) {\n\n  // do NOT update root element\n  if (!element.parent) {\n    return;\n  }\n\n  var visual = this._clear(gfx);\n\n  // redraw\n  if (type === 'shape') {\n    this.drawShape(visual, element);\n\n    // update positioning\n    translate(gfx, element.x, element.y);\n  } else\n  if (type === 'connection') {\n    this.drawConnection(visual, element);\n  } else {\n    throw new Error('unknown type: ' + type);\n  }\n\n  if (element.hidden) {\n    svgAttr(gfx, 'display', 'none');\n  } else {\n    svgAttr(gfx, 'display', 'block');\n  }\n};\n\nGraphicsFactory.prototype.remove = function(element) {\n  var gfx = this._elementRegistry.getGraphics(element);\n\n  // remove\n  svgRemove(gfx.parentNode);\n};\n\n\n// helpers //////////\n\nfunction prependTo(newNode, parentNode, siblingNode) {\n  var node = siblingNode || parentNode.firstChild;\n\n  // do not prepend node to itself to prevent IE from crashing\n  // https://github.com/bpmn-io/bpmn-js/issues/746\n  if (newNode === node) {\n    return;\n  }\n\n  parentNode.insertBefore(newNode, node);\n}\n","import DrawModule from '../draw';\n\nimport Canvas from './Canvas';\nimport ElementRegistry from './ElementRegistry';\nimport ElementFactory from './ElementFactory';\nimport EventBus from './EventBus';\nimport GraphicsFactory from './GraphicsFactory';\n\nexport default {\n  __depends__: [ DrawModule ],\n  __init__: [ 'canvas' ],\n  canvas: [ 'type', Canvas ],\n  elementRegistry: [ 'type', ElementRegistry ],\n  elementFactory: [ 'type', ElementFactory ],\n  eventBus: [ 'type', EventBus ],\n  graphicsFactory: [ 'type', GraphicsFactory ]\n};","import { Injector } from 'didi';\n\nimport CoreModule from './core';\n\n\n/**\n * Bootstrap an injector from a list of modules, instantiating a number of default components\n *\n * @ignore\n * @param {Array<didi.Module>} bootstrapModules\n *\n * @return {didi.Injector} a injector to use to access the components\n */\nfunction bootstrap(bootstrapModules) {\n\n  var modules = [],\n      components = [];\n\n  function hasModule(m) {\n    return modules.indexOf(m) >= 0;\n  }\n\n  function addModule(m) {\n    modules.push(m);\n  }\n\n  function visit(m) {\n    if (hasModule(m)) {\n      return;\n    }\n\n    (m.__depends__ || []).forEach(visit);\n\n    if (hasModule(m)) {\n      return;\n    }\n\n    addModule(m);\n\n    (m.__init__ || []).forEach(function(c) {\n      components.push(c);\n    });\n  }\n\n  bootstrapModules.forEach(visit);\n\n  var injector = new Injector(modules);\n\n  components.forEach(function(c) {\n\n    try {\n\n      // eagerly resolve component (fn or string)\n      injector[typeof c === 'string' ? 'get' : 'invoke'](c);\n    } catch (e) {\n      console.error('Failed to instantiate component');\n      console.error(e.stack);\n\n      throw e;\n    }\n  });\n\n  return injector;\n}\n\n/**\n * Creates an injector from passed options.\n *\n * @ignore\n * @param  {Object} options\n * @return {didi.Injector}\n */\nfunction createInjector(options) {\n\n  options = options || {};\n\n  var configModule = {\n    'config': ['value', options]\n  };\n\n  var modules = [ configModule, CoreModule ].concat(options.modules || []);\n\n  return bootstrap(modules);\n}\n\n\n/**\n * The main diagram-js entry point that bootstraps the diagram with the given\n * configuration.\n *\n * To register extensions with the diagram, pass them as Array<didi.Module> to the constructor.\n *\n * @class djs.Diagram\n * @memberOf djs\n * @constructor\n *\n * @example\n *\n * <caption>Creating a plug-in that logs whenever a shape is added to the canvas.</caption>\n *\n * // plug-in implemenentation\n * function MyLoggingPlugin(eventBus) {\n *   eventBus.on('shape.added', function(event) {\n *     console.log('shape ', event.shape, ' was added to the diagram');\n *   });\n * }\n *\n * // export as module\n * export default {\n *   __init__: [ 'myLoggingPlugin' ],\n *     myLoggingPlugin: [ 'type', MyLoggingPlugin ]\n * };\n *\n *\n * // instantiate the diagram with the new plug-in\n *\n * import MyLoggingModule from 'path-to-my-logging-plugin';\n *\n * var diagram = new Diagram({\n *   modules: [\n *     MyLoggingModule\n *   ]\n * });\n *\n * diagram.invoke([ 'canvas', function(canvas) {\n *   // add shape to drawing canvas\n *   canvas.addShape({ x: 10, y: 10 });\n * });\n *\n * // 'shape ... was added to the diagram' logged to console\n *\n * @param {Object} options\n * @param {Array<didi.Module>} [options.modules] external modules to instantiate with the diagram\n * @param {didi.Injector} [injector] an (optional) injector to bootstrap the diagram with\n */\nexport default function Diagram(options, injector) {\n\n  // create injector unless explicitly specified\n  this.injector = injector = injector || createInjector(options);\n\n  // API\n\n  /**\n   * Resolves a diagram service\n   *\n   * @method Diagram#get\n   *\n   * @param {string} name the name of the diagram service to be retrieved\n   * @param {boolean} [strict=true] if false, resolve missing services to null\n   */\n  this.get = injector.get;\n\n  /**\n   * Executes a function into which diagram services are injected\n   *\n   * @method Diagram#invoke\n   *\n   * @param {Function|Object[]} fn the function to resolve\n   * @param {Object} locals a number of locals to use to resolve certain dependencies\n   */\n  this.invoke = injector.invoke;\n\n  // init\n\n  // indicate via event\n\n\n  /**\n   * An event indicating that all plug-ins are loaded.\n   *\n   * Use this event to fire other events to interested plug-ins\n   *\n   * @memberOf Diagram\n   *\n   * @event diagram.init\n   *\n   * @example\n   *\n   * eventBus.on('diagram.init', function() {\n   *   eventBus.fire('my-custom-event', { foo: 'BAR' });\n   * });\n   *\n   * @type {Object}\n   */\n  this.get('eventBus').fire('diagram.init');\n}\n\n\n/**\n * Destroys the diagram\n *\n * @method  Diagram#destroy\n */\nDiagram.prototype.destroy = function() {\n  this.get('eventBus').fire('diagram.destroy');\n};\n\n/**\n * Clear the diagram, removing all contents.\n */\nDiagram.prototype.clear = function() {\n  this.get('eventBus').fire('diagram.clear');\n};\n","import { forEach, bind, pick, assign, isString, isObject } from 'min-dash';\n\n/**\n * Moddle base element.\n */\nfunction Base() { }\n\nBase.prototype.get = function(name) {\n  return this.$model.properties.get(this, name);\n};\n\nBase.prototype.set = function(name, value) {\n  this.$model.properties.set(this, name, value);\n};\n\n/**\n * A model element factory.\n *\n * @param {Moddle} model\n * @param {Properties} properties\n */\nfunction Factory(model, properties) {\n  this.model = model;\n  this.properties = properties;\n}\n\n\nFactory.prototype.createType = function(descriptor) {\n\n  var model = this.model;\n\n  var props = this.properties,\n      prototype = Object.create(Base.prototype);\n\n  // initialize default values\n  forEach(descriptor.properties, function(p) {\n    if (!p.isMany && p.default !== undefined) {\n      prototype[p.name] = p.default;\n    }\n  });\n\n  props.defineModel(prototype, model);\n  props.defineDescriptor(prototype, descriptor);\n\n  var name = descriptor.ns.name;\n\n  /**\n   * The new type constructor\n   */\n  function ModdleElement(attrs) {\n    props.define(this, '$type', { value: name, enumerable: true });\n    props.define(this, '$attrs', { value: {} });\n    props.define(this, '$parent', { writable: true });\n\n    forEach(attrs, bind(function(val, key) {\n      this.set(key, val);\n    }, this));\n  }\n\n  ModdleElement.prototype = prototype;\n\n  ModdleElement.hasType = prototype.$instanceOf = this.model.hasType;\n\n  // static links\n  props.defineModel(ModdleElement, model);\n  props.defineDescriptor(ModdleElement, descriptor);\n\n  return ModdleElement;\n};\n\n/**\n * Built-in moddle types\n */\nvar BUILTINS = {\n  String: true,\n  Boolean: true,\n  Integer: true,\n  Real: true,\n  Element: true\n};\n\n/**\n * Converters for built in types from string representations\n */\nvar TYPE_CONVERTERS = {\n  String: function(s) { return s; },\n  Boolean: function(s) { return s === 'true'; },\n  Integer: function(s) { return parseInt(s, 10); },\n  Real: function(s) { return parseFloat(s, 10); }\n};\n\n/**\n * Convert a type to its real representation\n */\nfunction coerceType(type, value) {\n\n  var converter = TYPE_CONVERTERS[type];\n\n  if (converter) {\n    return converter(value);\n  } else {\n    return value;\n  }\n}\n\n/**\n * Return whether the given type is built-in\n */\nfunction isBuiltIn(type) {\n  return !!BUILTINS[type];\n}\n\n/**\n * Return whether the given type is simple\n */\nfunction isSimple(type) {\n  return !!TYPE_CONVERTERS[type];\n}\n\n/**\n * Parses a namespaced attribute name of the form (ns:)localName to an object,\n * given a default prefix to assume in case no explicit namespace is given.\n *\n * @param {String} name\n * @param {String} [defaultPrefix] the default prefix to take, if none is present.\n *\n * @return {Object} the parsed name\n */\nfunction parseName(name, defaultPrefix) {\n  var parts = name.split(/:/),\n      localName, prefix;\n\n  // no prefix (i.e. only local name)\n  if (parts.length === 1) {\n    localName = name;\n    prefix = defaultPrefix;\n  } else\n  // prefix + local name\n  if (parts.length === 2) {\n    localName = parts[1];\n    prefix = parts[0];\n  } else {\n    throw new Error('expected <prefix:localName> or <localName>, got ' + name);\n  }\n\n  name = (prefix ? prefix + ':' : '') + localName;\n\n  return {\n    name: name,\n    prefix: prefix,\n    localName: localName\n  };\n}\n\n/**\n * A utility to build element descriptors.\n */\nfunction DescriptorBuilder(nameNs) {\n  this.ns = nameNs;\n  this.name = nameNs.name;\n  this.allTypes = [];\n  this.allTypesByName = {};\n  this.properties = [];\n  this.propertiesByName = {};\n}\n\n\nDescriptorBuilder.prototype.build = function() {\n  return pick(this, [\n    'ns',\n    'name',\n    'allTypes',\n    'allTypesByName',\n    'properties',\n    'propertiesByName',\n    'bodyProperty',\n    'idProperty'\n  ]);\n};\n\n/**\n * Add property at given index.\n *\n * @param {Object} p\n * @param {Number} [idx]\n * @param {Boolean} [validate=true]\n */\nDescriptorBuilder.prototype.addProperty = function(p, idx, validate) {\n\n  if (typeof idx === 'boolean') {\n    validate = idx;\n    idx = undefined;\n  }\n\n  this.addNamedProperty(p, validate !== false);\n\n  var properties = this.properties;\n\n  if (idx !== undefined) {\n    properties.splice(idx, 0, p);\n  } else {\n    properties.push(p);\n  }\n};\n\n\nDescriptorBuilder.prototype.replaceProperty = function(oldProperty, newProperty, replace) {\n  var oldNameNs = oldProperty.ns;\n\n  var props = this.properties,\n      propertiesByName = this.propertiesByName,\n      rename = oldProperty.name !== newProperty.name;\n\n  if (oldProperty.isId) {\n    if (!newProperty.isId) {\n      throw new Error(\n        'property <' + newProperty.ns.name + '> must be id property ' +\n        'to refine <' + oldProperty.ns.name + '>');\n    }\n\n    this.setIdProperty(newProperty, false);\n  }\n\n  if (oldProperty.isBody) {\n\n    if (!newProperty.isBody) {\n      throw new Error(\n        'property <' + newProperty.ns.name + '> must be body property ' +\n        'to refine <' + oldProperty.ns.name + '>');\n    }\n\n    // TODO: Check compatibility\n    this.setBodyProperty(newProperty, false);\n  }\n\n  // validate existence and get location of old property\n  var idx = props.indexOf(oldProperty);\n  if (idx === -1) {\n    throw new Error('property <' + oldNameNs.name + '> not found in property list');\n  }\n\n  // remove old property\n  props.splice(idx, 1);\n\n  // replacing the named property is intentional\n  //\n  //  * validate only if this is a \"rename\" operation\n  //  * add at specific index unless we \"replace\"\n  //\n  this.addProperty(newProperty, replace ? undefined : idx, rename);\n\n  // make new property available under old name\n  propertiesByName[oldNameNs.name] = propertiesByName[oldNameNs.localName] = newProperty;\n};\n\n\nDescriptorBuilder.prototype.redefineProperty = function(p, targetPropertyName, replace) {\n\n  var nsPrefix = p.ns.prefix;\n  var parts = targetPropertyName.split('#');\n\n  var name = parseName(parts[0], nsPrefix);\n  var attrName = parseName(parts[1], name.prefix).name;\n\n  var redefinedProperty = this.propertiesByName[attrName];\n  if (!redefinedProperty) {\n    throw new Error('refined property <' + attrName + '> not found');\n  } else {\n    this.replaceProperty(redefinedProperty, p, replace);\n  }\n\n  delete p.redefines;\n};\n\nDescriptorBuilder.prototype.addNamedProperty = function(p, validate) {\n  var ns = p.ns,\n      propsByName = this.propertiesByName;\n\n  if (validate) {\n    this.assertNotDefined(p, ns.name);\n    this.assertNotDefined(p, ns.localName);\n  }\n\n  propsByName[ns.name] = propsByName[ns.localName] = p;\n};\n\nDescriptorBuilder.prototype.removeNamedProperty = function(p) {\n  var ns = p.ns,\n      propsByName = this.propertiesByName;\n\n  delete propsByName[ns.name];\n  delete propsByName[ns.localName];\n};\n\nDescriptorBuilder.prototype.setBodyProperty = function(p, validate) {\n\n  if (validate && this.bodyProperty) {\n    throw new Error(\n      'body property defined multiple times ' +\n      '(<' + this.bodyProperty.ns.name + '>, <' + p.ns.name + '>)');\n  }\n\n  this.bodyProperty = p;\n};\n\nDescriptorBuilder.prototype.setIdProperty = function(p, validate) {\n\n  if (validate && this.idProperty) {\n    throw new Error(\n      'id property defined multiple times ' +\n      '(<' + this.idProperty.ns.name + '>, <' + p.ns.name + '>)');\n  }\n\n  this.idProperty = p;\n};\n\nDescriptorBuilder.prototype.assertNotDefined = function(p, name) {\n  var propertyName = p.name,\n      definedProperty = this.propertiesByName[propertyName];\n\n  if (definedProperty) {\n    throw new Error(\n      'property <' + propertyName + '> already defined; ' +\n      'override of <' + definedProperty.definedBy.ns.name + '#' + definedProperty.ns.name + '> by ' +\n      '<' + p.definedBy.ns.name + '#' + p.ns.name + '> not allowed without redefines');\n  }\n};\n\nDescriptorBuilder.prototype.hasProperty = function(name) {\n  return this.propertiesByName[name];\n};\n\nDescriptorBuilder.prototype.addTrait = function(t, inherited) {\n\n  var typesByName = this.allTypesByName,\n      types = this.allTypes;\n\n  var typeName = t.name;\n\n  if (typeName in typesByName) {\n    return;\n  }\n\n  forEach(t.properties, bind(function(p) {\n\n    // clone property to allow extensions\n    p = assign({}, p, {\n      name: p.ns.localName,\n      inherited: inherited\n    });\n\n    Object.defineProperty(p, 'definedBy', {\n      value: t\n    });\n\n    var replaces = p.replaces,\n        redefines = p.redefines;\n\n    // add replace/redefine support\n    if (replaces || redefines) {\n      this.redefineProperty(p, replaces || redefines, replaces);\n    } else {\n      if (p.isBody) {\n        this.setBodyProperty(p);\n      }\n      if (p.isId) {\n        this.setIdProperty(p);\n      }\n      this.addProperty(p);\n    }\n  }, this));\n\n  types.push(t);\n  typesByName[typeName] = t;\n};\n\n/**\n * A registry of Moddle packages.\n *\n * @param {Array<Package>} packages\n * @param {Properties} properties\n */\nfunction Registry(packages, properties) {\n  this.packageMap = {};\n  this.typeMap = {};\n\n  this.packages = [];\n\n  this.properties = properties;\n\n  forEach(packages, bind(this.registerPackage, this));\n}\n\n\nRegistry.prototype.getPackage = function(uriOrPrefix) {\n  return this.packageMap[uriOrPrefix];\n};\n\nRegistry.prototype.getPackages = function() {\n  return this.packages;\n};\n\n\nRegistry.prototype.registerPackage = function(pkg) {\n\n  // copy package\n  pkg = assign({}, pkg);\n\n  var pkgMap = this.packageMap;\n\n  ensureAvailable(pkgMap, pkg, 'prefix');\n  ensureAvailable(pkgMap, pkg, 'uri');\n\n  // register types\n  forEach(pkg.types, bind(function(descriptor) {\n    this.registerType(descriptor, pkg);\n  }, this));\n\n  pkgMap[pkg.uri] = pkgMap[pkg.prefix] = pkg;\n  this.packages.push(pkg);\n};\n\n\n/**\n * Register a type from a specific package with us\n */\nRegistry.prototype.registerType = function(type, pkg) {\n\n  type = assign({}, type, {\n    superClass: (type.superClass || []).slice(),\n    extends: (type.extends || []).slice(),\n    properties: (type.properties || []).slice(),\n    meta: assign((type.meta || {}))\n  });\n\n  var ns = parseName(type.name, pkg.prefix),\n      name = ns.name,\n      propertiesByName = {};\n\n  // parse properties\n  forEach(type.properties, bind(function(p) {\n\n    // namespace property names\n    var propertyNs = parseName(p.name, ns.prefix),\n        propertyName = propertyNs.name;\n\n    // namespace property types\n    if (!isBuiltIn(p.type)) {\n      p.type = parseName(p.type, propertyNs.prefix).name;\n    }\n\n    assign(p, {\n      ns: propertyNs,\n      name: propertyName\n    });\n\n    propertiesByName[propertyName] = p;\n  }, this));\n\n  // update ns + name\n  assign(type, {\n    ns: ns,\n    name: name,\n    propertiesByName: propertiesByName\n  });\n\n  forEach(type.extends, bind(function(extendsName) {\n    var extended = this.typeMap[extendsName];\n\n    extended.traits = extended.traits || [];\n    extended.traits.push(name);\n  }, this));\n\n  // link to package\n  this.definePackage(type, pkg);\n\n  // register\n  this.typeMap[name] = type;\n};\n\n\n/**\n * Traverse the type hierarchy from bottom to top,\n * calling iterator with (type, inherited) for all elements in\n * the inheritance chain.\n *\n * @param {Object} nsName\n * @param {Function} iterator\n * @param {Boolean} [trait=false]\n */\nRegistry.prototype.mapTypes = function(nsName, iterator, trait) {\n\n  var type = isBuiltIn(nsName.name) ? { name: nsName.name } : this.typeMap[nsName.name];\n\n  var self = this;\n\n  /**\n   * Traverse the selected trait.\n   *\n   * @param {String} cls\n   */\n  function traverseTrait(cls) {\n    return traverseSuper(cls, true);\n  }\n\n  /**\n   * Traverse the selected super type or trait\n   *\n   * @param {String} cls\n   * @param {Boolean} [trait=false]\n   */\n  function traverseSuper(cls, trait) {\n    var parentNs = parseName(cls, isBuiltIn(cls) ? '' : nsName.prefix);\n    self.mapTypes(parentNs, iterator, trait);\n  }\n\n  if (!type) {\n    throw new Error('unknown type <' + nsName.name + '>');\n  }\n\n  forEach(type.superClass, trait ? traverseTrait : traverseSuper);\n\n  // call iterator with (type, inherited=!trait)\n  iterator(type, !trait);\n\n  forEach(type.traits, traverseTrait);\n};\n\n\n/**\n * Returns the effective descriptor for a type.\n *\n * @param  {String} type the namespaced name (ns:localName) of the type\n *\n * @return {Descriptor} the resulting effective descriptor\n */\nRegistry.prototype.getEffectiveDescriptor = function(name) {\n\n  var nsName = parseName(name);\n\n  var builder = new DescriptorBuilder(nsName);\n\n  this.mapTypes(nsName, function(type, inherited) {\n    builder.addTrait(type, inherited);\n  });\n\n  var descriptor = builder.build();\n\n  // define package link\n  this.definePackage(descriptor, descriptor.allTypes[descriptor.allTypes.length - 1].$pkg);\n\n  return descriptor;\n};\n\n\nRegistry.prototype.definePackage = function(target, pkg) {\n  this.properties.define(target, '$pkg', { value: pkg });\n};\n\n\n\n///////// helpers ////////////////////////////\n\nfunction ensureAvailable(packageMap, pkg, identifierKey) {\n\n  var value = pkg[identifierKey];\n\n  if (value in packageMap) {\n    throw new Error('package with ' + identifierKey + ' <' + value + '> already defined');\n  }\n}\n\n/**\n * A utility that gets and sets properties of model elements.\n *\n * @param {Model} model\n */\nfunction Properties(model) {\n  this.model = model;\n}\n\n\n/**\n * Sets a named property on the target element.\n * If the value is undefined, the property gets deleted.\n *\n * @param {Object} target\n * @param {String} name\n * @param {Object} value\n */\nProperties.prototype.set = function(target, name, value) {\n\n  var property = this.model.getPropertyDescriptor(target, name);\n\n  var propertyName = property && property.name;\n\n  if (isUndefined(value)) {\n    // unset the property, if the specified value is undefined;\n    // delete from $attrs (for extensions) or the target itself\n    if (property) {\n      delete target[propertyName];\n    } else {\n      delete target.$attrs[name];\n    }\n  } else {\n    // set the property, defining well defined properties on the fly\n    // or simply updating them in target.$attrs (for extensions)\n    if (property) {\n      if (propertyName in target) {\n        target[propertyName] = value;\n      } else {\n        defineProperty(target, property, value);\n      }\n    } else {\n      target.$attrs[name] = value;\n    }\n  }\n};\n\n/**\n * Returns the named property of the given element\n *\n * @param  {Object} target\n * @param  {String} name\n *\n * @return {Object}\n */\nProperties.prototype.get = function(target, name) {\n\n  var property = this.model.getPropertyDescriptor(target, name);\n\n  if (!property) {\n    return target.$attrs[name];\n  }\n\n  var propertyName = property.name;\n\n  // check if access to collection property and lazily initialize it\n  if (!target[propertyName] && property.isMany) {\n    defineProperty(target, property, []);\n  }\n\n  return target[propertyName];\n};\n\n\n/**\n * Define a property on the target element\n *\n * @param  {Object} target\n * @param  {String} name\n * @param  {Object} options\n */\nProperties.prototype.define = function(target, name, options) {\n  Object.defineProperty(target, name, options);\n};\n\n\n/**\n * Define the descriptor for an element\n */\nProperties.prototype.defineDescriptor = function(target, descriptor) {\n  this.define(target, '$descriptor', { value: descriptor });\n};\n\n/**\n * Define the model for an element\n */\nProperties.prototype.defineModel = function(target, model) {\n  this.define(target, '$model', { value: model });\n};\n\n\nfunction isUndefined(val) {\n  return typeof val === 'undefined';\n}\n\nfunction defineProperty(target, property, value) {\n  Object.defineProperty(target, property.name, {\n    enumerable: !property.isReference,\n    writable: true,\n    value: value,\n    configurable: true\n  });\n}\n\n//// Moddle implementation /////////////////////////////////////////////////\n\n/**\n * @class Moddle\n *\n * A model that can be used to create elements of a specific type.\n *\n * @example\n *\n * var Moddle = require('moddle');\n *\n * var pkg = {\n *   name: 'mypackage',\n *   prefix: 'my',\n *   types: [\n *     { name: 'Root' }\n *   ]\n * };\n *\n * var moddle = new Moddle([pkg]);\n *\n * @param {Array<Package>} packages the packages to contain\n */\nfunction Moddle(packages) {\n\n  this.properties = new Properties(this);\n\n  this.factory = new Factory(this, this.properties);\n  this.registry = new Registry(packages, this.properties);\n\n  this.typeCache = {};\n}\n\n\n/**\n * Create an instance of the specified type.\n *\n * @method Moddle#create\n *\n * @example\n *\n * var foo = moddle.create('my:Foo');\n * var bar = moddle.create('my:Bar', { id: 'BAR_1' });\n *\n * @param  {String|Object} descriptor the type descriptor or name know to the model\n * @param  {Object} attrs   a number of attributes to initialize the model instance with\n * @return {Object}         model instance\n */\nModdle.prototype.create = function(descriptor, attrs) {\n  var Type = this.getType(descriptor);\n\n  if (!Type) {\n    throw new Error('unknown type <' + descriptor + '>');\n  }\n\n  return new Type(attrs);\n};\n\n\n/**\n * Returns the type representing a given descriptor\n *\n * @method Moddle#getType\n *\n * @example\n *\n * var Foo = moddle.getType('my:Foo');\n * var foo = new Foo({ 'id' : 'FOO_1' });\n *\n * @param  {String|Object} descriptor the type descriptor or name know to the model\n * @return {Object}         the type representing the descriptor\n */\nModdle.prototype.getType = function(descriptor) {\n\n  var cache = this.typeCache;\n\n  var name = isString(descriptor) ? descriptor : descriptor.ns.name;\n\n  var type = cache[name];\n\n  if (!type) {\n    descriptor = this.registry.getEffectiveDescriptor(name);\n    type = cache[name] = this.factory.createType(descriptor);\n  }\n\n  return type;\n};\n\n\n/**\n * Creates an any-element type to be used within model instances.\n *\n * This can be used to create custom elements that lie outside the meta-model.\n * The created element contains all the meta-data required to serialize it\n * as part of meta-model elements.\n *\n * @method Moddle#createAny\n *\n * @example\n *\n * var foo = moddle.createAny('vendor:Foo', 'http://vendor', {\n *   value: 'bar'\n * });\n *\n * var container = moddle.create('my:Container', 'http://my', {\n *   any: [ foo ]\n * });\n *\n * // go ahead and serialize the stuff\n *\n *\n * @param  {String} name  the name of the element\n * @param  {String} nsUri the namespace uri of the element\n * @param  {Object} [properties] a map of properties to initialize the instance with\n * @return {Object} the any type instance\n */\nModdle.prototype.createAny = function(name, nsUri, properties) {\n\n  var nameNs = parseName(name);\n\n  var element = {\n    $type: name,\n    $instanceOf: function(type) {\n      return type === this.$type;\n    }\n  };\n\n  var descriptor = {\n    name: name,\n    isGeneric: true,\n    ns: {\n      prefix: nameNs.prefix,\n      localName: nameNs.localName,\n      uri: nsUri\n    }\n  };\n\n  this.properties.defineDescriptor(element, descriptor);\n  this.properties.defineModel(element, this);\n  this.properties.define(element, '$parent', { enumerable: false, writable: true });\n\n  forEach(properties, function(a, key) {\n    if (isObject(a) && a.value !== undefined) {\n      element[a.name] = a.value;\n    } else {\n      element[key] = a;\n    }\n  });\n\n  return element;\n};\n\n/**\n * Returns a registered package by uri or prefix\n *\n * @return {Object} the package\n */\nModdle.prototype.getPackage = function(uriOrPrefix) {\n  return this.registry.getPackage(uriOrPrefix);\n};\n\n/**\n * Returns a snapshot of all known packages\n *\n * @return {Object} the package\n */\nModdle.prototype.getPackages = function() {\n  return this.registry.getPackages();\n};\n\n/**\n * Returns the descriptor for an element\n */\nModdle.prototype.getElementDescriptor = function(element) {\n  return element.$descriptor;\n};\n\n/**\n * Returns true if the given descriptor or instance\n * represents the given type.\n *\n * May be applied to this, if element is omitted.\n */\nModdle.prototype.hasType = function(element, type) {\n  if (type === undefined) {\n    type = element;\n    element = this;\n  }\n\n  var descriptor = element.$model.getElementDescriptor(element);\n\n  return (type in descriptor.allTypesByName);\n};\n\n/**\n * Returns the descriptor of an elements named property\n */\nModdle.prototype.getPropertyDescriptor = function(element, property) {\n  return this.getElementDescriptor(element).propertiesByName[property];\n};\n\n/**\n * Returns a mapped type's descriptor\n */\nModdle.prototype.getTypeDescriptor = function(type) {\n  return this.registry.typeMap[type];\n};\n\nexport { Moddle, coerceType, isBuiltIn as isBuiltInType, isSimple as isSimpleType, parseName as parseNameNS };\n","var fromCharCode = String.fromCharCode;\n\nvar hasOwnProperty = Object.prototype.hasOwnProperty;\n\nvar ENTITY_PATTERN = /&#(\\d+);|&#x([0-9a-f]+);|&(\\w+);/ig;\n\nvar ENTITY_MAPPING = {\n  'amp': '&',\n  'apos': '\\'',\n  'gt': '>',\n  'lt': '<',\n  'quot': '\"'\n};\n\n// map UPPERCASE variants of supported special chars\nObject.keys(ENTITY_MAPPING).forEach(function(k) {\n  ENTITY_MAPPING[k.toUpperCase()] = ENTITY_MAPPING[k];\n});\n\n\nfunction replaceEntities(_, d, x, z) {\n\n  // reserved names, i.e. &nbsp;\n  if (z) {\n    if (hasOwnProperty.call(ENTITY_MAPPING, z)) {\n      return ENTITY_MAPPING[z];\n    } else {\n\n      // fall back to original value\n      return '&' + z + ';';\n    }\n  }\n\n  // decimal encoded char\n  if (d) {\n    return fromCharCode(d);\n  }\n\n  // hex encoded char\n  return fromCharCode(parseInt(x, 16));\n}\n\n\n/**\n * A basic entity decoder that can decode a minimal\n * sub-set of reserved names (&amp;) as well as\n * hex (&#xaaf;) and decimal (&#1231;) encoded characters.\n *\n * @param {string} str\n *\n * @return {string} decoded string\n */\nfunction decodeEntities(s) {\n  if (s.length > 3 && s.indexOf('&') !== -1) {\n    return s.replace(ENTITY_PATTERN, replaceEntities);\n  }\n\n  return s;\n}\n\nvar XSI_URI = 'http://www.w3.org/2001/XMLSchema-instance';\nvar XSI_PREFIX = 'xsi';\nvar XSI_TYPE = 'xsi:type';\n\nvar NON_WHITESPACE_OUTSIDE_ROOT_NODE = 'non-whitespace outside of root node';\n\nfunction error(msg) {\n  return new Error(msg);\n}\n\nfunction missingNamespaceForPrefix(prefix) {\n  return 'missing namespace for prefix <' + prefix + '>';\n}\n\nfunction getter(getFn) {\n  return {\n    'get': getFn,\n    'enumerable': true\n  };\n}\n\nfunction cloneNsMatrix(nsMatrix) {\n  var clone = {}, key;\n  for (key in nsMatrix) {\n    clone[key] = nsMatrix[key];\n  }\n  return clone;\n}\n\nfunction uriPrefix(prefix) {\n  return prefix + '$uri';\n}\n\nfunction buildNsMatrix(nsUriToPrefix) {\n  var nsMatrix = {},\n      uri,\n      prefix;\n\n  for (uri in nsUriToPrefix) {\n    prefix = nsUriToPrefix[uri];\n    nsMatrix[prefix] = prefix;\n    nsMatrix[uriPrefix(prefix)] = uri;\n  }\n\n  return nsMatrix;\n}\n\nfunction noopGetContext() {\n  return { 'line': 0, 'column': 0 };\n}\n\nfunction throwFunc(err) {\n  throw err;\n}\n\n/**\n * Creates a new parser with the given options.\n *\n * @constructor\n *\n * @param  {!Object<string, ?>=} options\n */\nfunction Parser(options) {\n\n  if (!this) {\n    return new Parser(options);\n  }\n\n  var proxy = options && options['proxy'];\n\n  var onText,\n      onOpenTag,\n      onCloseTag,\n      onCDATA,\n      onError = throwFunc,\n      onWarning,\n      onComment,\n      onQuestion,\n      onAttention;\n\n  var getContext = noopGetContext;\n\n  /**\n   * Do we need to parse the current elements attributes for namespaces?\n   *\n   * @type {boolean}\n   */\n  var maybeNS = false;\n\n  /**\n   * Do we process namespaces at all?\n   *\n   * @type {boolean}\n   */\n  var isNamespace = false;\n\n  /**\n   * The caught error returned on parse end\n   *\n   * @type {Error}\n   */\n  var returnError = null;\n\n  /**\n   * Should we stop parsing?\n   *\n   * @type {boolean}\n   */\n  var parseStop = false;\n\n  /**\n   * A map of { uri: prefix } used by the parser.\n   *\n   * This map will ensure we can normalize prefixes during processing;\n   * for each uri, only one prefix will be exposed to the handlers.\n   *\n   * @type {!Object<string, string>}}\n   */\n  var nsUriToPrefix;\n\n  /**\n   * Handle parse error.\n   *\n   * @param  {string|Error} err\n   */\n  function handleError(err) {\n    if (!(err instanceof Error)) {\n      err = error(err);\n    }\n\n    returnError = err;\n\n    onError(err, getContext);\n  }\n\n  /**\n   * Handle parse error.\n   *\n   * @param  {string|Error} err\n   */\n  function handleWarning(err) {\n\n    if (!onWarning) {\n      return;\n    }\n\n    if (!(err instanceof Error)) {\n      err = error(err);\n    }\n\n    onWarning(err, getContext);\n  }\n\n  /**\n   * Register parse listener.\n   *\n   * @param  {string}   name\n   * @param  {Function} cb\n   *\n   * @return {Parser}\n   */\n  this['on'] = function(name, cb) {\n\n    if (typeof cb !== 'function') {\n      throw error('required args <name, cb>');\n    }\n\n    switch (name) {\n    case 'openTag': onOpenTag = cb; break;\n    case 'text': onText = cb; break;\n    case 'closeTag': onCloseTag = cb; break;\n    case 'error': onError = cb; break;\n    case 'warn': onWarning = cb; break;\n    case 'cdata': onCDATA = cb; break;\n    case 'attention': onAttention = cb; break; // <!XXXXX zzzz=\"eeee\">\n    case 'question': onQuestion = cb; break; // <? ....  ?>\n    case 'comment': onComment = cb; break;\n    default:\n      throw error('unsupported event: ' + name);\n    }\n\n    return this;\n  };\n\n  /**\n   * Set the namespace to prefix mapping.\n   *\n   * @example\n   *\n   * parser.ns({\n   *   'http://foo': 'foo',\n   *   'http://bar': 'bar'\n   * });\n   *\n   * @param  {!Object<string, string>} nsMap\n   *\n   * @return {Parser}\n   */\n  this['ns'] = function(nsMap) {\n\n    if (typeof nsMap === 'undefined') {\n      nsMap = {};\n    }\n\n    if (typeof nsMap !== 'object') {\n      throw error('required args <nsMap={}>');\n    }\n\n    var _nsUriToPrefix = {}, k;\n\n    for (k in nsMap) {\n      _nsUriToPrefix[k] = nsMap[k];\n    }\n\n    // FORCE default mapping for schema instance\n    _nsUriToPrefix[XSI_URI] = XSI_PREFIX;\n\n    isNamespace = true;\n    nsUriToPrefix = _nsUriToPrefix;\n\n    return this;\n  };\n\n  /**\n   * Parse xml string.\n   *\n   * @param  {string} xml\n   *\n   * @return {Error} returnError, if not thrown\n   */\n  this['parse'] = function(xml) {\n    if (typeof xml !== 'string') {\n      throw error('required args <xml=string>');\n    }\n\n    returnError = null;\n\n    parse(xml);\n\n    getContext = noopGetContext;\n    parseStop = false;\n\n    return returnError;\n  };\n\n  /**\n   * Stop parsing.\n   */\n  this['stop'] = function() {\n    parseStop = true;\n  };\n\n  /**\n   * Parse string, invoking configured listeners on element.\n   *\n   * @param  {string} xml\n   */\n  function parse(xml) {\n    var nsMatrixStack = isNamespace ? [] : null,\n        nsMatrix = isNamespace ? buildNsMatrix(nsUriToPrefix) : null,\n        _nsMatrix,\n        nodeStack = [],\n        anonymousNsCount = 0,\n        tagStart = false,\n        tagEnd = false,\n        i = 0, j = 0,\n        x, y, q, w, v,\n        xmlns,\n        elementName,\n        _elementName,\n        elementProxy\n        ;\n\n    var attrsString = '',\n        attrsStart = 0,\n        cachedAttrs // false = parsed with errors, null = needs parsing\n        ;\n\n    /**\n     * Parse attributes on demand and returns the parsed attributes.\n     *\n     * Return semantics: (1) `false` on attribute parse error,\n     * (2) object hash on extracted attrs.\n     *\n     * @return {boolean|Object}\n     */\n    function getAttrs() {\n      if (cachedAttrs !== null) {\n        return cachedAttrs;\n      }\n\n      var nsUri,\n          nsUriPrefix,\n          nsName,\n          defaultAlias = isNamespace && nsMatrix['xmlns'],\n          attrList = isNamespace && maybeNS ? [] : null,\n          i = attrsStart,\n          s = attrsString,\n          l = s.length,\n          hasNewMatrix,\n          newalias,\n          value,\n          alias,\n          name,\n          attrs = {},\n          seenAttrs = {},\n          skipAttr,\n          w,\n          j;\n\n      parseAttr:\n      for (; i < l; i++) {\n        skipAttr = false;\n        w = s.charCodeAt(i);\n\n        if (w === 32 || (w < 14 && w > 8)) { // WHITESPACE={ \\f\\n\\r\\t\\v}\n          continue;\n        }\n\n        // wait for non whitespace character\n        if (w < 65 || w > 122 || (w > 90 && w < 97)) {\n          if (w !== 95 && w !== 58) { // char 95\"_\" 58\":\"\n            handleWarning('illegal first char attribute name');\n            skipAttr = true;\n          }\n        }\n\n        // parse attribute name\n        for (j = i + 1; j < l; j++) {\n          w = s.charCodeAt(j);\n\n          if (\n            w > 96 && w < 123 ||\n            w > 64 && w < 91 ||\n            w > 47 && w < 59 ||\n            w === 46 || // '.'\n            w === 45 || // '-'\n            w === 95 // '_'\n          ) {\n            continue;\n          }\n\n          // unexpected whitespace\n          if (w === 32 || (w < 14 && w > 8)) { // WHITESPACE\n            handleWarning('missing attribute value');\n            i = j;\n\n            continue parseAttr;\n          }\n\n          // expected \"=\"\n          if (w === 61) { // \"=\" == 61\n            break;\n          }\n\n          handleWarning('illegal attribute name char');\n          skipAttr = true;\n        }\n\n        name = s.substring(i, j);\n\n        if (name === 'xmlns:xmlns') {\n          handleWarning('illegal declaration of xmlns');\n          skipAttr = true;\n        }\n\n        w = s.charCodeAt(j + 1);\n\n        if (w === 34) { // '\"'\n          j = s.indexOf('\"', i = j + 2);\n\n          if (j === -1) {\n            j = s.indexOf('\\'', i);\n\n            if (j !== -1) {\n              handleWarning('attribute value quote missmatch');\n              skipAttr = true;\n            }\n          }\n\n        } else if (w === 39) { // \"'\"\n          j = s.indexOf('\\'', i = j + 2);\n\n          if (j === -1) {\n            j = s.indexOf('\"', i);\n\n            if (j !== -1) {\n              handleWarning('attribute value quote missmatch');\n              skipAttr = true;\n            }\n          }\n\n        } else {\n          handleWarning('missing attribute value quotes');\n          skipAttr = true;\n\n          // skip to next space\n          for (j = j + 1; j < l; j++) {\n            w = s.charCodeAt(j + 1);\n\n            if (w === 32 || (w < 14 && w > 8)) { // WHITESPACE\n              break;\n            }\n          }\n\n        }\n\n        if (j === -1) {\n          handleWarning('missing closing quotes');\n\n          j = l;\n          skipAttr = true;\n        }\n\n        if (!skipAttr) {\n          value = s.substring(i, j);\n        }\n\n        i = j;\n\n        // ensure SPACE follows attribute\n        // skip illegal content otherwise\n        // example a=\"b\"c\n        for (; j + 1 < l; j++) {\n          w = s.charCodeAt(j + 1);\n\n          if (w === 32 || (w < 14 && w > 8)) { // WHITESPACE\n            break;\n          }\n\n          // FIRST ILLEGAL CHAR\n          if (i === j) {\n            handleWarning('illegal character after attribute end');\n            skipAttr = true;\n          }\n        }\n\n        // advance cursor to next attribute\n        i = j + 1;\n\n        if (skipAttr) {\n          continue parseAttr;\n        }\n\n        // check attribute re-declaration\n        if (name in seenAttrs) {\n          handleWarning('attribute <' + name + '> already defined');\n          continue;\n        }\n\n        seenAttrs[name] = true;\n\n        if (!isNamespace) {\n          attrs[name] = value;\n          continue;\n        }\n\n        // try to extract namespace information\n        if (maybeNS) {\n          newalias = (\n            name === 'xmlns'\n              ? 'xmlns'\n              : (name.charCodeAt(0) === 120 && name.substr(0, 6) === 'xmlns:')\n                ? name.substr(6)\n                : null\n          );\n\n          // handle xmlns(:alias) assignment\n          if (newalias !== null) {\n            nsUri = decodeEntities(value);\n            nsUriPrefix = uriPrefix(newalias);\n\n            alias = nsUriToPrefix[nsUri];\n\n            if (!alias) {\n\n              // no prefix defined or prefix collision\n              if (\n                (newalias === 'xmlns') ||\n                (nsUriPrefix in nsMatrix && nsMatrix[nsUriPrefix] !== nsUri)\n              ) {\n\n                // alocate free ns prefix\n                do {\n                  alias = 'ns' + (anonymousNsCount++);\n                } while (typeof nsMatrix[alias] !== 'undefined');\n              } else {\n                alias = newalias;\n              }\n\n              nsUriToPrefix[nsUri] = alias;\n            }\n\n            if (nsMatrix[newalias] !== alias) {\n              if (!hasNewMatrix) {\n                nsMatrix = cloneNsMatrix(nsMatrix);\n                hasNewMatrix = true;\n              }\n\n              nsMatrix[newalias] = alias;\n              if (newalias === 'xmlns') {\n                nsMatrix[uriPrefix(alias)] = nsUri;\n                defaultAlias = alias;\n              }\n\n              nsMatrix[nsUriPrefix] = nsUri;\n            }\n\n            // expose xmlns(:asd)=\"...\" in attributes\n            attrs[name] = value;\n            continue;\n          }\n\n          // collect attributes until all namespace\n          // declarations are processed\n          attrList.push(name, value);\n          continue;\n\n        } /** end if (maybeNs) */\n\n        // handle attributes on element without\n        // namespace declarations\n        w = name.indexOf(':');\n        if (w === -1) {\n          attrs[name] = value;\n          continue;\n        }\n\n        // normalize ns attribute name\n        if (!(nsName = nsMatrix[name.substring(0, w)])) {\n          handleWarning(missingNamespaceForPrefix(name.substring(0, w)));\n          continue;\n        }\n\n        name = defaultAlias === nsName\n          ? name.substr(w + 1)\n          : nsName + name.substr(w);\n\n        // end: normalize ns attribute name\n\n        // normalize xsi:type ns attribute value\n        if (name === XSI_TYPE) {\n          w = value.indexOf(':');\n\n          if (w !== -1) {\n            nsName = value.substring(0, w);\n\n            // handle default prefixes, i.e. xs:String gracefully\n            nsName = nsMatrix[nsName] || nsName;\n            value = nsName + value.substring(w);\n          } else {\n            value = defaultAlias + ':' + value;\n          }\n        }\n\n        // end: normalize xsi:type ns attribute value\n\n        attrs[name] = value;\n      }\n\n\n      // handle deferred, possibly namespaced attributes\n      if (maybeNS) {\n\n        // normalize captured attributes\n        for (i = 0, l = attrList.length; i < l; i++) {\n\n          name = attrList[i++];\n          value = attrList[i];\n\n          w = name.indexOf(':');\n\n          if (w !== -1) {\n\n            // normalize ns attribute name\n            if (!(nsName = nsMatrix[name.substring(0, w)])) {\n              handleWarning(missingNamespaceForPrefix(name.substring(0, w)));\n              continue;\n            }\n\n            name = defaultAlias === nsName\n              ? name.substr(w + 1)\n              : nsName + name.substr(w);\n\n            // end: normalize ns attribute name\n\n            // normalize xsi:type ns attribute value\n            if (name === XSI_TYPE) {\n              w = value.indexOf(':');\n\n              if (w !== -1) {\n                nsName = value.substring(0, w);\n\n                // handle default prefixes, i.e. xs:String gracefully\n                nsName = nsMatrix[nsName] || nsName;\n                value = nsName + value.substring(w);\n              } else {\n                value = defaultAlias + ':' + value;\n              }\n            }\n\n            // end: normalize xsi:type ns attribute value\n          }\n\n          attrs[name] = value;\n        }\n\n        // end: normalize captured attributes\n      }\n\n      return cachedAttrs = attrs;\n    }\n\n    /**\n     * Extract the parse context { line, column, part }\n     * from the current parser position.\n     *\n     * @return {Object} parse context\n     */\n    function getParseContext() {\n      var splitsRe = /(\\r\\n|\\r|\\n)/g;\n\n      var line = 0;\n      var column = 0;\n      var startOfLine = 0;\n      var endOfLine = j;\n      var match;\n      var data;\n\n      while (i >= startOfLine) {\n\n        match = splitsRe.exec(xml);\n\n        if (!match) {\n          break;\n        }\n\n        // end of line = (break idx + break chars)\n        endOfLine = match[0].length + match.index;\n\n        if (endOfLine > i) {\n          break;\n        }\n\n        // advance to next line\n        line += 1;\n\n        startOfLine = endOfLine;\n      }\n\n      // EOF errors\n      if (i == -1) {\n        column = endOfLine;\n        data = xml.substring(j);\n      } else\n\n      // start errors\n      if (j === 0) {\n        data = xml.substring(j, i);\n      }\n\n      // other errors\n      else {\n        column = i - startOfLine;\n        data = (j == -1 ? xml.substring(i) : xml.substring(i, j + 1));\n      }\n\n      return {\n        'data': data,\n        'line': line,\n        'column': column\n      };\n    }\n\n    getContext = getParseContext;\n\n\n    if (proxy) {\n      elementProxy = Object.create({}, {\n        'name': getter(function() {\n          return elementName;\n        }),\n        'originalName': getter(function() {\n          return _elementName;\n        }),\n        'attrs': getter(getAttrs),\n        'ns': getter(function() {\n          return nsMatrix;\n        })\n      });\n    }\n\n    // actual parse logic\n    while (j !== -1) {\n\n      if (xml.charCodeAt(j) === 60) { // \"<\"\n        i = j;\n      } else {\n        i = xml.indexOf('<', j);\n      }\n\n      // parse end\n      if (i === -1) {\n        if (nodeStack.length) {\n          return handleError('unexpected end of file');\n        }\n\n        if (j === 0) {\n          return handleError('missing start tag');\n        }\n\n        if (j < xml.length) {\n          if (xml.substring(j).trim()) {\n            handleWarning(NON_WHITESPACE_OUTSIDE_ROOT_NODE);\n          }\n        }\n\n        return;\n      }\n\n      // parse text\n      if (j !== i) {\n\n        if (nodeStack.length) {\n          if (onText) {\n            onText(xml.substring(j, i), decodeEntities, getContext);\n\n            if (parseStop) {\n              return;\n            }\n          }\n        } else {\n          if (xml.substring(j, i).trim()) {\n            handleWarning(NON_WHITESPACE_OUTSIDE_ROOT_NODE);\n\n            if (parseStop) {\n              return;\n            }\n          }\n        }\n      }\n\n      w = xml.charCodeAt(i+1);\n\n      // parse comments + CDATA\n      if (w === 33) { // \"!\"\n        q = xml.charCodeAt(i+2);\n\n        // CDATA section\n        if (q === 91 && xml.substr(i + 3, 6) === 'CDATA[') { // 91 == \"[\"\n          j = xml.indexOf(']]>', i);\n          if (j === -1) {\n            return handleError('unclosed cdata');\n          }\n\n          if (onCDATA) {\n            onCDATA(xml.substring(i + 9, j), getContext);\n            if (parseStop) {\n              return;\n            }\n          }\n\n          j += 3;\n          continue;\n        }\n\n        // comment\n        if (q === 45 && xml.charCodeAt(i + 3) === 45) { // 45 == \"-\"\n          j = xml.indexOf('-->', i);\n          if (j === -1) {\n            return handleError('unclosed comment');\n          }\n\n\n          if (onComment) {\n            onComment(xml.substring(i + 4, j), decodeEntities, getContext);\n            if (parseStop) {\n              return;\n            }\n          }\n\n          j += 3;\n          continue;\n        }\n      }\n\n      // parse question <? ... ?>\n      if (w === 63) { // \"?\"\n        j = xml.indexOf('?>', i);\n        if (j === -1) {\n          return handleError('unclosed question');\n        }\n\n        if (onQuestion) {\n          onQuestion(xml.substring(i, j + 2), getContext);\n          if (parseStop) {\n            return;\n          }\n        }\n\n        j += 2;\n        continue;\n      }\n\n      // find matching closing tag for attention or standard tags\n      // for that we must skip through attribute values\n      // (enclosed in single or double quotes)\n      for (x = i + 1; ; x++) {\n        v = xml.charCodeAt(x);\n        if (isNaN(v)) {\n          j = -1;\n          return handleError('unclosed tag');\n        }\n\n        // [10] AttValue ::= '\"' ([^<&\"] | Reference)* '\"' | \"'\" ([^<&'] | Reference)* \"'\"\n        // skips the quoted string\n        // (double quotes) does not appear in a literal enclosed by (double quotes)\n        // (single quote) does not appear in a literal enclosed by (single quote)\n        if (v === 34) { //  '\"'\n          q = xml.indexOf('\"', x + 1);\n          x = q !== -1 ? q : x;\n        } else if (v === 39) { // \"'\"\n          q = xml.indexOf(\"'\", x + 1);\n          x = q !== -1 ? q : x;\n        } else if (v === 62) { // '>'\n          j = x;\n          break;\n        }\n      }\n\n\n      // parse attention <! ...>\n      // previously comment and CDATA have already been parsed\n      if (w === 33) { // \"!\"\n\n        if (onAttention) {\n          onAttention(xml.substring(i, j + 1), decodeEntities, getContext);\n          if (parseStop) {\n            return;\n          }\n        }\n\n        j += 1;\n        continue;\n      }\n\n      // don't process attributes;\n      // there are none\n      cachedAttrs = {};\n\n      // if (xml.charCodeAt(i+1) === 47) { // </...\n      if (w === 47) { // </...\n        tagStart = false;\n        tagEnd = true;\n\n        if (!nodeStack.length) {\n          return handleError('missing open tag');\n        }\n\n        // verify open <-> close tag match\n        x = elementName = nodeStack.pop();\n        q = i + 2 + x.length;\n\n        if (xml.substring(i + 2, q) !== x) {\n          return handleError('closing tag mismatch');\n        }\n\n        // verify chars in close tag\n        for (; q < j; q++) {\n          w = xml.charCodeAt(q);\n\n          if (w === 32 || (w > 8 && w < 14)) { // \\f\\n\\r\\t\\v space\n            continue;\n          }\n\n          return handleError('close tag');\n        }\n\n      } else {\n        if (xml.charCodeAt(j - 1) === 47) { // .../>\n          x = elementName = xml.substring(i + 1, j - 1);\n\n          tagStart = true;\n          tagEnd = true;\n\n        } else {\n          x = elementName = xml.substring(i + 1, j);\n\n          tagStart = true;\n          tagEnd = false;\n        }\n\n        if (!(w > 96 && w < 123 || w > 64 && w < 91 || w === 95 || w === 58)) { // char 95\"_\" 58\":\"\n          return handleError('illegal first char nodeName');\n        }\n\n        for (q = 1, y = x.length; q < y; q++) {\n          w = x.charCodeAt(q);\n\n          if (w > 96 && w < 123 || w > 64 && w < 91 || w > 47 && w < 59 || w === 45 || w === 95 || w == 46) {\n            continue;\n          }\n\n          if (w === 32 || (w < 14 && w > 8)) { // \\f\\n\\r\\t\\v space\n            elementName = x.substring(0, q);\n\n            // maybe there are attributes\n            cachedAttrs = null;\n            break;\n          }\n\n          return handleError('invalid nodeName');\n        }\n\n        if (!tagEnd) {\n          nodeStack.push(elementName);\n        }\n      }\n\n      if (isNamespace) {\n\n        _nsMatrix = nsMatrix;\n\n        if (tagStart) {\n\n          // remember old namespace\n          // unless we're self-closing\n          if (!tagEnd) {\n            nsMatrixStack.push(_nsMatrix);\n          }\n\n          if (cachedAttrs === null) {\n\n            // quick check, whether there may be namespace\n            // declarations on the node; if that is the case\n            // we need to eagerly parse the node attributes\n            if ((maybeNS = x.indexOf('xmlns', q) !== -1)) {\n              attrsStart = q;\n              attrsString = x;\n\n              getAttrs();\n\n              maybeNS = false;\n            }\n          }\n        }\n\n        _elementName = elementName;\n\n        w = elementName.indexOf(':');\n        if (w !== -1) {\n          xmlns = nsMatrix[elementName.substring(0, w)];\n\n          // prefix given; namespace must exist\n          if (!xmlns) {\n            return handleError('missing namespace on <' + _elementName + '>');\n          }\n\n          elementName = elementName.substr(w + 1);\n        } else {\n          xmlns = nsMatrix['xmlns'];\n\n          // if no default namespace is defined,\n          // we'll import the element as anonymous.\n          //\n          // it is up to users to correct that to the document defined\n          // targetNamespace, or whatever their undersanding of the\n          // XML spec mandates.\n        }\n\n        // adjust namespace prefixs as configured\n        if (xmlns) {\n          elementName = xmlns + ':' + elementName;\n        }\n\n      }\n\n      if (tagStart) {\n        attrsStart = q;\n        attrsString = x;\n\n        if (onOpenTag) {\n          if (proxy) {\n            onOpenTag(elementProxy, decodeEntities, tagEnd, getContext);\n          } else {\n            onOpenTag(elementName, getAttrs, decodeEntities, tagEnd, getContext);\n          }\n\n          if (parseStop) {\n            return;\n          }\n        }\n\n      }\n\n      if (tagEnd) {\n\n        if (onCloseTag) {\n          onCloseTag(proxy ? elementProxy : elementName, decodeEntities, tagStart, getContext);\n\n          if (parseStop) {\n            return;\n          }\n        }\n\n        // restore old namespace\n        if (isNamespace) {\n          if (!tagStart) {\n            nsMatrix = nsMatrixStack.pop();\n          } else {\n            nsMatrix = _nsMatrix;\n          }\n        }\n      }\n\n      j += 1;\n    }\n  } /** end parse */\n\n}\n\nexport { Parser, decodeEntities as decode };\n","import { forEach, assign, find, filter, has, isString, map } from 'min-dash';\nimport { Parser } from 'saxen';\nimport { coerceType, parseNameNS, isSimpleType, Moddle } from 'moddle';\n\nfunction hasLowerCaseAlias(pkg) {\n  return pkg.xml && pkg.xml.tagAlias === 'lowerCase';\n}\n\nvar DEFAULT_NS_MAP = {\n  'xsi': 'http://www.w3.org/2001/XMLSchema-instance',\n  'xml': 'http://www.w3.org/XML/1998/namespace'\n};\n\nvar XSI_TYPE = 'xsi:type';\n\nfunction serializeFormat(element) {\n  return element.xml && element.xml.serialize;\n}\n\nfunction serializeAsType(element) {\n  return serializeFormat(element) === XSI_TYPE;\n}\n\nfunction serializeAsProperty(element) {\n  return serializeFormat(element) === 'property';\n}\n\nfunction capitalize(str) {\n  return str.charAt(0).toUpperCase() + str.slice(1);\n}\n\nfunction aliasToName(aliasNs, pkg) {\n\n  if (!hasLowerCaseAlias(pkg)) {\n    return aliasNs.name;\n  }\n\n  return aliasNs.prefix + ':' + capitalize(aliasNs.localName);\n}\n\nfunction prefixedToName(nameNs, pkg) {\n\n  var name = nameNs.name,\n      localName = nameNs.localName;\n\n  var typePrefix = pkg.xml && pkg.xml.typePrefix;\n\n  if (typePrefix && localName.indexOf(typePrefix) === 0) {\n    return nameNs.prefix + ':' + localName.slice(typePrefix.length);\n  } else {\n    return name;\n  }\n}\n\nfunction normalizeXsiTypeName(name, model) {\n\n  var nameNs = parseNameNS(name);\n  var pkg = model.getPackage(nameNs.prefix);\n\n  return prefixedToName(nameNs, pkg);\n}\n\nfunction error(message) {\n  return new Error(message);\n}\n\n/**\n * Get the moddle descriptor for a given instance or type.\n *\n * @param  {ModdleElement|Function} element\n *\n * @return {Object} the moddle descriptor\n */\nfunction getModdleDescriptor(element) {\n  return element.$descriptor;\n}\n\n\n/**\n * A parse context.\n *\n * @class\n *\n * @param {Object} options\n * @param {ElementHandler} options.rootHandler the root handler for parsing a document\n * @param {boolean} [options.lax=false] whether or not to ignore invalid elements\n */\nfunction Context(options) {\n\n  /**\n   * @property {ElementHandler} rootHandler\n   */\n\n  /**\n   * @property {Boolean} lax\n   */\n\n  assign(this, options);\n\n  this.elementsById = {};\n  this.references = [];\n  this.warnings = [];\n\n  /**\n   * Add an unresolved reference.\n   *\n   * @param {Object} reference\n   */\n  this.addReference = function(reference) {\n    this.references.push(reference);\n  };\n\n  /**\n   * Add a processed element.\n   *\n   * @param {ModdleElement} element\n   */\n  this.addElement = function(element) {\n\n    if (!element) {\n      throw error('expected element');\n    }\n\n    var elementsById = this.elementsById;\n\n    var descriptor = getModdleDescriptor(element);\n\n    var idProperty = descriptor.idProperty,\n        id;\n\n    if (idProperty) {\n      id = element.get(idProperty.name);\n\n      if (id) {\n\n        // for QName validation as per http://www.w3.org/TR/REC-xml/#NT-NameChar\n        if (!/^([a-z][\\w-.]*:)?[a-z_][\\w-.]*$/i.test(id)) {\n          throw new Error('illegal ID <' + id + '>');\n        }\n\n        if (elementsById[id]) {\n          throw error('duplicate ID <' + id + '>');\n        }\n\n        elementsById[id] = element;\n      }\n    }\n  };\n\n  /**\n   * Add an import warning.\n   *\n   * @param {Object} warning\n   * @param {String} warning.message\n   * @param {Error} [warning.error]\n   */\n  this.addWarning = function(warning) {\n    this.warnings.push(warning);\n  };\n}\n\nfunction BaseHandler() {}\n\nBaseHandler.prototype.handleEnd = function() {};\nBaseHandler.prototype.handleText = function() {};\nBaseHandler.prototype.handleNode = function() {};\n\n\n/**\n * A simple pass through handler that does nothing except for\n * ignoring all input it receives.\n *\n * This is used to ignore unknown elements and\n * attributes.\n */\nfunction NoopHandler() { }\n\nNoopHandler.prototype = Object.create(BaseHandler.prototype);\n\nNoopHandler.prototype.handleNode = function() {\n  return this;\n};\n\nfunction BodyHandler() {}\n\nBodyHandler.prototype = Object.create(BaseHandler.prototype);\n\nBodyHandler.prototype.handleText = function(text) {\n  this.body = (this.body || '') + text;\n};\n\nfunction ReferenceHandler(property, context) {\n  this.property = property;\n  this.context = context;\n}\n\nReferenceHandler.prototype = Object.create(BodyHandler.prototype);\n\nReferenceHandler.prototype.handleNode = function(node) {\n\n  if (this.element) {\n    throw error('expected no sub nodes');\n  } else {\n    this.element = this.createReference(node);\n  }\n\n  return this;\n};\n\nReferenceHandler.prototype.handleEnd = function() {\n  this.element.id = this.body;\n};\n\nReferenceHandler.prototype.createReference = function(node) {\n  return {\n    property: this.property.ns.name,\n    id: ''\n  };\n};\n\nfunction ValueHandler(propertyDesc, element) {\n  this.element = element;\n  this.propertyDesc = propertyDesc;\n}\n\nValueHandler.prototype = Object.create(BodyHandler.prototype);\n\nValueHandler.prototype.handleEnd = function() {\n\n  var value = this.body || '',\n      element = this.element,\n      propertyDesc = this.propertyDesc;\n\n  value = coerceType(propertyDesc.type, value);\n\n  if (propertyDesc.isMany) {\n    element.get(propertyDesc.name).push(value);\n  } else {\n    element.set(propertyDesc.name, value);\n  }\n};\n\n\nfunction BaseElementHandler() {}\n\nBaseElementHandler.prototype = Object.create(BodyHandler.prototype);\n\nBaseElementHandler.prototype.handleNode = function(node) {\n  var parser = this,\n      element = this.element;\n\n  if (!element) {\n    element = this.element = this.createElement(node);\n\n    this.context.addElement(element);\n  } else {\n    parser = this.handleChild(node);\n  }\n\n  return parser;\n};\n\n/**\n * @class Reader.ElementHandler\n *\n */\nfunction ElementHandler(model, typeName, context) {\n  this.model = model;\n  this.type = model.getType(typeName);\n  this.context = context;\n}\n\nElementHandler.prototype = Object.create(BaseElementHandler.prototype);\n\nElementHandler.prototype.addReference = function(reference) {\n  this.context.addReference(reference);\n};\n\nElementHandler.prototype.handleText = function(text) {\n\n  var element = this.element,\n      descriptor = getModdleDescriptor(element),\n      bodyProperty = descriptor.bodyProperty;\n\n  if (!bodyProperty) {\n    throw error('unexpected body text <' + text + '>');\n  }\n\n  BodyHandler.prototype.handleText.call(this, text);\n};\n\nElementHandler.prototype.handleEnd = function() {\n\n  var value = this.body,\n      element = this.element,\n      descriptor = getModdleDescriptor(element),\n      bodyProperty = descriptor.bodyProperty;\n\n  if (bodyProperty && value !== undefined) {\n    value = coerceType(bodyProperty.type, value);\n    element.set(bodyProperty.name, value);\n  }\n};\n\n/**\n * Create an instance of the model from the given node.\n *\n * @param  {Element} node the xml node\n */\nElementHandler.prototype.createElement = function(node) {\n  var attributes = node.attributes,\n      Type = this.type,\n      descriptor = getModdleDescriptor(Type),\n      context = this.context,\n      instance = new Type({}),\n      model = this.model,\n      propNameNs;\n\n  forEach(attributes, function(value, name) {\n\n    var prop = descriptor.propertiesByName[name],\n        values;\n\n    if (prop && prop.isReference) {\n\n      if (!prop.isMany) {\n        context.addReference({\n          element: instance,\n          property: prop.ns.name,\n          id: value\n        });\n      } else {\n\n        // IDREFS: parse references as whitespace-separated list\n        values = value.split(' ');\n\n        forEach(values, function(v) {\n          context.addReference({\n            element: instance,\n            property: prop.ns.name,\n            id: v\n          });\n        });\n      }\n\n    } else {\n      if (prop) {\n        value = coerceType(prop.type, value);\n      } else\n      if (name !== 'xmlns') {\n        propNameNs = parseNameNS(name, descriptor.ns.prefix);\n\n        // check whether attribute is defined in a well-known namespace\n        // if that is the case we emit a warning to indicate potential misuse\n        if (model.getPackage(propNameNs.prefix)) {\n\n          context.addWarning({\n            message: 'unknown attribute <' + name + '>',\n            element: instance,\n            property: name,\n            value: value\n          });\n        }\n      }\n\n      instance.set(name, value);\n    }\n  });\n\n  return instance;\n};\n\nElementHandler.prototype.getPropertyForNode = function(node) {\n\n  var name = node.name;\n  var nameNs = parseNameNS(name);\n\n  var type = this.type,\n      model = this.model,\n      descriptor = getModdleDescriptor(type);\n\n  var propertyName = nameNs.name,\n      property = descriptor.propertiesByName[propertyName],\n      elementTypeName,\n      elementType;\n\n  // search for properties by name first\n\n  if (property && !property.isAttr) {\n\n    if (serializeAsType(property)) {\n      elementTypeName = node.attributes[XSI_TYPE];\n\n      // xsi type is optional, if it does not exists the\n      // default type is assumed\n      if (elementTypeName) {\n\n        // take possible type prefixes from XML\n        // into account, i.e.: xsi:type=\"t{ActualType}\"\n        elementTypeName = normalizeXsiTypeName(elementTypeName, model);\n\n        elementType = model.getType(elementTypeName);\n\n        return assign({}, property, {\n          effectiveType: getModdleDescriptor(elementType).name\n        });\n      }\n    }\n\n    // search for properties by name first\n    return property;\n  }\n\n  var pkg = model.getPackage(nameNs.prefix);\n\n  if (pkg) {\n    elementTypeName = aliasToName(nameNs, pkg);\n    elementType = model.getType(elementTypeName);\n\n    // search for collection members later\n    property = find(descriptor.properties, function(p) {\n      return !p.isVirtual && !p.isReference && !p.isAttribute && elementType.hasType(p.type);\n    });\n\n    if (property) {\n      return assign({}, property, {\n        effectiveType: getModdleDescriptor(elementType).name\n      });\n    }\n  } else {\n\n    // parse unknown element (maybe extension)\n    property = find(descriptor.properties, function(p) {\n      return !p.isReference && !p.isAttribute && p.type === 'Element';\n    });\n\n    if (property) {\n      return property;\n    }\n  }\n\n  throw error('unrecognized element <' + nameNs.name + '>');\n};\n\nElementHandler.prototype.toString = function() {\n  return 'ElementDescriptor[' + getModdleDescriptor(this.type).name + ']';\n};\n\nElementHandler.prototype.valueHandler = function(propertyDesc, element) {\n  return new ValueHandler(propertyDesc, element);\n};\n\nElementHandler.prototype.referenceHandler = function(propertyDesc) {\n  return new ReferenceHandler(propertyDesc, this.context);\n};\n\nElementHandler.prototype.handler = function(type) {\n  if (type === 'Element') {\n    return new GenericElementHandler(this.model, type, this.context);\n  } else {\n    return new ElementHandler(this.model, type, this.context);\n  }\n};\n\n/**\n * Handle the child element parsing\n *\n * @param  {Element} node the xml node\n */\nElementHandler.prototype.handleChild = function(node) {\n  var propertyDesc, type, element, childHandler;\n\n  propertyDesc = this.getPropertyForNode(node);\n  element = this.element;\n\n  type = propertyDesc.effectiveType || propertyDesc.type;\n\n  if (isSimpleType(type)) {\n    return this.valueHandler(propertyDesc, element);\n  }\n\n  if (propertyDesc.isReference) {\n    childHandler = this.referenceHandler(propertyDesc).handleNode(node);\n  } else {\n    childHandler = this.handler(type).handleNode(node);\n  }\n\n  var newElement = childHandler.element;\n\n  // child handles may decide to skip elements\n  // by not returning anything\n  if (newElement !== undefined) {\n\n    if (propertyDesc.isMany) {\n      element.get(propertyDesc.name).push(newElement);\n    } else {\n      element.set(propertyDesc.name, newElement);\n    }\n\n    if (propertyDesc.isReference) {\n      assign(newElement, {\n        element: element\n      });\n\n      this.context.addReference(newElement);\n    } else {\n\n      // establish child -> parent relationship\n      newElement.$parent = element;\n    }\n  }\n\n  return childHandler;\n};\n\n/**\n * An element handler that performs special validation\n * to ensure the node it gets initialized with matches\n * the handlers type (namespace wise).\n *\n * @param {Moddle} model\n * @param {String} typeName\n * @param {Context} context\n */\nfunction RootElementHandler(model, typeName, context) {\n  ElementHandler.call(this, model, typeName, context);\n}\n\nRootElementHandler.prototype = Object.create(ElementHandler.prototype);\n\nRootElementHandler.prototype.createElement = function(node) {\n\n  var name = node.name,\n      nameNs = parseNameNS(name),\n      model = this.model,\n      type = this.type,\n      pkg = model.getPackage(nameNs.prefix),\n      typeName = pkg && aliasToName(nameNs, pkg) || name;\n\n  // verify the correct namespace if we parse\n  // the first element in the handler tree\n  //\n  // this ensures we don't mistakenly import wrong namespace elements\n  if (!type.hasType(typeName)) {\n    throw error('unexpected element <' + node.originalName + '>');\n  }\n\n  return ElementHandler.prototype.createElement.call(this, node);\n};\n\n\nfunction GenericElementHandler(model, typeName, context) {\n  this.model = model;\n  this.context = context;\n}\n\nGenericElementHandler.prototype = Object.create(BaseElementHandler.prototype);\n\nGenericElementHandler.prototype.createElement = function(node) {\n\n  var name = node.name,\n      ns = parseNameNS(name),\n      prefix = ns.prefix,\n      uri = node.ns[prefix + '$uri'],\n      attributes = node.attributes;\n\n  return this.model.createAny(name, uri, attributes);\n};\n\nGenericElementHandler.prototype.handleChild = function(node) {\n\n  var handler = new GenericElementHandler(this.model, 'Element', this.context).handleNode(node),\n      element = this.element;\n\n  var newElement = handler.element,\n      children;\n\n  if (newElement !== undefined) {\n    children = element.$children = element.$children || [];\n    children.push(newElement);\n\n    // establish child -> parent relationship\n    newElement.$parent = element;\n  }\n\n  return handler;\n};\n\nGenericElementHandler.prototype.handleEnd = function() {\n  if (this.body) {\n    this.element.$body = this.body;\n  }\n};\n\n/**\n * A reader for a meta-model\n *\n * @param {Object} options\n * @param {Model} options.model used to read xml files\n * @param {Boolean} options.lax whether to make parse errors warnings\n */\nfunction Reader(options) {\n\n  if (options instanceof Moddle) {\n    options = {\n      model: options\n    };\n  }\n\n  assign(this, { lax: false }, options);\n}\n\n/**\n * The fromXML result.\n *\n * @typedef {Object} ParseResult\n *\n * @property {ModdleElement} rootElement\n * @property {Array<Object>} references\n * @property {Array<Error>} warnings\n * @property {Object} elementsById - a mapping containing each ID -> ModdleElement\n */\n\n/**\n * The fromXML result.\n *\n * @typedef {Error} ParseError\n *\n * @property {Array<Error>} warnings\n */\n\n/**\n * Parse the given XML into a moddle document tree.\n *\n * @param {String} xml\n * @param {ElementHandler|Object} options or rootHandler\n *\n * @returns {Promise<ParseResult, ParseError>}\n */\nReader.prototype.fromXML = function(xml, options, done) {\n\n  var rootHandler = options.rootHandler;\n\n  if (options instanceof ElementHandler) {\n\n    // root handler passed via (xml, { rootHandler: ElementHandler }, ...)\n    rootHandler = options;\n    options = {};\n  } else {\n    if (typeof options === 'string') {\n\n      // rootHandler passed via (xml, 'someString', ...)\n      rootHandler = this.handler(options);\n      options = {};\n    } else if (typeof rootHandler === 'string') {\n\n      // rootHandler passed via (xml, { rootHandler: 'someString' }, ...)\n      rootHandler = this.handler(rootHandler);\n    }\n  }\n\n  var model = this.model,\n      lax = this.lax;\n\n  var context = new Context(assign({}, options, { rootHandler: rootHandler })),\n      parser = new Parser({ proxy: true }),\n      stack = createStack();\n\n  rootHandler.context = context;\n\n  // push root handler\n  stack.push(rootHandler);\n\n\n  /**\n   * Handle error.\n   *\n   * @param  {Error} err\n   * @param  {Function} getContext\n   * @param  {boolean} lax\n   *\n   * @return {boolean} true if handled\n   */\n  function handleError(err, getContext, lax) {\n\n    var ctx = getContext();\n\n    var line = ctx.line,\n        column = ctx.column,\n        data = ctx.data;\n\n    // we receive the full context data here,\n    // for elements trim down the information\n    // to the tag name, only\n    if (data.charAt(0) === '<' && data.indexOf(' ') !== -1) {\n      data = data.slice(0, data.indexOf(' ')) + '>';\n    }\n\n    var message =\n      'unparsable content ' + (data ? data + ' ' : '') + 'detected\\n\\t' +\n        'line: ' + line + '\\n\\t' +\n        'column: ' + column + '\\n\\t' +\n        'nested error: ' + err.message;\n\n    if (lax) {\n      context.addWarning({\n        message: message,\n        error: err\n      });\n\n      return true;\n    } else {\n      throw error(message);\n    }\n  }\n\n  function handleWarning(err, getContext) {\n\n    // just like handling errors in <lax=true> mode\n    return handleError(err, getContext, true);\n  }\n\n  /**\n   * Resolve collected references on parse end.\n   */\n  function resolveReferences() {\n\n    var elementsById = context.elementsById;\n    var references = context.references;\n\n    var i, r;\n\n    for (i = 0; (r = references[i]); i++) {\n      var element = r.element;\n      var reference = elementsById[r.id];\n      var property = getModdleDescriptor(element).propertiesByName[r.property];\n\n      if (!reference) {\n        context.addWarning({\n          message: 'unresolved reference <' + r.id + '>',\n          element: r.element,\n          property: r.property,\n          value: r.id\n        });\n      }\n\n      if (property.isMany) {\n        var collection = element.get(property.name),\n            idx = collection.indexOf(r);\n\n        // we replace an existing place holder (idx != -1) or\n        // append to the collection instead\n        if (idx === -1) {\n          idx = collection.length;\n        }\n\n        if (!reference) {\n\n          // remove unresolvable reference\n          collection.splice(idx, 1);\n        } else {\n\n          // add or update reference in collection\n          collection[idx] = reference;\n        }\n      } else {\n        element.set(property.name, reference);\n      }\n    }\n  }\n\n  function handleClose() {\n    stack.pop().handleEnd();\n  }\n\n  var PREAMBLE_START_PATTERN = /^<\\?xml /i;\n\n  var ENCODING_PATTERN = / encoding=\"([^\"]+)\"/i;\n\n  var UTF_8_PATTERN = /^utf-8$/i;\n\n  function handleQuestion(question) {\n\n    if (!PREAMBLE_START_PATTERN.test(question)) {\n      return;\n    }\n\n    var match = ENCODING_PATTERN.exec(question);\n    var encoding = match && match[1];\n\n    if (!encoding || UTF_8_PATTERN.test(encoding)) {\n      return;\n    }\n\n    context.addWarning({\n      message:\n        'unsupported document encoding <' + encoding + '>, ' +\n        'falling back to UTF-8'\n    });\n  }\n\n  function handleOpen(node, getContext) {\n    var handler = stack.peek();\n\n    try {\n      stack.push(handler.handleNode(node));\n    } catch (err) {\n\n      if (handleError(err, getContext, lax)) {\n        stack.push(new NoopHandler());\n      }\n    }\n  }\n\n  function handleCData(text, getContext) {\n\n    try {\n      stack.peek().handleText(text);\n    } catch (err) {\n      handleWarning(err, getContext);\n    }\n  }\n\n  function handleText(text, getContext) {\n\n    // strip whitespace only nodes, i.e. before\n    // <!CDATA[ ... ]> sections and in between tags\n    text = text.trim();\n\n    if (!text) {\n      return;\n    }\n\n    handleCData(text, getContext);\n  }\n\n  var uriMap = model.getPackages().reduce(function(uriMap, p) {\n    uriMap[p.uri] = p.prefix;\n\n    return uriMap;\n  }, {\n    'http://www.w3.org/XML/1998/namespace': 'xml' // add default xml ns\n  });\n  parser\n    .ns(uriMap)\n    .on('openTag', function(obj, decodeStr, selfClosing, getContext) {\n\n      // gracefully handle unparsable attributes (attrs=false)\n      var attrs = obj.attrs || {};\n\n      var decodedAttrs = Object.keys(attrs).reduce(function(d, key) {\n        var value = decodeStr(attrs[key]);\n\n        d[key] = value;\n\n        return d;\n      }, {});\n\n      var node = {\n        name: obj.name,\n        originalName: obj.originalName,\n        attributes: decodedAttrs,\n        ns: obj.ns\n      };\n\n      handleOpen(node, getContext);\n    })\n    .on('question', handleQuestion)\n    .on('closeTag', handleClose)\n    .on('cdata', handleCData)\n    .on('text', function(text, decodeEntities, getContext) {\n      handleText(decodeEntities(text), getContext);\n    })\n    .on('error', handleError)\n    .on('warn', handleWarning);\n\n  // async XML parsing to make sure the execution environment\n  // (node or brower) is kept responsive and that certain optimization\n  // strategies can kick in.\n  return new Promise(function(resolve, reject) {\n\n    var err;\n\n    try {\n      parser.parse(xml);\n\n      resolveReferences();\n    } catch (e) {\n      err = e;\n    }\n\n    var rootElement = rootHandler.element;\n\n    if (!err && !rootElement) {\n      err = error('failed to parse document as <' + rootHandler.type.$descriptor.name + '>');\n    }\n\n    var warnings = context.warnings;\n    var references = context.references;\n    var elementsById = context.elementsById;\n\n    if (err) {\n      err.warnings = warnings;\n\n      return reject(err);\n    } else {\n      return resolve({\n        rootElement: rootElement,\n        elementsById: elementsById,\n        references: references,\n        warnings: warnings\n      });\n    }\n  });\n};\n\nReader.prototype.handler = function(name) {\n  return new RootElementHandler(this.model, name);\n};\n\n\n// helpers //////////////////////////\n\nfunction createStack() {\n  var stack = [];\n\n  Object.defineProperty(stack, 'peek', {\n    value: function() {\n      return this[this.length - 1];\n    }\n  });\n\n  return stack;\n}\n\nvar XML_PREAMBLE = '<?xml version=\"1.0\" encoding=\"UTF-8\"?>\\n';\n\nvar ESCAPE_ATTR_CHARS = /<|>|'|\"|&|\\n\\r|\\n/g;\nvar ESCAPE_CHARS = /<|>|&/g;\n\n\nfunction Namespaces(parent) {\n\n  var prefixMap = {};\n  var uriMap = {};\n  var used = {};\n\n  var wellknown = [];\n  var custom = [];\n\n  // API\n\n  this.byUri = function(uri) {\n    return uriMap[uri] || (\n      parent && parent.byUri(uri)\n    );\n  };\n\n  this.add = function(ns, isWellknown) {\n\n    uriMap[ns.uri] = ns;\n\n    if (isWellknown) {\n      wellknown.push(ns);\n    } else {\n      custom.push(ns);\n    }\n\n    this.mapPrefix(ns.prefix, ns.uri);\n  };\n\n  this.uriByPrefix = function(prefix) {\n    return prefixMap[prefix || 'xmlns'];\n  };\n\n  this.mapPrefix = function(prefix, uri) {\n    prefixMap[prefix || 'xmlns'] = uri;\n  };\n\n  this.getNSKey = function(ns) {\n    return (ns.prefix !== undefined) ? (ns.uri + '|' + ns.prefix) : ns.uri;\n  };\n\n  this.logUsed = function(ns) {\n\n    var uri = ns.uri;\n    var nsKey = this.getNSKey(ns);\n\n    used[nsKey] = this.byUri(uri);\n\n    // Inform parent recursively about the usage of this NS\n    if (parent) {\n      parent.logUsed(ns);\n    }\n  };\n\n  this.getUsed = function(ns) {\n\n    function isUsed(ns) {\n      var nsKey = self.getNSKey(ns);\n\n      return used[nsKey];\n    }\n\n    var self = this;\n\n    var allNs = [].concat(wellknown, custom);\n\n    return allNs.filter(isUsed);\n  };\n\n}\n\nfunction lower(string) {\n  return string.charAt(0).toLowerCase() + string.slice(1);\n}\n\nfunction nameToAlias(name, pkg) {\n  if (hasLowerCaseAlias(pkg)) {\n    return lower(name);\n  } else {\n    return name;\n  }\n}\n\nfunction inherits(ctor, superCtor) {\n  ctor.super_ = superCtor;\n  ctor.prototype = Object.create(superCtor.prototype, {\n    constructor: {\n      value: ctor,\n      enumerable: false,\n      writable: true,\n      configurable: true\n    }\n  });\n}\n\nfunction nsName(ns) {\n  if (isString(ns)) {\n    return ns;\n  } else {\n    return (ns.prefix ? ns.prefix + ':' : '') + ns.localName;\n  }\n}\n\nfunction getNsAttrs(namespaces) {\n\n  return map(namespaces.getUsed(), function(ns) {\n    var name = 'xmlns' + (ns.prefix ? ':' + ns.prefix : '');\n    return { name: name, value: ns.uri };\n  });\n\n}\n\nfunction getElementNs(ns, descriptor) {\n  if (descriptor.isGeneric) {\n    return assign({ localName: descriptor.ns.localName }, ns);\n  } else {\n    return assign({ localName: nameToAlias(descriptor.ns.localName, descriptor.$pkg) }, ns);\n  }\n}\n\nfunction getPropertyNs(ns, descriptor) {\n  return assign({ localName: descriptor.ns.localName }, ns);\n}\n\nfunction getSerializableProperties(element) {\n  var descriptor = element.$descriptor;\n\n  return filter(descriptor.properties, function(p) {\n    var name = p.name;\n\n    if (p.isVirtual) {\n      return false;\n    }\n\n    // do not serialize defaults\n    if (!has(element, name)) {\n      return false;\n    }\n\n    var value = element[name];\n\n    // do not serialize default equals\n    if (value === p.default) {\n      return false;\n    }\n\n    // do not serialize null properties\n    if (value === null) {\n      return false;\n    }\n\n    return p.isMany ? value.length : true;\n  });\n}\n\nvar ESCAPE_ATTR_MAP = {\n  '\\n': '#10',\n  '\\n\\r': '#10',\n  '\"': '#34',\n  '\\'': '#39',\n  '<': '#60',\n  '>': '#62',\n  '&': '#38'\n};\n\nvar ESCAPE_MAP = {\n  '<': 'lt',\n  '>': 'gt',\n  '&': 'amp'\n};\n\nfunction escape(str, charPattern, replaceMap) {\n\n  // ensure we are handling strings here\n  str = isString(str) ? str : '' + str;\n\n  return str.replace(charPattern, function(s) {\n    return '&' + replaceMap[s] + ';';\n  });\n}\n\n/**\n * Escape a string attribute to not contain any bad values (line breaks, '\"', ...)\n *\n * @param {String} str the string to escape\n * @return {String} the escaped string\n */\nfunction escapeAttr(str) {\n  return escape(str, ESCAPE_ATTR_CHARS, ESCAPE_ATTR_MAP);\n}\n\nfunction escapeBody(str) {\n  return escape(str, ESCAPE_CHARS, ESCAPE_MAP);\n}\n\nfunction filterAttributes(props) {\n  return filter(props, function(p) { return p.isAttr; });\n}\n\nfunction filterContained(props) {\n  return filter(props, function(p) { return !p.isAttr; });\n}\n\n\nfunction ReferenceSerializer(tagName) {\n  this.tagName = tagName;\n}\n\nReferenceSerializer.prototype.build = function(element) {\n  this.element = element;\n  return this;\n};\n\nReferenceSerializer.prototype.serializeTo = function(writer) {\n  writer\n    .appendIndent()\n    .append('<' + this.tagName + '>' + this.element.id + '</' + this.tagName + '>')\n    .appendNewLine();\n};\n\nfunction BodySerializer() {}\n\nBodySerializer.prototype.serializeValue =\nBodySerializer.prototype.serializeTo = function(writer) {\n  writer.append(\n    this.escape\n      ? escapeBody(this.value)\n      : this.value\n  );\n};\n\nBodySerializer.prototype.build = function(prop, value) {\n  this.value = value;\n\n  if (prop.type === 'String' && value.search(ESCAPE_CHARS) !== -1) {\n    this.escape = true;\n  }\n\n  return this;\n};\n\nfunction ValueSerializer(tagName) {\n  this.tagName = tagName;\n}\n\ninherits(ValueSerializer, BodySerializer);\n\nValueSerializer.prototype.serializeTo = function(writer) {\n\n  writer\n    .appendIndent()\n    .append('<' + this.tagName + '>');\n\n  this.serializeValue(writer);\n\n  writer\n    .append('</' + this.tagName + '>')\n    .appendNewLine();\n};\n\nfunction ElementSerializer(parent, propertyDescriptor) {\n  this.body = [];\n  this.attrs = [];\n\n  this.parent = parent;\n  this.propertyDescriptor = propertyDescriptor;\n}\n\nElementSerializer.prototype.build = function(element) {\n  this.element = element;\n\n  var elementDescriptor = element.$descriptor,\n      propertyDescriptor = this.propertyDescriptor;\n\n  var otherAttrs,\n      properties;\n\n  var isGeneric = elementDescriptor.isGeneric;\n\n  if (isGeneric) {\n    otherAttrs = this.parseGeneric(element);\n  } else {\n    otherAttrs = this.parseNsAttributes(element);\n  }\n\n  if (propertyDescriptor) {\n    this.ns = this.nsPropertyTagName(propertyDescriptor);\n  } else {\n    this.ns = this.nsTagName(elementDescriptor);\n  }\n\n  // compute tag name\n  this.tagName = this.addTagName(this.ns);\n\n  if (!isGeneric) {\n    properties = getSerializableProperties(element);\n\n    this.parseAttributes(filterAttributes(properties));\n    this.parseContainments(filterContained(properties));\n  }\n\n  this.parseGenericAttributes(element, otherAttrs);\n\n  return this;\n};\n\nElementSerializer.prototype.nsTagName = function(descriptor) {\n  var effectiveNs = this.logNamespaceUsed(descriptor.ns);\n  return getElementNs(effectiveNs, descriptor);\n};\n\nElementSerializer.prototype.nsPropertyTagName = function(descriptor) {\n  var effectiveNs = this.logNamespaceUsed(descriptor.ns);\n  return getPropertyNs(effectiveNs, descriptor);\n};\n\nElementSerializer.prototype.isLocalNs = function(ns) {\n  return ns.uri === this.ns.uri;\n};\n\n/**\n * Get the actual ns attribute name for the given element.\n *\n * @param {Object} element\n * @param {Boolean} [element.inherited=false]\n *\n * @return {Object} nsName\n */\nElementSerializer.prototype.nsAttributeName = function(element) {\n\n  var ns;\n\n  if (isString(element)) {\n    ns = parseNameNS(element);\n  } else {\n    ns = element.ns;\n  }\n\n  // return just local name for inherited attributes\n  if (element.inherited) {\n    return { localName: ns.localName };\n  }\n\n  // parse + log effective ns\n  var effectiveNs = this.logNamespaceUsed(ns);\n\n  // LOG ACTUAL namespace use\n  this.getNamespaces().logUsed(effectiveNs);\n\n  // strip prefix if same namespace like parent\n  if (this.isLocalNs(effectiveNs)) {\n    return { localName: ns.localName };\n  } else {\n    return assign({ localName: ns.localName }, effectiveNs);\n  }\n};\n\nElementSerializer.prototype.parseGeneric = function(element) {\n\n  var self = this,\n      body = this.body;\n\n  var attributes = [];\n\n  forEach(element, function(val, key) {\n\n    var nonNsAttr;\n\n    if (key === '$body') {\n      body.push(new BodySerializer().build({ type: 'String' }, val));\n    } else\n    if (key === '$children') {\n      forEach(val, function(child) {\n        body.push(new ElementSerializer(self).build(child));\n      });\n    } else\n    if (key.indexOf('$') !== 0) {\n      nonNsAttr = self.parseNsAttribute(element, key, val);\n\n      if (nonNsAttr) {\n        attributes.push({ name: key, value: val });\n      }\n    }\n  });\n\n  return attributes;\n};\n\nElementSerializer.prototype.parseNsAttribute = function(element, name, value) {\n  var model = element.$model;\n\n  var nameNs = parseNameNS(name);\n\n  var ns;\n\n  // parse xmlns:foo=\"http://foo.bar\"\n  if (nameNs.prefix === 'xmlns') {\n    ns = { prefix: nameNs.localName, uri: value };\n  }\n\n  // parse xmlns=\"http://foo.bar\"\n  if (!nameNs.prefix && nameNs.localName === 'xmlns') {\n    ns = { uri: value };\n  }\n\n  if (!ns) {\n    return {\n      name: name,\n      value: value\n    };\n  }\n\n  if (model && model.getPackage(value)) {\n\n    // register well known namespace\n    this.logNamespace(ns, true, true);\n  } else {\n\n    // log custom namespace directly as used\n    var actualNs = this.logNamespaceUsed(ns, true);\n\n    this.getNamespaces().logUsed(actualNs);\n  }\n};\n\n\n/**\n * Parse namespaces and return a list of left over generic attributes\n *\n * @param  {Object} element\n * @return {Array<Object>}\n */\nElementSerializer.prototype.parseNsAttributes = function(element, attrs) {\n  var self = this;\n\n  var genericAttrs = element.$attrs;\n\n  var attributes = [];\n\n  // parse namespace attributes first\n  // and log them. push non namespace attributes to a list\n  // and process them later\n  forEach(genericAttrs, function(value, name) {\n\n    var nonNsAttr = self.parseNsAttribute(element, name, value);\n\n    if (nonNsAttr) {\n      attributes.push(nonNsAttr);\n    }\n  });\n\n  return attributes;\n};\n\nElementSerializer.prototype.parseGenericAttributes = function(element, attributes) {\n\n  var self = this;\n\n  forEach(attributes, function(attr) {\n\n    // do not serialize xsi:type attribute\n    // it is set manually based on the actual implementation type\n    if (attr.name === XSI_TYPE) {\n      return;\n    }\n\n    try {\n      self.addAttribute(self.nsAttributeName(attr.name), attr.value);\n    } catch (e) {\n      console.warn(\n        'missing namespace information for ',\n        attr.name, '=', attr.value, 'on', element,\n        e);\n    }\n  });\n};\n\nElementSerializer.prototype.parseContainments = function(properties) {\n\n  var self = this,\n      body = this.body,\n      element = this.element;\n\n  forEach(properties, function(p) {\n    var value = element.get(p.name),\n        isReference = p.isReference,\n        isMany = p.isMany;\n\n    if (!isMany) {\n      value = [ value ];\n    }\n\n    if (p.isBody) {\n      body.push(new BodySerializer().build(p, value[0]));\n    } else\n    if (isSimpleType(p.type)) {\n      forEach(value, function(v) {\n        body.push(new ValueSerializer(self.addTagName(self.nsPropertyTagName(p))).build(p, v));\n      });\n    } else\n    if (isReference) {\n      forEach(value, function(v) {\n        body.push(new ReferenceSerializer(self.addTagName(self.nsPropertyTagName(p))).build(v));\n      });\n    } else {\n\n      // allow serialization via type\n      // rather than element name\n      var asType = serializeAsType(p),\n          asProperty = serializeAsProperty(p);\n\n      forEach(value, function(v) {\n        var serializer;\n\n        if (asType) {\n          serializer = new TypeSerializer(self, p);\n        } else\n        if (asProperty) {\n          serializer = new ElementSerializer(self, p);\n        } else {\n          serializer = new ElementSerializer(self);\n        }\n\n        body.push(serializer.build(v));\n      });\n    }\n  });\n};\n\nElementSerializer.prototype.getNamespaces = function(local) {\n\n  var namespaces = this.namespaces,\n      parent = this.parent,\n      parentNamespaces;\n\n  if (!namespaces) {\n    parentNamespaces = parent && parent.getNamespaces();\n\n    if (local || !parentNamespaces) {\n      this.namespaces = namespaces = new Namespaces(parentNamespaces);\n    } else {\n      namespaces = parentNamespaces;\n    }\n  }\n\n  return namespaces;\n};\n\nElementSerializer.prototype.logNamespace = function(ns, wellknown, local) {\n  var namespaces = this.getNamespaces(local);\n\n  var nsUri = ns.uri,\n      nsPrefix = ns.prefix;\n\n  var existing = namespaces.byUri(nsUri);\n\n  if (nsPrefix !== 'xml' && (!existing || local)) {\n    namespaces.add(ns, wellknown);\n  }\n\n  namespaces.mapPrefix(nsPrefix, nsUri);\n\n  return ns;\n};\n\nElementSerializer.prototype.logNamespaceUsed = function(ns, local) {\n  var element = this.element,\n      model = element.$model,\n      namespaces = this.getNamespaces(local);\n\n  // ns may be\n  //\n  //   * prefix only\n  //   * prefix:uri\n  //   * localName only\n\n  var prefix = ns.prefix,\n      uri = ns.uri,\n      newPrefix, idx,\n      wellknownUri;\n\n  // handle anonymous namespaces (elementForm=unqualified), cf. #23\n  if (!prefix && !uri) {\n    return { localName: ns.localName };\n  }\n\n  wellknownUri = DEFAULT_NS_MAP[prefix] || model && (model.getPackage(prefix) || {}).uri;\n\n  uri = uri || wellknownUri || namespaces.uriByPrefix(prefix);\n\n  if (!uri) {\n    throw new Error('no namespace uri given for prefix <' + prefix + '>');\n  }\n\n  ns = namespaces.byUri(uri);\n\n  if (!ns) {\n    newPrefix = prefix;\n    idx = 1;\n\n    // find a prefix that is not mapped yet\n    while (namespaces.uriByPrefix(newPrefix)) {\n      newPrefix = prefix + '_' + idx++;\n    }\n\n    ns = this.logNamespace({ prefix: newPrefix, uri: uri }, wellknownUri === uri);\n  }\n\n  if (prefix) {\n    namespaces.mapPrefix(prefix, uri);\n  }\n\n  return ns;\n};\n\nElementSerializer.prototype.parseAttributes = function(properties) {\n  var self = this,\n      element = this.element;\n\n  forEach(properties, function(p) {\n\n    var value = element.get(p.name);\n\n    if (p.isReference) {\n\n      if (!p.isMany) {\n        value = value.id;\n      }\n      else {\n        var values = [];\n        forEach(value, function(v) {\n          values.push(v.id);\n        });\n\n        // IDREFS is a whitespace-separated list of references.\n        value = values.join(' ');\n      }\n\n    }\n\n    self.addAttribute(self.nsAttributeName(p), value);\n  });\n};\n\nElementSerializer.prototype.addTagName = function(nsTagName) {\n  var actualNs = this.logNamespaceUsed(nsTagName);\n\n  this.getNamespaces().logUsed(actualNs);\n\n  return nsName(nsTagName);\n};\n\nElementSerializer.prototype.addAttribute = function(name, value) {\n  var attrs = this.attrs;\n\n  if (isString(value)) {\n    value = escapeAttr(value);\n  }\n\n  attrs.push({ name: name, value: value });\n};\n\nElementSerializer.prototype.serializeAttributes = function(writer) {\n  var attrs = this.attrs,\n      namespaces = this.namespaces;\n\n  if (namespaces) {\n    attrs = getNsAttrs(namespaces).concat(attrs);\n  }\n\n  forEach(attrs, function(a) {\n    writer\n      .append(' ')\n      .append(nsName(a.name)).append('=\"').append(a.value).append('\"');\n  });\n};\n\nElementSerializer.prototype.serializeTo = function(writer) {\n  var firstBody = this.body[0],\n      indent = firstBody && firstBody.constructor !== BodySerializer;\n\n  writer\n    .appendIndent()\n    .append('<' + this.tagName);\n\n  this.serializeAttributes(writer);\n\n  writer.append(firstBody ? '>' : ' />');\n\n  if (firstBody) {\n\n    if (indent) {\n      writer\n        .appendNewLine()\n        .indent();\n    }\n\n    forEach(this.body, function(b) {\n      b.serializeTo(writer);\n    });\n\n    if (indent) {\n      writer\n        .unindent()\n        .appendIndent();\n    }\n\n    writer.append('</' + this.tagName + '>');\n  }\n\n  writer.appendNewLine();\n};\n\n/**\n * A serializer for types that handles serialization of data types\n */\nfunction TypeSerializer(parent, propertyDescriptor) {\n  ElementSerializer.call(this, parent, propertyDescriptor);\n}\n\ninherits(TypeSerializer, ElementSerializer);\n\nTypeSerializer.prototype.parseNsAttributes = function(element) {\n\n  // extracted attributes\n  var attributes = ElementSerializer.prototype.parseNsAttributes.call(this, element);\n\n  var descriptor = element.$descriptor;\n\n  // only serialize xsi:type if necessary\n  if (descriptor.name === this.propertyDescriptor.type) {\n    return attributes;\n  }\n\n  var typeNs = this.typeNs = this.nsTagName(descriptor);\n  this.getNamespaces().logUsed(this.typeNs);\n\n  // add xsi:type attribute to represent the elements\n  // actual type\n\n  var pkg = element.$model.getPackage(typeNs.uri),\n      typePrefix = (pkg.xml && pkg.xml.typePrefix) || '';\n\n  this.addAttribute(\n    this.nsAttributeName(XSI_TYPE),\n    (typeNs.prefix ? typeNs.prefix + ':' : '') + typePrefix + descriptor.ns.localName\n  );\n\n  return attributes;\n};\n\nTypeSerializer.prototype.isLocalNs = function(ns) {\n  return ns.uri === (this.typeNs || this.ns).uri;\n};\n\nfunction SavingWriter() {\n  this.value = '';\n\n  this.write = function(str) {\n    this.value += str;\n  };\n}\n\nfunction FormatingWriter(out, format) {\n\n  var indent = [''];\n\n  this.append = function(str) {\n    out.write(str);\n\n    return this;\n  };\n\n  this.appendNewLine = function() {\n    if (format) {\n      out.write('\\n');\n    }\n\n    return this;\n  };\n\n  this.appendIndent = function() {\n    if (format) {\n      out.write(indent.join('  '));\n    }\n\n    return this;\n  };\n\n  this.indent = function() {\n    indent.push('');\n    return this;\n  };\n\n  this.unindent = function() {\n    indent.pop();\n    return this;\n  };\n}\n\n/**\n * A writer for meta-model backed document trees\n *\n * @param {Object} options output options to pass into the writer\n */\nfunction Writer(options) {\n\n  options = assign({ format: false, preamble: true }, options || {});\n\n  function toXML(tree, writer) {\n    var internalWriter = writer || new SavingWriter();\n    var formatingWriter = new FormatingWriter(internalWriter, options.format);\n\n    if (options.preamble) {\n      formatingWriter.append(XML_PREAMBLE);\n    }\n\n    new ElementSerializer().build(tree).serializeTo(formatingWriter);\n\n    if (!writer) {\n      return internalWriter.value;\n    }\n  }\n\n  return {\n    toXML: toXML\n  };\n}\n\nexport { Reader, Writer };\n","import { isString, assign } from 'min-dash';\n\nimport { Moddle } from 'moddle';\n\nimport { Reader, Writer } from 'moddle-xml';\n\n/**\n * A sub class of {@link Moddle} with support for import and export of Postit-js xml files.\n *\n * @class PostitModdle\n *\n * @extends Moddle\n *\n * @param {Object|Array} packages to use for instantiating the model\n * @param {Object} [options] additional options to pass over\n */\nexport default function PostitModdle(packages, options) {\n  Moddle.call(this, packages, options);\n}\n\nPostitModdle.prototype = Object.create(Moddle.prototype);\n\n/**\n * The fromXML result.\n *\n * @typedef {Object} ParseResult\n *\n * @property {ModdleElement} rootElement\n * @property {Array<Object>} references\n * @property {Array<Error>} warnings\n * @property {Object} elementsById - a mapping containing each ID -> ModdleElement\n */\n\n/**\n * The fromXML error.\n *\n * @typedef {Error} ParseError\n *\n * @property {Array<Error>} warnings\n */\n\n/**\n * Instantiates a Postit model tree from a given xml string.\n *\n * @param {String}   xmlStr\n * @param {String}   [typeName='postit:Definitions'] name of the root element\n * @param {Object}   [options]  options to pass to the underlying reader\n *\n * @returns {Promise<ParseResult, ParseError>}\n */\nPostitModdle.prototype.fromXML = function(xmlStr, typeName, options) {\n  if (!isString(typeName)) {\n    options = typeName;\n    typeName = 'postit:Definitions';\n  }\n\n  var reader = new Reader(assign({ model: this, lax: true }, options));\n  var rootHandler = reader.handler(typeName);\n\n  return reader.fromXML(xmlStr, rootHandler);\n};\n\n/**\n * The toXML result.\n *\n * @typedef {Object} SerializationResult\n *\n * @property {String} xml\n */\n\n/**\n * Serializes a Postit object tree to XML.\n *\n * @param {String}   element    the root element, typically an instance of `postit:Definitions`\n * @param {Object}   [options]  to pass to the underlying writer\n *\n * @returns {Promise<SerializationResult, Error>}\n */\nPostitModdle.prototype.toXML = function(element, options) {\n  var writer = new Writer(options);\n\n  return new Promise(function(resolve, reject) {\n    try {\n      var result = writer.toXML(element);\n\n      return resolve({\n        xml: result\n      });\n    } catch (err) {\n      return reject(err);\n    }\n  });\n};\n","\nimport {\n  assign\n} from 'min-dash';\n\nimport Moddle from './Moddle';\n\nimport PostitDescriptors from './resources/postit.json';\nimport DiDescriptors from './resources/postitDi.json';\nimport DcDescriptors from './resources/dc.json';\n\nvar packages = {\n  postit: PostitDescriptors,\n  postitDi: DiDescriptors,\n  dc: DcDescriptors,\n};\n\nexport default function(additionalPackages, options) {\n  var pks = assign({}, packages, additionalPackages);\n\n  return new Moddle(pks, options);\n}\n","export function elementToString(e) {\n  if (!e) {\n    return '<null>';\n  }\n\n  return '<' + e.$type + (e.id ? ' id=\"' + e.id : '') + '\" />';\n}","import {\n  find,\n  forEach\n} from 'min-dash';\n\nimport Refs from 'object-refs';\n\nimport {\n  elementToString\n} from './Util';\n\nvar diRefs = new Refs(\n  { name: 'boardElement', enumerable: true },\n  { name: 'di', configurable: true }\n);\n\n/**\n * Returns true if an element has the given meta-model type\n *\n * @param  {ModdleElement}  element\n * @param  {String}         type\n *\n * @return {Boolean}\n */\nfunction is(element, type) {\n  return element.$instanceOf(type);\n}\n\n\n/**\n * Find a suitable display candidate for definitions where the DI does not\n * correctly specify one.\n */\nfunction findDisplayCandidate(definitions) {\n  return find(definitions.rootElements, function(e) {\n    return is(e, 'postit:PostitBoard');\n  });\n}\n\n\nexport default function PostitTreeWalker(handler, translate) {\n\n  // list of containers already walked\n  var handledElements = {};\n\n  // list of elements to handle deferred to ensure\n  // prerequisites are drawn\n  var deferred = [];\n\n  // Helpers //////////////////////\n\n  function visitRoot(element, diagram) {\n    return handler.root(element, diagram);\n  }\n\n  function visit(element, ctx) {\n\n    var gfx = element.gfx;\n\n    // avoid multiple rendering of elements\n    if (gfx) {\n      throw new Error(\n        translate('already rendered {element}', { element: elementToString(element) })\n      );\n    }\n\n    // call handler\n    return handler.element(element, ctx);\n  }\n\n  function visitIfDi(element, ctx) {\n\n    try {\n      var gfx = element.di && visit(element, ctx);\n\n      handled(element);\n\n      return gfx;\n    } catch (e) {\n      logError(e.message, { element: element, error: e });\n\n      console.error(translate('failed to import {element}', { element: elementToString(element) }));\n      console.error(e);\n    }\n  }\n\n  function logError(message, context) {\n    handler.error(message, context);\n  }\n\n  function handled(element) {\n    handledElements[element.id] = element;\n  }\n\n  // DI handling //////////////////////\n\n  function registerDi(di) {\n    var boardElement = di.boardElement;\n\n    if (boardElement) {\n      if (boardElement.di) {\n        logError(\n          translate('multiple DI elements defined for {element}', {\n            element: elementToString(boardElement)\n          }),\n          { element: boardElement }\n        );\n      } else {\n        diRefs.bind(boardElement, 'di');\n        boardElement.di = di;\n      }\n    } else {\n      logError(\n        translate('no boardElement referenced in {element}', {\n          element: elementToString(di)\n        }),\n        { element: di }\n      );\n    }\n  }\n\n  function handleBoard(diagram) {\n    handlePlane(diagram.plane);\n  }\n\n  function handlePlane(plane) {\n    registerDi(plane);\n\n    forEach(plane.planeElement, handlePlaneElement);\n  }\n\n  function handlePlaneElement(planeElement) {\n    registerDi(planeElement);\n  }\n\n\n  // Semantic handling //////////////////////\n\n  /**\n   * Handle definitions and return the rendered board (if any)\n   *\n   * @param {ModdleElement} definitions to walk and import\n   * @param {ModdleElement} [rootBoard] specific board to import and display\n   *\n   * @throws {Error} if no diagram to display could be found\n   */\n  function handleDefinitions(definitions, rootBoard) {\n\n    // make sure we walk the correct boardElement\n\n    var rootBoards = definitions.rootBoards;\n\n    if (rootBoard && rootBoards.indexOf(rootBoard) === -1) {\n      throw new Error(translate('rootBoard not part of postit:Definitions'));\n    }\n\n    if (!rootBoard && rootBoards && rootBoards.length) {\n      rootBoard = rootBoards[0];\n    }\n\n    // no root board -> nothing to import\n    if (!rootBoard) {\n      throw new Error(translate('no rootBoard to display'));\n    }\n\n    // load DI from selected root board only\n    handleBoard(rootBoard);\n\n    var plane = rootBoard.plane;\n\n    if (!plane) {\n      throw new Error(translate(\n        'no plane for {element}',\n        { element: elementToString(rootBoard) }\n      ));\n    }\n\n    var rootElement = plane.boardElement;\n\n    // ensure we default to a suitable display candidate (board),\n    // even if non is specified in DI\n    if (!rootElement) {\n      rootElement = findDisplayCandidate(definitions);\n\n      if (!rootElement) {\n        throw new Error(translate('no board to display'));\n      } else {\n\n        logError(\n          translate('correcting missing boardElement on {plane} to {rootElement}', {\n            plane: elementToString(plane),\n            rootElement: elementToString(rootElement)\n          })\n        );\n\n        // correct DI on the fly\n        plane.boardElement = rootElement;\n        registerDi(plane);\n      }\n    }\n\n\n    var ctx = visitRoot(rootElement, plane);\n\n    if (is(rootElement, 'postit:PostitBoard')) {\n      handlePostitBoard(rootElement, ctx);\n    }\n\n    // handle all deferred elements\n    handleDeferred(deferred);\n  }\n\n  function handleBoardElements(boardElements, context) {\n    forEach(boardElements, function(element) {\n      visitIfDi(element, context);\n    });\n  }\n\n  function handlePostitBoard(board, context) {\n    handleBoardElements(board.boardElements, context);\n\n    // log board handled\n    handled(board);\n  }\n\n  function handleDeferred() {\n\n    var fn;\n\n    // drain deferred until empty\n    while (deferred.length) {\n      fn = deferred.shift();\n\n      fn();\n    }\n  }\n\n\n\n\n  // API //////////////////////\n\n  return {\n    handleDeferred: handleDeferred,\n    handleDefinitions: handleDefinitions,\n    registerDi: registerDi\n  };\n}","/**\n * This file must not be changed or exchanged.\n *\n * @see http://bpmn.io/license for more information.\n */\n\nimport {\n  domify,\n  delegate as domDelegate\n} from 'min-dom';\n\n\nvar BPMNIO_LOGO_SVG = '<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 58 23\"><path fill=\"currentColor\" d=\"M7.75 3.8v.58c0 1.7-.52 2.78-1.67 3.32C7.46 8.24 8 9.5 8 11.24v1.34c0 2.54-1.35 3.9-3.93 3.9H0V0h3.91c2.68 0 3.84 1.25 3.84 3.8zM2.59 2.35V6.7H3.6c.97 0 1.56-.42 1.56-1.74v-.92c0-1.18-.4-1.7-1.32-1.7zm0 6.7v5.07h1.48c.87 0 1.34-.4 1.34-1.63v-1.43c0-1.53-.5-2-1.67-2H2.6zm14.65-4.98v2.14c0 2.64-1.27 4.08-3.87 4.08h-1.22v6.2H9.56V0h3.82c2.59 0 3.86 1.44 3.86 4.07zm-5.09-1.71v5.57h1.22c.83 0 1.28-.37 1.28-1.55V3.91c0-1.18-.45-1.56-1.28-1.56h-1.22zm11.89 9.34L25.81 0h3.6v16.48h-2.44V4.66l-1.8 11.82h-2.45L20.8 4.83v11.65h-2.26V0h3.6zm9.56-7.15v11.93h-2.33V0h3.25l2.66 9.87V0h2.31v16.48h-2.66zm10.25 9.44v2.5h-2.5v-2.5zM50 4.16C50 1.52 51.38.02 53.93.02c2.54 0 3.93 1.5 3.93 4.14v8.37c0 2.64-1.4 4.14-3.93 4.14-2.55 0-3.93-1.5-3.93-4.14zm2.58 8.53c0 1.18.52 1.63 1.35 1.63.82 0 1.34-.45 1.34-1.63V4c0-1.17-.52-1.62-1.34-1.62-.83 0-1.35.45-1.35 1.62zM0 18.7h57.86V23H0zM45.73 0h2.6v2.58h-2.6zm2.59 16.48V4.16h-2.59v12.32z\"></path></svg>';\n\nvar BPMNIO_LOGO_URL = 'data:image/svg+xml,' + encodeURIComponent(BPMNIO_LOGO_SVG);\n\nexport var BPMNIO_IMG = '<img width=\"52\" height=\"52\" src=\"' + BPMNIO_LOGO_URL + '\" />';\n\nfunction css(attrs) {\n  return attrs.join(';');\n}\n\nvar LIGHTBOX_STYLES = css([\n  'z-index: 1001',\n  'position: fixed',\n  'top: 0',\n  'left: 0',\n  'right: 0',\n  'bottom: 0'\n]);\n\nvar BACKDROP_STYLES = css([\n  'width: 100%',\n  'height: 100%',\n  'background: rgba(0,0,0,0.2)'\n]);\n\nvar NOTICE_STYLES = css([\n  'position: absolute',\n  'left: 50%',\n  'top: 40%',\n  'margin: 0 -130px',\n  'width: 260px',\n  'padding: 10px',\n  'background: white',\n  'border: solid 1px #AAA',\n  'border-radius: 3px',\n  'font-family: Helvetica, Arial, sans-serif',\n  'font-size: 14px',\n  'line-height: 1.2em'\n]);\n\nvar LIGHTBOX_MARKUP =\n  '<div class=\"bjs-powered-by-lightbox\" style=\"' + LIGHTBOX_STYLES + '\">' +\n    '<div class=\"backdrop\" style=\"' + BACKDROP_STYLES + '\"></div>' +\n    '<div class=\"notice\" style=\"' + NOTICE_STYLES + '\">' +\n      '<a href=\"http://bpmn.io\" target=\"_blank\" style=\"float: left; margin-right: 10px\">' +\n        BPMNIO_IMG +\n      '</a>' +\n      'Web-based tooling for BPMN, DMN and CMMN diagrams ' +\n      'powered by <a href=\"http://bpmn.io\" target=\"_blank\">bpmn.io</a>.' +\n    '</div>' +\n  '</div>';\n\n\nvar lightbox;\n\nexport function open() {\n\n  if (!lightbox) {\n    lightbox = domify(LIGHTBOX_MARKUP);\n\n    domDelegate.bind(lightbox, '.backdrop', 'click', function(event) {\n      document.body.removeChild(lightbox);\n    });\n  }\n\n  document.body.appendChild(lightbox);\n}","/**\n * The code in the <project-logo></project-logo> area\n * must not be changed.\n *\n * @see http://bpmn.io/license for more information.\n */\nimport {\n  assign,\n  find,\n  isNumber,\n  omit\n} from 'min-dash';\n\nimport {\n  domify,\n  query as domQuery,\n  remove as domRemove\n} from 'min-dom';\n\nimport {\n  innerSVG\n} from 'tiny-svg';\n\nimport Diagram from 'diagram-js';\nimport Moddle from './moddle';\n\nimport inherits from 'inherits';\n\nimport {\n  importPostitDiagram\n} from './import/Importer';\n\n\n\n\n/**\n * A base viewer for Postit boards.\n *\n * Have a look at {@link Viewer}, {@link NavigatedViewer} or {@link Modeler} for\n * bundles that include actual features.\n *\n * @param {Object} [options] configuration options to pass to the viewer\n * @param {DOMElement} [options.container] the container to render the viewer in, defaults to body.\n * @param {String|Number} [options.width] the width of the viewer\n * @param {String|Number} [options.height] the height of the viewer\n * @param {Object} [options.moddleExtensions] extension packages to provide\n * @param {Array<didi.Module>} [options.modules] a list of modules to override the default modules\n * @param {Array<didi.Module>} [options.additionalModules] a list of modules to use with the default modules\n */\nexport default function BaseViewer(options) {\n\n  options = assign({}, DEFAULT_OPTIONS, options);\n\n  this._moddle = this._createModdle(options);\n\n  this._container = this._createContainer(options);\n\n  /* <project-logo> */\n\n  addProjectLogo(this._container);\n\n  /* </project-logo> */\n\n  this._init(this._container, this._moddle, options);\n}\n\ninherits(BaseViewer, Diagram);\n\n/**\n* The importXML result.\n*\n* @typedef {Object} ImportXMLResult\n*\n* @property {Array<string>} warnings\n*/\n\n/**\n* The importXML error.\n*\n* @typedef {Error} ImportXMLError\n*\n* @property {Array<string>} warnings\n*/\n\n\n/**\n * Parse and render a Postit diagram.\n *\n * Once finished the viewer reports back the result to the\n * provided callback function with (err, warnings).\n *\n * ## Life-Cycle Events\n *\n * During import the viewer will fire life-cycle events:\n *\n *   * import.parse.start (about to read model from xml)\n *   * import.parse.complete (model read; may have worked or not)\n *   * import.render.start (graphical import start)\n *   * import.render.complete (graphical import finished)\n *   * import.done (everything done)\n *\n * You can use these events to hook into the life-cycle.\n *\n * @param {String} xml the Postit xml\n * @param {ModdleElement<PostitRootBoard>|String} [rootBoard] Postit board or id of board to render (if not provided, the first one will be rendered)\n *\n * @returns {Promise<ImportXMLResult, ImportXMLError>}\n */\nBaseViewer.prototype.importXML = function(xml, rootBoard) {\n\n  var self = this;\n\n  return new Promise(function(resolve, reject) {\n\n    // hook in pre-parse listeners +\n    // allow xml manipulation\n    xml = self._emit('import.parse.start', { xml: xml }) || xml;\n\n    self._moddle.fromXML(xml, 'postit:Definitions').then(function(result) {\n\n      var definitions = result.rootElement;\n      var references = result.references;\n      var parseWarnings = result.warnings;\n      var elementsById = result.elementsById;\n\n      var context = {\n        references: references,\n        elementsById: elementsById,\n        warnings: parseWarnings\n      };\n\n      // hook in post parse listeners +\n      // allow definitions manipulation\n      definitions = self._emit('import.parse.complete', {\n        definitions: definitions,\n        context: context\n      }) || definitions;\n\n      self.importDefinitions(definitions, rootBoard).then(function(result) {\n        var allWarnings = [].concat(parseWarnings, result.warnings || []);\n\n        self._emit('import.done', { error: null, warnings: allWarnings });\n\n        return resolve({ warnings: allWarnings });\n      }).catch(function(err) {\n        var allWarnings = [].concat(parseWarnings, err.warnings || []);\n\n        self._emit('import.done', { error: err, warnings: allWarnings });\n\n        return reject(addWarningsToError(err, allWarnings));\n      });\n    }).catch(function(err) {\n\n      self._emit('import.parse.complete', {\n        error: err\n      });\n\n      err = checkValidationError(err);\n\n      self._emit('import.done', { error: err, warnings: err.warnings });\n\n      return reject(err);\n    });\n\n  });\n};\n\n/**\n* The importDefinitions result.\n*\n* @typedef {Object} ImportDefinitionsResult\n*\n* @property {Array<string>} warnings\n*/\n\n/**\n* The importDefinitions error.\n*\n* @typedef {Error} ImportDefinitionsError\n*\n* @property {Array<string>} warnings\n*/\n\n/**\n * Import parsed definitions and render a Postit diagram.\n *\n * Once finished the viewer reports back the result to the\n * provided callback function with (err, warnings).\n *\n * ## Life-Cycle Events\n *\n * During import the viewer will fire life-cycle events:\n *\n *   * import.render.start (graphical import start)\n *   * import.render.complete (graphical import finished)\n *\n * You can use these events to hook into the life-cycle.\n *\n * @param {ModdleElement<Definitions>} definitions parsed Postit definitions\n * @param {ModdleElement<PostitRootBoard>|String} [rootBoard] Postit board or id of board to render (if not provided, the first one will be rendered)\n *\n * returns {Promise<ImportDefinitionsResult, ImportDefinitionsError>}\n */\nBaseViewer.prototype.importDefinitions = function(definitions, rootBoard) {\n\n  var self = this;\n\n  return new Promise(function(resolve, reject) {\n\n    self._setDefinitions(definitions);\n\n    self.open(rootBoard).then(function(result) {\n\n      var warnings = result.warnings;\n\n      return resolve({ warnings: warnings });\n    }).catch(function(err) {\n\n      return reject(err);\n    });\n  });\n};\n\n/**\n * The open result.\n *\n * @typedef {Object} OpenResult\n *\n * @property {Array<string>} warnings\n */\n\n/**\n* The open error.\n*\n* @typedef {Error} OpenError\n*\n* @property {Array<string>} warnings\n*/\n\n/**\n * Open board of previously imported XML.\n *\n * Once finished the viewer reports back the result to the\n * provided callback function with (err, warnings).\n *\n * ## Life-Cycle Events\n *\n * During switch the viewer will fire life-cycle events:\n *\n *   * import.render.start (graphical import start)\n *   * import.render.complete (graphical import finished)\n *\n * You can use these events to hook into the life-cycle.\n *\n * @param {String|ModdleElement<PostitRootBoard>} [rootBoardOrId] id or the diagram to open\n *\n * returns {Promise<OpenResult, OpenError>}\n */\nBaseViewer.prototype.open = function(rootBoardOrId) {\n\n  var definitions = this._definitions;\n  var rootBord = rootBoardOrId;\n\n  var self = this;\n\n  return new Promise(function(resolve, reject) {\n    if (!definitions) {\n      var err1 = new Error('no XML imported');\n\n      return reject(addWarningsToError(err1, []));\n    }\n\n    if (typeof rootBoardOrId === 'string') {\n      rootBord = findRootBoard(definitions, rootBoardOrId);\n\n      if (!rootBord) {\n        var err2 = new Error('PostitRootBoard <' + rootBoardOrId + '> not found');\n\n        return reject(addWarningsToError(err2, []));\n      }\n    }\n\n    // clear existing rendered diagram\n    // catch synchronous exceptions during #clear()\n    try {\n      self.clear();\n    } catch (error) {\n\n      return reject(addWarningsToError(error, []));\n    }\n\n    // perform graphical import\n    importPostitDiagram(self, definitions, rootBord).then(function(result) {\n\n      var warnings = result.warnings;\n\n      return resolve({ warnings: warnings });\n    }).catch(function(err) {\n\n      return reject(err);\n    });\n  });\n};\n\n/**\n * The saveXML result.\n *\n * @typedef {Object} SaveXMLResult\n *\n * @property {string} xml\n */\n\n/**\n * Export the currently displayed Postit diagram as\n * a Postit XML document.\n *\n * ## Life-Cycle Events\n *\n * During XML saving the viewer will fire life-cycle events:\n *\n *   * saveXML.start (before serialization)\n *   * saveXML.serialized (after xml generation)\n *   * saveXML.done (everything done)\n *\n * You can use these events to hook into the life-cycle.\n *\n * @param {Object} [options] export options\n * @param {Boolean} [options.format=false] output formatted XML\n * @param {Boolean} [options.preamble=true] output preamble\n *\n * returns {Promise<SaveXMLResult, Error>}\n */\nBaseViewer.prototype.saveXML = function(options) {\n\n  options = options || {};\n\n  var self = this;\n\n  var definitions = this._definitions;\n\n  return new Promise(function(resolve, reject) {\n\n    if (!definitions) {\n      var err = new Error('no definitions loaded');\n\n      return reject(err);\n    }\n\n    // allow to fiddle around with definitions\n    definitions = self._emit('saveXML.start', {\n      definitions: definitions\n    }) || definitions;\n\n    self._moddle.toXML(definitions, options).then(function(result) {\n\n      var xml = result.xml;\n\n      try {\n        xml = self._emit('saveXML.serialized', {\n          error: null,\n          xml: xml\n        }) || xml;\n\n        self._emit('saveXML.done', {\n          error: null,\n          xml: xml\n        });\n      } catch (e) {\n        console.error('error in saveXML life-cycle listener', e);\n      }\n\n      return resolve({ xml: xml });\n    }).catch(function(err) {\n\n      return reject(err);\n    });\n  });\n};\n\n/**\n * The saveSVG result.\n *\n * @typedef {Object} SaveSVGResult\n *\n * @property {string} svg\n */\n\n/**\n * Export the currently displayed Postit diagram as\n * an SVG image.\n *\n * ## Life-Cycle Events\n *\n * During SVG saving the viewer will fire life-cycle events:\n *\n *   * saveSVG.start (before serialization)\n *   * saveSVG.done (everything done)\n *\n * You can use these events to hook into the life-cycle.\n *\n * @param {Object} [options]\n *\n * returns {Promise<SaveSVGResult, Error>}\n */\nBaseViewer.prototype.saveSVG = function(options) {\n\n  options = options || {};\n\n  var self = this;\n\n  return new Promise(function(resolve, reject) {\n\n    self._emit('saveSVG.start');\n\n    var svg, err;\n\n    try {\n      var canvas = self.get('canvas');\n\n      var contentNode = canvas.getDefaultLayer(),\n          defsNode = domQuery('defs', canvas._svg);\n\n      var contents = innerSVG(contentNode),\n          defs = defsNode ? '<defs>' + innerSVG(defsNode) + '</defs>' : '';\n\n      var bbox = contentNode.getBBox();\n\n      svg =\n        '<?xml version=\"1.0\" encoding=\"utf-8\"?>\\n' +\n        '<!-- created with diagram-js / http://bpmn.io -->\\n' +\n        '<!DOCTYPE svg PUBLIC \"-//W3C//DTD SVG 1.1//EN\" \"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd\">\\n' +\n        '<svg xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" ' +\n             'width=\"' + bbox.width + '\" height=\"' + bbox.height + '\" ' +\n             'viewBox=\"' + bbox.x + ' ' + bbox.y + ' ' + bbox.width + ' ' + bbox.height + '\" version=\"1.1\">' +\n          defs + contents +\n        '</svg>';\n    } catch (e) {\n      err = e;\n    }\n\n    self._emit('saveSVG.done', {\n      error: err,\n      svg: svg\n    });\n\n    if (!err) {\n      return resolve({ svg: svg });\n    }\n\n    return reject(err);\n  });\n};\n\n/**\n * Get a named diagram service.\n *\n * @example\n *\n * var elementRegistry = viewer.get('elementRegistry');\n * var startEventShape = elementRegistry.get('StartEvent_1');\n *\n * @param {String} name\n *\n * @return {Object} diagram service instance\n *\n * @method BaseViewer#get\n */\n\n/**\n * Invoke a function in the context of this viewer.\n *\n * @example\n *\n * viewer.invoke(function(elementRegistry) {\n *   var startEventShape = elementRegistry.get('StartEvent_1');\n * });\n *\n * @param {Function} fn to be invoked\n *\n * @return {Object} the functions return value\n *\n * @method BaseViewer#invoke\n */\n\n\nBaseViewer.prototype._setDefinitions = function(definitions) {\n  this._definitions = definitions;\n};\n\nBaseViewer.prototype.getModules = function() {\n  return this._modules;\n};\n\n/**\n * Remove all drawn elements from the viewer.\n *\n * After calling this method the viewer can still\n * be reused for opening another diagram.\n *\n * @method BaseViewer#clear\n */\nBaseViewer.prototype.clear = function() {\n  if (!this.getDefinitions()) {\n\n    // no diagram to clear\n    return;\n  }\n\n  // remove businessObject#di binding\n  //\n  // this is necessary, as we establish the bindings\n  // in the PostitTreeWalker (and assume none are given\n  // on reimport)\n  this.get('elementRegistry').forEach(function(element) {\n    var bo = element.businessObject;\n\n    if (bo && bo.di) {\n      delete bo.di;\n    }\n  });\n\n  // remove drawn elements\n  Diagram.prototype.clear.call(this);\n};\n\n/**\n * Destroy the viewer instance and remove all its\n * remainders from the document tree.\n */\nBaseViewer.prototype.destroy = function() {\n\n  // diagram destroy\n  Diagram.prototype.destroy.call(this);\n\n  // dom detach\n  domRemove(this._container);\n};\n\n/**\n * Register an event listener\n *\n * Remove a previously added listener via {@link #off(event, callback)}.\n *\n * @param {String} event\n * @param {Number} [priority]\n * @param {Function} callback\n * @param {Object} [that]\n */\nBaseViewer.prototype.on = function(event, priority, callback, target) {\n  return this.get('eventBus').on(event, priority, callback, target);\n};\n\n/**\n * De-register an event listener\n *\n * @param {String} event\n * @param {Function} callback\n */\nBaseViewer.prototype.off = function(event, callback) {\n  this.get('eventBus').off(event, callback);\n};\n\nBaseViewer.prototype.attachTo = function(parentNode) {\n\n  if (!parentNode) {\n    throw new Error('parentNode required');\n  }\n\n  // ensure we detach from the\n  // previous, old parent\n  this.detach();\n\n  // unwrap jQuery if provided\n  if (parentNode.get && parentNode.constructor.prototype.jquery) {\n    parentNode = parentNode.get(0);\n  }\n\n  if (typeof parentNode === 'string') {\n    parentNode = domQuery(parentNode);\n  }\n\n  parentNode.appendChild(this._container);\n\n  this._emit('attach', {});\n\n  this.get('canvas').resized();\n};\n\nBaseViewer.prototype.getDefinitions = function() {\n  return this._definitions;\n};\n\nBaseViewer.prototype.detach = function() {\n\n  var container = this._container,\n      parentNode = container.parentNode;\n\n  if (!parentNode) {\n    return;\n  }\n\n  this._emit('detach', {});\n\n  parentNode.removeChild(container);\n};\n\nBaseViewer.prototype._init = function(container, moddle, options) {\n\n  var baseModules = options.modules || this.getModules(),\n      additionalModules = options.additionalModules || [],\n      staticModules = [\n        {\n          postitjs: [ 'value', this ],\n          moddle: [ 'value', moddle ]\n        }\n      ];\n\n  var diagramModules = [].concat(staticModules, baseModules, additionalModules);\n\n  var diagramOptions = assign(omit(options, [ 'additionalModules' ]), {\n    canvas: assign({}, options.canvas, { container: container }),\n    modules: diagramModules\n  });\n\n  // invoke diagram constructor\n  Diagram.call(this, diagramOptions);\n\n  if (options && options.container) {\n    this.attachTo(options.container);\n  }\n};\n\n/**\n * Emit an event on the underlying {@link EventBus}\n *\n * @param  {String} type\n * @param  {Object} event\n *\n * @return {Object} event processing result (if any)\n */\nBaseViewer.prototype._emit = function(type, event) {\n  return this.get('eventBus').fire(type, event);\n};\n\nBaseViewer.prototype._createContainer = function(options) {\n\n  var container = domify('<div class=\"pjs-container\"></div>');\n\n  assign(container.style, {\n    width: ensureUnit(options.width),\n    height: ensureUnit(options.height),\n    position: options.position\n  });\n\n  return container;\n};\n\nBaseViewer.prototype._createModdle = function(options) {\n  var moddleOptions = assign({}, this._moddleExtensions, options.moddleExtensions);\n\n  return new Moddle(moddleOptions);\n};\n\nBaseViewer.prototype._modules = [];\n\nBaseViewer.prototype._moddleExtensions = {};\n\n\n// helpers ///////////////\n\nfunction addWarningsToError(err, warningsAry) {\n  err.warnings = warningsAry;\n  return err;\n}\n\nfunction checkValidationError(err) {\n\n  // check if we can help the user by indicating wrong Postit xml\n  // (in case he or the exporting tool did not get that right)\n\n  var pattern = /unparsable content <([^>]+)> detected([\\s\\S]*)$/;\n  var match = pattern.exec(err.message);\n\n  if (match) {\n    err.message =\n      'unparsable content <' + match[1] + '> detected; ' +\n      'this may indicate an invalid Postit board file' + match[2];\n  }\n\n  return err;\n}\n\nvar DEFAULT_OPTIONS = {\n  width: '100%',\n  height: '100%',\n  position: 'relative'\n};\n\n\n/**\n * Ensure the passed argument is a proper unit (defaulting to px)\n */\nfunction ensureUnit(val) {\n  return val + (isNumber(val) ? 'px' : '');\n}\n\n\n/**\n * Find RootBoard in definitions by ID\n *\n * @param {ModdleElement<Definitions>} definitions\n * @param {String} boardId\n *\n * @return {ModdleElement<PostitRootBoard>|null}\n */\nfunction findRootBoard(definitions, boardId) {\n  if (!boardId) {\n    return null;\n  }\n\n  return find(definitions.rootBoards, function(element) {\n    return element.id === boardId;\n  }) || null;\n}\n\n\n/* <project-logo> */\n\nimport {\n  open as openPoweredBy,\n  BPMNIO_IMG\n} from './util/PoweredByUtil';\n\nimport {\n  event as domEvent\n} from 'min-dom';\n\n/**\n * Adds the project logo to the diagram container as\n * required by the bpmn.io license.\n *\n * @see http://bpmn.io/license\n *\n * @param {Element} container\n */\nfunction addProjectLogo(container) {\n  var img = BPMNIO_IMG;\n\n  var linkMarkup =\n    '<a href=\"http://bpmn.io\" ' +\n       'target=\"_blank\" ' +\n       'class=\"bjs-powered-by\" ' +\n       'title=\"Powered by bpmn.io\" ' +\n       'style=\"position: absolute; bottom: 15px; right: 15px; z-index: 100\">' +\n      img +\n    '</a>';\n\n  var linkElement = domify(linkMarkup);\n\n  container.appendChild(linkElement);\n\n  domEvent.bind(linkElement, 'click', function(event) {\n    openPoweredBy();\n\n    event.preventDefault();\n  });\n}\n\n/* </project-logo> */","import PostitTreeWalker from './PostitTreeWalker';\n\n/**\n * The importPostitDiagram result.\n *\n * @typedef {Object} importPostitDiagramResult\n *\n * @property {Array<string>} warnings\n */\n\n/**\n* The importPostitDiagram error.\n*\n* @typedef {Error} importPostitDiagramError\n*\n* @property {Array<string>} warnings\n*/\n\n/**\n * Import the definitions into a diagram.\n *\n * Errors and warnings are reported through the specified callback.\n *\n * @param  {djs.Diagram} diagram\n * @param  {ModdleElement<Definitions>} definitions\n * @param  {ModdleElement<PotitRootBoard>} [rootBoard] the diagram to be rendered\n * (if not provided, the first one will be rendered)\n *\n * Returns {Promise<importPostitDiagramResult, importPostitDiagramError>}\n */\nexport function importPostitDiagram(diagram, definitions, rootBoard) {\n\n  var importer,\n      eventBus,\n      translate;\n\n  var error,\n      warnings = [];\n\n  /**\n   * Walk the diagram semantically, importing (=drawing)\n   * all elements you encounter.\n   *\n   * @param {ModdleElement<Definitions>} definitions\n   * @param {ModdleElement<PostitRootBoard>} rootBoard\n   */\n  function render(definitions, rootBoard) {\n\n    var visitor = {\n\n      root: function(element) {\n        return importer.add(element);\n      },\n\n      element: function(element, parentShape) {\n        return importer.add(element, parentShape);\n      },\n\n      error: function(message, context) {\n        warnings.push({ message: message, context: context });\n      }\n    };\n\n    var walker = new PostitTreeWalker(visitor, translate);\n\n    // traverse xml document model,\n    // starting at definitions\n    walker.handleDefinitions(definitions, rootBoard);\n  }\n\n  return new Promise(function(resolve, reject) {\n    try {\n      importer = diagram.get('postitImporter');\n      eventBus = diagram.get('eventBus');\n      translate = diagram.get('translate');\n\n      eventBus.fire('import.render.start', { definitions: definitions });\n\n      render(definitions, rootBoard);\n\n      eventBus.fire('import.render.complete', {\n        error: error,\n        warnings: warnings\n      });\n\n      return resolve({ warnings: warnings });\n    } catch (e) {\n      return reject(e);\n    }\n  });\n}","import inherits from 'inherits';\n\nimport Ids from 'ids';\n\nimport BaseViewer from './BaseViewer';\n\n\n/**\n * A base modeler for postit-js boards.\n *\n * Have a look at {@link Modeler} for a bundle that includes actual features.\n *\n * @param {Object} [options] configuration options to pass to the viewer\n * @param {DOMElement} [options.container] the container to render the viewer in, defaults to body.\n * @param {String|Number} [options.width] the width of the viewer\n * @param {String|Number} [options.height] the height of the viewer\n * @param {Object} [options.moddleExtensions] extension packages to provide\n * @param {Array<didi.Module>} [options.modules] a list of modules to override the default modules\n * @param {Array<didi.Module>} [options.additionalModules] a list of modules to use with the default modules\n */\nexport default function BaseModeler(options) {\n  BaseViewer.call(this, options);\n\n  // hook ID collection into the modeler\n  this.on('import.parse.complete', function(event) {\n    if (!event.error) {\n      this._collectIds(event.definitions, event.context);\n    }\n  }, this);\n\n  this.on('diagram.destroy', function() {\n    this.get('moddle').ids.clear();\n  }, this);\n}\n\ninherits(BaseModeler, BaseViewer);\n\n\n/**\n * Create a moddle instance, attaching ids to it.\n *\n * @param {Object} options\n */\nBaseModeler.prototype._createModdle = function(options) {\n  var moddle = BaseViewer.prototype._createModdle.call(this, options);\n\n  // attach ids to moddle to be able to track\n  // and validated ids in the XML document\n  // tree\n  moddle.ids = new Ids([ 32, 36, 1 ]);\n\n  return moddle;\n};\n\n/**\n * Collect ids processed during parsing of the\n * definitions object.\n *\n * @param {ModdleElement} definitions\n * @param {Context} context\n */\nBaseModeler.prototype._collectIds = function(definitions, context) {\n\n  var moddle = definitions.$model,\n      ids = moddle.ids,\n      id;\n\n  // remove references from previous import\n  ids.clear();\n\n  for (id in context.elementsById) {\n    ids.claim(id, context.elementsById[id]);\n  }\n};","/**\n * Is an element of the given postit type?\n *\n * @param  {djs.model.Base|ModdleElement} element\n * @param  {String} type\n *\n * @return {Boolean}\n */\nexport function is(element, type) {\n  var bo = getBusinessObject(element);\n\n  return bo && (typeof bo.$instanceOf === 'function') && bo.$instanceOf(type);\n}\n\n\n/**\n * Return the business object for a given element.\n *\n * @param  {djs.model.Base|ModdleElement} element\n *\n * @return {ModdleElement}\n */\nexport function getBusinessObject(element) {\n  return (element && element.businessObject) || element;\n}","import {\n  some\n} from 'min-dash';\n\nimport { is } from '../../../util/ModelUtil';\n\n\n/**\n * Return true if element has any of the given types.\n *\n * @param {djs.model.Base} element\n * @param {Array<String>} types\n *\n * @return {Boolean}\n */\nexport function isAny(element, types) {\n  return some(types, function(t) {\n    return is(element, t);\n  });\n}\n\n\n/**\n * Return the parent of the element with any of the given types.\n *\n * @param {djs.model.Base} element\n * @param {String|Array<String>} anyType\n *\n * @return {djs.model.Base}\n */\nexport function getParent(element, anyType) {\n\n  if (typeof anyType === 'string') {\n    anyType = [ anyType ];\n  }\n\n  while ((element = element.parent)) {\n    if (isAny(element, anyType)) {\n      return element;\n    }\n  }\n\n  return null;\n}","import { isAny } from '../modeling/util/ModelingUtil';\n\nfunction getLabelAttr(semantic) {\n  if (isAny(semantic, [ 'postit:Postit', 'postit:TextBox', 'postit:Group' ])) {\n    return 'name';\n  }\n}\n\nexport function getLabel(element) {\n  var semantic = element.businessObject,\n      attr = getLabelAttr(semantic);\n\n  if (attr) {\n    return semantic[attr] || '';\n  }\n}\n\n\nexport function setLabel(element, text) {\n  var semantic = element.businessObject,\n      attr = getLabelAttr(semantic);\n\n  if (attr) {\n    semantic[attr] = text;\n  }\n\n  return element;\n}","import {\n  every,\n  some\n} from 'min-dash';\n\nimport {\n  componentsToPath\n} from 'diagram-js/lib/util/RenderUtil';\n\nimport {\n  getBusinessObject\n} from '../util/ModelUtil';\n\n\n// element utils //////////////////////\n\n/**\n * Checks if eventDefinition of the given element matches with semantic type.\n *\n * @return {boolean} true if element is of the given semantic type\n */\nexport function isTypedEvent(event, eventDefinitionType, filter) {\n\n  function matches(definition, filter) {\n    return every(filter, function(val, key) {\n\n      // we want a == conversion here, to be able to catch\n      // undefined == false and friends\n      /* jshint -W116 */\n      return definition[key] == val;\n    });\n  }\n\n  return some(event.eventDefinitions, function(definition) {\n    return definition.$type === eventDefinitionType && matches(event, filter);\n  });\n}\n\nexport function getDi(element) {\n  return element.businessObject.di;\n}\n\nexport function getSemantic(element) {\n  return element.businessObject;\n}\n\n\n// color access //////////////////////\n\nexport function getFillColor(element, defaultColor) {\n  return (\n    getColor(element) ||\n    getDi(element).get('bioc:fill') ||\n    defaultColor ||\n    'white'\n  );\n}\n\nexport function getStrokeColor(element, defaultColor) {\n  return (\n    getColor(element) ||\n    getDi(element).get('bioc:stroke') ||\n    defaultColor ||\n    'black'\n  );\n}\n\n\n// cropping path customizations //////////////////////\n\nexport function getCirclePath(shape) {\n\n  var cx = shape.x + shape.width / 2,\n      cy = shape.y + shape.height / 2,\n      radius = shape.width / 2;\n\n  var circlePath = [\n    ['M', cx, cy],\n    ['m', 0, -radius],\n    ['a', radius, radius, 0, 1, 1, 0, 2 * radius],\n    ['a', radius, radius, 0, 1, 1, 0, -2 * radius],\n    ['z']\n  ];\n\n  return componentsToPath(circlePath);\n}\n\nexport function getRoundRectPath(shape, borderRadius) {\n\n  var x = shape.x,\n      y = shape.y,\n      width = shape.width,\n      height = shape.height;\n\n  var roundRectPath = [\n    ['M', x + borderRadius, y],\n    ['l', width - borderRadius * 2, 0],\n    ['a', borderRadius, borderRadius, 0, 0, 1, borderRadius, borderRadius],\n    ['l', 0, height - borderRadius * 2],\n    ['a', borderRadius, borderRadius, 0, 0, 1, -borderRadius, borderRadius],\n    ['l', borderRadius * 2 - width, 0],\n    ['a', borderRadius, borderRadius, 0, 0, 1, -borderRadius, -borderRadius],\n    ['l', 0, borderRadius * 2 - height],\n    ['a', borderRadius, borderRadius, 0, 0, 1, borderRadius, -borderRadius],\n    ['z']\n  ];\n\n  return componentsToPath(roundRectPath);\n}\n\nexport function getDiamondPath(shape) {\n\n  var width = shape.width,\n      height = shape.height,\n      x = shape.x,\n      y = shape.y,\n      halfWidth = width / 2,\n      halfHeight = height / 2;\n\n  var diamondPath = [\n    ['M', x + halfWidth, y],\n    ['l', halfWidth, halfHeight],\n    ['l', -halfWidth, halfHeight],\n    ['l', -halfWidth, -halfHeight],\n    ['z']\n  ];\n\n  return componentsToPath(diamondPath);\n}\n\nexport function getRectPath(shape) {\n  var x = shape.x,\n      y = shape.y,\n      width = shape.width,\n      height = shape.height;\n\n  var rectPath = [\n    ['M', x, y],\n    ['l', width, 0],\n    ['l', 0, height],\n    ['l', -width, 0],\n    ['z']\n  ];\n\n  return componentsToPath(rectPath);\n}\n\n// helpers //////////\n\nfunction getColor(element) {\n  var bo = getBusinessObject(element);\n\n  return bo.color || element.color;\n}","import inherits from 'inherits';\n\nimport {\n  isObject,\n  assign\n} from 'min-dash';\n\nimport {\n  append as svgAppend,\n  attr as svgAttr,\n  create as svgCreate,\n  classes as svgClasses\n} from 'tiny-svg';\n\nimport BaseRenderer from 'diagram-js/lib/draw/BaseRenderer';\n\nimport {\n  getLabel\n} from '../features/label-editing/LabelUtil';\n\nimport {\n  getBusinessObject,\n  is\n} from '../util/ModelUtil';\n\nimport {\n  getSemantic,\n  getRectPath,\n  getFillColor,\n  getStrokeColor\n} from './PostitRendererUtil';\n\nvar DEFAULT_FILL_OPACITY = .95;\n\nvar TASK_BORDER_RADIUS = 10;\n\nvar DEFAULT_TEXT_SIZE = 16;\n\nexport default function PostitRenderer(\n    config, eventBus, styles, pathMap,\n    canvas, textRenderer, priority) {\n\n  BaseRenderer.call(this, eventBus, priority);\n\n  var defaultFillColor = config && config.defaultFillColor,\n      defaultStrokeColor = config && config.defaultStrokeColor;\n\n  var computeStyle = styles.computeStyle;\n\n  function drawCircle(parentGfx, width, height, offset, attrs) {\n\n    if (isObject(offset)) {\n      attrs = offset;\n      offset = 0;\n    }\n\n    offset = offset || 0;\n\n    attrs = computeStyle(attrs, {\n      stroke: 'black',\n      strokeWidth: 2,\n      fill: 'white'\n    });\n\n    if (attrs.fill === 'none') {\n      delete attrs.fillOpacity;\n    }\n\n    var cx = width / 2,\n        cy = height / 2;\n\n    var circle = svgCreate('circle');\n    svgAttr(circle, {\n      cx: cx,\n      cy: cy,\n      r: Math.round((width + height) / 4 - offset)\n    });\n    svgAttr(circle, attrs);\n\n    svgAppend(parentGfx, circle);\n\n    return circle;\n  }\n\n  function drawRect(parentGfx, width, height, r, offset, attrs) {\n\n    if (isObject(offset)) {\n      attrs = offset;\n      offset = 0;\n    }\n\n    offset = offset || 0;\n\n    attrs = computeStyle(attrs, {\n      stroke: 'black',\n      strokeWidth: 2,\n      fill: 'white'\n    });\n\n    var rect = svgCreate('rect');\n    svgAttr(rect, {\n      x: offset,\n      y: offset,\n      width: width - offset * 2,\n      height: height - offset * 2,\n      rx: r,\n      ry: r\n    });\n    svgAttr(rect, attrs);\n\n    svgAppend(parentGfx, rect);\n\n    return rect;\n  }\n\n  function drawPath(parentGfx, d, attrs) {\n\n    attrs = computeStyle(attrs, [ 'no-fill' ], {\n      strokeWidth: 2,\n      stroke: 'black'\n    });\n\n    var path = svgCreate('path');\n    svgAttr(path, { d: d });\n    svgAttr(path, attrs);\n\n    svgAppend(parentGfx, path);\n\n    return path;\n  }\n\n\n  function renderLabel(parentGfx, label, options) {\n\n    options = assign({\n      size: {\n        width: 100\n      }\n    }, options);\n\n    var text = textRenderer.createText(label || '', options);\n\n    svgClasses(text).add('djs-label');\n\n    svgAppend(parentGfx, text);\n\n    return text;\n  }\n\n  function renderEmbeddedLabel(parentGfx, element, align, fontSize) {\n    var semantic = getSemantic(element);\n\n    return renderLabel(parentGfx, semantic.name, {\n      box: element,\n      align: align,\n      padding: 5,\n      style: {\n        fill: getColor(element) === 'black' ? 'white' : 'black',\n        fontSize: fontSize || DEFAULT_TEXT_SIZE\n      },\n    });\n  }\n\n  function renderExternalLabel(parentGfx, element) {\n\n    var box = {\n      width: 90,\n      height: 30,\n      x: element.width / 2 + element.x,\n      y: element.height / 2 + element.y\n    };\n\n    return renderLabel(parentGfx, getLabel(element), {\n      box: box,\n      fitBox: true,\n      style: assign(\n        {},\n        textRenderer.getExternalStyle(),\n        {\n          fill: 'black'\n        }\n      )\n    });\n  }\n\n  this.handlers = {\n    'postit:SquarePostit': function(parentGfx, element) {\n\n      var attrs = {\n        fill: getFillColor(element, defaultFillColor),\n        stroke: getStrokeColor(element, defaultStrokeColor)\n      };\n\n      if (!('fillOpacity' in attrs)) {\n        attrs.fillOpacity = DEFAULT_FILL_OPACITY;\n      }\n\n      var rect = drawRect(parentGfx, element.width, element.height, 0, attrs);\n\n      renderEmbeddedLabel(parentGfx, element, 'center-middle');\n\n      return rect;\n    },\n\n    'postit:Group': function(parentGfx, element) {\n\n      var group = drawRect(parentGfx, element.width, element.height, TASK_BORDER_RADIUS, {\n        stroke: 'black',\n        strokeWidth: 1,\n        strokeDasharray: '8,3,1,3',\n        fill: 'none',\n        pointerEvents: 'none'\n      });\n\n      return group;\n    },\n\n    'postit:CirclePostit': function(parentGfx, element) {\n      var attrs = {\n        fill: getFillColor(element, defaultFillColor),\n        stroke: getStrokeColor(element, defaultStrokeColor)\n      };\n\n      if (!('fillOpacity' in attrs)) {\n        attrs.fillOpacity = DEFAULT_FILL_OPACITY;\n      }\n\n      var rect = drawCircle(parentGfx, element.width, element.height, attrs);\n\n      renderEmbeddedLabel(parentGfx, element, 'center-middle');\n\n      return rect;\n    },\n    'postit:TextBox': function(parentGfx, element) {\n      var attrs = {\n        fill: 'none',\n        stroke: 'none'\n      };\n\n      var textSize = element.textSize || DEFAULT_TEXT_SIZE;\n\n      var rect = drawRect(parentGfx, element.width, element.height, 0, attrs);\n\n      renderEmbeddedLabel(parentGfx, element, 'center-middle', textSize);\n\n      return rect;\n    },\n    'postit:Image': function(parentGfx, element) {\n      var imageSource = getImageSource(element);\n\n      var gfx;\n      if (!imageSource) {\n\n        // default placeholder\n        gfx = drawRect(parentGfx, element.width, element.height, 0, {\n          fill: '#ccc',\n          stroke: '#ccc'\n        });\n\n        renderLabel(parentGfx, 'Image Placeholder', {\n          box: element,\n          align: 'center-middle',\n          padding: 5,\n          style: {\n            fill: 'black',\n            fontSize: DEFAULT_TEXT_SIZE\n          },\n        });\n\n      } else {\n        gfx = svgCreate('image', {\n          x: 0,\n          y: 0,\n          width: element.width,\n          height: element.height,\n          href: getImageSource(element)\n        });\n\n        svgAppend(parentGfx, gfx);\n      }\n\n      return gfx;\n    },\n\n    'label': function(parentGfx, element) {\n      return renderExternalLabel(parentGfx, element);\n    }\n  };\n\n\n  // extension API, use at your own risk\n  this._drawPath = drawPath;\n\n}\n\n\ninherits(PostitRenderer, BaseRenderer);\n\nPostitRenderer.$inject = [\n  'config.postit',\n  'eventBus',\n  'styles',\n  'pathMap',\n  'canvas',\n  'textRenderer'\n];\n\n\nPostitRenderer.prototype.canRender = function(element) {\n  return is(element, 'postit:BoardElement');\n};\n\nPostitRenderer.prototype.drawShape = function(parentGfx, element) {\n  var type = element.type;\n  var h = this.handlers[type];\n\n  /* jshint -W040 */\n  return h(parentGfx, element);\n};\n\nPostitRenderer.prototype.getShapePath = function(element) {\n\n  return getRectPath(element);\n};\n\n// helpers //////////\n\nfunction getColor(element) {\n  var bo = getBusinessObject(element);\n\n  return bo.color || element.color;\n}\n\nfunction getImageSource(element) {\n  var bo = getBusinessObject(element);\n\n  return bo.source || element.source;\n}\n\n","import {\n  isObject,\n  assign,\n  forEach,\n  reduce\n} from 'min-dash';\n\nimport {\n  append as svgAppend,\n  attr as svgAttr,\n  create as svgCreate,\n  remove as svgRemove\n} from 'tiny-svg';\n\nvar DEFAULT_BOX_PADDING = 0;\n\nvar DEFAULT_LABEL_SIZE = {\n  width: 150,\n  height: 50\n};\n\n\nfunction parseAlign(align) {\n\n  var parts = align.split('-');\n\n  return {\n    horizontal: parts[0] || 'center',\n    vertical: parts[1] || 'top'\n  };\n}\n\nfunction parsePadding(padding) {\n\n  if (isObject(padding)) {\n    return assign({ top: 0, left: 0, right: 0, bottom: 0 }, padding);\n  } else {\n    return {\n      top: padding,\n      left: padding,\n      right: padding,\n      bottom: padding\n    };\n  }\n}\n\nfunction getTextBBox(text, fakeText) {\n\n  fakeText.textContent = text;\n\n  var textBBox;\n\n  try {\n    var bbox,\n        emptyLine = text === '';\n\n    // add dummy text, when line is empty to\n    // determine correct height\n    fakeText.textContent = emptyLine ? 'dummy' : text;\n\n    textBBox = fakeText.getBBox();\n\n    // take text rendering related horizontal\n    // padding into account\n    bbox = {\n      width: textBBox.width + textBBox.x * 2,\n      height: textBBox.height\n    };\n\n    if (emptyLine) {\n\n      // correct width\n      bbox.width = 0;\n    }\n\n    return bbox;\n  } catch (e) {\n    return { width: 0, height: 0 };\n  }\n}\n\n\n/**\n * Layout the next line and return the layouted element.\n *\n * Alters the lines passed.\n *\n * @param  {Array<string>} lines\n * @return {Object} the line descriptor, an object { width, height, text }\n */\nfunction layoutNext(lines, maxWidth, fakeText) {\n\n  var originalLine = lines.shift(),\n      fitLine = originalLine;\n\n  var textBBox;\n\n  for (;;) {\n    textBBox = getTextBBox(fitLine, fakeText);\n\n    textBBox.width = fitLine ? textBBox.width : 0;\n\n    // try to fit\n    if (fitLine === ' ' || fitLine === '' || textBBox.width < Math.round(maxWidth) || fitLine.length < 2) {\n      return fit(lines, fitLine, originalLine, textBBox);\n    }\n\n    fitLine = shortenLine(fitLine, textBBox.width, maxWidth);\n  }\n}\n\nfunction fit(lines, fitLine, originalLine, textBBox) {\n  if (fitLine.length < originalLine.length) {\n    var remainder = originalLine.slice(fitLine.length).trim();\n\n    lines.unshift(remainder);\n  }\n\n  return {\n    width: textBBox.width,\n    height: textBBox.height,\n    text: fitLine\n  };\n}\n\nvar SOFT_BREAK = '\\u00AD';\n\n\n/**\n * Shortens a line based on spacing and hyphens.\n * Returns the shortened result on success.\n *\n * @param  {string} line\n * @param  {number} maxLength the maximum characters of the string\n * @return {string} the shortened string\n */\nfunction semanticShorten(line, maxLength) {\n\n  var parts = line.split(/(\\s|-|\\u00AD)/g),\n      part,\n      shortenedParts = [],\n      length = 0;\n\n  // try to shorten via break chars\n  if (parts.length > 1) {\n\n    while ((part = parts.shift())) {\n      if (part.length + length < maxLength) {\n        shortenedParts.push(part);\n        length += part.length;\n      } else {\n\n        // remove previous part, too if hyphen does not fit anymore\n        if (part === '-' || part === SOFT_BREAK) {\n          shortenedParts.pop();\n        }\n\n        break;\n      }\n    }\n  }\n\n  var last = shortenedParts[shortenedParts.length - 1];\n\n  // translate trailing soft break to actual hyphen\n  if (last && last === SOFT_BREAK) {\n    shortenedParts[shortenedParts.length - 1] = '-';\n  }\n\n  return shortenedParts.join('');\n}\n\n\nfunction shortenLine(line, width, maxWidth) {\n  var length = Math.max(line.length * (maxWidth / width), 1);\n\n  // try to shorten semantically (i.e. based on spaces and hyphens)\n  var shortenedLine = semanticShorten(line, length);\n\n  if (!shortenedLine) {\n\n    // force shorten by cutting the long word\n    shortenedLine = line.slice(0, Math.max(Math.round(length - 1), 1));\n  }\n\n  return shortenedLine;\n}\n\n\nfunction getHelperSvg() {\n  var helperSvg = document.getElementById('helper-svg');\n\n  if (!helperSvg) {\n    helperSvg = svgCreate('svg');\n\n    svgAttr(helperSvg, {\n      id: 'helper-svg',\n      width: 0,\n      height: 0,\n      style: 'visibility: hidden; position: fixed'\n    });\n\n    document.body.appendChild(helperSvg);\n  }\n\n  return helperSvg;\n}\n\n\n/**\n * Creates a new label utility\n *\n * @param {Object} config\n * @param {Dimensions} config.size\n * @param {number} config.padding\n * @param {Object} config.style\n * @param {string} config.align\n */\nexport default function Text(config) {\n\n  this._config = assign({}, {\n    size: DEFAULT_LABEL_SIZE,\n    padding: DEFAULT_BOX_PADDING,\n    style: {},\n    align: 'center-top'\n  }, config || {});\n}\n\n/**\n * Returns the layouted text as an SVG element.\n *\n * @param {string} text\n * @param {Object} options\n *\n * @return {SVGElement}\n */\nText.prototype.createText = function(text, options) {\n  return this.layoutText(text, options).element;\n};\n\n/**\n * Returns a labels layouted dimensions.\n *\n * @param {string} text to layout\n * @param {Object} options\n *\n * @return {Dimensions}\n */\nText.prototype.getDimensions = function(text, options) {\n  return this.layoutText(text, options).dimensions;\n};\n\n/**\n * Creates and returns a label and its bounding box.\n *\n * @method Text#createText\n *\n * @param {string} text the text to render on the label\n * @param {Object} options\n * @param {string} options.align how to align in the bounding box.\n *                               Any of { 'center-middle', 'center-top' },\n *                               defaults to 'center-top'.\n * @param {string} options.style style to be applied to the text\n * @param {boolean} options.fitBox indicates if box will be recalculated to\n *                                 fit text\n *\n * @return {Object} { element, dimensions }\n */\nText.prototype.layoutText = function(text, options) {\n  var box = assign({}, this._config.size, options.box),\n      style = assign({}, this._config.style, options.style),\n      align = parseAlign(options.align || this._config.align),\n      padding = parsePadding(options.padding !== undefined ? options.padding : this._config.padding),\n      fitBox = options.fitBox || false;\n\n  var lineHeight = getLineHeight(style);\n\n  // we split text by lines and normalize\n  // {soft break} + {line break} => { line break }\n  var lines = text.split(/\\u00AD?\\r?\\n/),\n      layouted = [];\n\n  var maxWidth = box.width - padding.left - padding.right;\n\n  // ensure correct rendering by attaching helper text node to invisible SVG\n  var helperText = svgCreate('text');\n  svgAttr(helperText, { x: 0, y: 0 });\n  svgAttr(helperText, style);\n\n  var helperSvg = getHelperSvg();\n\n  svgAppend(helperSvg, helperText);\n\n  while (lines.length) {\n    layouted.push(layoutNext(lines, maxWidth, helperText));\n  }\n\n  if (align.vertical === 'middle') {\n    padding.top = padding.bottom = 0;\n  }\n\n  var totalHeight = reduce(layouted, function(sum, line, idx) {\n    return sum + (lineHeight || line.height);\n  }, 0) + padding.top + padding.bottom;\n\n  var maxLineWidth = reduce(layouted, function(sum, line, idx) {\n    return line.width > sum ? line.width : sum;\n  }, 0);\n\n  // the y position of the next line\n  var y = padding.top;\n\n  if (align.vertical === 'middle') {\n    y += (box.height - totalHeight) / 2;\n  }\n\n  // magic number initial offset\n  y -= (lineHeight || layouted[0].height) / 4;\n\n\n  var textElement = svgCreate('text');\n\n  svgAttr(textElement, style);\n\n  // layout each line taking into account that parent\n  // shape might resize to fit text size\n  forEach(layouted, function(line) {\n\n    var x;\n\n    y += (lineHeight || line.height);\n\n    switch (align.horizontal) {\n    case 'left':\n      x = padding.left;\n      break;\n\n    case 'right':\n      x = ((fitBox ? maxLineWidth : maxWidth)\n        - padding.right - line.width);\n      break;\n\n    default:\n\n      // aka center\n      x = Math.max((((fitBox ? maxLineWidth : maxWidth)\n        - line.width) / 2 + padding.left), 0);\n    }\n\n    var tspan = svgCreate('tspan');\n    svgAttr(tspan, { x: x, y: y });\n\n    tspan.textContent = line.text;\n\n    svgAppend(textElement, tspan);\n  });\n\n  svgRemove(helperText);\n\n  var dimensions = {\n    width: maxLineWidth,\n    height: totalHeight\n  };\n\n  return {\n    dimensions: dimensions,\n    element: textElement\n  };\n};\n\n\nfunction getLineHeight(style) {\n  if ('fontSize' in style && 'lineHeight' in style) {\n    return style.lineHeight * parseInt(style.fontSize, 10);\n  }\n}","import { assign } from 'min-dash';\n\nimport TextUtil from 'diagram-js/lib/util/Text';\n\nvar DEFAULT_FONT_SIZE = 16;\nvar LINE_HEIGHT_RATIO = 1.2;\n\n\nexport default function TextRenderer(config) {\n\n  var defaultStyle = assign({\n    fontFamily: 'IBM Plex, sans-serif',\n    fontSize: DEFAULT_FONT_SIZE,\n    fontWeight: 'normal',\n    lineHeight: LINE_HEIGHT_RATIO\n  }, config && config.defaultStyle || {});\n\n  var fontSize = parseInt(defaultStyle.fontSize, 10) - 1;\n\n  var externalStyle = assign({}, defaultStyle, {\n    fontSize: fontSize\n  }, config && config.externalStyle || {});\n\n  var textUtil = new TextUtil({\n    style: defaultStyle\n  });\n\n  /**\n   * Get the new bounds of an externally rendered,\n   * layouted label.\n   *\n   * @param  {Bounds} bounds\n   * @param  {String} text\n   *\n   * @return {Bounds}\n   */\n  this.getExternalLabelBounds = function(bounds, text) {\n\n    var layoutedDimensions = textUtil.getDimensions(text, {\n      box: {\n        width: 90,\n        height: 30,\n        x: bounds.width / 2 + bounds.x,\n        y: bounds.height / 2 + bounds.y\n      },\n      style: externalStyle\n    });\n\n    // resize label shape to fit label text\n    return {\n      x: Math.round(bounds.x + bounds.width / 2 - layoutedDimensions.width / 2),\n      y: Math.round(bounds.y),\n      width: Math.ceil(layoutedDimensions.width),\n      height: Math.ceil(layoutedDimensions.height)\n    };\n\n  };\n\n  /**\n   * Create a layouted text element.\n   *\n   * @param {String} text\n   * @param {Object} [options]\n   *\n   * @return {SVGElement} rendered text\n   */\n  this.createText = function(text, options) {\n    return textUtil.createText(text, options || {});\n  };\n\n  /**\n   * Get default text style.\n   */\n  this.getDefaultStyle = function() {\n    return defaultStyle;\n  };\n\n  /**\n   * Get the external text style.\n   */\n  this.getExternalStyle = function() {\n    return externalStyle;\n  };\n\n}\n\nTextRenderer.$inject = [\n  'config.textRenderer'\n];","/**\n * Map containing SVG paths needed by PostitRenderer.\n */\n\nexport default function PathMap() {\n\n  /**\n   * Contains a map of path elements\n   *\n   * <h1>Path definition</h1>\n   * A parameterized path is defined like this:\n   * <pre>\n   * 'GATEWAY_PARALLEL': {\n   *   d: 'm {mx},{my} {e.x0},0 0,{e.x1} {e.x1},0 0,{e.y0} -{e.x1},0 0,{e.y1} ' +\n          '-{e.x0},0 0,-{e.y1} -{e.x1},0 0,-{e.y0} {e.x1},0 z',\n   *   height: 17.5,\n   *   width:  17.5,\n   *   heightElements: [2.5, 7.5],\n   *   widthElements: [2.5, 7.5]\n   * }\n   * </pre>\n   * <p>It's important to specify a correct <b>height and width</b> for the path as the scaling\n   * is based on the ratio between the specified height and width in this object and the\n   * height and width that is set as scale target (Note x,y coordinates will be scaled with\n   * individual ratios).</p>\n   * <p>The '<b>heightElements</b>' and '<b>widthElements</b>' array must contain the values that will be scaled.\n   * The scaling is based on the computed ratios.\n   * Coordinates on the y axis should be in the <b>heightElement</b>'s array, they will be scaled using\n   * the computed ratio coefficient.\n   * In the parameterized path the scaled values can be accessed through the 'e' object in {} brackets.\n   *   <ul>\n   *    <li>The values for the y axis can be accessed in the path string using {e.y0}, {e.y1}, ....</li>\n   *    <li>The values for the x axis can be accessed in the path string using {e.x0}, {e.x1}, ....</li>\n   *   </ul>\n   *   The numbers x0, x1 respectively y0, y1, ... map to the corresponding array index.\n   * </p>\n   */\n  this.pathMap = {\n    'EVENT_MESSAGE': {\n      d: 'm {mx},{my} l 0,{e.y1} l {e.x1},0 l 0,-{e.y1} z l {e.x0},{e.y0} l {e.x0},-{e.y0}',\n      height: 36,\n      width:  36,\n      heightElements: [6, 14],\n      widthElements: [10.5, 21]\n    },\n    'EVENT_SIGNAL': {\n      d: 'M {mx},{my} l {e.x0},{e.y0} l -{e.x1},0 Z',\n      height: 36,\n      width: 36,\n      heightElements: [18],\n      widthElements: [10, 20]\n    },\n    'EVENT_ESCALATION': {\n      d: 'M {mx},{my} l {e.x0},{e.y0} l -{e.x0},-{e.y1} l -{e.x0},{e.y1} Z',\n      height: 36,\n      width: 36,\n      heightElements: [20, 7],\n      widthElements: [8]\n    },\n    'EVENT_CONDITIONAL': {\n      d: 'M {e.x0},{e.y0} l {e.x1},0 l 0,{e.y2} l -{e.x1},0 Z ' +\n         'M {e.x2},{e.y3} l {e.x0},0 ' +\n         'M {e.x2},{e.y4} l {e.x0},0 ' +\n         'M {e.x2},{e.y5} l {e.x0},0 ' +\n         'M {e.x2},{e.y6} l {e.x0},0 ' +\n         'M {e.x2},{e.y7} l {e.x0},0 ' +\n         'M {e.x2},{e.y8} l {e.x0},0 ',\n      height: 36,\n      width:  36,\n      heightElements: [8.5, 14.5, 18, 11.5, 14.5, 17.5, 20.5, 23.5, 26.5],\n      widthElements:  [10.5, 14.5, 12.5]\n    },\n    'EVENT_LINK': {\n      d: 'm {mx},{my} 0,{e.y0} -{e.x1},0 0,{e.y1} {e.x1},0 0,{e.y0} {e.x0},-{e.y2} -{e.x0},-{e.y2} z',\n      height: 36,\n      width: 36,\n      heightElements: [4.4375, 6.75, 7.8125],\n      widthElements: [9.84375, 13.5]\n    },\n    'EVENT_ERROR': {\n      d: 'm {mx},{my} {e.x0},-{e.y0} {e.x1},-{e.y1} {e.x2},{e.y2} {e.x3},-{e.y3} -{e.x4},{e.y4} -{e.x5},-{e.y5} z',\n      height: 36,\n      width: 36,\n      heightElements: [0.023, 8.737, 8.151, 16.564, 10.591, 8.714],\n      widthElements: [0.085, 6.672, 6.97, 4.273, 5.337, 6.636]\n    },\n    'EVENT_CANCEL_45': {\n      d: 'm {mx},{my} -{e.x1},0 0,{e.x0} {e.x1},0 0,{e.y1} {e.x0},0 ' +\n        '0,-{e.y1} {e.x1},0 0,-{e.y0} -{e.x1},0 0,-{e.y1} -{e.x0},0 z',\n      height: 36,\n      width: 36,\n      heightElements: [4.75, 8.5],\n      widthElements: [4.75, 8.5]\n    },\n    'EVENT_COMPENSATION': {\n      d: 'm {mx},{my} {e.x0},-{e.y0} 0,{e.y1} z m {e.x1},-{e.y2} {e.x2},-{e.y3} 0,{e.y1} -{e.x2},-{e.y3} z',\n      height: 36,\n      width: 36,\n      heightElements: [6.5, 13, 0.4, 6.1],\n      widthElements: [9, 9.3, 8.7]\n    },\n    'EVENT_TIMER_WH': {\n      d: 'M {mx},{my} l {e.x0},-{e.y0} m -{e.x0},{e.y0} l {e.x1},{e.y1} ',\n      height: 36,\n      width:  36,\n      heightElements: [10, 2],\n      widthElements: [3, 7]\n    },\n    'EVENT_TIMER_LINE': {\n      d:  'M {mx},{my} ' +\n          'm {e.x0},{e.y0} l -{e.x1},{e.y1} ',\n      height: 36,\n      width:  36,\n      heightElements: [10, 3],\n      widthElements: [0, 0]\n    },\n    'EVENT_MULTIPLE': {\n      d:'m {mx},{my} {e.x1},-{e.y0} {e.x1},{e.y0} -{e.x0},{e.y1} -{e.x2},0 z',\n      height: 36,\n      width:  36,\n      heightElements: [6.28099, 12.56199],\n      widthElements: [3.1405, 9.42149, 12.56198]\n    },\n    'EVENT_PARALLEL_MULTIPLE': {\n      d:'m {mx},{my} {e.x0},0 0,{e.y1} {e.x1},0 0,{e.y0} -{e.x1},0 0,{e.y1} ' +\n        '-{e.x0},0 0,-{e.y1} -{e.x1},0 0,-{e.y0} {e.x1},0 z',\n      height: 36,\n      width:  36,\n      heightElements: [2.56228, 7.68683],\n      widthElements: [2.56228, 7.68683]\n    },\n    'GATEWAY_EXCLUSIVE': {\n      d:'m {mx},{my} {e.x0},{e.y0} {e.x1},{e.y0} {e.x2},0 {e.x4},{e.y2} ' +\n                    '{e.x4},{e.y1} {e.x2},0 {e.x1},{e.y3} {e.x0},{e.y3} ' +\n                    '{e.x3},0 {e.x5},{e.y1} {e.x5},{e.y2} {e.x3},0 z',\n      height: 17.5,\n      width:  17.5,\n      heightElements: [8.5, 6.5312, -6.5312, -8.5],\n      widthElements:  [6.5, -6.5, 3, -3, 5, -5]\n    },\n    'GATEWAY_PARALLEL': {\n      d:'m {mx},{my} 0,{e.y1} -{e.x1},0 0,{e.y0} {e.x1},0 0,{e.y1} {e.x0},0 ' +\n        '0,-{e.y1} {e.x1},0 0,-{e.y0} -{e.x1},0 0,-{e.y1} -{e.x0},0 z',\n      height: 30,\n      width:  30,\n      heightElements: [5, 12.5],\n      widthElements: [5, 12.5]\n    },\n    'GATEWAY_EVENT_BASED': {\n      d:'m {mx},{my} {e.x0},{e.y0} {e.x0},{e.y1} {e.x1},{e.y2} {e.x2},0 z',\n      height: 11,\n      width:  11,\n      heightElements: [-6, 6, 12, -12],\n      widthElements: [9, -3, -12]\n    },\n    'GATEWAY_COMPLEX': {\n      d:'m {mx},{my} 0,{e.y0} -{e.x0},-{e.y1} -{e.x1},{e.y2} {e.x0},{e.y1} -{e.x2},0 0,{e.y3} ' +\n        '{e.x2},0  -{e.x0},{e.y1} l {e.x1},{e.y2} {e.x0},-{e.y1} 0,{e.y0} {e.x3},0 0,-{e.y0} {e.x0},{e.y1} ' +\n        '{e.x1},-{e.y2} -{e.x0},-{e.y1} {e.x2},0 0,-{e.y3} -{e.x2},0 {e.x0},-{e.y1} -{e.x1},-{e.y2} ' +\n        '-{e.x0},{e.y1} 0,-{e.y0} -{e.x3},0 z',\n      height: 17.125,\n      width:  17.125,\n      heightElements: [4.875, 3.4375, 2.125, 3],\n      widthElements: [3.4375, 2.125, 4.875, 3]\n    },\n    'DATA_OBJECT_PATH': {\n      d:'m 0,0 {e.x1},0 {e.x0},{e.y0} 0,{e.y1} -{e.x2},0 0,-{e.y2} {e.x1},0 0,{e.y0} {e.x0},0',\n      height: 61,\n      width:  51,\n      heightElements: [10, 50, 60],\n      widthElements: [10, 40, 50, 60]\n    },\n    'DATA_OBJECT_COLLECTION_PATH': {\n      d:'m {mx}, {my} ' +\n        'm  0 15  l 0 -15 ' +\n        'm  4 15  l 0 -15 ' +\n        'm  4 15  l 0 -15 ',\n      height: 61,\n      width:  51,\n      heightElements: [12],\n      widthElements: [1, 6, 12, 15]\n    },\n    'DATA_ARROW': {\n      d:'m 5,9 9,0 0,-3 5,5 -5,5 0,-3 -9,0 z',\n      height: 61,\n      width:  51,\n      heightElements: [],\n      widthElements: []\n    },\n    'DATA_STORE': {\n      d:'m  {mx},{my} ' +\n        'l  0,{e.y2} ' +\n        'c  {e.x0},{e.y1} {e.x1},{e.y1}  {e.x2},0 ' +\n        'l  0,-{e.y2} ' +\n        'c -{e.x0},-{e.y1} -{e.x1},-{e.y1} -{e.x2},0' +\n        'c  {e.x0},{e.y1} {e.x1},{e.y1}  {e.x2},0 ' +\n        'm  -{e.x2},{e.y0}' +\n        'c  {e.x0},{e.y1} {e.x1},{e.y1} {e.x2},0' +\n        'm  -{e.x2},{e.y0}' +\n        'c  {e.x0},{e.y1} {e.x1},{e.y1}  {e.x2},0',\n      height: 61,\n      width:  61,\n      heightElements: [7, 10, 45],\n      widthElements:  [2, 58, 60]\n    },\n    'TEXT_ANNOTATION': {\n      d: 'm {mx}, {my} m 10,0 l -10,0 l 0,{e.y0} l 10,0',\n      height: 30,\n      width: 10,\n      heightElements: [30],\n      widthElements: [10]\n    },\n    'MARKER_SUB_PROCESS': {\n      d: 'm{mx},{my} m 7,2 l 0,10 m -5,-5 l 10,0',\n      height: 10,\n      width: 10,\n      heightElements: [],\n      widthElements: []\n    },\n    'MARKER_PARALLEL': {\n      d: 'm{mx},{my} m 3,2 l 0,10 m 3,-10 l 0,10 m 3,-10 l 0,10',\n      height: 10,\n      width: 10,\n      heightElements: [],\n      widthElements: []\n    },\n    'MARKER_SEQUENTIAL': {\n      d: 'm{mx},{my} m 0,3 l 10,0 m -10,3 l 10,0 m -10,3 l 10,0',\n      height: 10,\n      width: 10,\n      heightElements: [],\n      widthElements: []\n    },\n    'MARKER_COMPENSATION': {\n      d: 'm {mx},{my} 7,-5 0,10 z m 7.1,-0.3 6.9,-4.7 0,10 -6.9,-4.7 z',\n      height: 10,\n      width: 21,\n      heightElements: [],\n      widthElements: []\n    },\n    'MARKER_LOOP': {\n      d: 'm {mx},{my} c 3.526979,0 6.386161,-2.829858 6.386161,-6.320661 0,-3.490806 -2.859182,-6.320661 ' +\n        '-6.386161,-6.320661 -3.526978,0 -6.38616,2.829855 -6.38616,6.320661 0,1.745402 ' +\n        '0.714797,3.325567 1.870463,4.469381 0.577834,0.571908 1.265885,1.034728 2.029916,1.35457 ' +\n        'l -0.718163,-3.909793 m 0.718163,3.909793 -3.885211,0.802902',\n      height: 13.9,\n      width: 13.7,\n      heightElements: [],\n      widthElements: []\n    },\n    'MARKER_ADHOC': {\n      d: 'm {mx},{my} m 0.84461,2.64411 c 1.05533,-1.23780996 2.64337,-2.07882 4.29653,-1.97997996 2.05163,0.0805 ' +\n        '3.85579,1.15803 5.76082,1.79107 1.06385,0.34139996 2.24454,0.1438 3.18759,-0.43767 0.61743,-0.33642 ' +\n        '1.2775,-0.64078 1.7542,-1.17511 0,0.56023 0,1.12046 0,1.6807 -0.98706,0.96237996 -2.29792,1.62393996 ' +\n        '-3.6918,1.66181996 -1.24459,0.0927 -2.46671,-0.2491 -3.59505,-0.74812 -1.35789,-0.55965 ' +\n        '-2.75133,-1.33436996 -4.27027,-1.18121996 -1.37741,0.14601 -2.41842,1.13685996 -3.44288,1.96782996 z',\n      height: 4,\n      width: 15,\n      heightElements: [],\n      widthElements: []\n    },\n    'TASK_TYPE_SEND': {\n      d: 'm {mx},{my} l 0,{e.y1} l {e.x1},0 l 0,-{e.y1} z l {e.x0},{e.y0} l {e.x0},-{e.y0}',\n      height: 14,\n      width:  21,\n      heightElements: [6, 14],\n      widthElements: [10.5, 21]\n    },\n    'TASK_TYPE_SCRIPT': {\n      d: 'm {mx},{my} c 9.966553,-6.27276 -8.000926,-7.91932 2.968968,-14.938 l -8.802728,0 ' +\n        'c -10.969894,7.01868 6.997585,8.66524 -2.968967,14.938 z ' +\n        'm -7,-12 l 5,0 ' +\n        'm -4.5,3 l 4.5,0 ' +\n        'm -3,3 l 5,0' +\n        'm -4,3 l 5,0',\n      height: 15,\n      width:  12.6,\n      heightElements: [6, 14],\n      widthElements: [10.5, 21]\n    },\n    'TASK_TYPE_USER_1': {\n      d: 'm {mx},{my} c 0.909,-0.845 1.594,-2.049 1.594,-3.385 0,-2.554 -1.805,-4.62199999 ' +\n        '-4.357,-4.62199999 -2.55199998,0 -4.28799998,2.06799999 -4.28799998,4.62199999 0,1.348 ' +\n        '0.974,2.562 1.89599998,3.405 -0.52899998,0.187 -5.669,2.097 -5.794,4.7560005 v 6.718 ' +\n        'h 17 v -6.718 c 0,-2.2980005 -5.5279996,-4.5950005 -6.0509996,-4.7760005 z' +\n        'm -8,6 l 0,5.5 m 11,0 l 0,-5'\n    },\n    'TASK_TYPE_USER_2': {\n      d: 'm {mx},{my} m 2.162,1.009 c 0,2.4470005 -2.158,4.4310005 -4.821,4.4310005 ' +\n        '-2.66499998,0 -4.822,-1.981 -4.822,-4.4310005 '\n    },\n    'TASK_TYPE_USER_3': {\n      d: 'm {mx},{my} m -6.9,-3.80 c 0,0 2.25099998,-2.358 4.27399998,-1.177 2.024,1.181 4.221,1.537 ' +\n        '4.124,0.965 -0.098,-0.57 -0.117,-3.79099999 -4.191,-4.13599999 -3.57499998,0.001 ' +\n        '-4.20799998,3.36699999 -4.20699998,4.34799999 z'\n    },\n    'TASK_TYPE_MANUAL': {\n      d: 'm {mx},{my} c 0.234,-0.01 5.604,0.008 8.029,0.004 0.808,0 1.271,-0.172 1.417,-0.752 0.227,-0.898 ' +\n        '-0.334,-1.314 -1.338,-1.316 -2.467,-0.01 -7.886,-0.004 -8.108,-0.004 -0.014,-0.079 0.016,-0.533 0,-0.61 ' +\n        '0.195,-0.042 8.507,0.006 9.616,0.002 0.877,-0.007 1.35,-0.438 1.353,-1.208 0.003,-0.768 -0.479,-1.09 ' +\n        '-1.35,-1.091 -2.968,-0.002 -9.619,-0.013 -9.619,-0.013 v -0.591 c 0,0 5.052,-0.016 7.225,-0.016 ' +\n        '0.888,-0.002 1.354,-0.416 1.351,-1.193 -0.006,-0.761 -0.492,-1.196 -1.361,-1.196 -3.473,-0.005 ' +\n        '-10.86,-0.003 -11.0829995,-0.003 -0.022,-0.047 -0.045,-0.094 -0.069,-0.139 0.3939995,-0.319 ' +\n        '2.0409995,-1.626 2.4149995,-2.017 0.469,-0.4870005 0.519,-1.1650005 0.162,-1.6040005 -0.414,-0.511 ' +\n        '-0.973,-0.5 -1.48,-0.236 -1.4609995,0.764 -6.5999995,3.6430005 -7.7329995,4.2710005 -0.9,0.499 ' +\n        '-1.516,1.253 -1.882,2.19 -0.37000002,0.95 -0.17,2.01 -0.166,2.979 0.004,0.718 -0.27300002,1.345 ' +\n        '-0.055,2.063 0.629,2.087 2.425,3.312 4.859,3.318 4.6179995,0.014 9.2379995,-0.139 13.8569995,-0.158 ' +\n        '0.755,-0.004 1.171,-0.301 1.182,-1.033 0.012,-0.754 -0.423,-0.969 -1.183,-0.973 -1.778,-0.01 ' +\n        '-5.824,-0.004 -6.04,-0.004 10e-4,-0.084 0.003,-0.586 10e-4,-0.67 z'\n    },\n    'TASK_TYPE_INSTANTIATING_SEND': {\n      d: 'm {mx},{my} l 0,8.4 l 12.6,0 l 0,-8.4 z l 6.3,3.6 l 6.3,-3.6'\n    },\n    'TASK_TYPE_SERVICE': {\n      d: 'm {mx},{my} v -1.71335 c 0.352326,-0.0705 0.703932,-0.17838 1.047628,-0.32133 ' +\n        '0.344416,-0.14465 0.665822,-0.32133 0.966377,-0.52145 l 1.19431,1.18005 1.567487,-1.57688 ' +\n        '-1.195028,-1.18014 c 0.403376,-0.61394 0.683079,-1.29908 0.825447,-2.01824 l 1.622133,-0.01 ' +\n        'v -2.2196 l -1.636514,0.01 c -0.07333,-0.35153 -0.178319,-0.70024 -0.323564,-1.04372 ' +\n        '-0.145244,-0.34406 -0.321407,-0.6644 -0.522735,-0.96217 l 1.131035,-1.13631 -1.583305,-1.56293 ' +\n        '-1.129598,1.13589 c -0.614052,-0.40108 -1.302883,-0.68093 -2.022633,-0.82247 l 0.0093,-1.61852 ' +\n        'h -2.241173 l 0.0042,1.63124 c -0.353763,0.0736 -0.705369,0.17977 -1.049785,0.32371 -0.344415,0.14437 ' +\n        '-0.665102,0.32092 -0.9635006,0.52046 l -1.1698628,-1.15823 -1.5667691,1.5792 1.1684265,1.15669 ' +\n        'c -0.4026573,0.61283 -0.68308,1.29797 -0.8247287,2.01713 l -1.6588041,0.003 v 2.22174 ' +\n        'l 1.6724648,-0.006 c 0.073327,0.35077 0.1797598,0.70243 0.3242851,1.04472 0.1452428,0.34448 ' +\n        '0.3214064,0.6644 0.5227339,0.96066 l -1.1993431,1.19723 1.5840256,1.56011 1.1964668,-1.19348 ' +\n        'c 0.6140517,0.40346 1.3028827,0.68232 2.0233517,0.82331 l 7.19e-4,1.69892 h 2.226848 z ' +\n        'm 0.221462,-3.9957 c -1.788948,0.7502 -3.8576,-0.0928 -4.6097055,-1.87438 -0.7521065,-1.78321 ' +\n        '0.090598,-3.84627 1.8802645,-4.59604 1.78823,-0.74936 3.856881,0.0929 4.608987,1.87437 ' +\n        '0.752106,1.78165 -0.0906,3.84612 -1.879546,4.59605 z'\n    },\n    'TASK_TYPE_SERVICE_FILL': {\n      d: 'm {mx},{my} c -1.788948,0.7502 -3.8576,-0.0928 -4.6097055,-1.87438 -0.7521065,-1.78321 ' +\n        '0.090598,-3.84627 1.8802645,-4.59604 1.78823,-0.74936 3.856881,0.0929 4.608987,1.87437 ' +\n        '0.752106,1.78165 -0.0906,3.84612 -1.879546,4.59605 z'\n    },\n    'TASK_TYPE_BUSINESS_RULE_HEADER': {\n      d: 'm {mx},{my} 0,4 20,0 0,-4 z'\n    },\n    'TASK_TYPE_BUSINESS_RULE_MAIN': {\n      d: 'm {mx},{my} 0,12 20,0 0,-12 z' +\n        'm 0,8 l 20,0 ' +\n        'm -13,-4 l 0,8'\n    },\n    'MESSAGE_FLOW_MARKER': {\n      d: 'm {mx},{my} m -10.5 ,-7 l 0,14 l 21,0 l 0,-14 z l 10.5,6 l 10.5,-6'\n    }\n  };\n\n  this.getRawPath = function getRawPath(pathId) {\n    return this.pathMap[pathId].d;\n  };\n\n  /**\n   * Scales the path to the given height and width.\n   * <h1>Use case</h1>\n   * <p>Use case is to scale the content of elements (event, gateways) based\n   * on the element bounding box's size.\n   * </p>\n   * <h1>Why not transform</h1>\n   * <p>Scaling a path with transform() will also scale the stroke and IE does not support\n   * the option 'non-scaling-stroke' to prevent this.\n   * Also there are use cases where only some parts of a path should be\n   * scaled.</p>\n   *\n   * @param {String} pathId The ID of the path.\n   * @param {Object} param <p>\n   *   Example param object scales the path to 60% size of the container (data.width, data.height).\n   *   <pre>\n   *   {\n   *     xScaleFactor: 0.6,\n   *     yScaleFactor:0.6,\n   *     containerWidth: data.width,\n   *     containerHeight: data.height,\n   *     position: {\n   *       mx: 0.46,\n   *       my: 0.2,\n   *     }\n   *   }\n   *   </pre>\n   *   <ul>\n   *    <li>targetpathwidth = xScaleFactor * containerWidth</li>\n   *    <li>targetpathheight = yScaleFactor * containerHeight</li>\n   *    <li>Position is used to set the starting coordinate of the path. M is computed:\n    *    <ul>\n    *      <li>position.x * containerWidth</li>\n    *      <li>position.y * containerHeight</li>\n    *    </ul>\n    *    Center of the container <pre> position: {\n   *       mx: 0.5,\n   *       my: 0.5,\n   *     }</pre>\n   *     Upper left corner of the container\n   *     <pre> position: {\n   *       mx: 0.0,\n   *       my: 0.0,\n   *     }</pre>\n   *    </li>\n   *   </ul>\n   * </p>\n   *\n   */\n  this.getScaledPath = function getScaledPath(pathId, param) {\n    var rawPath = this.pathMap[pathId];\n\n    // positioning\n    // compute the start point of the path\n    var mx, my;\n\n    if (param.abspos) {\n      mx = param.abspos.x;\n      my = param.abspos.y;\n    } else {\n      mx = param.containerWidth * param.position.mx;\n      my = param.containerHeight * param.position.my;\n    }\n\n    var coordinates = {}; // map for the scaled coordinates\n    if (param.position) {\n\n      // path\n      var heightRatio = (param.containerHeight / rawPath.height) * param.yScaleFactor;\n      var widthRatio = (param.containerWidth / rawPath.width) * param.xScaleFactor;\n\n\n      // Apply height ratio\n      for (var heightIndex = 0; heightIndex < rawPath.heightElements.length; heightIndex++) {\n        coordinates['y' + heightIndex] = rawPath.heightElements[heightIndex] * heightRatio;\n      }\n\n      // Apply width ratio\n      for (var widthIndex = 0; widthIndex < rawPath.widthElements.length; widthIndex++) {\n        coordinates['x' + widthIndex] = rawPath.widthElements[widthIndex] * widthRatio;\n      }\n    }\n\n    // Apply value to raw path\n    var path = format(\n      rawPath.d, {\n        mx: mx,\n        my: my,\n        e: coordinates\n      }\n    );\n    return path;\n  };\n}\n\n// helpers //////////////////////\n\n// copied from https://github.com/adobe-webplatform/Snap.svg/blob/master/src/svg.js\nvar tokenRegex = /\\{([^}]+)\\}/g,\n    objNotationRegex = /(?:(?:^|\\.)(.+?)(?=\\[|\\.|$|\\()|\\[('|\")(.+?)\\2\\])(\\(\\))?/g; // matches .xxxxx or [\"xxxxx\"] to run over object properties\n\nfunction replacer(all, key, obj) {\n  var res = obj;\n  key.replace(objNotationRegex, function(all, name, quote, quotedName, isFunc) {\n    name = name || quotedName;\n    if (res) {\n      if (name in res) {\n        res = res[name];\n      }\n      typeof res == 'function' && isFunc && (res = res());\n    }\n  });\n  res = (res == null || res == obj ? all : res) + '';\n\n  return res;\n}\n\nfunction format(str, obj) {\n  return String(str).replace(tokenRegex, function(all, key) {\n    return replacer(all, key, obj);\n  });\n}\n","import PostitRenderer from './PostitRenderer';\nimport TextRenderer from './TextRenderer';\n\nimport PathMap from './PathMap';\n\nexport default {\n  __init__: [ 'postitRenderer' ],\n  postitRenderer: [ 'type', PostitRenderer ],\n  textRenderer: [ 'type', TextRenderer ],\n  pathMap: [ 'type', PathMap ]\n};\n","import translate from './translate';\n\nexport default {\n  translate: [ 'value', translate ]\n};","/**\n * A simple translation stub to be used for multi-language support\n * in diagrams. Can be easily replaced with a more sophisticated\n * solution.\n *\n * @example\n *\n * // use it inside any diagram component by injecting `translate`.\n *\n * function MyService(translate) {\n *   alert(translate('HELLO {you}', { you: 'You!' }));\n * }\n *\n * @param {string} template to interpolate\n * @param {Object} [replacements] a map with substitutes\n *\n * @return {string} the translated string\n */\nexport default function translate(template, replacements) {\n\n  replacements = replacements || {};\n\n  return template.replace(/{([^}]+)}/g, function(_, key) {\n    return replacements[key] || '{' + key + '}';\n  });\n}","import {\n  assign\n} from 'min-dash';\n\nimport { is } from './ModelUtil';\n\n\nexport var DEFAULT_LABEL_SIZE = {\n  width: 90,\n  height: 20\n};\n\nexport var FLOW_LABEL_INDENT = 15;\n\n\n/**\n * Returns true if the given semantic has an external label\n *\n * @param {BoardElement} semantic\n * @return {Boolean} true if has label\n */\nexport function isLabelExternal(semantic) {\n  return is(semantic, 'postit:Group');\n}\n\n/**\n * Returns true if the given element has an external label\n *\n * @param {djs.model.shape} element\n * @return {Boolean} true if has label\n */\nexport function hasExternalLabel(element) {\n  return isLabel(element.label);\n}\n\n\n/**\n * Get the middle of a number of waypoints\n *\n * @param  {Array<Point>} waypoints\n * @return {Point} the mid point\n */\nexport function getWaypointsMid(waypoints) {\n\n  var mid = waypoints.length / 2 - 1;\n\n  var first = waypoints[Math.floor(mid)];\n  var second = waypoints[Math.ceil(mid + 0.01)];\n\n  return {\n    x: first.x + (second.x - first.x) / 2,\n    y: first.y + (second.y - first.y) / 2\n  };\n}\n\n\nexport function getExternalLabelMid(element) {\n\n  if (is(element, 'postit:Group')) {\n    return {\n      x: element.x + element.width / 2,\n      y: element.y + DEFAULT_LABEL_SIZE.height / 2\n    };\n  } else {\n    return {\n      x: element.x + element.width / 2,\n      y: element.y + element.height + DEFAULT_LABEL_SIZE.height / 2\n    };\n  }\n}\n\n\n/**\n * Returns the bounds of an elements label, parsed from the elements DI or\n * generated from its bounds.\n *\n * @param {BoardElement} semantic\n * @param {djs.model.Base} element\n */\nexport function getExternalLabelBounds(semantic, element) {\n\n  var mid,\n      size,\n      bounds,\n      di = semantic.di,\n      label = di.label;\n\n  if (label && label.bounds) {\n    bounds = label.bounds;\n\n    size = {\n      width: Math.max(DEFAULT_LABEL_SIZE.width, bounds.width),\n      height: bounds.height\n    };\n\n    mid = {\n      x: bounds.x + bounds.width / 2,\n      y: bounds.y + bounds.height / 2\n    };\n  } else {\n\n    mid = getExternalLabelMid(element);\n\n    size = DEFAULT_LABEL_SIZE;\n  }\n\n  return assign({\n    x: mid.x - size.width / 2,\n    y: mid.y - size.height / 2\n  }, size);\n}\n\nexport function isLabel(element) {\n  return element && !!element.labelTarget;\n}\n","import {\n  assign\n} from 'min-dash';\n\nimport { is } from '../util/ModelUtil';\n\nimport {\n  isLabelExternal,\n  getExternalLabelBounds\n} from '../util/LabelUtil';\n\nimport {\n  getLabel\n} from '../features/label-editing/LabelUtil';\n\nimport {\n  elementToString\n} from './Util';\n\n\nfunction elementData(semantic, attrs) {\n  return assign({\n    id: semantic.id,\n    type: semantic.$type,\n    businessObject: semantic\n  }, attrs);\n}\n\nfunction notYetDrawn(translate, semantic, refSemantic, property) {\n  return new Error(translate('element {element} referenced by {referenced}#{property} not yet drawn', {\n    element: elementToString(refSemantic),\n    referenced: elementToString(semantic),\n    property: property\n  }));\n}\n\n\n/**\n * An importer that adds postit elements to the canvas\n *\n * @param {EventBus} eventBus\n * @param {Canvas} canvas\n * @param {ElementFactory} elementFactory\n * @param {ElementRegistry} elementRegistry\n * @param {Function} translate\n * @param {TextRenderer} textRenderer\n */\nexport default function PostitImporter(\n    eventBus, canvas, elementFactory,\n    elementRegistry, translate, textRenderer) {\n\n  this._eventBus = eventBus;\n  this._canvas = canvas;\n  this._elementFactory = elementFactory;\n  this._elementRegistry = elementRegistry;\n  this._translate = translate;\n  this._textRenderer = textRenderer;\n}\n\nPostitImporter.$inject = [\n  'eventBus',\n  'canvas',\n  'elementFactory',\n  'elementRegistry',\n  'translate',\n  'textRenderer'\n];\n\n\n/**\n * Add postit element (semantic) to the canvas onto the\n * specified parent shape.\n */\nPostitImporter.prototype.add = function(semantic, parentElement) {\n\n  var di = semantic.di,\n      element,\n      translate = this._translate,\n      hidden;\n\n  var parentIndex;\n\n  // ROOT ELEMENT\n  // handle the special case that we deal with a\n  // invisible root element\n  if (is(di, 'postitDi:PostitPlane')) {\n\n    // add a virtual element (not being drawn)\n    element = this._elementFactory.createRoot(elementData(semantic));\n\n    this._canvas.setRootElement(element);\n  }\n\n  // SHAPE\n  else if (is(di, 'postitDi:PostitShape')) {\n\n    var isFrame = isFrameElement(semantic);\n\n    hidden = parentElement && (parentElement.hidden || parentElement.collapsed);\n\n    var bounds = semantic.di.bounds;\n\n    element = this._elementFactory.createShape(elementData(semantic, {\n      hidden: hidden,\n      x: Math.round(bounds.x),\n      y: Math.round(bounds.y),\n      width: Math.round(bounds.width),\n      height: Math.round(bounds.height),\n      isFrame: isFrame\n    }));\n\n    this._canvas.addShape(element, parentElement, parentIndex);\n  }\n\n  else {\n    throw new Error(translate('unknown di {di} for element {semantic}', {\n      di: elementToString(di),\n      semantic: elementToString(semantic)\n    }));\n  }\n\n  // (optional) LABEL\n  if (isLabelExternal(semantic) && getLabel(element)) {\n    this.addLabel(semantic, element);\n  }\n\n\n  this._eventBus.fire('boardElement.added', { element: element });\n\n  return element;\n};\n\n\n/**\n * Attach the boundary element to the given host\n *\n * @param {ModdleElement} boundarySemantic\n * @param {djs.model.Base} boundaryElement\n */\nPostitImporter.prototype._attachBoundary = function(boundarySemantic, boundaryElement) {\n  var translate = this._translate;\n  var hostSemantic = boundarySemantic.attachedToRef;\n\n  if (!hostSemantic) {\n    throw new Error(translate('missing {semantic}#attachedToRef', {\n      semantic: elementToString(boundarySemantic)\n    }));\n  }\n\n  var host = this._elementRegistry.get(hostSemantic.id),\n      attachers = host && host.attachers;\n\n  if (!host) {\n    throw notYetDrawn(translate, boundarySemantic, hostSemantic, 'attachedToRef');\n  }\n\n  // wire element.host <> host.attachers\n  boundaryElement.host = host;\n\n  if (!attachers) {\n    host.attachers = attachers = [];\n  }\n\n  if (attachers.indexOf(boundaryElement) === -1) {\n    attachers.push(boundaryElement);\n  }\n};\n\n\n/**\n * add label for an element\n */\nPostitImporter.prototype.addLabel = function(semantic, element) {\n  var bounds,\n      text,\n      label;\n\n  bounds = getExternalLabelBounds(semantic, element);\n\n  text = getLabel(element);\n\n  if (text) {\n\n    // get corrected bounds from actual layouted text\n    bounds = this._textRenderer.getExternalLabelBounds(bounds, text);\n  }\n\n  label = this._elementFactory.createLabel(elementData(semantic, {\n    id: semantic.id + '_label',\n    labelTarget: element,\n    type: 'label',\n    hidden: element.hidden || !getLabel(element),\n    x: Math.round(bounds.x),\n    y: Math.round(bounds.y),\n    width: Math.round(bounds.width),\n    height: Math.round(bounds.height)\n  }));\n\n  return this._canvas.addShape(label, element.parent);\n};\n\n/**\n * Return the drawn connection end based on the given side.\n *\n * @throws {Error} if the end is not yet drawn\n */\nPostitImporter.prototype._getEnd = function(semantic, side) {\n\n  var element,\n      refSemantic,\n      translate = this._translate;\n\n  refSemantic = semantic[side + 'Ref'];\n\n\n  element = refSemantic && this._getElement(refSemantic);\n\n  if (element) {\n    return element;\n  }\n\n  if (refSemantic) {\n    throw notYetDrawn(translate, semantic, refSemantic, side + 'Ref');\n  } else {\n    throw new Error(translate('{semantic}#{side} Ref not specified', {\n      semantic: elementToString(semantic),\n      side: side\n    }));\n  }\n};\n\nPostitImporter.prototype._getSource = function(semantic) {\n  return this._getEnd(semantic, 'source');\n};\n\nPostitImporter.prototype._getTarget = function(semantic) {\n  return this._getEnd(semantic, 'target');\n};\n\n\nPostitImporter.prototype._getElement = function(semantic) {\n  return this._elementRegistry.get(semantic.id);\n};\n\n\n// helpers //////////\n\nfunction isFrameElement(semantic) {\n  return is(semantic, 'postit:Group');\n}","import translate from 'diagram-js/lib/i18n/translate';\n\nimport PostitImporter from './PostitImporter';\n\nexport default {\n  __depends__: [\n    translate\n  ],\n  postitImporter: [ 'type', PostitImporter ]\n};","import DrawModule from '../draw';\nimport ImportModule from '../import';\n\nexport default {\n  __depends__: [\n    DrawModule,\n    ImportModule\n  ]\n};","function __stopPropagation(event) {\n  if (!event || typeof event.stopPropagation !== 'function') {\n    return;\n  }\n\n  event.stopPropagation();\n}\n\n\nexport function getOriginal(event) {\n  return event.originalEvent || event.srcEvent;\n}\n\n\nexport function stopPropagation(event, immediate) {\n  __stopPropagation(event, immediate);\n  __stopPropagation(getOriginal(event), immediate);\n}\n\n\nexport function toPoint(event) {\n\n  if (event.pointers && event.pointers.length) {\n    event = event.pointers[0];\n  }\n\n  if (event.touches && event.touches.length) {\n    event = event.touches[0];\n  }\n\n  return event ? {\n    x: event.clientX,\n    y: event.clientY\n  } : null;\n}","import {\n  getOriginal as getOriginalEvent\n} from './Event';\n\nimport {\n  isMac\n} from './Platform';\n\nexport {\n  isMac\n} from './Platform';\n\nexport function isButton(event, button) {\n  return (getOriginalEvent(event) || event).button === button;\n}\n\nexport function isPrimaryButton(event) {\n\n  // button === 0 -> left ka primary mouse button\n  return isButton(event, 0);\n}\n\nexport function isAuxiliaryButton(event) {\n\n  // button === 1 -> auxiliary ka wheel button\n  return isButton(event, 1);\n}\n\nexport function isSecondaryButton(event) {\n\n  // button === 2 -> right ka secondary button\n  return isButton(event, 2);\n}\n\nexport function hasPrimaryModifier(event) {\n  var originalEvent = getOriginalEvent(event) || event;\n\n  if (!isPrimaryButton(event)) {\n    return false;\n  }\n\n  // Use cmd as primary modifier key for mac OS\n  if (isMac()) {\n    return originalEvent.metaKey;\n  } else {\n    return originalEvent.ctrlKey;\n  }\n}\n\n\nexport function hasSecondaryModifier(event) {\n  var originalEvent = getOriginalEvent(event) || event;\n\n  return isPrimaryButton(event) && originalEvent.shiftKey;\n}\n","export function isMac() {\n  return (/mac/i).test(navigator.platform);\n}","import {\n  forEach,\n  assign\n} from 'min-dash';\n\nimport {\n  delegate as domDelegate,\n  query as domQuery,\n  queryAll as domQueryAll\n} from 'min-dom';\n\nimport {\n  isPrimaryButton,\n  isAuxiliaryButton\n} from '../../util/Mouse';\n\nimport {\n  append as svgAppend,\n  attr as svgAttr,\n  create as svgCreate,\n  remove as svgRemove\n} from 'tiny-svg';\n\nimport {\n  createLine,\n  updateLine\n} from '../../util/RenderUtil';\n\nfunction allowAll(event) { return true; }\n\nfunction allowPrimaryAndAuxiliary(event) {\n  return isPrimaryButton(event) || isAuxiliaryButton(event);\n}\n\nvar LOW_PRIORITY = 500;\n\n\n/**\n * A plugin that provides interaction events for diagram elements.\n *\n * It emits the following events:\n *\n *   * element.click\n *   * element.contextmenu\n *   * element.dblclick\n *   * element.hover\n *   * element.mousedown\n *   * element.mousemove\n *   * element.mouseup\n *   * element.out\n *\n * Each event is a tuple { element, gfx, originalEvent }.\n *\n * Canceling the event via Event#preventDefault()\n * prevents the original DOM operation.\n *\n * @param {EventBus} eventBus\n */\nexport default function InteractionEvents(eventBus, elementRegistry, styles) {\n\n  var self = this;\n\n  /**\n   * Fire an interaction event.\n   *\n   * @param {string} type local event name, e.g. element.click.\n   * @param {DOMEvent} event native event\n   * @param {djs.model.Base} [element] the diagram element to emit the event on;\n   *                                   defaults to the event target\n   */\n  function fire(type, event, element) {\n\n    if (isIgnored(type, event)) {\n      return;\n    }\n\n    var target, gfx, returnValue;\n\n    if (!element) {\n      target = event.delegateTarget || event.target;\n\n      if (target) {\n        gfx = target;\n        element = elementRegistry.get(gfx);\n      }\n    } else {\n      gfx = elementRegistry.getGraphics(element);\n    }\n\n    if (!gfx || !element) {\n      return;\n    }\n\n    returnValue = eventBus.fire(type, {\n      element: element,\n      gfx: gfx,\n      originalEvent: event\n    });\n\n    if (returnValue === false) {\n      event.stopPropagation();\n      event.preventDefault();\n    }\n  }\n\n  // TODO(nikku): document this\n  var handlers = {};\n\n  function mouseHandler(localEventName) {\n    return handlers[localEventName];\n  }\n\n  function isIgnored(localEventName, event) {\n\n    var filter = ignoredFilters[localEventName] || isPrimaryButton;\n\n    // only react on left mouse button interactions\n    // except for interaction events that are enabled\n    // for secundary mouse button\n    return !filter(event);\n  }\n\n  var bindings = {\n    click: 'element.click',\n    contextmenu: 'element.contextmenu',\n    dblclick: 'element.dblclick',\n    mousedown: 'element.mousedown',\n    mousemove: 'element.mousemove',\n    mouseover: 'element.hover',\n    mouseout: 'element.out',\n    mouseup: 'element.mouseup',\n  };\n\n  var ignoredFilters = {\n    'element.contextmenu': allowAll,\n    'element.mousedown': allowPrimaryAndAuxiliary,\n    'element.mouseup': allowPrimaryAndAuxiliary,\n    'element.click': allowPrimaryAndAuxiliary,\n    'element.dblclick': allowPrimaryAndAuxiliary\n  };\n\n\n  // manual event trigger //////////\n\n  /**\n   * Trigger an interaction event (based on a native dom event)\n   * on the target shape or connection.\n   *\n   * @param {string} eventName the name of the triggered DOM event\n   * @param {MouseEvent} event\n   * @param {djs.model.Base} targetElement\n   */\n  function triggerMouseEvent(eventName, event, targetElement) {\n\n    // i.e. element.mousedown...\n    var localEventName = bindings[eventName];\n\n    if (!localEventName) {\n      throw new Error('unmapped DOM event name <' + eventName + '>');\n    }\n\n    return fire(localEventName, event, targetElement);\n  }\n\n\n  var ELEMENT_SELECTOR = 'svg, .djs-element';\n\n  // event handling ///////\n\n  function registerEvent(node, event, localEvent, ignoredFilter) {\n\n    var handler = handlers[localEvent] = function(event) {\n      fire(localEvent, event);\n    };\n\n    if (ignoredFilter) {\n      ignoredFilters[localEvent] = ignoredFilter;\n    }\n\n    handler.$delegate = domDelegate.bind(node, ELEMENT_SELECTOR, event, handler);\n  }\n\n  function unregisterEvent(node, event, localEvent) {\n\n    var handler = mouseHandler(localEvent);\n\n    if (!handler) {\n      return;\n    }\n\n    domDelegate.unbind(node, event, handler.$delegate);\n  }\n\n  function registerEvents(svg) {\n    forEach(bindings, function(val, key) {\n      registerEvent(svg, key, val);\n    });\n  }\n\n  function unregisterEvents(svg) {\n    forEach(bindings, function(val, key) {\n      unregisterEvent(svg, key, val);\n    });\n  }\n\n  eventBus.on('canvas.destroy', function(event) {\n    unregisterEvents(event.svg);\n  });\n\n  eventBus.on('canvas.init', function(event) {\n    registerEvents(event.svg);\n  });\n\n\n  // hit box updating ////////////////\n\n  eventBus.on([ 'shape.added', 'connection.added' ], function(event) {\n    var element = event.element,\n        gfx = event.gfx;\n\n    eventBus.fire('interactionEvents.createHit', { element: element, gfx: gfx });\n  });\n\n  // Update djs-hit on change.\n  // A low priortity is necessary, because djs-hit of labels has to be updated\n  // after the label bounds have been updated in the renderer.\n  eventBus.on([\n    'shape.changed',\n    'connection.changed'\n  ], LOW_PRIORITY, function(event) {\n\n    var element = event.element,\n        gfx = event.gfx;\n\n    eventBus.fire('interactionEvents.updateHit', { element: element, gfx: gfx });\n  });\n\n  eventBus.on('interactionEvents.createHit', LOW_PRIORITY, function(event) {\n    var element = event.element,\n        gfx = event.gfx;\n\n    self.createDefaultHit(element, gfx);\n  });\n\n  eventBus.on('interactionEvents.updateHit', function(event) {\n    var element = event.element,\n        gfx = event.gfx;\n\n    self.updateDefaultHit(element, gfx);\n  });\n\n\n  // hit styles ////////////\n\n  var STROKE_HIT_STYLE = createHitStyle('djs-hit djs-hit-stroke');\n\n  var CLICK_STROKE_HIT_STYLE = createHitStyle('djs-hit djs-hit-click-stroke');\n\n  var ALL_HIT_STYLE = createHitStyle('djs-hit djs-hit-all');\n\n  var HIT_TYPES = {\n    'all': ALL_HIT_STYLE,\n    'click-stroke': CLICK_STROKE_HIT_STYLE,\n    'stroke': STROKE_HIT_STYLE\n  };\n\n  function createHitStyle(classNames, attrs) {\n\n    attrs = assign({\n      stroke: 'white',\n      strokeWidth: 15\n    }, attrs || {});\n\n    return styles.cls(classNames, [ 'no-fill', 'no-border' ], attrs);\n  }\n\n\n  // style helpers ///////////////\n\n  function applyStyle(hit, type) {\n\n    var attrs = HIT_TYPES[type];\n\n    if (!attrs) {\n      throw new Error('invalid hit type <' + type + '>');\n    }\n\n    svgAttr(hit, attrs);\n\n    return hit;\n  }\n\n  function appendHit(gfx, hit) {\n    svgAppend(gfx, hit);\n  }\n\n\n  // API\n\n  /**\n   * Remove hints on the given graphics.\n   *\n   * @param {SVGElement} gfx\n   */\n  this.removeHits = function(gfx) {\n    var hits = domQueryAll('.djs-hit', gfx);\n\n    forEach(hits, svgRemove);\n  };\n\n  /**\n   * Create default hit for the given element.\n   *\n   * @param {djs.model.Base} element\n   * @param {SVGElement} gfx\n   *\n   * @return {SVGElement} created hit\n   */\n  this.createDefaultHit = function(element, gfx) {\n    var waypoints = element.waypoints,\n        isFrame = element.isFrame,\n        boxType;\n\n    if (waypoints) {\n      return this.createWaypointsHit(gfx, waypoints);\n    } else {\n\n      boxType = isFrame ? 'stroke' : 'all';\n\n      return this.createBoxHit(gfx, boxType, {\n        width: element.width,\n        height: element.height\n      });\n    }\n  };\n\n  /**\n   * Create hits for the given waypoints.\n   *\n   * @param {SVGElement} gfx\n   * @param {Array<Point>} waypoints\n   *\n   * @return {SVGElement}\n   */\n  this.createWaypointsHit = function(gfx, waypoints) {\n\n    var hit = createLine(waypoints);\n\n    applyStyle(hit, 'stroke');\n\n    appendHit(gfx, hit);\n\n    return hit;\n  };\n\n  /**\n   * Create hits for a box.\n   *\n   * @param {SVGElement} gfx\n   * @param {string} hitType\n   * @param {Object} attrs\n   *\n   * @return {SVGElement}\n   */\n  this.createBoxHit = function(gfx, type, attrs) {\n\n    attrs = assign({\n      x: 0,\n      y: 0\n    }, attrs);\n\n    var hit = svgCreate('rect');\n\n    applyStyle(hit, type);\n\n    svgAttr(hit, attrs);\n\n    appendHit(gfx, hit);\n\n    return hit;\n  };\n\n  /**\n   * Update default hit of the element.\n   *\n   * @param  {djs.model.Base} element\n   * @param  {SVGElement} gfx\n   *\n   * @return {SVGElement} updated hit\n   */\n  this.updateDefaultHit = function(element, gfx) {\n\n    var hit = domQuery('.djs-hit', gfx);\n\n    if (!hit) {\n      return;\n    }\n\n    if (element.waypoints) {\n      updateLine(hit, element.waypoints);\n    } else {\n      svgAttr(hit, {\n        width: element.width,\n        height: element.height\n      });\n    }\n\n    return hit;\n  };\n\n  this.fire = fire;\n\n  this.triggerMouseEvent = triggerMouseEvent;\n\n  this.mouseHandler = mouseHandler;\n\n  this.registerEvent = registerEvent;\n  this.unregisterEvent = unregisterEvent;\n}\n\n\nInteractionEvents.$inject = [\n  'eventBus',\n  'elementRegistry',\n  'styles'\n];\n\n\n/**\n * An event indicating that the mouse hovered over an element\n *\n * @event element.hover\n *\n * @type {Object}\n * @property {djs.model.Base} element\n * @property {SVGElement} gfx\n * @property {Event} originalEvent\n */\n\n/**\n * An event indicating that the mouse has left an element\n *\n * @event element.out\n *\n * @type {Object}\n * @property {djs.model.Base} element\n * @property {SVGElement} gfx\n * @property {Event} originalEvent\n */\n\n/**\n * An event indicating that the mouse has clicked an element\n *\n * @event element.click\n *\n * @type {Object}\n * @property {djs.model.Base} element\n * @property {SVGElement} gfx\n * @property {Event} originalEvent\n */\n\n/**\n * An event indicating that the mouse has double clicked an element\n *\n * @event element.dblclick\n *\n * @type {Object}\n * @property {djs.model.Base} element\n * @property {SVGElement} gfx\n * @property {Event} originalEvent\n */\n\n/**\n * An event indicating that the mouse has gone down on an element.\n *\n * @event element.mousedown\n *\n * @type {Object}\n * @property {djs.model.Base} element\n * @property {SVGElement} gfx\n * @property {Event} originalEvent\n */\n\n/**\n * An event indicating that the mouse has gone up on an element.\n *\n * @event element.mouseup\n *\n * @type {Object}\n * @property {djs.model.Base} element\n * @property {SVGElement} gfx\n * @property {Event} originalEvent\n */\n\n/**\n * An event indicating that the context menu action is triggered\n * via mouse or touch controls.\n *\n * @event element.contextmenu\n *\n * @type {Object}\n * @property {djs.model.Base} element\n * @property {SVGElement} gfx\n * @property {Event} originalEvent\n */","import InteractionEvents from './InteractionEvents';\n\nexport default {\n  __init__: [ 'interactionEvents' ],\n  interactionEvents: [ 'type', InteractionEvents ]\n};","import { getBBox } from '../../util/Elements';\n\nvar LOW_PRIORITY = 500;\n\nimport {\n  append as svgAppend,\n  attr as svgAttr,\n  create as svgCreate\n} from 'tiny-svg';\n\nimport {\n  query as domQuery\n} from 'min-dom';\n\nimport {\n  assign\n} from 'min-dash';\n\n\n/**\n * @class\n *\n * A plugin that adds an outline to shapes and connections that may be activated and styled\n * via CSS classes.\n *\n * @param {EventBus} eventBus\n * @param {Styles} styles\n * @param {ElementRegistry} elementRegistry\n */\nexport default function Outline(eventBus, styles, elementRegistry) {\n\n  this.offset = 6;\n\n  var OUTLINE_STYLE = styles.cls('djs-outline', [ 'no-fill' ]);\n\n  var self = this;\n\n  function createOutline(gfx, bounds) {\n    var outline = svgCreate('rect');\n\n    svgAttr(outline, assign({\n      x: 10,\n      y: 10,\n      width: 100,\n      height: 100\n    }, OUTLINE_STYLE));\n\n    svgAppend(gfx, outline);\n\n    return outline;\n  }\n\n  // A low priortity is necessary, because outlines of labels have to be updated\n  // after the label bounds have been updated in the renderer.\n  eventBus.on([ 'shape.added', 'shape.changed' ], LOW_PRIORITY, function(event) {\n    var element = event.element,\n        gfx = event.gfx;\n\n    var outline = domQuery('.djs-outline', gfx);\n\n    if (!outline) {\n      outline = createOutline(gfx, element);\n    }\n\n    self.updateShapeOutline(outline, element);\n  });\n\n  eventBus.on([ 'connection.added', 'connection.changed' ], function(event) {\n    var element = event.element,\n        gfx = event.gfx;\n\n    var outline = domQuery('.djs-outline', gfx);\n\n    if (!outline) {\n      outline = createOutline(gfx, element);\n    }\n\n    self.updateConnectionOutline(outline, element);\n  });\n}\n\n\n/**\n * Updates the outline of a shape respecting the dimension of the\n * element and an outline offset.\n *\n * @param  {SVGElement} outline\n * @param  {djs.model.Base} element\n */\nOutline.prototype.updateShapeOutline = function(outline, element) {\n\n  svgAttr(outline, {\n    x: -this.offset,\n    y: -this.offset,\n    width: element.width + this.offset * 2,\n    height: element.height + this.offset * 2\n  });\n\n};\n\n\n/**\n * Updates the outline of a connection respecting the bounding box of\n * the connection and an outline offset.\n *\n * @param  {SVGElement} outline\n * @param  {djs.model.Base} element\n */\nOutline.prototype.updateConnectionOutline = function(outline, connection) {\n\n  var bbox = getBBox(connection);\n\n  svgAttr(outline, {\n    x: bbox.x - this.offset,\n    y: bbox.y - this.offset,\n    width: bbox.width + this.offset * 2,\n    height: bbox.height + this.offset * 2\n  });\n\n};\n\n\nOutline.$inject = ['eventBus', 'styles', 'elementRegistry'];","import Outline from './Outline';\n\nexport default {\n  __init__: [ 'outline' ],\n  outline: [ 'type', Outline ]\n};","import {\n  isArray,\n  forEach\n} from 'min-dash';\n\n\n/**\n * A service that offers the current selection in a diagram.\n * Offers the api to control the selection, too.\n *\n * @class\n *\n * @param {EventBus} eventBus the event bus\n */\nexport default function Selection(eventBus) {\n\n  this._eventBus = eventBus;\n\n  this._selectedElements = [];\n\n  var self = this;\n\n  eventBus.on([ 'shape.remove', 'connection.remove' ], function(e) {\n    var element = e.element;\n    self.deselect(element);\n  });\n\n  eventBus.on([ 'diagram.clear' ], function(e) {\n    self.select(null);\n  });\n}\n\nSelection.$inject = [ 'eventBus' ];\n\n\nSelection.prototype.deselect = function(element) {\n  var selectedElements = this._selectedElements;\n\n  var idx = selectedElements.indexOf(element);\n\n  if (idx !== -1) {\n    var oldSelection = selectedElements.slice();\n\n    selectedElements.splice(idx, 1);\n\n    this._eventBus.fire('selection.changed', { oldSelection: oldSelection, newSelection: selectedElements });\n  }\n};\n\n\nSelection.prototype.get = function() {\n  return this._selectedElements;\n};\n\nSelection.prototype.isSelected = function(element) {\n  return this._selectedElements.indexOf(element) !== -1;\n};\n\n\n/**\n * This method selects one or more elements on the diagram.\n *\n * By passing an additional add parameter you can decide whether or not the element(s)\n * should be added to the already existing selection or not.\n *\n * @method Selection#select\n *\n * @param  {Object|Object[]} elements element or array of elements to be selected\n * @param  {boolean} [add] whether the element(s) should be appended to the current selection, defaults to false\n */\nSelection.prototype.select = function(elements, add) {\n  var selectedElements = this._selectedElements,\n      oldSelection = selectedElements.slice();\n\n  if (!isArray(elements)) {\n    elements = elements ? [ elements ] : [];\n  }\n\n  // selection may be cleared by passing an empty array or null\n  // to the method\n  if (add) {\n    forEach(elements, function(element) {\n      if (selectedElements.indexOf(element) !== -1) {\n\n        // already selected\n        return;\n      } else {\n        selectedElements.push(element);\n      }\n    });\n  } else {\n    this._selectedElements = selectedElements = elements.slice();\n  }\n\n  this._eventBus.fire('selection.changed', { oldSelection: oldSelection, newSelection: selectedElements });\n};\n","import {\n  forEach\n} from 'min-dash';\n\nvar MARKER_HOVER = 'hover',\n    MARKER_SELECTED = 'selected';\n\n\n/**\n * A plugin that adds a visible selection UI to shapes and connections\n * by appending the <code>hover</code> and <code>selected</code> classes to them.\n *\n * @class\n *\n * Makes elements selectable, too.\n *\n * @param {EventBus} events\n * @param {SelectionService} selection\n * @param {Canvas} canvas\n */\nexport default function SelectionVisuals(events, canvas, selection, styles) {\n\n  this._multiSelectionBox = null;\n\n  function addMarker(e, cls) {\n    canvas.addMarker(e, cls);\n  }\n\n  function removeMarker(e, cls) {\n    canvas.removeMarker(e, cls);\n  }\n\n  events.on('element.hover', function(event) {\n    addMarker(event.element, MARKER_HOVER);\n  });\n\n  events.on('element.out', function(event) {\n    removeMarker(event.element, MARKER_HOVER);\n  });\n\n  events.on('selection.changed', function(event) {\n\n    function deselect(s) {\n      removeMarker(s, MARKER_SELECTED);\n    }\n\n    function select(s) {\n      addMarker(s, MARKER_SELECTED);\n    }\n\n    var oldSelection = event.oldSelection,\n        newSelection = event.newSelection;\n\n    forEach(oldSelection, function(e) {\n      if (newSelection.indexOf(e) === -1) {\n        deselect(e);\n      }\n    });\n\n    forEach(newSelection, function(e) {\n      if (oldSelection.indexOf(e) === -1) {\n        select(e);\n      }\n    });\n  });\n}\n\nSelectionVisuals.$inject = [\n  'eventBus',\n  'canvas',\n  'selection',\n  'styles'\n];","import {\n  hasPrimaryModifier,\n  hasSecondaryModifier,\n  isPrimaryButton\n} from '../../util/Mouse';\n\nimport {\n  find,\n  isArray\n} from 'min-dash';\n\n\nexport default function SelectionBehavior(eventBus, selection, canvas, elementRegistry) {\n\n  // Select elements on create\n  eventBus.on('create.end', 500, function(event) {\n    var context = event.context,\n        canExecute = context.canExecute,\n        elements = context.elements,\n        hints = context.hints || {},\n        autoSelect = hints.autoSelect;\n\n    if (canExecute) {\n      if (autoSelect === false) {\n\n        // Select no elements\n        return;\n      }\n\n      if (isArray(autoSelect)) {\n        selection.select(autoSelect);\n      } else {\n\n        // Select all elements by default\n        selection.select(elements.filter(isShown));\n      }\n    }\n  });\n\n  // Select connection targets on connect\n  eventBus.on('connect.end', 500, function(event) {\n    var context = event.context,\n        canExecute = context.canExecute,\n        hover = context.hover;\n\n    if (canExecute && hover) {\n      selection.select(hover);\n    }\n  });\n\n  // Select shapes on move\n  eventBus.on('shape.move.end', 500, function(event) {\n    var previousSelection = event.previousSelection || [];\n\n    var shape = elementRegistry.get(event.context.shape.id);\n\n    // Always select main shape on move\n    var isSelected = find(previousSelection, function(selectedShape) {\n      return shape.id === selectedShape.id;\n    });\n\n    if (!isSelected) {\n      selection.select(shape);\n    }\n  });\n\n  // Select elements on click\n  eventBus.on('element.click', function(event) {\n\n    if (!isPrimaryButton(event)) {\n      return;\n    }\n\n    var element = event.element;\n\n    if (element === canvas.getRootElement()) {\n      element = null;\n    }\n\n    var isSelected = selection.isSelected(element),\n        isMultiSelect = selection.get().length > 1;\n\n    // Add to selection if CTRL or SHIFT pressed\n    var add = hasPrimaryModifier(event) || hasSecondaryModifier(event);\n\n    if (isSelected && isMultiSelect) {\n      if (add) {\n\n        // Deselect element\n        return selection.deselect(element);\n      } else {\n\n        // Select element only\n        return selection.select(element);\n      }\n    } else if (!isSelected) {\n\n      // Select element\n      selection.select(element, add);\n    } else {\n\n      // Deselect element\n      selection.deselect(element);\n    }\n  });\n}\n\nSelectionBehavior.$inject = [\n  'eventBus',\n  'selection',\n  'canvas',\n  'elementRegistry'\n];\n\n\nfunction isShown(element) {\n  return !element.hidden;\n}\n","import InteractionEventsModule from '../interaction-events';\nimport OutlineModule from '../outline';\n\nimport Selection from './Selection';\nimport SelectionVisuals from './SelectionVisuals';\nimport SelectionBehavior from './SelectionBehavior';\n\n\nexport default {\n  __init__: [ 'selectionVisuals', 'selectionBehavior' ],\n  __depends__: [\n    InteractionEventsModule,\n    OutlineModule\n  ],\n  selection: [ 'type', Selection ],\n  selectionVisuals: [ 'type', SelectionVisuals ],\n  selectionBehavior: [ 'type', SelectionBehavior ]\n};\n","/**\n * Util that provides unique IDs.\n *\n * @class djs.util.IdGenerator\n * @constructor\n * @memberOf djs.util\n *\n * The ids can be customized via a given prefix and contain a random value to avoid collisions.\n *\n * @param {string} prefix a prefix to prepend to generated ids (for better readability)\n */\nexport default function IdGenerator(prefix) {\n\n  this._counter = 0;\n  this._prefix = (prefix ? prefix + '-' : '') + Math.floor(Math.random() * 1000000000) + '-';\n}\n\n/**\n * Returns a next unique ID.\n *\n * @method djs.util.IdGenerator#next\n *\n * @returns {string} the id\n */\nIdGenerator.prototype.next = function() {\n  return this._prefix + (++this._counter);\n};\n","import {\n  isArray,\n  isString,\n  isObject,\n  assign,\n  forEach,\n  find,\n  filter,\n  matchPattern,\n  isDefined\n} from 'min-dash';\n\nimport {\n  domify,\n  classes as domClasses,\n  attr as domAttr,\n  remove as domRemove,\n  clear as domClear\n} from 'min-dom';\n\nimport {\n  getBBox\n} from '../../util/Elements';\n\nimport Ids from '../../util/IdGenerator';\n\n// document wide unique overlay ids\nvar ids = new Ids('ov');\n\nvar LOW_PRIORITY = 500;\n\n\n/**\n * A service that allows users to attach overlays to diagram elements.\n *\n * The overlay service will take care of overlay positioning during updates.\n *\n * @example\n *\n * // add a pink badge on the top left of the shape\n * overlays.add(someShape, {\n *   position: {\n *     top: -5,\n *     left: -5\n *   },\n *   html: '<div style=\"width: 10px; background: fuchsia; color: white;\">0</div>'\n * });\n *\n * // or add via shape id\n *\n * overlays.add('some-element-id', {\n *   position: {\n *     top: -5,\n *     left: -5\n *   }\n *   html: '<div style=\"width: 10px; background: fuchsia; color: white;\">0</div>'\n * });\n *\n * // or add with optional type\n *\n * overlays.add(someShape, 'badge', {\n *   position: {\n *     top: -5,\n *     left: -5\n *   }\n *   html: '<div style=\"width: 10px; background: fuchsia; color: white;\">0</div>'\n * });\n *\n *\n * // remove an overlay\n *\n * var id = overlays.add(...);\n * overlays.remove(id);\n *\n *\n * You may configure overlay defaults during tool by providing a `config` module\n * with `overlays.defaults` as an entry:\n *\n * {\n *   overlays: {\n *     defaults: {\n *       show: {\n *         minZoom: 0.7,\n *         maxZoom: 5.0\n *       },\n *       scale: {\n *         min: 1\n *       }\n *     }\n * }\n *\n * @param {Object} config\n * @param {EventBus} eventBus\n * @param {Canvas} canvas\n * @param {ElementRegistry} elementRegistry\n */\nexport default function Overlays(config, eventBus, canvas, elementRegistry) {\n\n  this._eventBus = eventBus;\n  this._canvas = canvas;\n  this._elementRegistry = elementRegistry;\n\n  this._ids = ids;\n\n  this._overlayDefaults = assign({\n\n    // no show constraints\n    show: null,\n\n    // always scale\n    scale: true\n  }, config && config.defaults);\n\n  /**\n   * Mapping overlayId -> overlay\n   */\n  this._overlays = {};\n\n  /**\n   * Mapping elementId -> overlay container\n   */\n  this._overlayContainers = [];\n\n  // root html element for all overlays\n  this._overlayRoot = createRoot(canvas.getContainer());\n\n  this._init();\n}\n\n\nOverlays.$inject = [\n  'config.overlays',\n  'eventBus',\n  'canvas',\n  'elementRegistry'\n];\n\n\n/**\n * Returns the overlay with the specified id or a list of overlays\n * for an element with a given type.\n *\n * @example\n *\n * // return the single overlay with the given id\n * overlays.get('some-id');\n *\n * // return all overlays for the shape\n * overlays.get({ element: someShape });\n *\n * // return all overlays on shape with type 'badge'\n * overlays.get({ element: someShape, type: 'badge' });\n *\n * // shape can also be specified as id\n * overlays.get({ element: 'element-id', type: 'badge' });\n *\n *\n * @param {Object} search\n * @param {string} [search.id]\n * @param {string|djs.model.Base} [search.element]\n * @param {string} [search.type]\n *\n * @return {Object|Array<Object>} the overlay(s)\n */\nOverlays.prototype.get = function(search) {\n\n  if (isString(search)) {\n    search = { id: search };\n  }\n\n  if (isString(search.element)) {\n    search.element = this._elementRegistry.get(search.element);\n  }\n\n  if (search.element) {\n    var container = this._getOverlayContainer(search.element, true);\n\n    // return a list of overlays when searching by element (+type)\n    if (container) {\n      return search.type ? filter(container.overlays, matchPattern({ type: search.type })) : container.overlays.slice();\n    } else {\n      return [];\n    }\n  } else\n  if (search.type) {\n    return filter(this._overlays, matchPattern({ type: search.type }));\n  } else {\n\n    // return single element when searching by id\n    return search.id ? this._overlays[search.id] : null;\n  }\n};\n\n/**\n * Adds a HTML overlay to an element.\n *\n * @param {string|djs.model.Base}   element   attach overlay to this shape\n * @param {string}                  [type]    optional type to assign to the overlay\n * @param {Object}                  overlay   the overlay configuration\n *\n * @param {string|DOMElement}       overlay.html                 html element to use as an overlay\n * @param {Object}                  [overlay.show]               show configuration\n * @param {number}                  [overlay.show.minZoom]       minimal zoom level to show the overlay\n * @param {number}                  [overlay.show.maxZoom]       maximum zoom level to show the overlay\n * @param {Object}                  overlay.position             where to attach the overlay\n * @param {number}                  [overlay.position.left]      relative to element bbox left attachment\n * @param {number}                  [overlay.position.top]       relative to element bbox top attachment\n * @param {number}                  [overlay.position.bottom]    relative to element bbox bottom attachment\n * @param {number}                  [overlay.position.right]     relative to element bbox right attachment\n * @param {boolean|Object}          [overlay.scale=true]         false to preserve the same size regardless of\n *                                                               diagram zoom\n * @param {number}                  [overlay.scale.min]\n * @param {number}                  [overlay.scale.max]\n *\n * @return {string}                 id that may be used to reference the overlay for update or removal\n */\nOverlays.prototype.add = function(element, type, overlay) {\n\n  if (isObject(type)) {\n    overlay = type;\n    type = null;\n  }\n\n  if (!element.id) {\n    element = this._elementRegistry.get(element);\n  }\n\n  if (!overlay.position) {\n    throw new Error('must specifiy overlay position');\n  }\n\n  if (!overlay.html) {\n    throw new Error('must specifiy overlay html');\n  }\n\n  if (!element) {\n    throw new Error('invalid element specified');\n  }\n\n  var id = this._ids.next();\n\n  overlay = assign({}, this._overlayDefaults, overlay, {\n    id: id,\n    type: type,\n    element: element,\n    html: overlay.html\n  });\n\n  this._addOverlay(overlay);\n\n  return id;\n};\n\n\n/**\n * Remove an overlay with the given id or all overlays matching the given filter.\n *\n * @see Overlays#get for filter options.\n *\n * @param {string} [id]\n * @param {Object} [filter]\n */\nOverlays.prototype.remove = function(filter) {\n\n  var overlays = this.get(filter) || [];\n\n  if (!isArray(overlays)) {\n    overlays = [ overlays ];\n  }\n\n  var self = this;\n\n  forEach(overlays, function(overlay) {\n\n    var container = self._getOverlayContainer(overlay.element, true);\n\n    if (overlay) {\n      domRemove(overlay.html);\n      domRemove(overlay.htmlContainer);\n\n      delete overlay.htmlContainer;\n      delete overlay.element;\n\n      delete self._overlays[overlay.id];\n    }\n\n    if (container) {\n      var idx = container.overlays.indexOf(overlay);\n      if (idx !== -1) {\n        container.overlays.splice(idx, 1);\n      }\n    }\n  });\n\n};\n\n\nOverlays.prototype.show = function() {\n  setVisible(this._overlayRoot);\n};\n\n\nOverlays.prototype.hide = function() {\n  setVisible(this._overlayRoot, false);\n};\n\nOverlays.prototype.clear = function() {\n  this._overlays = {};\n\n  this._overlayContainers = [];\n\n  domClear(this._overlayRoot);\n};\n\nOverlays.prototype._updateOverlayContainer = function(container) {\n  var element = container.element,\n      html = container.html;\n\n  // update container left,top according to the elements x,y coordinates\n  // this ensures we can attach child elements relative to this container\n\n  var x = element.x,\n      y = element.y;\n\n  if (element.waypoints) {\n    var bbox = getBBox(element);\n    x = bbox.x;\n    y = bbox.y;\n  }\n\n  setPosition(html, x, y);\n\n  domAttr(container.html, 'data-container-id', element.id);\n};\n\n\nOverlays.prototype._updateOverlay = function(overlay) {\n\n  var position = overlay.position,\n      htmlContainer = overlay.htmlContainer,\n      element = overlay.element;\n\n  // update overlay html relative to shape because\n  // it is already positioned on the element\n\n  // update relative\n  var left = position.left,\n      top = position.top;\n\n  if (position.right !== undefined) {\n\n    var width;\n\n    if (element.waypoints) {\n      width = getBBox(element).width;\n    } else {\n      width = element.width;\n    }\n\n    left = position.right * -1 + width;\n  }\n\n  if (position.bottom !== undefined) {\n\n    var height;\n\n    if (element.waypoints) {\n      height = getBBox(element).height;\n    } else {\n      height = element.height;\n    }\n\n    top = position.bottom * -1 + height;\n  }\n\n  setPosition(htmlContainer, left || 0, top || 0);\n};\n\n\nOverlays.prototype._createOverlayContainer = function(element) {\n  var html = domify('<div class=\"djs-overlays\" style=\"position: absolute\" />');\n\n  this._overlayRoot.appendChild(html);\n\n  var container = {\n    html: html,\n    element: element,\n    overlays: []\n  };\n\n  this._updateOverlayContainer(container);\n\n  this._overlayContainers.push(container);\n\n  return container;\n};\n\n\nOverlays.prototype._updateRoot = function(viewbox) {\n  var scale = viewbox.scale || 1;\n\n  var matrix = 'matrix(' +\n  [\n    scale,\n    0,\n    0,\n    scale,\n    -1 * viewbox.x * scale,\n    -1 * viewbox.y * scale\n  ].join(',') +\n  ')';\n\n  setTransform(this._overlayRoot, matrix);\n};\n\n\nOverlays.prototype._getOverlayContainer = function(element, raw) {\n  var container = find(this._overlayContainers, function(c) {\n    return c.element === element;\n  });\n\n\n  if (!container && !raw) {\n    return this._createOverlayContainer(element);\n  }\n\n  return container;\n};\n\n\nOverlays.prototype._addOverlay = function(overlay) {\n\n  var id = overlay.id,\n      element = overlay.element,\n      html = overlay.html,\n      htmlContainer,\n      overlayContainer;\n\n  // unwrap jquery (for those who need it)\n  if (html.get && html.constructor.prototype.jquery) {\n    html = html.get(0);\n  }\n\n  // create proper html elements from\n  // overlay HTML strings\n  if (isString(html)) {\n    html = domify(html);\n  }\n\n  overlayContainer = this._getOverlayContainer(element);\n\n  htmlContainer = domify('<div class=\"djs-overlay\" data-overlay-id=\"' + id + '\" style=\"position: absolute\">');\n\n  htmlContainer.appendChild(html);\n\n  if (overlay.type) {\n    domClasses(htmlContainer).add('djs-overlay-' + overlay.type);\n  }\n\n  overlay.htmlContainer = htmlContainer;\n\n  overlayContainer.overlays.push(overlay);\n  overlayContainer.html.appendChild(htmlContainer);\n\n  this._overlays[id] = overlay;\n\n  this._updateOverlay(overlay);\n  this._updateOverlayVisibilty(overlay, this._canvas.viewbox());\n};\n\n\nOverlays.prototype._updateOverlayVisibilty = function(overlay, viewbox) {\n  var show = overlay.show,\n      minZoom = show && show.minZoom,\n      maxZoom = show && show.maxZoom,\n      htmlContainer = overlay.htmlContainer,\n      visible = true;\n\n  if (show) {\n    if (\n      (isDefined(minZoom) && minZoom > viewbox.scale) ||\n      (isDefined(maxZoom) && maxZoom < viewbox.scale)\n    ) {\n      visible = false;\n    }\n\n    setVisible(htmlContainer, visible);\n  }\n\n  this._updateOverlayScale(overlay, viewbox);\n};\n\n\nOverlays.prototype._updateOverlayScale = function(overlay, viewbox) {\n  var shouldScale = overlay.scale,\n      minScale,\n      maxScale,\n      htmlContainer = overlay.htmlContainer;\n\n  var scale, transform = '';\n\n  if (shouldScale !== true) {\n\n    if (shouldScale === false) {\n      minScale = 1;\n      maxScale = 1;\n    } else {\n      minScale = shouldScale.min;\n      maxScale = shouldScale.max;\n    }\n\n    if (isDefined(minScale) && viewbox.scale < minScale) {\n      scale = (1 / viewbox.scale || 1) * minScale;\n    }\n\n    if (isDefined(maxScale) && viewbox.scale > maxScale) {\n      scale = (1 / viewbox.scale || 1) * maxScale;\n    }\n  }\n\n  if (isDefined(scale)) {\n    transform = 'scale(' + scale + ',' + scale + ')';\n  }\n\n  setTransform(htmlContainer, transform);\n};\n\n\nOverlays.prototype._updateOverlaysVisibilty = function(viewbox) {\n\n  var self = this;\n\n  forEach(this._overlays, function(overlay) {\n    self._updateOverlayVisibilty(overlay, viewbox);\n  });\n};\n\n\nOverlays.prototype._init = function() {\n\n  var eventBus = this._eventBus;\n\n  var self = this;\n\n\n  // scroll/zoom integration\n\n  function updateViewbox(viewbox) {\n    self._updateRoot(viewbox);\n    self._updateOverlaysVisibilty(viewbox);\n\n    self.show();\n  }\n\n  eventBus.on('canvas.viewbox.changing', function(event) {\n    self.hide();\n  });\n\n  eventBus.on('canvas.viewbox.changed', function(event) {\n    updateViewbox(event.viewbox);\n  });\n\n\n  // remove integration\n\n  eventBus.on([ 'shape.remove', 'connection.remove' ], function(e) {\n    var element = e.element;\n    var overlays = self.get({ element: element });\n\n    forEach(overlays, function(o) {\n      self.remove(o.id);\n    });\n\n    var container = self._getOverlayContainer(element);\n\n    if (container) {\n      domRemove(container.html);\n      var i = self._overlayContainers.indexOf(container);\n      if (i !== -1) {\n        self._overlayContainers.splice(i, 1);\n      }\n    }\n  });\n\n\n  // move integration\n\n  eventBus.on('element.changed', LOW_PRIORITY, function(e) {\n    var element = e.element;\n\n    var container = self._getOverlayContainer(element, true);\n\n    if (container) {\n      forEach(container.overlays, function(overlay) {\n        self._updateOverlay(overlay);\n      });\n\n      self._updateOverlayContainer(container);\n    }\n  });\n\n\n  // marker integration, simply add them on the overlays as classes, too.\n\n  eventBus.on('element.marker.update', function(e) {\n    var container = self._getOverlayContainer(e.element, true);\n    if (container) {\n      domClasses(container.html)[e.add ? 'add' : 'remove'](e.marker);\n    }\n  });\n\n\n  // clear overlays with diagram\n\n  eventBus.on('diagram.clear', this.clear, this);\n};\n\n\n\n// helpers /////////////////////////////\n\nfunction createRoot(parentNode) {\n  var root = domify(\n    '<div class=\"djs-overlay-container\" style=\"position: absolute; width: 0; height: 0;\" />'\n  );\n\n  parentNode.insertBefore(root, parentNode.firstChild);\n\n  return root;\n}\n\nfunction setPosition(el, x, y) {\n  assign(el.style, { left: x + 'px', top: y + 'px' });\n}\n\nfunction setVisible(el, visible) {\n  el.style.display = visible === false ? 'none' : '';\n}\n\nfunction setTransform(el, transform) {\n\n  el.style['transform-origin'] = 'top left';\n\n  [ '', '-ms-', '-webkit-' ].forEach(function(prefix) {\n    el.style[prefix + 'transform'] = transform;\n  });\n}","import Overlays from './Overlays';\n\nexport default {\n  __init__: [ 'overlays' ],\n  overlays: [ 'type', Overlays ]\n};","import inherits from 'inherits';\n\nimport CoreModule from './core';\nimport TranslateModule from 'diagram-js/lib/i18n/translate';\nimport SelectionModule from 'diagram-js/lib/features/selection';\nimport OverlaysModule from 'diagram-js/lib/features/overlays';\n\nimport BaseViewer from './BaseViewer';\n\nexport default function Viewer(options) {\n  BaseViewer.call(this, options);\n}\n\ninherits(Viewer, BaseViewer);\n\n// modules the viewer is composed of\nViewer.prototype._modules = [\n  CoreModule,\n  TranslateModule,\n  SelectionModule,\n  OverlaysModule\n];\n\n// default moddle extensions the viewer is composed of\nViewer.prototype._moddleExtensions = {};","import { isArray } from 'min-dash';\r\n\r\n/**\r\n * Returns true if event was triggered with any modifier\r\n * @param {KeyboardEvent} event\r\n */\r\nexport function hasModifier(event) {\r\n  return (event.ctrlKey || event.metaKey || event.shiftKey || event.altKey);\r\n}\r\n\r\n/**\r\n * @param {KeyboardEvent} event\r\n */\r\nexport function isCmd(event) {\r\n\r\n  // ensure we don't react to AltGr\r\n  // (mapped to CTRL + ALT)\r\n  if (event.altKey) {\r\n    return false;\r\n  }\r\n\r\n  return event.ctrlKey || event.metaKey;\r\n}\r\n\r\n/**\r\n * Checks if key pressed is one of provided keys.\r\n *\r\n * @param {string|Array<string>} keys\r\n * @param {KeyboardEvent} event\r\n */\r\nexport function isKey(keys, event) {\r\n  keys = isArray(keys) ? keys : [ keys ];\r\n\r\n  return keys.indexOf(event.key) !== -1 || keys.indexOf(event.keyCode) !== -1;\r\n}\r\n\r\n/**\r\n * @param {KeyboardEvent} event\r\n */\r\nexport function isShift(event) {\r\n  return event.shiftKey;\r\n}","import {\n  isFunction\n} from 'min-dash';\n\nimport {\n  event as domEvent,\n  matches as domMatches\n} from 'min-dom';\n\nimport {\n  hasModifier,\n  isCmd,\n  isKey,\n  isShift\n} from './KeyboardUtil';\n\nvar KEYDOWN_EVENT = 'keyboard.keydown',\n    KEYUP_EVENT = 'keyboard.keyup';\n\nvar DEFAULT_PRIORITY = 1000;\n\n\n/**\n * A keyboard abstraction that may be activated and\n * deactivated by users at will, consuming key events\n * and triggering diagram actions.\n *\n * For keys pressed down, keyboard fires `keyboard.keydown` event.\n * The event context contains one field which is `KeyboardEvent` event.\n *\n * The implementation fires the following key events that allow\n * other components to hook into key handling:\n *\n *  - keyboard.bind\n *  - keyboard.unbind\n *  - keyboard.init\n *  - keyboard.destroy\n *\n * All events contain one field which is node.\n *\n * A default binding for the keyboard may be specified via the\n * `keyboard.bindTo` configuration option.\n *\n * @param {Config} config\n * @param {EventBus} eventBus\n */\nexport default function Keyboard(config, eventBus) {\n  var self = this;\n\n  this._config = config || {};\n  this._eventBus = eventBus;\n\n  this._keydownHandler = this._keydownHandler.bind(this);\n  this._keyupHandler = this._keyupHandler.bind(this);\n\n  // properly clean dom registrations\n  eventBus.on('diagram.destroy', function() {\n    self._fire('destroy');\n\n    self.unbind();\n  });\n\n  eventBus.on('diagram.init', function() {\n    self._fire('init');\n  });\n\n  eventBus.on('attach', function() {\n    if (config && config.bindTo) {\n      self.bind(config.bindTo);\n    }\n  });\n\n  eventBus.on('detach', function() {\n    self.unbind();\n  });\n}\n\nKeyboard.$inject = [\n  'config.keyboard',\n  'eventBus'\n];\n\nKeyboard.prototype._keydownHandler = function(event) {\n  this._keyHandler(event, KEYDOWN_EVENT);\n};\n\nKeyboard.prototype._keyupHandler = function(event) {\n  this._keyHandler(event, KEYUP_EVENT);\n};\n\nKeyboard.prototype._keyHandler = function(event, type) {\n  var target = event.target,\n      eventBusResult;\n\n  if (isInput(target)) {\n    return;\n  }\n\n  var context = {\n    keyEvent: event\n  };\n\n  eventBusResult = this._eventBus.fire(type || KEYDOWN_EVENT, context);\n\n  if (eventBusResult) {\n    event.preventDefault();\n  }\n};\n\nKeyboard.prototype.bind = function(node) {\n\n  // make sure that the keyboard is only bound once to the DOM\n  this.unbind();\n\n  this._node = node;\n\n  // bind key events\n  domEvent.bind(node, 'keydown', this._keydownHandler, true);\n  domEvent.bind(node, 'keyup', this._keyupHandler, true);\n\n  this._fire('bind');\n};\n\nKeyboard.prototype.getBinding = function() {\n  return this._node;\n};\n\nKeyboard.prototype.unbind = function() {\n  var node = this._node;\n\n  if (node) {\n    this._fire('unbind');\n\n    // unbind key events\n    domEvent.unbind(node, 'keydown', this._keydownHandler, true);\n    domEvent.unbind(node, 'keyup', this._keyupHandler, true);\n  }\n\n  this._node = null;\n};\n\nKeyboard.prototype._fire = function(event) {\n  this._eventBus.fire('keyboard.' + event, { node: this._node });\n};\n\n/**\n * Add a listener function that is notified with `KeyboardEvent` whenever\n * the keyboard is bound and the user presses a key. If no priority is\n * provided, the default value of 1000 is used.\n *\n * @param {number} [priority]\n * @param {Function} listener\n * @param {string} type\n */\nKeyboard.prototype.addListener = function(priority, listener, type) {\n  if (isFunction(priority)) {\n    type = listener;\n    listener = priority;\n    priority = DEFAULT_PRIORITY;\n  }\n\n  this._eventBus.on(type || KEYDOWN_EVENT, priority, listener);\n};\n\nKeyboard.prototype.removeListener = function(listener, type) {\n  this._eventBus.off(type || KEYDOWN_EVENT, listener);\n};\n\nKeyboard.prototype.hasModifier = hasModifier;\nKeyboard.prototype.isCmd = isCmd;\nKeyboard.prototype.isShift = isShift;\nKeyboard.prototype.isKey = isKey;\n\n\n\n// helpers ///////\n\nfunction isInput(target) {\n  return target && (domMatches(target, 'input, textarea') || target.contentEditable === 'true');\n}\n","import {\n  isCmd,\n  isKey,\n  isShift\n} from './KeyboardUtil';\n\nvar LOW_PRIORITY = 500;\n\nexport var KEYCODE_C = 67;\nexport var KEYCODE_V = 86;\nexport var KEYCODE_Y = 89;\nexport var KEYCODE_Z = 90;\n\nexport var KEYS_COPY = ['c', 'C', KEYCODE_C ];\nexport var KEYS_PASTE = [ 'v', 'V', KEYCODE_V ];\nexport var KEYS_REDO = [ 'y', 'Y', KEYCODE_Y ];\nexport var KEYS_UNDO = [ 'z', 'Z', KEYCODE_Z ];\n\n\n/**\n * Adds default keyboard bindings.\n *\n * This does not pull in any features will bind only actions that\n * have previously been registered against the editorActions component.\n *\n * @param {EventBus} eventBus\n * @param {Keyboard} keyboard\n */\nexport default function KeyboardBindings(eventBus, keyboard) {\n\n  var self = this;\n\n  eventBus.on('editorActions.init', LOW_PRIORITY, function(event) {\n\n    var editorActions = event.editorActions;\n\n    self.registerBindings(keyboard, editorActions);\n  });\n}\n\nKeyboardBindings.$inject = [\n  'eventBus',\n  'keyboard'\n];\n\n\n/**\n * Register available keyboard bindings.\n *\n * @param {Keyboard} keyboard\n * @param {EditorActions} editorActions\n */\nKeyboardBindings.prototype.registerBindings = function(keyboard, editorActions) {\n\n  /**\n   * Add keyboard binding if respective editor action\n   * is registered.\n   *\n   * @param {string} action name\n   * @param {Function} fn that implements the key binding\n   */\n  function addListener(action, fn) {\n\n    if (editorActions.isRegistered(action)) {\n      keyboard.addListener(fn);\n    }\n  }\n\n\n  // undo\n  // (CTRL|CMD) + Z\n  addListener('undo', function(context) {\n\n    var event = context.keyEvent;\n\n    if (isCmd(event) && !isShift(event) && isKey(KEYS_UNDO, event)) {\n      editorActions.trigger('undo');\n\n      return true;\n    }\n  });\n\n  // redo\n  // CTRL + Y\n  // CMD + SHIFT + Z\n  addListener('redo', function(context) {\n\n    var event = context.keyEvent;\n\n    if (isCmd(event) && (isKey(KEYS_REDO, event) || (isKey(KEYS_UNDO, event) && isShift(event)))) {\n      editorActions.trigger('redo');\n\n      return true;\n    }\n  });\n\n  // copy\n  // CTRL/CMD + C\n  addListener('copy', function(context) {\n\n    var event = context.keyEvent;\n\n    if (isCmd(event) && isKey(KEYS_COPY, event)) {\n      editorActions.trigger('copy');\n\n      return true;\n    }\n  });\n\n  // paste\n  // CTRL/CMD + V\n  addListener('paste', function(context) {\n\n    var event = context.keyEvent;\n\n    if (isCmd(event) && isKey(KEYS_PASTE, event)) {\n      editorActions.trigger('paste');\n\n      return true;\n    }\n  });\n\n  // zoom in one step\n  // CTRL/CMD + +\n  addListener('stepZoom', function(context) {\n\n    var event = context.keyEvent;\n\n    // quirk: it has to be triggered by `=` as well to work on international keyboard layout\n    // cf: https://github.com/bpmn-io/bpmn-js/issues/1362#issuecomment-722989754\n    if (isKey([ '+', 'Add', '=' ], event) && isCmd(event)) {\n      editorActions.trigger('stepZoom', { value: 1 });\n\n      return true;\n    }\n  });\n\n  // zoom out one step\n  // CTRL + -\n  addListener('stepZoom', function(context) {\n\n    var event = context.keyEvent;\n\n    if (isKey([ '-', 'Subtract' ], event) && isCmd(event)) {\n      editorActions.trigger('stepZoom', { value: -1 });\n\n      return true;\n    }\n  });\n\n  // zoom to the default level\n  // CTRL + 0\n  addListener('zoom', function(context) {\n\n    var event = context.keyEvent;\n\n    if (isKey('0', event) && isCmd(event)) {\n      editorActions.trigger('zoom', { value: 1 });\n\n      return true;\n    }\n  });\n\n  // delete selected element\n  // DEL\n  addListener('removeSelection', function(context) {\n\n    var event = context.keyEvent;\n\n    if (isKey(['Backspace', 'Delete', 'Del' ], event)) {\n      editorActions.trigger('removeSelection');\n\n      return true;\n    }\n  });\n};","import Keyboard from './Keyboard';\nimport KeyboardBindings from './KeyboardBindings';\n\nexport default {\n  __init__: [ 'keyboard', 'keyboardBindings' ],\n  keyboard: [ 'type', Keyboard ],\n  keyboardBindings: [ 'type', KeyboardBindings ]\n};\n","import { assign } from 'min-dash';\n\n\nvar DEFAULT_CONFIG = {\n  moveSpeed: 50,\n  moveSpeedAccelerated: 200\n};\n\n\n/**\n * A feature that allows users to move the canvas using the keyboard.\n *\n * @param {Object} config\n * @param {number} [config.moveSpeed=50]\n * @param {number} [config.moveSpeedAccelerated=200]\n * @param {Keyboard} keyboard\n * @param {Canvas} canvas\n */\nexport default function KeyboardMove(\n    config,\n    keyboard,\n    canvas\n) {\n\n  var self = this;\n\n  this._config = assign({}, DEFAULT_CONFIG, config || {});\n\n  keyboard.addListener(arrowsListener);\n\n\n  function arrowsListener(context) {\n\n    var event = context.keyEvent,\n        config = self._config;\n\n    if (!keyboard.isCmd(event)) {\n      return;\n    }\n\n    if (keyboard.isKey([\n      'ArrowLeft', 'Left',\n      'ArrowUp', 'Up',\n      'ArrowDown', 'Down',\n      'ArrowRight', 'Right'\n    ], event)) {\n\n      var speed = (\n        keyboard.isShift(event) ?\n          config.moveSpeedAccelerated :\n          config.moveSpeed\n      );\n\n      var direction;\n\n      switch (event.key) {\n      case 'ArrowLeft':\n      case 'Left':\n        direction = 'left';\n        break;\n      case 'ArrowUp':\n      case 'Up':\n        direction = 'up';\n        break;\n      case 'ArrowRight':\n      case 'Right':\n        direction = 'right';\n        break;\n      case 'ArrowDown':\n      case 'Down':\n        direction = 'down';\n        break;\n      }\n\n      self.moveCanvas({\n        speed: speed,\n        direction: direction\n      });\n\n      return true;\n    }\n  }\n\n  this.moveCanvas = function(opts) {\n\n    var dx = 0,\n        dy = 0,\n        speed = opts.speed;\n\n    var actualSpeed = speed / Math.min(Math.sqrt(canvas.viewbox().scale), 1);\n\n    switch (opts.direction) {\n    case 'left': // Left\n      dx = actualSpeed;\n      break;\n    case 'up': // Up\n      dy = actualSpeed;\n      break;\n    case 'right': // Right\n      dx = -actualSpeed;\n      break;\n    case 'down': // Down\n      dy = -actualSpeed;\n      break;\n    }\n\n    canvas.scroll({\n      dx: dx,\n      dy: dy\n    });\n  };\n\n}\n\n\nKeyboardMove.$inject = [\n  'config.keyboardMove',\n  'keyboard',\n  'canvas'\n];\n","import KeyboardModule from '../../features/keyboard';\n\nimport KeyboardMove from './KeyboardMove';\n\n\nexport default {\n  __depends__: [\n    KeyboardModule\n  ],\n  __init__: [ 'keyboardMove' ],\n  keyboardMove: [ 'type', KeyboardMove ]\n};","import {\n  classes as domClasses\n} from 'min-dom';\n\nvar CURSOR_CLS_PATTERN = /^djs-cursor-.*$/;\n\n\nexport function set(mode) {\n  var classes = domClasses(document.body);\n\n  classes.removeMatching(CURSOR_CLS_PATTERN);\n\n  if (mode) {\n    classes.add('djs-cursor-' + mode);\n  }\n}\n\nexport function unset() {\n  set(null);\n}\n\nexport function has(mode) {\n  var classes = domClasses(document.body);\n\n  return classes.has('djs-cursor-' + mode);\n}\n","var TRAP_PRIORITY = 5000;\n\n/**\n * Installs a click trap that prevents a ghost click following a dragging operation.\n *\n * @return {Function} a function to immediately remove the installed trap.\n */\nexport function install(eventBus, eventName) {\n\n  eventName = eventName || 'element.click';\n\n  function trap() {\n    return false;\n  }\n\n  eventBus.once(eventName, TRAP_PRIORITY, trap);\n\n  return function() {\n    eventBus.off(eventName, trap);\n  };\n}","export function center(bounds) {\n  return {\n    x: bounds.x + (bounds.width / 2),\n    y: bounds.y + (bounds.height / 2)\n  };\n}\n\n\nexport function delta(a, b) {\n  return {\n    x: a.x - b.x,\n    y: a.y - b.y\n  };\n}","import {\n  set as cursorSet,\n  unset as cursorUnset\n} from '../../util/Cursor';\n\nimport {\n  install as installClickTrap\n} from '../../util/ClickTrap';\n\nimport {\n  delta as deltaPos\n} from '../../util/PositionUtil';\n\nimport {\n  event as domEvent,\n  closest as domClosest\n} from 'min-dom';\n\nimport {\n  toPoint\n} from '../../util/Event';\n\n\nvar THRESHOLD = 15;\n\n\n/**\n * Move the canvas via mouse.\n *\n * @param {EventBus} eventBus\n * @param {Canvas} canvas\n */\nexport default function MoveCanvas(eventBus, canvas) {\n\n  var context;\n\n\n  // listen for move on element mouse down;\n  // allow others to hook into the event before us though\n  // (dragging / element moving will do this)\n  eventBus.on('element.mousedown', 500, function(e) {\n    return handleStart(e.originalEvent);\n  });\n\n\n  function handleMove(event) {\n\n    var start = context.start,\n        button = context.button,\n        position = toPoint(event),\n        delta = deltaPos(position, start);\n\n    if (!context.dragging && length(delta) > THRESHOLD) {\n      context.dragging = true;\n\n      if (button === 0) {\n        installClickTrap(eventBus);\n      }\n\n      cursorSet('grab');\n    }\n\n    if (context.dragging) {\n\n      var lastPosition = context.last || context.start;\n\n      delta = deltaPos(position, lastPosition);\n\n      canvas.scroll({\n        dx: delta.x,\n        dy: delta.y\n      });\n\n      context.last = position;\n    }\n\n    // prevent select\n    event.preventDefault();\n  }\n\n\n  function handleEnd(event) {\n    domEvent.unbind(document, 'mousemove', handleMove);\n    domEvent.unbind(document, 'mouseup', handleEnd);\n\n    context = null;\n\n    cursorUnset();\n  }\n\n  function handleStart(event) {\n\n    // event is already handled by '.djs-draggable'\n    if (domClosest(event.target, '.djs-draggable')) {\n      return;\n    }\n\n    var button = event.button;\n\n    // reject right mouse button or modifier key\n    if (button >= 2 || event.ctrlKey || event.shiftKey || event.altKey) {\n      return;\n    }\n\n    context = {\n      button: button,\n      start: toPoint(event)\n    };\n\n    domEvent.bind(document, 'mousemove', handleMove);\n    domEvent.bind(document, 'mouseup', handleEnd);\n\n    // we've handled the event\n    return true;\n  }\n\n  this.isActive = function() {\n    return !!context;\n  };\n\n}\n\n\nMoveCanvas.$inject = [\n  'eventBus',\n  'canvas'\n];\n\n\n\n// helpers ///////\n\nfunction length(point) {\n  return Math.sqrt(Math.pow(point.x, 2) + Math.pow(point.y, 2));\n}\n","import MoveCanvas from './MoveCanvas';\n\nexport default {\n  __init__: [ 'moveCanvas' ],\n  moveCanvas: [ 'type', MoveCanvas ]\n};","/**\n * Get the logarithm of x with base 10\n * @param  {Integer} value\n */\nexport function log10(x) {\n  return Math.log(x) / Math.log(10);\n}\n\nexport { delta as substract } from './PositionUtil';\n","import {\n  log10\n} from '../../util/Math';\n\n/**\n * Get step size for given range and number of steps.\n *\n * @param {Object} range\n * @param {number} range.min\n * @param {number} range.max\n */\nexport function getStepSize(range, steps) {\n\n  var minLinearRange = log10(range.min),\n      maxLinearRange = log10(range.max);\n\n  var absoluteLinearRange = Math.abs(minLinearRange) + Math.abs(maxLinearRange);\n\n  return absoluteLinearRange / steps;\n}\n\nexport function cap(range, scale) {\n  return Math.max(range.min, Math.min(range.max, scale));\n}\n","import {\n  event as domEvent,\n  closest as domClosest\n} from 'min-dom';\n\nimport {\n  getStepSize,\n  cap\n} from './ZoomUtil';\n\nimport {\n  log10\n} from '../../util/Math';\n\nimport {\n  bind\n} from 'min-dash';\n\nvar sign = Math.sign || function(n) {\n  return n >= 0 ? 1 : -1;\n};\n\nvar RANGE = { min: 0.2, max: 4 },\n    NUM_STEPS = 10;\n\nvar DELTA_THRESHOLD = 0.1;\n\nvar DEFAULT_SCALE = 0.75;\n\n/**\n * An implementation of zooming and scrolling within the\n * {@link Canvas} via the mouse wheel.\n *\n * Mouse wheel zooming / scrolling may be disabled using\n * the {@link toggle(enabled)} method.\n *\n * @param {Object} [config]\n * @param {boolean} [config.enabled=true] default enabled state\n * @param {number} [config.scale=.75] scroll sensivity\n * @param {EventBus} eventBus\n * @param {Canvas} canvas\n */\nexport default function ZoomScroll(config, eventBus, canvas) {\n\n  config = config || {};\n\n  this._enabled = false;\n\n  this._canvas = canvas;\n  this._container = canvas._container;\n\n  this._handleWheel = bind(this._handleWheel, this);\n\n  this._totalDelta = 0;\n  this._scale = config.scale || DEFAULT_SCALE;\n\n  var self = this;\n\n  eventBus.on('canvas.init', function(e) {\n    self._init(config.enabled !== false);\n  });\n}\n\nZoomScroll.$inject = [\n  'config.zoomScroll',\n  'eventBus',\n  'canvas'\n];\n\nZoomScroll.prototype.scroll = function scroll(delta) {\n  this._canvas.scroll(delta);\n};\n\n\nZoomScroll.prototype.reset = function reset() {\n  this._canvas.zoom('fit-viewport');\n};\n\n/**\n * Zoom depending on delta.\n *\n * @param {number} delta\n * @param {Object} position\n */\nZoomScroll.prototype.zoom = function zoom(delta, position) {\n\n  // zoom with half the step size of stepZoom\n  var stepSize = getStepSize(RANGE, NUM_STEPS * 2);\n\n  // add until threshold reached\n  this._totalDelta += delta;\n\n  if (Math.abs(this._totalDelta) > DELTA_THRESHOLD) {\n    this._zoom(delta, position, stepSize);\n\n    // reset\n    this._totalDelta = 0;\n  }\n};\n\n\nZoomScroll.prototype._handleWheel = function handleWheel(event) {\n\n  // event is already handled by '.djs-scrollable'\n  if (domClosest(event.target, '.djs-scrollable', true)) {\n    return;\n  }\n\n  var element = this._container;\n\n  event.preventDefault();\n\n  // pinch to zoom is mapped to wheel + ctrlKey = true\n  // in modern browsers (!)\n\n  var isZoom = event.ctrlKey;\n\n  var isHorizontalScroll = event.shiftKey;\n\n  var factor = -1 * this._scale,\n      delta;\n\n  if (isZoom) {\n    factor *= event.deltaMode === 0 ? 0.020 : 0.32;\n  } else {\n    factor *= event.deltaMode === 0 ? 1.0 : 16.0;\n  }\n\n  if (isZoom) {\n    var elementRect = element.getBoundingClientRect();\n\n    var offset = {\n      x: event.clientX - elementRect.left,\n      y: event.clientY - elementRect.top\n    };\n\n    delta = (\n      Math.sqrt(\n        Math.pow(event.deltaY, 2) +\n        Math.pow(event.deltaX, 2)\n      ) * sign(event.deltaY) * factor\n    );\n\n    // zoom in relative to diagram {x,y} coordinates\n    this.zoom(delta, offset);\n  } else {\n\n    if (isHorizontalScroll) {\n      delta = {\n        dx: factor * event.deltaY,\n        dy: 0\n      };\n    } else {\n      delta = {\n        dx: factor * event.deltaX,\n        dy: factor * event.deltaY\n      };\n    }\n\n    this.scroll(delta);\n  }\n};\n\n/**\n * Zoom with fixed step size.\n *\n * @param {number} delta - Zoom delta (1 for zooming in, -1 for out).\n * @param {Object} position\n */\nZoomScroll.prototype.stepZoom = function stepZoom(delta, position) {\n\n  var stepSize = getStepSize(RANGE, NUM_STEPS);\n\n  this._zoom(delta, position, stepSize);\n};\n\n\n/**\n * Zoom in/out given a step size.\n *\n * @param {number} delta\n * @param {Object} position\n * @param {number} stepSize\n */\nZoomScroll.prototype._zoom = function(delta, position, stepSize) {\n  var canvas = this._canvas;\n\n  var direction = delta > 0 ? 1 : -1;\n\n  var currentLinearZoomLevel = log10(canvas.zoom());\n\n  // snap to a proximate zoom step\n  var newLinearZoomLevel = Math.round(currentLinearZoomLevel / stepSize) * stepSize;\n\n  // increase or decrease one zoom step in the given direction\n  newLinearZoomLevel += stepSize * direction;\n\n  // calculate the absolute logarithmic zoom level based on the linear zoom level\n  // (e.g. 2 for an absolute x2 zoom)\n  var newLogZoomLevel = Math.pow(10, newLinearZoomLevel);\n\n  canvas.zoom(cap(RANGE, newLogZoomLevel), position);\n};\n\n\n/**\n * Toggle the zoom scroll ability via mouse wheel.\n *\n * @param  {boolean} [newEnabled] new enabled state\n */\nZoomScroll.prototype.toggle = function toggle(newEnabled) {\n\n  var element = this._container;\n  var handleWheel = this._handleWheel;\n\n  var oldEnabled = this._enabled;\n\n  if (typeof newEnabled === 'undefined') {\n    newEnabled = !oldEnabled;\n  }\n\n  // only react on actual changes\n  if (oldEnabled !== newEnabled) {\n\n    // add or remove wheel listener based on\n    // changed enabled state\n    domEvent[newEnabled ? 'bind' : 'unbind'](element, 'wheel', handleWheel, false);\n  }\n\n  this._enabled = newEnabled;\n\n  return newEnabled;\n};\n\n\nZoomScroll.prototype._init = function(newEnabled) {\n  this.toggle(newEnabled);\n};\n","import ZoomScroll from './ZoomScroll';\n\nexport default {\n  __init__: [ 'zoomScroll' ],\n  zoomScroll: [ 'type', ZoomScroll ]\n};","import inherits from 'inherits';\n\nimport Viewer from './Viewer';\n\nimport KeyboardMoveModule from 'diagram-js/lib/navigation/keyboard-move';\nimport MoveCanvasModule from 'diagram-js/lib/navigation/movecanvas';\nimport ZoomScrollModule from 'diagram-js/lib/navigation/zoomscroll';\n\n\n/**\n * A viewer that includes mouse navigation facilities\n *\n * @param {Object} options\n */\nexport default function NavigatedViewer(options) {\n  Viewer.call(this, options);\n}\n\ninherits(NavigatedViewer, Viewer);\n\n\nNavigatedViewer.prototype._navigationModules = [\n  KeyboardMoveModule,\n  MoveCanvasModule,\n  ZoomScrollModule\n];\n\nNavigatedViewer.prototype._modules = [].concat(\n  Viewer.prototype._modules,\n  NavigatedViewer.prototype._navigationModules\n);","import {\n  forEach\n} from 'min-dash';\n\nimport {\n  event as domEvent,\n  closest as domClosest\n} from 'min-dom';\n\nimport Hammer from 'hammerjs';\n\nimport {\n  toPoint\n} from '../../util/Event';\n\nvar MIN_ZOOM = 0.2,\n    MAX_ZOOM = 4;\n\nvar mouseEvents = [\n  'mousedown',\n  'mouseup',\n  'mouseover',\n  'mouseout',\n  'click',\n  'dblclick'\n];\n\nfunction log() {\n\n  // console.log.apply(console, arguments);\n}\n\nfunction get(service, injector) {\n  return injector.get(service, false);\n}\n\nfunction stopEvent(event) {\n\n  event.preventDefault();\n\n  if (typeof event.stopPropagation === 'function') {\n    event.stopPropagation();\n  } else if (event.srcEvent && typeof event.srcEvent.stopPropagation === 'function') {\n\n    // iPhone & iPad\n    event.srcEvent.stopPropagation();\n  }\n\n  if (typeof event.stopImmediatePropagation === 'function') {\n    event.stopImmediatePropagation();\n  }\n}\n\n\nfunction createTouchRecognizer(node) {\n\n  function stopMouse(event) {\n\n    forEach(mouseEvents, function(e) {\n      domEvent.bind(node, e, stopEvent, true);\n    });\n  }\n\n  function allowMouse(event) {\n    setTimeout(function() {\n      forEach(mouseEvents, function(e) {\n        domEvent.unbind(node, e, stopEvent, true);\n      });\n    }, 500);\n  }\n\n  domEvent.bind(node, 'touchstart', stopMouse, true);\n  domEvent.bind(node, 'touchend', allowMouse, true);\n  domEvent.bind(node, 'touchcancel', allowMouse, true);\n\n  // A touch event recognizer that handles\n  // touch events only (we know, we can already handle\n  // mouse events out of the box)\n\n  var recognizer = new Hammer.Manager(node, {\n    inputClass: Hammer.TouchInput,\n    recognizers: [],\n    domEvents: true\n  });\n\n\n  var tap = new Hammer.Tap();\n  var pan = new Hammer.Pan({ threshold: 10 });\n  var press = new Hammer.Press();\n  var pinch = new Hammer.Pinch();\n\n  var doubleTap = new Hammer.Tap({ event: 'doubletap', taps: 2 });\n\n  pinch.requireFailure(pan);\n  pinch.requireFailure(press);\n\n  recognizer.add([ pan, press, pinch, doubleTap, tap ]);\n\n  recognizer.reset = function(force) {\n    var recognizers = this.recognizers,\n        session = this.session;\n\n    if (session.stopped) {\n      return;\n    }\n\n    log('recognizer', 'stop');\n\n    recognizer.stop(force);\n\n    setTimeout(function() {\n      var i, r;\n\n      log('recognizer', 'reset');\n      for (i = 0; (r = recognizers[i]); i++) {\n        r.reset();\n        r.state = 8; // FAILED STATE\n      }\n\n      session.curRecognizer = null;\n    }, 0);\n  };\n\n  recognizer.on('hammer.input', function(event) {\n    if (event.srcEvent.defaultPrevented) {\n      recognizer.reset(true);\n    }\n  });\n\n  return recognizer;\n}\n\n/**\n * A plugin that provides touch events for elements.\n *\n * @param {EventBus} eventBus\n * @param {InteractionEvents} interactionEvents\n */\nexport default function TouchInteractionEvents(\n    injector, canvas, eventBus,\n    elementRegistry, interactionEvents) {\n\n  // optional integrations\n  var dragging = get('dragging', injector),\n      move = get('move', injector),\n      contextPad = get('contextPad', injector),\n      palette = get('palette', injector);\n\n  // the touch recognizer\n  var recognizer;\n\n  function handler(type) {\n\n    return function(event) {\n      log('element', type, event);\n\n      interactionEvents.fire(type, event);\n    };\n  }\n\n  function getGfx(target) {\n    var node = domClosest(target, 'svg, .djs-element', true);\n    return node;\n  }\n\n  function initEvents(svg) {\n\n    // touch recognizer\n    recognizer = createTouchRecognizer(svg);\n\n    recognizer.on('doubletap', handler('element.dblclick'));\n\n    recognizer.on('tap', handler('element.click'));\n\n    function startGrabCanvas(event) {\n\n      log('canvas', 'grab start');\n\n      var lx = 0, ly = 0;\n\n      function update(e) {\n\n        var dx = e.deltaX - lx,\n            dy = e.deltaY - ly;\n\n        canvas.scroll({ dx: dx, dy: dy });\n\n        lx = e.deltaX;\n        ly = e.deltaY;\n      }\n\n      function end(e) {\n        recognizer.off('panmove', update);\n        recognizer.off('panend', end);\n        recognizer.off('pancancel', end);\n\n        log('canvas', 'grab end');\n      }\n\n      recognizer.on('panmove', update);\n      recognizer.on('panend', end);\n      recognizer.on('pancancel', end);\n    }\n\n    function startGrab(event) {\n\n      var gfx = getGfx(event.target),\n          element = gfx && elementRegistry.get(gfx);\n\n      // recognizer\n      if (move && canvas.getRootElement() !== element) {\n        log('element', 'move start', element, event, true);\n        return move.start(event, element, true);\n      } else {\n        startGrabCanvas(event);\n      }\n    }\n\n    function startZoom(e) {\n\n      log('canvas', 'zoom start');\n\n      var zoom = canvas.zoom(),\n          mid = e.center;\n\n      function update(e) {\n\n        var ratio = 1 - (1 - e.scale) / 1.50,\n            newZoom = Math.max(MIN_ZOOM, Math.min(MAX_ZOOM, ratio * zoom));\n\n        canvas.zoom(newZoom, mid);\n\n        stopEvent(e);\n      }\n\n      function end(e) {\n        recognizer.off('pinchmove', update);\n        recognizer.off('pinchend', end);\n        recognizer.off('pinchcancel', end);\n\n        recognizer.reset(true);\n\n        log('canvas', 'zoom end');\n      }\n\n      recognizer.on('pinchmove', update);\n      recognizer.on('pinchend', end);\n      recognizer.on('pinchcancel', end);\n    }\n\n    recognizer.on('panstart', startGrab);\n    recognizer.on('press', startGrab);\n\n    recognizer.on('pinchstart', startZoom);\n  }\n\n  if (dragging) {\n\n    // simulate hover during dragging\n    eventBus.on('drag.move', function(event) {\n\n      var originalEvent = event.originalEvent;\n\n      if (!originalEvent || originalEvent instanceof MouseEvent) {\n        return;\n      }\n\n      var position = toPoint(originalEvent);\n\n      // this gets really expensive ...\n      var node = document.elementFromPoint(position.x, position.y),\n          gfx = getGfx(node),\n          element = gfx && elementRegistry.get(gfx);\n\n      if (element !== event.hover) {\n        if (event.hover) {\n          dragging.out(event);\n        }\n\n        if (element) {\n          dragging.hover({ element: element, gfx: gfx });\n\n          event.hover = element;\n          event.hoverGfx = gfx;\n        }\n      }\n    });\n  }\n\n  if (contextPad) {\n\n    eventBus.on('contextPad.create', function(event) {\n      var node = event.pad.html;\n\n      // touch recognizer\n      var padRecognizer = createTouchRecognizer(node);\n\n      padRecognizer.on('panstart', function(event) {\n        log('context-pad', 'panstart', event);\n        contextPad.trigger('dragstart', event, true);\n      });\n\n      padRecognizer.on('press', function(event) {\n        log('context-pad', 'press', event);\n        contextPad.trigger('dragstart', event, true);\n      });\n\n      padRecognizer.on('tap', function(event) {\n        log('context-pad', 'tap', event);\n        contextPad.trigger('click', event);\n      });\n    });\n  }\n\n  if (palette) {\n    eventBus.on('palette.create', function(event) {\n      var node = event.container;\n\n      // touch recognizer\n      var padRecognizer = createTouchRecognizer(node);\n\n      padRecognizer.on('panstart', function(event) {\n        log('palette', 'panstart', event);\n        palette.trigger('dragstart', event, true);\n      });\n\n      padRecognizer.on('press', function(event) {\n        log('palette', 'press', event);\n        palette.trigger('dragstart', event, true);\n      });\n\n      padRecognizer.on('tap', function(event) {\n        log('palette', 'tap', event);\n        palette.trigger('click', event);\n      });\n    });\n  }\n\n  eventBus.on('canvas.init', function(event) {\n    initEvents(event.svg);\n  });\n}\n\n\nTouchInteractionEvents.$inject = [\n  'injector',\n  'canvas',\n  'eventBus',\n  'elementRegistry',\n  'interactionEvents',\n  'touchFix'\n];\n","import {\n  append as svgAppend,\n  attr as svgAttr,\n  create as svgCreate\n} from 'tiny-svg';\n\n\nexport default function TouchFix(canvas, eventBus) {\n\n  var self = this;\n\n  eventBus.on('canvas.init', function(e) {\n    self.addBBoxMarker(e.svg);\n  });\n}\n\nTouchFix.$inject = [ 'canvas', 'eventBus' ];\n\n\n/**\n * Safari mobile (iOS 7) does not fire touchstart event in <SVG> element\n * if there is no shape between 0,0 and viewport elements origin.\n *\n * So touchstart event is only fired when the <g class=\"viewport\"> element was hit.\n * Putting an element over and below the 'viewport' fixes that behavior.\n */\nTouchFix.prototype.addBBoxMarker = function(svg) {\n\n  var markerStyle = {\n    fill: 'none',\n    class: 'outer-bound-marker'\n  };\n\n  var rect1 = svgCreate('rect');\n  svgAttr(rect1, {\n    x: -10000,\n    y: 10000,\n    width: 10,\n    height: 10\n  });\n  svgAttr(rect1, markerStyle);\n\n  svgAppend(svg, rect1);\n\n  var rect2 = svgCreate('rect');\n  svgAttr(rect2, {\n    x: 10000,\n    y: 10000,\n    width: 10,\n    height: 10\n  });\n  svgAttr(rect2, markerStyle);\n\n  svgAppend(svg, rect2);\n};\n","import InteractionEventsModule from '../interaction-events';\n\nimport TouchInteractionEvents from './TouchInteractionEvents';\nimport TouchFix from './TouchFix';\n\nexport default {\n  __depends__: [ InteractionEventsModule ],\n  __init__: [ 'touchInteractionEvents' ],\n  touchInteractionEvents: [ 'type', TouchInteractionEvents ],\n  touchFix: [ 'type', TouchFix ]\n};","import TouchModule from '../../features/touch';\n\nexport default {\n  __depends__: [\n    TouchModule\n  ]\n};","import {\n  filter,\n  forEach,\n  sortBy\n} from 'min-dash';\n\nfunction last(arr) {\n  return arr && arr[arr.length - 1];\n}\n\nfunction sortTopOrMiddle(element) {\n  return element.y;\n}\n\nfunction sortLeftOrCenter(element) {\n  return element.x;\n}\n\n/**\n * Sorting functions for different types of alignment\n *\n * @type {Object}\n *\n * @return {Function}\n */\nvar ALIGNMENT_SORTING = {\n  left: sortLeftOrCenter,\n  center: sortLeftOrCenter,\n  right: function(element) {\n    return element.x + element.width;\n  },\n  top: sortTopOrMiddle,\n  middle: sortTopOrMiddle,\n  bottom: function(element) {\n    return element.y + element.height;\n  }\n};\n\n\nexport default function AlignElements(modeling) {\n  this._modeling = modeling;\n}\n\nAlignElements.$inject = [ 'modeling' ];\n\n\n/**\n * Get the relevant \"axis\" and \"dimension\" related to the current type of alignment\n *\n * @param  {string} type left|right|center|top|bottom|middle\n *\n * @return {Object} { axis, dimension }\n */\nAlignElements.prototype._getOrientationDetails = function(type) {\n  var vertical = [ 'top', 'bottom', 'middle' ],\n      axis = 'x',\n      dimension = 'width';\n\n  if (vertical.indexOf(type) !== -1) {\n    axis = 'y';\n    dimension = 'height';\n  }\n\n  return {\n    axis: axis,\n    dimension: dimension\n  };\n};\n\nAlignElements.prototype._isType = function(type, types) {\n  return types.indexOf(type) !== -1;\n};\n\n/**\n * Get a point on the relevant axis where elements should align to\n *\n * @param  {string} type left|right|center|top|bottom|middle\n * @param  {Array} sortedElements\n *\n * @return {Object}\n */\nAlignElements.prototype._alignmentPosition = function(type, sortedElements) {\n  var orientation = this._getOrientationDetails(type),\n      axis = orientation.axis,\n      dimension = orientation.dimension,\n      alignment = {},\n      centers = {},\n      hasSharedCenters = false,\n      centeredElements,\n      firstElement,\n      lastElement;\n\n  function getMiddleOrTop(first, last) {\n    return Math.round((first[axis] + last[axis] + last[dimension]) / 2);\n  }\n\n  if (this._isType(type, [ 'left', 'top' ])) {\n    alignment[type] = sortedElements[0][axis];\n\n  } else if (this._isType(type, [ 'right', 'bottom' ])) {\n    lastElement = last(sortedElements);\n\n    alignment[type] = lastElement[axis] + lastElement[dimension];\n\n  } else if (this._isType(type, [ 'center', 'middle' ])) {\n\n    // check if there is a center shared by more than one shape\n    // if not, just take the middle of the range\n    forEach(sortedElements, function(element) {\n      var center = element[axis] + Math.round(element[dimension] / 2);\n\n      if (centers[center]) {\n        centers[center].elements.push(element);\n      } else {\n        centers[center] = {\n          elements: [ element ],\n          center: center\n        };\n      }\n    });\n\n    centeredElements = sortBy(centers, function(center) {\n      if (center.elements.length > 1) {\n        hasSharedCenters = true;\n      }\n\n      return center.elements.length;\n    });\n\n    if (hasSharedCenters) {\n      alignment[type] = last(centeredElements).center;\n\n      return alignment;\n    }\n\n    firstElement = sortedElements[0];\n\n    sortedElements = sortBy(sortedElements, function(element) {\n      return element[axis] + element[dimension];\n    });\n\n    lastElement = last(sortedElements);\n\n    alignment[type] = getMiddleOrTop(firstElement, lastElement);\n  }\n\n  return alignment;\n};\n\n/**\n * Executes the alignment of a selection of elements\n *\n * @param  {Array} elements [description]\n * @param  {string} type left|right|center|top|bottom|middle\n */\nAlignElements.prototype.trigger = function(elements, type) {\n  var modeling = this._modeling;\n\n  var filteredElements = filter(elements, function(element) {\n    return !(element.waypoints || element.host || element.labelTarget);\n  });\n\n  if (filteredElements.length < 2) {\n    return;\n  }\n\n  var sortFn = ALIGNMENT_SORTING[type];\n\n  var sortedElements = sortBy(filteredElements, sortFn);\n\n  var alignment = this._alignmentPosition(type, sortedElements);\n\n  modeling.alignElements(sortedElements, alignment);\n};\n","import AlignElements from './AlignElements';\n\nexport default {\n  __init__: [ 'alignElements' ],\n  alignElements: [ 'type', AlignElements ]\n};\n","import {\n  closest as domClosest\n} from 'min-dom';\n\nimport {\n  toPoint\n} from '../../util/Event';\n\nvar HIGH_PRIORITY = 1500;\n\n\n/**\n * Browsers may swallow certain events (hover, out ...) if users are to\n * fast with the mouse.\n *\n * @see http://stackoverflow.com/questions/7448468/why-cant-i-reliably-capture-a-mouseout-event\n *\n * The fix implemented in this component ensure that we\n *\n * 1) have a hover state after a successful drag.move event\n * 2) have an out event when dragging leaves an element\n *\n * @param {ElementRegistry} elementRegistry\n * @param {EventBus} eventBus\n * @param {Injector} injector\n */\nexport default function HoverFix(elementRegistry, eventBus, injector) {\n\n  var self = this;\n\n  var dragging = injector.get('dragging', false);\n\n  /**\n   * Make sure we are god damn hovering!\n   *\n   * @param {Event} dragging event\n   */\n  function ensureHover(event) {\n\n    if (event.hover) {\n      return;\n    }\n\n    var originalEvent = event.originalEvent;\n\n    var gfx = self._findTargetGfx(originalEvent);\n\n    var element = gfx && elementRegistry.get(gfx);\n\n    if (gfx && element) {\n\n      // 1) cancel current mousemove\n      event.stopPropagation();\n\n      // 2) emit fake hover for new target\n      dragging.hover({ element: element, gfx: gfx });\n\n      // 3) re-trigger move event\n      dragging.move(originalEvent);\n    }\n  }\n\n\n  if (dragging) {\n\n    /**\n     * We wait for a specific sequence of events before\n     * emitting a fake drag.hover event.\n     *\n     * Event Sequence:\n     *\n     * drag.start\n     * drag.move >> ensure we are hovering\n     */\n    eventBus.on('drag.start', function(event) {\n\n      eventBus.once('drag.move', HIGH_PRIORITY, function(event) {\n\n        ensureHover(event);\n\n      });\n\n    });\n  }\n\n\n  /**\n   * We make sure that element.out is always fired, even if the\n   * browser swallows an element.out event.\n   *\n   * Event sequence:\n   *\n   * element.hover\n   * (element.out >> sometimes swallowed)\n   * element.hover >> ensure we fired element.out\n   */\n  (function() {\n    var hoverGfx;\n    var hover;\n\n    eventBus.on('element.hover', function(event) {\n\n      // (1) remember current hover element\n      hoverGfx = event.gfx;\n      hover = event.element;\n    });\n\n    eventBus.on('element.hover', HIGH_PRIORITY, function(event) {\n\n      // (3) am I on an element still?\n      if (hover) {\n\n        // (4) that is a problem, gotta \"simulate the out\"\n        eventBus.fire('element.out', {\n          element: hover,\n          gfx: hoverGfx\n        });\n      }\n\n    });\n\n    eventBus.on('element.out', function() {\n\n      // (2) unset hover state if we correctly outed us *GG*\n      hoverGfx = null;\n      hover = null;\n    });\n\n  })();\n\n  this._findTargetGfx = function(event) {\n    var position,\n        target;\n\n    if (!(event instanceof MouseEvent)) {\n      return;\n    }\n\n    position = toPoint(event);\n\n    // damn expensive operation, ouch!\n    target = document.elementFromPoint(position.x, position.y);\n\n    return getGfx(target);\n  };\n\n}\n\nHoverFix.$inject = [\n  'elementRegistry',\n  'eventBus',\n  'injector'\n];\n\n\n// helpers /////////////////////\n\nfunction getGfx(target) {\n  return domClosest(target, 'svg, .djs-element', true);\n}","import HoverFix from './HoverFix';\n\nexport default {\n  __init__: [\n    'hoverFix'\n  ],\n  hoverFix: [ 'type', HoverFix ],\n};","var round = Math.round;\n\nimport { assign } from 'min-dash';\n\nimport {\n  event as domEvent\n} from 'min-dom';\n\nimport {\n  getOriginal,\n  toPoint,\n  stopPropagation\n} from '../../util/Event';\n\nimport {\n  set as cursorSet,\n  unset as cursorUnset\n} from '../../util/Cursor';\n\nimport {\n  install as installClickTrap\n} from '../../util/ClickTrap';\n\nimport {\n  delta as deltaPos\n} from '../../util/PositionUtil';\n\nvar DRAG_ACTIVE_CLS = 'djs-drag-active';\n\n\nfunction preventDefault(event) {\n  event.preventDefault();\n}\n\nfunction isTouchEvent(event) {\n\n  // check for TouchEvent being available first\n  // (i.e. not available on desktop Firefox)\n  return typeof TouchEvent !== 'undefined' && event instanceof TouchEvent;\n}\n\nfunction getLength(point) {\n  return Math.sqrt(Math.pow(point.x, 2) + Math.pow(point.y, 2));\n}\n\n/**\n * A helper that fires canvas localized drag events and realizes\n * the general \"drag-and-drop\" look and feel.\n *\n * Calling {@link Dragging#activate} activates dragging on a canvas.\n *\n * It provides the following:\n *\n *   * emits life cycle events, namespaced with a prefix assigned\n *     during dragging activation\n *   * sets and restores the cursor\n *   * sets and restores the selection if elements still exist\n *   * ensures there can be only one drag operation active at a time\n *\n * Dragging may be canceled manually by calling {@link Dragging#cancel}\n * or by pressing ESC.\n *\n *\n * ## Life-cycle events\n *\n * Dragging can be in three different states, off, initialized\n * and active.\n *\n * (1) off: no dragging operation is in progress\n * (2) initialized: a new drag operation got initialized but not yet\n *                  started (i.e. because of no initial move)\n * (3) started: dragging is in progress\n *\n * Eventually dragging will be off again after a drag operation has\n * been ended or canceled via user click or ESC key press.\n *\n * To indicate transitions between these states dragging emits generic\n * life-cycle events with the `drag.` prefix _and_ events namespaced\n * to a prefix choosen by a user during drag initialization.\n *\n * The following events are emitted (appropriately prefixed) via\n * the {@link EventBus}.\n *\n * * `init`\n * * `start`\n * * `move`\n * * `end`\n * * `ended` (dragging already in off state)\n * * `cancel` (only if previously started)\n * * `canceled` (dragging already in off state, only if previously started)\n * * `cleanup`\n *\n *\n * @example\n *\n * function MyDragComponent(eventBus, dragging) {\n *\n *   eventBus.on('mydrag.start', function(event) {\n *     console.log('yes, we start dragging');\n *   });\n *\n *   eventBus.on('mydrag.move', function(event) {\n *     console.log('canvas local coordinates', event.x, event.y, event.dx, event.dy);\n *\n *     // local drag data is passed with the event\n *     event.context.foo; // \"BAR\"\n *\n *     // the original mouse event, too\n *     event.originalEvent; // MouseEvent(...)\n *   });\n *\n *   eventBus.on('element.click', function(event) {\n *     dragging.init(event, 'mydrag', {\n *       cursor: 'grabbing',\n *       data: {\n *         context: {\n *           foo: \"BAR\"\n *         }\n *       }\n *     });\n *   });\n * }\n */\nexport default function Dragging(eventBus, canvas, selection, elementRegistry) {\n\n  var defaultOptions = {\n    threshold: 5,\n    trapClick: true\n  };\n\n  // the currently active drag operation\n  // dragging is active as soon as this context exists.\n  //\n  // it is visually _active_ only when a context.active flag is set to true.\n  var context;\n\n  /* convert a global event into local coordinates */\n  function toLocalPoint(globalPosition) {\n\n    var viewbox = canvas.viewbox();\n\n    var clientRect = canvas._container.getBoundingClientRect();\n\n    return {\n      x: viewbox.x + (globalPosition.x - clientRect.left) / viewbox.scale,\n      y: viewbox.y + (globalPosition.y - clientRect.top) / viewbox.scale\n    };\n  }\n\n  // helpers\n\n  function fire(type, dragContext) {\n    dragContext = dragContext || context;\n\n    var event = eventBus.createEvent(\n      assign(\n        {},\n        dragContext.payload,\n        dragContext.data,\n        { isTouch: dragContext.isTouch }\n      )\n    );\n\n    // default integration\n    if (eventBus.fire('drag.' + type, event) === false) {\n      return false;\n    }\n\n    return eventBus.fire(dragContext.prefix + '.' + type, event);\n  }\n\n  function restoreSelection(previousSelection) {\n    var existingSelection = previousSelection.filter(function(element) {\n      return elementRegistry.get(element.id);\n    });\n\n    existingSelection.length && selection.select(existingSelection);\n  }\n\n  // event listeners\n\n  function move(event, activate) {\n    var payload = context.payload,\n        displacement = context.displacement;\n\n    var globalStart = context.globalStart,\n        globalCurrent = toPoint(event),\n        globalDelta = deltaPos(globalCurrent, globalStart);\n\n    var localStart = context.localStart,\n        localCurrent = toLocalPoint(globalCurrent),\n        localDelta = deltaPos(localCurrent, localStart);\n\n\n    // activate context explicitly or once threshold is reached\n    if (!context.active && (activate || getLength(globalDelta) > context.threshold)) {\n\n      // fire start event with original\n      // starting coordinates\n\n      assign(payload, {\n        x: round(localStart.x + displacement.x),\n        y: round(localStart.y + displacement.y),\n        dx: 0,\n        dy: 0\n      }, { originalEvent: event });\n\n      if (false === fire('start')) {\n        return cancel();\n      }\n\n      context.active = true;\n\n      // unset selection and remember old selection\n      // the previous (old) selection will always passed\n      // with the event via the event.previousSelection property\n      if (!context.keepSelection) {\n        payload.previousSelection = selection.get();\n        selection.select(null);\n      }\n\n      // allow custom cursor\n      if (context.cursor) {\n        cursorSet(context.cursor);\n      }\n\n      // indicate dragging via marker on root element\n      canvas.addMarker(canvas.getRootElement(), DRAG_ACTIVE_CLS);\n    }\n\n    stopPropagation(event);\n\n    if (context.active) {\n\n      // update payload with actual coordinates\n      assign(payload, {\n        x: round(localCurrent.x + displacement.x),\n        y: round(localCurrent.y + displacement.y),\n        dx: round(localDelta.x),\n        dy: round(localDelta.y)\n      }, { originalEvent: event });\n\n      // emit move event\n      fire('move');\n    }\n  }\n\n  function end(event) {\n    var previousContext,\n        returnValue = true;\n\n    if (context.active) {\n\n      if (event) {\n        context.payload.originalEvent = event;\n\n        // suppress original event (click, ...)\n        // because we just ended a drag operation\n        stopPropagation(event);\n      }\n\n      // implementations may stop restoring the\n      // original state (selections, ...) by preventing the\n      // end events default action\n      returnValue = fire('end');\n    }\n\n    if (returnValue === false) {\n      fire('rejected');\n    }\n\n    previousContext = cleanup(returnValue !== true);\n\n    // last event to be fired when all drag operations are done\n    // at this point in time no drag operation is in progress anymore\n    fire('ended', previousContext);\n  }\n\n\n  // cancel active drag operation if the user presses\n  // the ESC key on the keyboard\n\n  function checkCancel(event) {\n\n    if (event.which === 27) {\n      preventDefault(event);\n\n      cancel();\n    }\n  }\n\n\n  // prevent ghost click that might occur after a finished\n  // drag and drop session\n\n  function trapClickAndEnd(event) {\n\n    var untrap;\n\n    // trap the click in case we are part of an active\n    // drag operation. This will effectively prevent\n    // the ghost click that cannot be canceled otherwise.\n    if (context.active) {\n\n      untrap = installClickTrap(eventBus);\n\n      // remove trap after minimal delay\n      setTimeout(untrap, 400);\n\n      // prevent default action (click)\n      preventDefault(event);\n    }\n\n    end(event);\n  }\n\n  function trapTouch(event) {\n    move(event);\n  }\n\n  // update the drag events hover (djs.model.Base) and hoverGfx (Snap<SVGElement>)\n  // properties during hover and out and fire {prefix}.hover and {prefix}.out properties\n  // respectively\n\n  function hover(event) {\n    var payload = context.payload;\n\n    payload.hoverGfx = event.gfx;\n    payload.hover = event.element;\n\n    fire('hover');\n  }\n\n  function out(event) {\n    fire('out');\n\n    var payload = context.payload;\n\n    payload.hoverGfx = null;\n    payload.hover = null;\n  }\n\n\n  // life-cycle methods\n\n  function cancel(restore) {\n    var previousContext;\n\n    if (!context) {\n      return;\n    }\n\n    var wasActive = context.active;\n\n    if (wasActive) {\n      fire('cancel');\n    }\n\n    previousContext = cleanup(restore);\n\n    if (wasActive) {\n\n      // last event to be fired when all drag operations are done\n      // at this point in time no drag operation is in progress anymore\n      fire('canceled', previousContext);\n    }\n  }\n\n  function cleanup(restore) {\n    var previousContext,\n        endDrag;\n\n    fire('cleanup');\n\n    // reset cursor\n    cursorUnset();\n\n    if (context.trapClick) {\n      endDrag = trapClickAndEnd;\n    } else {\n      endDrag = end;\n    }\n\n    // reset dom listeners\n    domEvent.unbind(document, 'mousemove', move);\n\n    domEvent.unbind(document, 'dragstart', preventDefault);\n    domEvent.unbind(document, 'selectstart', preventDefault);\n\n    domEvent.unbind(document, 'mousedown', endDrag, true);\n    domEvent.unbind(document, 'mouseup', endDrag, true);\n\n    domEvent.unbind(document, 'keyup', checkCancel);\n\n    domEvent.unbind(document, 'touchstart', trapTouch, true);\n    domEvent.unbind(document, 'touchcancel', cancel, true);\n    domEvent.unbind(document, 'touchmove', move, true);\n    domEvent.unbind(document, 'touchend', end, true);\n\n    eventBus.off('element.hover', hover);\n    eventBus.off('element.out', out);\n\n    // remove drag marker on root element\n    canvas.removeMarker(canvas.getRootElement(), DRAG_ACTIVE_CLS);\n\n    // restore selection, unless it has changed\n    var previousSelection = context.payload.previousSelection;\n\n    if (restore !== false && previousSelection && !selection.get().length) {\n      restoreSelection(previousSelection);\n    }\n\n    previousContext = context;\n\n    context = null;\n\n    return previousContext;\n  }\n\n  /**\n   * Initialize a drag operation.\n   *\n   * If `localPosition` is given, drag events will be emitted\n   * relative to it.\n   *\n   * @param {MouseEvent|TouchEvent} [event]\n   * @param {Point} [localPosition] actual diagram local position this drag operation should start at\n   * @param {string} prefix\n   * @param {Object} [options]\n   */\n  function init(event, relativeTo, prefix, options) {\n\n    // only one drag operation may be active, at a time\n    if (context) {\n      cancel(false);\n    }\n\n    if (typeof relativeTo === 'string') {\n      options = prefix;\n      prefix = relativeTo;\n      relativeTo = null;\n    }\n\n    options = assign({}, defaultOptions, options || {});\n\n    var data = options.data || {},\n        originalEvent,\n        globalStart,\n        localStart,\n        endDrag,\n        isTouch;\n\n    if (options.trapClick) {\n      endDrag = trapClickAndEnd;\n    } else {\n      endDrag = end;\n    }\n\n    if (event) {\n      originalEvent = getOriginal(event) || event;\n      globalStart = toPoint(event);\n\n      stopPropagation(event);\n\n      // prevent default browser dragging behavior\n      if (originalEvent.type === 'dragstart') {\n        preventDefault(originalEvent);\n      }\n    } else {\n      originalEvent = null;\n      globalStart = { x: 0, y: 0 };\n    }\n\n    localStart = toLocalPoint(globalStart);\n\n    if (!relativeTo) {\n      relativeTo = localStart;\n    }\n\n    isTouch = isTouchEvent(originalEvent);\n\n    context = assign({\n      prefix: prefix,\n      data: data,\n      payload: {},\n      globalStart: globalStart,\n      displacement: deltaPos(relativeTo, localStart),\n      localStart: localStart,\n      isTouch: isTouch\n    }, options);\n\n    // skip dom registration if trigger\n    // is set to manual (during testing)\n    if (!options.manual) {\n\n      // add dom listeners\n\n      if (isTouch) {\n        domEvent.bind(document, 'touchstart', trapTouch, true);\n        domEvent.bind(document, 'touchcancel', cancel, true);\n        domEvent.bind(document, 'touchmove', move, true);\n        domEvent.bind(document, 'touchend', end, true);\n      } else {\n\n        // assume we use the mouse to interact per default\n        domEvent.bind(document, 'mousemove', move);\n\n        // prevent default browser drag and text selection behavior\n        domEvent.bind(document, 'dragstart', preventDefault);\n        domEvent.bind(document, 'selectstart', preventDefault);\n\n        domEvent.bind(document, 'mousedown', endDrag, true);\n        domEvent.bind(document, 'mouseup', endDrag, true);\n      }\n\n      domEvent.bind(document, 'keyup', checkCancel);\n\n      eventBus.on('element.hover', hover);\n      eventBus.on('element.out', out);\n    }\n\n    fire('init');\n\n    if (options.autoActivate) {\n      move(event, true);\n    }\n  }\n\n  // cancel on diagram destruction\n  eventBus.on('diagram.destroy', cancel);\n\n\n  // API\n\n  this.init = init;\n  this.move = move;\n  this.hover = hover;\n  this.out = out;\n  this.end = end;\n\n  this.cancel = cancel;\n\n  // for introspection\n\n  this.context = function() {\n    return context;\n  };\n\n  this.setOptions = function(options) {\n    assign(defaultOptions, options);\n  };\n}\n\nDragging.$inject = [\n  'eventBus',\n  'canvas',\n  'selection',\n  'elementRegistry'\n];\n","import HoverFixModule from '../hover-fix';\nimport SelectionModule from '../selection';\n\nimport Dragging from './Dragging';\n\n\nexport default {\n  __depends__: [\n    HoverFixModule,\n    SelectionModule,\n  ],\n  dragging: [ 'type', Dragging ],\n};","import { assign } from 'min-dash';\n\nimport {\n  toPoint\n} from '../../util/Event';\n\n\n/**\n * Initiates canvas scrolling if current cursor point is close to a border.\n * Cancelled when current point moves back inside the scrolling borders\n * or cancelled manually.\n *\n * Default options :\n *   scrollThresholdIn: [ 20, 20, 20, 20 ],\n *   scrollThresholdOut: [ 0, 0, 0, 0 ],\n *   scrollRepeatTimeout: 15,\n *   scrollStep: 10\n *\n * Threshold order:\n *   [ left, top, right, bottom ]\n */\nexport default function AutoScroll(config, eventBus, canvas) {\n\n  this._canvas = canvas;\n\n  this._opts = assign({\n    scrollThresholdIn: [ 20, 20, 20, 20 ],\n    scrollThresholdOut: [ 0, 0, 0, 0 ],\n    scrollRepeatTimeout: 15,\n    scrollStep: 10\n  }, config);\n\n  var self = this;\n\n  eventBus.on('drag.move', function(e) {\n    var point = self._toBorderPoint(e);\n\n    self.startScroll(point);\n  });\n\n  eventBus.on([ 'drag.cleanup' ], function() {\n    self.stopScroll();\n  });\n}\n\nAutoScroll.$inject = [\n  'config.autoScroll',\n  'eventBus',\n  'canvas'\n];\n\n\n/**\n * Starts scrolling loop.\n * Point is given in global scale in canvas container box plane.\n *\n * @param  {Object} point { x: X, y: Y }\n */\nAutoScroll.prototype.startScroll = function(point) {\n\n  var canvas = this._canvas;\n  var opts = this._opts;\n  var self = this;\n\n  var clientRect = canvas.getContainer().getBoundingClientRect();\n\n  var diff = [\n    point.x,\n    point.y,\n    clientRect.width - point.x,\n    clientRect.height - point.y\n  ];\n\n  this.stopScroll();\n\n  var dx = 0,\n      dy = 0;\n\n  for (var i = 0; i < 4; i++) {\n    if (between(diff[i], opts.scrollThresholdOut[i], opts.scrollThresholdIn[i])) {\n      if (i === 0) {\n        dx = opts.scrollStep;\n      } else if (i == 1) {\n        dy = opts.scrollStep;\n      } else if (i == 2) {\n        dx = -opts.scrollStep;\n      } else if (i == 3) {\n        dy = -opts.scrollStep;\n      }\n    }\n  }\n\n  if (dx !== 0 || dy !== 0) {\n    canvas.scroll({ dx: dx, dy: dy });\n\n    this._scrolling = setTimeout(function() {\n      self.startScroll(point);\n    }, opts.scrollRepeatTimeout);\n  }\n};\n\nfunction between(val, start, end) {\n  if (start < val && val < end) {\n    return true;\n  }\n\n  return false;\n}\n\n\n/**\n * Stops scrolling loop.\n */\nAutoScroll.prototype.stopScroll = function() {\n  clearTimeout(this._scrolling);\n};\n\n\n/**\n * Overrides defaults options.\n *\n * @param  {Object} options\n */\nAutoScroll.prototype.setOptions = function(options) {\n  this._opts = assign({}, this._opts, options);\n};\n\n\n/**\n * Converts event to a point in canvas container plane in global scale.\n *\n * @param  {Event} event\n * @return {Point}\n */\nAutoScroll.prototype._toBorderPoint = function(event) {\n  var clientRect = this._canvas._container.getBoundingClientRect();\n\n  var globalPosition = toPoint(event.originalEvent);\n\n  return {\n    x: globalPosition.x - clientRect.left,\n    y: globalPosition.y - clientRect.top\n  };\n};","import DraggingModule from '../dragging';\n\nimport AutoScroll from './AutoScroll';\n\n\nexport default {\n  __depends__: [\n    DraggingModule,\n  ],\n  __init__: [ 'autoScroll' ],\n  autoScroll: [ 'type', AutoScroll ]\n};","/**\n * A service that provides rules for certain diagram actions.\n *\n * The default implementation will hook into the {@link CommandStack}\n * to perform the actual rule evaluation. Make sure to provide the\n * `commandStack` service with this module if you plan to use it.\n *\n * Together with this implementation you may use the {@link RuleProvider}\n * to implement your own rule checkers.\n *\n * This module is ment to be easily replaced, thus the tiny foot print.\n *\n * @param {Injector} injector\n */\nexport default function Rules(injector) {\n  this._commandStack = injector.get('commandStack', false);\n}\n\nRules.$inject = [ 'injector' ];\n\n\n/**\n * Returns whether or not a given modeling action can be executed\n * in the specified context.\n *\n * This implementation will respond with allow unless anyone\n * objects.\n *\n * @param {string} action the action to be checked\n * @param {Object} [context] the context to check the action in\n *\n * @return {boolean} returns true, false or null depending on whether the\n *                   operation is allowed, not allowed or should be ignored.\n */\nRules.prototype.allowed = function(action, context) {\n  var allowed = true;\n\n  var commandStack = this._commandStack;\n\n  if (commandStack) {\n    allowed = commandStack.canExecute(action, context);\n  }\n\n  // map undefined to true, i.e. no rules\n  return allowed === undefined ? true : allowed;\n};","import Rules from './Rules';\n\nexport default {\n  __init__: [ 'rules' ],\n  rules: [ 'type', Rules ]\n};\n","import {\n  every,\n  isArray\n} from 'min-dash';\n\n/**\n * Computes the distance between two points\n *\n * @param  {Point}  p\n * @param  {Point}  q\n *\n * @return {number}  distance\n */\nexport function pointDistance(a, b) {\n  if (!a || !b) {\n    return -1;\n  }\n\n  return Math.sqrt(\n    Math.pow(a.x - b.x, 2) +\n    Math.pow(a.y - b.y, 2)\n  );\n}\n\n\n/**\n * Returns true if the point r is on the line between p and q\n *\n * @param  {Point}  p\n * @param  {Point}  q\n * @param  {Point}  r\n * @param  {number} [accuracy=5] accuracy for points on line check (lower is better)\n *\n * @return {boolean}\n */\nexport function pointsOnLine(p, q, r, accuracy) {\n\n  if (typeof accuracy === 'undefined') {\n    accuracy = 5;\n  }\n\n  if (!p || !q || !r) {\n    return false;\n  }\n\n  var val = (q.x - p.x) * (r.y - p.y) - (q.y - p.y) * (r.x - p.x),\n      dist = pointDistance(p, q);\n\n  // @see http://stackoverflow.com/a/907491/412190\n  return Math.abs(val / dist) <= accuracy;\n}\n\n\nvar ALIGNED_THRESHOLD = 2;\n\n/**\n * Check whether two points are horizontally or vertically aligned.\n *\n * @param {Array<Point>|Point}\n * @param {Point}\n *\n * @return {string|boolean}\n */\nexport function pointsAligned(a, b) {\n  var points;\n\n  if (isArray(a)) {\n    points = a;\n  } else {\n    points = [ a, b ];\n  }\n\n  if (pointsAlignedHorizontally(points)) {\n    return 'h';\n  }\n\n  if (pointsAlignedVertically(points)) {\n    return 'v';\n  }\n\n  return false;\n}\n\nexport function pointsAlignedHorizontally(a, b) {\n  var points;\n\n  if (isArray(a)) {\n    points = a;\n  } else {\n    points = [ a, b ];\n  }\n\n  var firstPoint = points.slice().shift();\n\n  return every(points, function(point) {\n    return Math.abs(firstPoint.y - point.y) <= ALIGNED_THRESHOLD;\n  });\n}\n\nexport function pointsAlignedVertically(a, b) {\n  var points;\n\n  if (isArray(a)) {\n    points = a;\n  } else {\n    points = [ a, b ];\n  }\n\n  var firstPoint = points.slice().shift();\n\n  return every(points, function(point) {\n    return Math.abs(firstPoint.x - point.x) <= ALIGNED_THRESHOLD;\n  });\n}\n\n\n\n/**\n * Returns true if the point p is inside the rectangle rect\n *\n * @param  {Point}  p\n * @param  {Rect} rect\n * @param  {number} tolerance\n *\n * @return {boolean}\n */\nexport function pointInRect(p, rect, tolerance) {\n  tolerance = tolerance || 0;\n\n  return p.x > rect.x - tolerance &&\n         p.y > rect.y - tolerance &&\n         p.x < rect.x + rect.width + tolerance &&\n         p.y < rect.y + rect.height + tolerance;\n}\n\n/**\n * Returns a point in the middle of points p and q\n *\n * @param  {Point}  p\n * @param  {Point}  q\n *\n * @return {Point} middle point\n */\nexport function getMidPoint(p, q) {\n  return {\n    x: Math.round(p.x + ((q.x - p.x) / 2.0)),\n    y: Math.round(p.y + ((q.y - p.y) / 2.0))\n  };\n}\n","import {\n  pointDistance\n} from './Geometry';\n\nimport intersectPaths from 'path-intersection';\n\nvar round = Math.round,\n    max = Math.max;\n\n\nfunction circlePath(center, r) {\n  var x = center.x,\n      y = center.y;\n\n  return [\n    ['M', x, y],\n    ['m', 0, -r],\n    ['a', r, r, 0, 1, 1, 0, 2 * r],\n    ['a', r, r, 0, 1, 1, 0, -2 * r],\n    ['z']\n  ];\n}\n\nfunction linePath(points) {\n  var segments = [];\n\n  points.forEach(function(p, idx) {\n    segments.push([ idx === 0 ? 'M' : 'L', p.x, p.y ]);\n  });\n\n  return segments;\n}\n\n\nvar INTERSECTION_THRESHOLD = 10;\n\nfunction getBendpointIntersection(waypoints, reference) {\n\n  var i, w;\n\n  for (i = 0; (w = waypoints[i]); i++) {\n\n    if (pointDistance(w, reference) <= INTERSECTION_THRESHOLD) {\n      return {\n        point: waypoints[i],\n        bendpoint: true,\n        index: i\n      };\n    }\n  }\n\n  return null;\n}\n\nfunction getPathIntersection(waypoints, reference) {\n\n  var intersections = intersectPaths(circlePath(reference, INTERSECTION_THRESHOLD), linePath(waypoints));\n\n  var a = intersections[0],\n      b = intersections[intersections.length - 1],\n      idx;\n\n  if (!a) {\n\n    // no intersection\n    return null;\n  }\n\n  if (a !== b) {\n\n    if (a.segment2 !== b.segment2) {\n\n      // we use the bendpoint in between both segments\n      // as the intersection point\n\n      idx = max(a.segment2, b.segment2) - 1;\n\n      return {\n        point: waypoints[idx],\n        bendpoint: true,\n        index: idx\n      };\n    }\n\n    return {\n      point: {\n        x: (round(a.x + b.x) / 2),\n        y: (round(a.y + b.y) / 2)\n      },\n      index: a.segment2\n    };\n  }\n\n  return {\n    point: {\n      x: round(a.x),\n      y: round(a.y)\n    },\n    index: a.segment2\n  };\n}\n\n/**\n * Returns the closest point on the connection towards a given reference point.\n *\n * @param  {Array<Point>} waypoints\n * @param  {Point} reference\n *\n * @return {Object} intersection data (segment, point)\n */\nexport function getApproxIntersection(waypoints, reference) {\n  return getBendpointIntersection(waypoints, reference) || getPathIntersection(waypoints, reference);\n}\n","import {\n  toPoint\n} from '../../util/Event';\n\nimport {\n  getMidPoint,\n  pointsAligned\n} from '../../util/Geometry';\n\nimport {\n  append as svgAppend,\n  attr as svgAttr,\n  classes as svgClasses,\n  create as svgCreate\n} from 'tiny-svg';\n\nimport {\n  rotate,\n  translate\n} from '../../util/SvgTransformUtil';\n\nimport {\n  getApproxIntersection\n} from '../../util/LineIntersection';\n\nexport var BENDPOINT_CLS = 'djs-bendpoint';\nexport var SEGMENT_DRAGGER_CLS = 'djs-segment-dragger';\n\nexport function toCanvasCoordinates(canvas, event) {\n\n  var position = toPoint(event),\n      clientRect = canvas._container.getBoundingClientRect(),\n      offset;\n\n  // canvas relative position\n\n  offset = {\n    x: clientRect.left,\n    y: clientRect.top\n  };\n\n  // update actual event payload with canvas relative measures\n\n  var viewbox = canvas.viewbox();\n\n  return {\n    x: viewbox.x + (position.x - offset.x) / viewbox.scale,\n    y: viewbox.y + (position.y - offset.y) / viewbox.scale\n  };\n}\n\nexport function getConnectionIntersection(canvas, waypoints, event) {\n  var localPosition = toCanvasCoordinates(canvas, event),\n      intersection = getApproxIntersection(waypoints, localPosition);\n\n  return intersection;\n}\n\nexport function addBendpoint(parentGfx, cls) {\n  var groupGfx = svgCreate('g');\n  svgClasses(groupGfx).add(BENDPOINT_CLS);\n\n  svgAppend(parentGfx, groupGfx);\n\n  var visual = svgCreate('circle');\n  svgAttr(visual, {\n    cx: 0,\n    cy: 0,\n    r: 4\n  });\n  svgClasses(visual).add('djs-visual');\n\n  svgAppend(groupGfx, visual);\n\n  var hit = svgCreate('circle');\n  svgAttr(hit, {\n    cx: 0,\n    cy: 0,\n    r: 10\n  });\n  svgClasses(hit).add('djs-hit');\n\n  svgAppend(groupGfx, hit);\n\n  if (cls) {\n    svgClasses(groupGfx).add(cls);\n  }\n\n  return groupGfx;\n}\n\nfunction createParallelDragger(parentGfx, segmentStart, segmentEnd, alignment) {\n  var draggerGfx = svgCreate('g');\n\n  svgAppend(parentGfx, draggerGfx);\n\n  var width = 14,\n      height = 3,\n      padding = 11,\n      hitWidth = calculateHitWidth(segmentStart, segmentEnd, alignment),\n      hitHeight = height + padding;\n\n  var visual = svgCreate('rect');\n  svgAttr(visual, {\n    x: -width / 2,\n    y: -height / 2,\n    width: width,\n    height: height\n  });\n  svgClasses(visual).add('djs-visual');\n\n  svgAppend(draggerGfx, visual);\n\n  var hit = svgCreate('rect');\n  svgAttr(hit, {\n    x: -hitWidth / 2,\n    y: -hitHeight / 2,\n    width: hitWidth,\n    height: hitHeight\n  });\n  svgClasses(hit).add('djs-hit');\n\n  svgAppend(draggerGfx, hit);\n\n  rotate(draggerGfx, alignment === 'v' ? 90 : 0, 0, 0);\n\n  return draggerGfx;\n}\n\n\nexport function addSegmentDragger(parentGfx, segmentStart, segmentEnd) {\n\n  var groupGfx = svgCreate('g'),\n      mid = getMidPoint(segmentStart, segmentEnd),\n      alignment = pointsAligned(segmentStart, segmentEnd);\n\n  svgAppend(parentGfx, groupGfx);\n\n  createParallelDragger(groupGfx, segmentStart, segmentEnd, alignment);\n\n  svgClasses(groupGfx).add(SEGMENT_DRAGGER_CLS);\n  svgClasses(groupGfx).add(alignment === 'h' ? 'horizontal' : 'vertical');\n\n  translate(groupGfx, mid.x, mid.y);\n\n  return groupGfx;\n}\n\n/**\n * Calculates region for segment move which is 2/3 of the full segment length\n * @param {number} segmentLength\n *\n * @return {number}\n */\nexport function calculateSegmentMoveRegion(segmentLength) {\n  return Math.abs(Math.round(segmentLength * 2 / 3));\n}\n\n// helper //////////\n\nfunction calculateHitWidth(segmentStart, segmentEnd, alignment) {\n  var segmentLengthXAxis = segmentEnd.x - segmentStart.x,\n      segmentLengthYAxis = segmentEnd.y - segmentStart.y;\n\n  return alignment === 'h' ?\n    calculateSegmentMoveRegion(segmentLengthXAxis) :\n    calculateSegmentMoveRegion(segmentLengthYAxis);\n}\n","import { forEach } from 'min-dash';\n\nimport {\n  event as domEvent,\n  query as domQuery,\n  queryAll as domQueryAll\n} from 'min-dom';\n\nimport {\n  BENDPOINT_CLS,\n  SEGMENT_DRAGGER_CLS,\n  addBendpoint,\n  addSegmentDragger,\n  calculateSegmentMoveRegion,\n  getConnectionIntersection\n} from './BendpointUtil';\n\nimport {\n  escapeCSS\n} from '../../util/EscapeUtil';\n\nimport {\n  pointsAligned,\n  getMidPoint\n} from '../../util/Geometry';\n\nimport {\n  isPrimaryButton\n} from '../../util/Mouse';\n\nimport {\n  append as svgAppend,\n  attr as svgAttr,\n  classes as svgClasses,\n  create as svgCreate,\n  remove as svgRemove\n} from 'tiny-svg';\n\nimport {\n  translate\n} from '../../util/SvgTransformUtil';\n\n\n/**\n * A service that adds editable bendpoints to connections.\n */\nexport default function Bendpoints(\n    eventBus, canvas, interactionEvents,\n    bendpointMove, connectionSegmentMove) {\n\n  /**\n   * Returns true if intersection point is inside middle region of segment, adjusted by\n   * optional threshold\n   */\n  function isIntersectionMiddle(intersection, waypoints, treshold) {\n    var idx = intersection.index,\n        p = intersection.point,\n        p0, p1, mid, aligned, xDelta, yDelta;\n\n    if (idx <= 0 || intersection.bendpoint) {\n      return false;\n    }\n\n    p0 = waypoints[idx - 1];\n    p1 = waypoints[idx];\n    mid = getMidPoint(p0, p1),\n    aligned = pointsAligned(p0, p1);\n    xDelta = Math.abs(p.x - mid.x);\n    yDelta = Math.abs(p.y - mid.y);\n\n    return aligned && xDelta <= treshold && yDelta <= treshold;\n  }\n\n  /**\n   * Calculates the threshold from a connection's middle which fits the two-third-region\n   */\n  function calculateIntersectionThreshold(connection, intersection) {\n    var waypoints = connection.waypoints,\n        relevantSegment, alignment, segmentLength, threshold;\n\n    if (intersection.index <= 0 || intersection.bendpoint) {\n      return null;\n    }\n\n    // segment relative to connection intersection\n    relevantSegment = {\n      start: waypoints[intersection.index - 1],\n      end: waypoints[intersection.index]\n    };\n\n    alignment = pointsAligned(relevantSegment.start, relevantSegment.end);\n\n    if (!alignment) {\n      return null;\n    }\n\n    if (alignment === 'h') {\n      segmentLength = relevantSegment.end.x - relevantSegment.start.x;\n    } else {\n      segmentLength = relevantSegment.end.y - relevantSegment.start.y;\n    }\n\n    // calculate threshold relative to 2/3 of segment length\n    threshold = calculateSegmentMoveRegion(segmentLength) / 2;\n\n    return threshold;\n  }\n\n  function activateBendpointMove(event, connection) {\n    var waypoints = connection.waypoints,\n        intersection = getConnectionIntersection(canvas, waypoints, event),\n        threshold;\n\n    if (!intersection) {\n      return;\n    }\n\n    threshold = calculateIntersectionThreshold(connection, intersection);\n\n    if (isIntersectionMiddle(intersection, waypoints, threshold)) {\n      connectionSegmentMove.start(event, connection, intersection.index);\n    } else {\n      bendpointMove.start(event, connection, intersection.index, !intersection.bendpoint);\n    }\n\n    // we've handled the event\n    return true;\n  }\n\n  function bindInteractionEvents(node, eventName, element) {\n\n    domEvent.bind(node, eventName, function(event) {\n      interactionEvents.triggerMouseEvent(eventName, event, element);\n      event.stopPropagation();\n    });\n  }\n\n  function getBendpointsContainer(element, create) {\n\n    var layer = canvas.getLayer('overlays'),\n        gfx = domQuery('.djs-bendpoints[data-element-id=\"' + escapeCSS(element.id) + '\"]', layer);\n\n    if (!gfx && create) {\n      gfx = svgCreate('g');\n      svgAttr(gfx, { 'data-element-id': element.id });\n      svgClasses(gfx).add('djs-bendpoints');\n\n      svgAppend(layer, gfx);\n\n      bindInteractionEvents(gfx, 'mousedown', element);\n      bindInteractionEvents(gfx, 'click', element);\n      bindInteractionEvents(gfx, 'dblclick', element);\n    }\n\n    return gfx;\n  }\n\n  function getSegmentDragger(idx, parentGfx) {\n    return domQuery(\n      '.djs-segment-dragger[data-segment-idx=\"' + idx + '\"]',\n      parentGfx\n    );\n  }\n\n  function createBendpoints(gfx, connection) {\n    connection.waypoints.forEach(function(p, idx) {\n      var bendpoint = addBendpoint(gfx);\n\n      svgAppend(gfx, bendpoint);\n\n      translate(bendpoint, p.x, p.y);\n    });\n\n    // add floating bendpoint\n    addBendpoint(gfx, 'floating');\n  }\n\n  function createSegmentDraggers(gfx, connection) {\n\n    var waypoints = connection.waypoints;\n\n    var segmentStart,\n        segmentEnd,\n        segmentDraggerGfx;\n\n    for (var i = 1; i < waypoints.length; i++) {\n\n      segmentStart = waypoints[i - 1];\n      segmentEnd = waypoints[i];\n\n      if (pointsAligned(segmentStart, segmentEnd)) {\n        segmentDraggerGfx = addSegmentDragger(gfx, segmentStart, segmentEnd);\n\n        svgAttr(segmentDraggerGfx, { 'data-segment-idx': i });\n\n        bindInteractionEvents(segmentDraggerGfx, 'mousemove', connection);\n      }\n    }\n  }\n\n  function clearBendpoints(gfx) {\n    forEach(domQueryAll('.' + BENDPOINT_CLS, gfx), function(node) {\n      svgRemove(node);\n    });\n  }\n\n  function clearSegmentDraggers(gfx) {\n    forEach(domQueryAll('.' + SEGMENT_DRAGGER_CLS, gfx), function(node) {\n      svgRemove(node);\n    });\n  }\n\n  function addHandles(connection) {\n\n    var gfx = getBendpointsContainer(connection);\n\n    if (!gfx) {\n      gfx = getBendpointsContainer(connection, true);\n\n      createBendpoints(gfx, connection);\n      createSegmentDraggers(gfx, connection);\n    }\n\n    return gfx;\n  }\n\n  function updateHandles(connection) {\n\n    var gfx = getBendpointsContainer(connection);\n\n    if (gfx) {\n      clearSegmentDraggers(gfx);\n      clearBendpoints(gfx);\n      createSegmentDraggers(gfx, connection);\n      createBendpoints(gfx, connection);\n    }\n  }\n\n  function updateFloatingBendpointPosition(parentGfx, intersection) {\n    var floating = domQuery('.floating', parentGfx),\n        point = intersection.point;\n\n    if (!floating) {\n      return;\n    }\n\n    translate(floating, point.x, point.y);\n\n  }\n\n  function updateSegmentDraggerPosition(parentGfx, intersection, waypoints) {\n\n    var draggerGfx = getSegmentDragger(intersection.index, parentGfx),\n        segmentStart = waypoints[intersection.index - 1],\n        segmentEnd = waypoints[intersection.index],\n        point = intersection.point,\n        mid = getMidPoint(segmentStart, segmentEnd),\n        alignment = pointsAligned(segmentStart, segmentEnd),\n        draggerVisual, relativePosition;\n\n    if (!draggerGfx) {\n      return;\n    }\n\n    draggerVisual = getDraggerVisual(draggerGfx);\n\n    relativePosition = {\n      x: point.x - mid.x,\n      y: point.y - mid.y\n    };\n\n    if (alignment === 'v') {\n\n      // rotate position\n      relativePosition = {\n        x: relativePosition.y,\n        y: relativePosition.x\n      };\n    }\n\n    translate(draggerVisual, relativePosition.x, relativePosition.y);\n  }\n\n  eventBus.on('connection.changed', function(event) {\n    updateHandles(event.element);\n  });\n\n  eventBus.on('connection.remove', function(event) {\n    var gfx = getBendpointsContainer(event.element);\n\n    if (gfx) {\n      svgRemove(gfx);\n    }\n  });\n\n  eventBus.on('element.marker.update', function(event) {\n\n    var element = event.element,\n        bendpointsGfx;\n\n    if (!element.waypoints) {\n      return;\n    }\n\n    bendpointsGfx = addHandles(element);\n\n    if (event.add) {\n      svgClasses(bendpointsGfx).add(event.marker);\n    } else {\n      svgClasses(bendpointsGfx).remove(event.marker);\n    }\n  });\n\n  eventBus.on('element.mousemove', function(event) {\n\n    var element = event.element,\n        waypoints = element.waypoints,\n        bendpointsGfx,\n        intersection;\n\n    if (waypoints) {\n      bendpointsGfx = getBendpointsContainer(element, true);\n\n      intersection = getConnectionIntersection(canvas, waypoints, event.originalEvent);\n\n      if (!intersection) {\n        return;\n      }\n\n      updateFloatingBendpointPosition(bendpointsGfx, intersection);\n\n      if (!intersection.bendpoint) {\n        updateSegmentDraggerPosition(bendpointsGfx, intersection, waypoints);\n      }\n\n    }\n  });\n\n  eventBus.on('element.mousedown', function(event) {\n\n    if (!isPrimaryButton(event)) {\n      return;\n    }\n\n    var originalEvent = event.originalEvent,\n        element = event.element;\n\n    if (!element.waypoints) {\n      return;\n    }\n\n    return activateBendpointMove(originalEvent, element);\n  });\n\n  eventBus.on('selection.changed', function(event) {\n    var newSelection = event.newSelection,\n        primary = newSelection[0];\n\n    if (primary && primary.waypoints) {\n      addHandles(primary);\n    }\n  });\n\n  eventBus.on('element.hover', function(event) {\n    var element = event.element;\n\n    if (element.waypoints) {\n      addHandles(element);\n      interactionEvents.registerEvent(event.gfx, 'mousemove', 'element.mousemove');\n    }\n  });\n\n  eventBus.on('element.out', function(event) {\n    interactionEvents.unregisterEvent(event.gfx, 'mousemove', 'element.mousemove');\n  });\n\n  // update bendpoint container data attribute on element ID change\n  eventBus.on('element.updateId', function(context) {\n    var element = context.element,\n        newId = context.newId;\n\n    if (element.waypoints) {\n      var bendpointContainer = getBendpointsContainer(element);\n\n      if (bendpointContainer) {\n        svgAttr(bendpointContainer, { 'data-element-id': newId });\n      }\n    }\n  });\n\n  // API\n\n  this.addHandles = addHandles;\n  this.updateHandles = updateHandles;\n  this.getBendpointsContainer = getBendpointsContainer;\n  this.getSegmentDragger = getSegmentDragger;\n}\n\nBendpoints.$inject = [\n  'eventBus',\n  'canvas',\n  'interactionEvents',\n  'bendpointMove',\n  'connectionSegmentMove'\n];\n\n\n\n// helper /////////////\n\nfunction getDraggerVisual(draggerGfx) {\n  return domQuery('.djs-visual', draggerGfx);\n}","import {\n  isObject,\n  sortBy\n} from 'min-dash';\n\nimport {\n  pointDistance,\n  pointsOnLine\n} from '../util/Geometry';\n\nimport intersectPaths from 'path-intersection';\n\n\nexport function roundBounds(bounds) {\n  return {\n    x: Math.round(bounds.x),\n    y: Math.round(bounds.y),\n    width: Math.round(bounds.width),\n    height: Math.round(bounds.height)\n  };\n}\n\n\nexport function roundPoint(point) {\n\n  return {\n    x: Math.round(point.x),\n    y: Math.round(point.y)\n  };\n}\n\n\n/**\n * Convert the given bounds to a { top, left, bottom, right } descriptor.\n *\n * @param {Bounds|Point} bounds\n *\n * @return {Object}\n */\nexport function asTRBL(bounds) {\n  return {\n    top: bounds.y,\n    right: bounds.x + (bounds.width || 0),\n    bottom: bounds.y + (bounds.height || 0),\n    left: bounds.x\n  };\n}\n\n\n/**\n * Convert a { top, left, bottom, right } to an objects bounds.\n *\n * @param {Object} trbl\n *\n * @return {Bounds}\n */\nexport function asBounds(trbl) {\n  return {\n    x: trbl.left,\n    y: trbl.top,\n    width: trbl.right - trbl.left,\n    height: trbl.bottom - trbl.top\n  };\n}\n\n\n/**\n * Get the mid of the given bounds or point.\n *\n * @param {Bounds|Point} bounds\n *\n * @return {Point}\n */\nexport function getMid(bounds) {\n  return roundPoint({\n    x: bounds.x + (bounds.width || 0) / 2,\n    y: bounds.y + (bounds.height || 0) / 2\n  });\n}\n\n\n// orientation utils //////////////////////\n\n/**\n * Get orientation of the given rectangle with respect to\n * the reference rectangle.\n *\n * A padding (positive or negative) may be passed to influence\n * horizontal / vertical orientation and intersection.\n *\n * @param {Bounds} rect\n * @param {Bounds} reference\n * @param {Point|number} padding\n *\n * @return {string} the orientation; one of top, top-left, left, ..., bottom, right or intersect.\n */\nexport function getOrientation(rect, reference, padding) {\n\n  padding = padding || 0;\n\n  // make sure we can use an object, too\n  // for individual { x, y } padding\n  if (!isObject(padding)) {\n    padding = { x: padding, y: padding };\n  }\n\n\n  var rectOrientation = asTRBL(rect),\n      referenceOrientation = asTRBL(reference);\n\n  var top = rectOrientation.bottom + padding.y <= referenceOrientation.top,\n      right = rectOrientation.left - padding.x >= referenceOrientation.right,\n      bottom = rectOrientation.top - padding.y >= referenceOrientation.bottom,\n      left = rectOrientation.right + padding.x <= referenceOrientation.left;\n\n  var vertical = top ? 'top' : (bottom ? 'bottom' : null),\n      horizontal = left ? 'left' : (right ? 'right' : null);\n\n  if (horizontal && vertical) {\n    return vertical + '-' + horizontal;\n  } else {\n    return horizontal || vertical || 'intersect';\n  }\n}\n\n\n// intersection utils //////////////////////\n\n/**\n * Get intersection between an element and a line path.\n *\n * @param {PathDef} elementPath\n * @param {PathDef} linePath\n * @param {boolean} cropStart crop from start or end\n *\n * @return {Point}\n */\nexport function getElementLineIntersection(elementPath, linePath, cropStart) {\n\n  var intersections = getIntersections(elementPath, linePath);\n\n  // recognize intersections\n  // only one -> choose\n  // two close together -> choose first\n  // two or more distinct -> pull out appropriate one\n  // none -> ok (fallback to point itself)\n  if (intersections.length === 1) {\n    return roundPoint(intersections[0]);\n  } else if (intersections.length === 2 && pointDistance(intersections[0], intersections[1]) < 1) {\n    return roundPoint(intersections[0]);\n  } else if (intersections.length > 1) {\n\n    // sort by intersections based on connection segment +\n    // distance from start\n    intersections = sortBy(intersections, function(i) {\n      var distance = Math.floor(i.t2 * 100) || 1;\n\n      distance = 100 - distance;\n\n      distance = (distance < 10 ? '0' : '') + distance;\n\n      // create a sort string that makes sure we sort\n      // line segment ASC + line segment position DESC (for cropStart)\n      // line segment ASC + line segment position ASC (for cropEnd)\n      return i.segment2 + '#' + distance;\n    });\n\n    return roundPoint(intersections[cropStart ? 0 : intersections.length - 1]);\n  }\n\n  return null;\n}\n\n\nexport function getIntersections(a, b) {\n  return intersectPaths(a, b);\n}\n\n\nexport function filterRedundantWaypoints(waypoints) {\n\n  // alter copy of waypoints, not original\n  waypoints = waypoints.slice();\n\n  var idx = 0,\n      point,\n      previousPoint,\n      nextPoint;\n\n  while (waypoints[idx]) {\n    point = waypoints[idx];\n    previousPoint = waypoints[idx - 1];\n    nextPoint = waypoints[idx + 1];\n\n    if (pointDistance(point, nextPoint) === 0 ||\n        pointsOnLine(previousPoint, nextPoint, point)) {\n\n      // remove point, if overlapping with {nextPoint}\n      // or on line with {previousPoint} -> {point} -> {nextPoint}\n      waypoints.splice(idx, 1);\n    } else {\n      idx++;\n    }\n  }\n\n  return waypoints;\n}\n","import { filterRedundantWaypoints } from '../../layout/LayoutUtil';\n\nvar round = Math.round;\n\nvar RECONNECT_START = 'reconnectStart',\n    RECONNECT_END = 'reconnectEnd',\n    UPDATE_WAYPOINTS = 'updateWaypoints';\n\n\n/**\n * Move bendpoints through drag and drop to add/remove bendpoints or reconnect connection.\n */\nexport default function BendpointMove(injector, eventBus, canvas, dragging, rules, modeling) {\n  this._injector = injector;\n\n  this.start = function(event, connection, bendpointIndex, insert) {\n    var gfx = canvas.getGraphics(connection),\n        source = connection.source,\n        target = connection.target,\n        waypoints = connection.waypoints,\n        type;\n\n    if (!insert && bendpointIndex === 0) {\n      type = RECONNECT_START;\n    } else\n    if (!insert && bendpointIndex === waypoints.length - 1) {\n      type = RECONNECT_END;\n    } else {\n      type = UPDATE_WAYPOINTS;\n    }\n\n    var command = type === UPDATE_WAYPOINTS ? 'connection.updateWaypoints' : 'connection.reconnect';\n\n    var allowed = rules.allowed(command, {\n      connection: connection,\n      source: source,\n      target: target\n    });\n\n    if (allowed === false) {\n      allowed = rules.allowed(command, {\n        connection: connection,\n        source: target,\n        target: source\n      });\n    }\n\n    if (allowed === false) {\n      return;\n    }\n\n    dragging.init(event, 'bendpoint.move', {\n      data: {\n        connection: connection,\n        connectionGfx: gfx,\n        context: {\n          allowed: allowed,\n          bendpointIndex: bendpointIndex,\n          connection: connection,\n          source: source,\n          target: target,\n          insert: insert,\n          type: type\n        }\n      }\n    });\n  };\n\n  eventBus.on('bendpoint.move.hover', function(event) {\n    var context = event.context,\n        connection = context.connection,\n        source = connection.source,\n        target = connection.target,\n        hover = event.hover,\n        type = context.type;\n\n    // cache hover state\n    context.hover = hover;\n\n    var allowed;\n\n    if (!hover) {\n      return;\n    }\n\n    var command = type === UPDATE_WAYPOINTS ? 'connection.updateWaypoints' : 'connection.reconnect';\n\n    allowed = context.allowed = rules.allowed(command, {\n      connection: connection,\n      source: type === RECONNECT_START ? hover : source,\n      target: type === RECONNECT_END ? hover : target\n    });\n\n    if (allowed) {\n      context.source = type === RECONNECT_START ? hover : source;\n      context.target = type === RECONNECT_END ? hover : target;\n\n      return;\n    }\n\n    if (allowed === false) {\n      allowed = context.allowed = rules.allowed(command, {\n        connection: connection,\n        source: type === RECONNECT_END ? hover : target,\n        target: type === RECONNECT_START ? hover : source\n      });\n    }\n\n    if (allowed) {\n      context.source = type === RECONNECT_END ? hover : target;\n      context.target = type === RECONNECT_START ? hover : source;\n    }\n  });\n\n  eventBus.on([ 'bendpoint.move.out', 'bendpoint.move.cleanup' ], function(event) {\n    var context = event.context,\n        type = context.type;\n\n    context.hover = null;\n    context.source = null;\n    context.target = null;\n\n    if (type !== UPDATE_WAYPOINTS) {\n      context.allowed = false;\n    }\n  });\n\n  eventBus.on('bendpoint.move.end', function(event) {\n    var context = event.context,\n        allowed = context.allowed,\n        bendpointIndex = context.bendpointIndex,\n        connection = context.connection,\n        insert = context.insert,\n        newWaypoints = connection.waypoints.slice(),\n        source = context.source,\n        target = context.target,\n        type = context.type,\n        hints = context.hints || {};\n\n    // ensure integer values (important if zoom level was > 1 during move)\n    var docking = {\n      x: round(event.x),\n      y: round(event.y)\n    };\n\n    if (!allowed) {\n      return false;\n    }\n\n    if (type === UPDATE_WAYPOINTS) {\n      if (insert) {\n\n        // insert new bendpoint\n        newWaypoints.splice(bendpointIndex, 0, docking);\n      } else {\n\n        // swap previous waypoint with moved one\n        newWaypoints[bendpointIndex] = docking;\n      }\n\n      // pass hints about actual moved bendpoint\n      // useful for connection/label layout\n      hints.bendpointMove = {\n        insert: insert,\n        bendpointIndex: bendpointIndex\n      };\n\n      newWaypoints = this.cropWaypoints(connection, newWaypoints);\n\n      modeling.updateWaypoints(connection, filterRedundantWaypoints(newWaypoints), hints);\n    } else {\n      if (type === RECONNECT_START) {\n        hints.docking = 'source';\n\n        if (isReverse(context)) {\n          hints.docking = 'target';\n\n          hints.newWaypoints = newWaypoints.reverse();\n        }\n      } else if (type === RECONNECT_END) {\n        hints.docking = 'target';\n\n        if (isReverse(context)) {\n          hints.docking = 'source';\n\n          hints.newWaypoints = newWaypoints.reverse();\n        }\n      }\n\n      modeling.reconnect(connection, source, target, docking, hints);\n    }\n  }, this);\n}\n\nBendpointMove.$inject = [\n  'injector',\n  'eventBus',\n  'canvas',\n  'dragging',\n  'rules',\n  'modeling'\n];\n\nBendpointMove.prototype.cropWaypoints = function(connection, newWaypoints) {\n  var connectionDocking = this._injector.get('connectionDocking', false);\n\n  if (!connectionDocking) {\n    return newWaypoints;\n  }\n\n  var waypoints = connection.waypoints;\n\n  connection.waypoints = newWaypoints;\n\n  connection.waypoints = connectionDocking.getCroppedWaypoints(connection);\n\n  newWaypoints = connection.waypoints;\n\n  connection.waypoints = waypoints;\n\n  return newWaypoints;\n};\n\n\n// helpers //////////\n\nexport function isReverse(context) {\n  var hover = context.hover,\n      source = context.source,\n      target = context.target,\n      type = context.type;\n\n  if (type === RECONNECT_START) {\n    return hover && target && hover === target && source !== target;\n  }\n\n  if (type === RECONNECT_END) {\n    return hover && source && hover === source && source !== target;\n  }\n}","import {\n  classes as svgClasses,\n  remove as svgRemove\n} from 'tiny-svg';\n\nimport { addBendpoint } from './BendpointUtil';\n\nimport { translate } from '../../util/SvgTransformUtil';\n\nimport { isReverse } from './BendpointMove';\n\nvar RECONNECT_START = 'reconnectStart',\n    RECONNECT_END = 'reconnectEnd',\n    UPDATE_WAYPOINTS = 'updateWaypoints';\n\nvar MARKER_OK = 'connect-ok',\n    MARKER_NOT_OK = 'connect-not-ok',\n    MARKER_CONNECT_HOVER = 'connect-hover',\n    MARKER_CONNECT_UPDATING = 'djs-updating',\n    MARKER_ELEMENT_HIDDEN = 'djs-element-hidden';\n\nvar HIGH_PRIORITY = 1100;\n\n/**\n * Preview connection while moving bendpoints.\n */\nexport default function BendpointMovePreview(bendpointMove, injector, eventBus, canvas) {\n  this._injector = injector;\n\n  var connectionPreview = injector.get('connectionPreview', false);\n\n  eventBus.on('bendpoint.move.start', function(event) {\n    var context = event.context,\n        bendpointIndex = context.bendpointIndex,\n        connection = context.connection,\n        insert = context.insert,\n        waypoints = connection.waypoints,\n        newWaypoints = waypoints.slice();\n\n    context.waypoints = waypoints;\n\n    if (insert) {\n\n      // insert placeholder for new bendpoint\n      newWaypoints.splice(bendpointIndex, 0, { x: event.x, y: event.y });\n    }\n\n    connection.waypoints = newWaypoints;\n\n    // add dragger gfx\n    var draggerGfx = context.draggerGfx = addBendpoint(canvas.getLayer('overlays'));\n\n    svgClasses(draggerGfx).add('djs-dragging');\n\n    canvas.addMarker(connection, MARKER_ELEMENT_HIDDEN);\n    canvas.addMarker(connection, MARKER_CONNECT_UPDATING);\n  });\n\n  eventBus.on('bendpoint.move.hover', function(event) {\n    var context = event.context,\n        allowed = context.allowed,\n        hover = context.hover,\n        type = context.type;\n\n    if (hover) {\n      canvas.addMarker(hover, MARKER_CONNECT_HOVER);\n\n      if (type === UPDATE_WAYPOINTS) {\n        return;\n      }\n\n      if (allowed) {\n        canvas.removeMarker(hover, MARKER_NOT_OK);\n        canvas.addMarker(hover, MARKER_OK);\n      } else if (allowed === false) {\n        canvas.removeMarker(hover, MARKER_OK);\n        canvas.addMarker(hover, MARKER_NOT_OK);\n      }\n    }\n  });\n\n  eventBus.on([\n    'bendpoint.move.out',\n    'bendpoint.move.cleanup'\n  ], HIGH_PRIORITY, function(event) {\n    var context = event.context,\n        hover = context.hover,\n        target = context.target;\n\n    if (hover) {\n      canvas.removeMarker(hover, MARKER_CONNECT_HOVER);\n      canvas.removeMarker(hover, target ? MARKER_OK : MARKER_NOT_OK);\n    }\n  });\n\n  eventBus.on('bendpoint.move.move', function(event) {\n    var context = event.context,\n        allowed = context.allowed,\n        bendpointIndex = context.bendpointIndex,\n        draggerGfx = context.draggerGfx,\n        hover = context.hover,\n        type = context.type,\n        connection = context.connection,\n        source = connection.source,\n        target = connection.target,\n        newWaypoints = connection.waypoints.slice(),\n        bendpoint = { x: event.x, y: event.y },\n        hints = context.hints || {},\n        drawPreviewHints = {};\n\n    if (connectionPreview) {\n      if (hints.connectionStart) {\n        drawPreviewHints.connectionStart = hints.connectionStart;\n      }\n\n      if (hints.connectionEnd) {\n        drawPreviewHints.connectionEnd = hints.connectionEnd;\n      }\n\n\n      if (type === RECONNECT_START) {\n        if (isReverse(context)) {\n          drawPreviewHints.connectionEnd = drawPreviewHints.connectionEnd || bendpoint;\n\n          drawPreviewHints.source = target;\n          drawPreviewHints.target = hover || source;\n\n          newWaypoints = newWaypoints.reverse();\n        } else {\n          drawPreviewHints.connectionStart = drawPreviewHints.connectionStart || bendpoint;\n\n          drawPreviewHints.source = hover || source;\n          drawPreviewHints.target = target;\n        }\n      } else if (type === RECONNECT_END) {\n        if (isReverse(context)) {\n          drawPreviewHints.connectionStart = drawPreviewHints.connectionStart || bendpoint;\n\n          drawPreviewHints.source = hover || target;\n          drawPreviewHints.target = source;\n\n          newWaypoints = newWaypoints.reverse();\n        } else {\n          drawPreviewHints.connectionEnd = drawPreviewHints.connectionEnd || bendpoint;\n\n          drawPreviewHints.source = source;\n          drawPreviewHints.target = hover || target;\n        }\n\n      } else {\n        drawPreviewHints.noCropping = true;\n        drawPreviewHints.noLayout = true;\n        newWaypoints[ bendpointIndex ] = bendpoint;\n      }\n\n      if (type === UPDATE_WAYPOINTS) {\n        newWaypoints = bendpointMove.cropWaypoints(connection, newWaypoints);\n      }\n\n      drawPreviewHints.waypoints = newWaypoints;\n\n      connectionPreview.drawPreview(context, allowed, drawPreviewHints);\n    }\n\n    translate(draggerGfx, event.x, event.y);\n  }, this);\n\n  eventBus.on([\n    'bendpoint.move.end',\n    'bendpoint.move.cancel'\n  ], HIGH_PRIORITY, function(event) {\n    var context = event.context,\n        connection = context.connection,\n        draggerGfx = context.draggerGfx,\n        hover = context.hover,\n        target = context.target,\n        waypoints = context.waypoints;\n\n    connection.waypoints = waypoints;\n\n    // remove dragger gfx\n    svgRemove(draggerGfx);\n\n    canvas.removeMarker(connection, MARKER_CONNECT_UPDATING);\n    canvas.removeMarker(connection, MARKER_ELEMENT_HIDDEN);\n\n    if (hover) {\n      canvas.removeMarker(hover, MARKER_OK);\n      canvas.removeMarker(hover, target ? MARKER_OK : MARKER_NOT_OK);\n    }\n\n    if (connectionPreview) {\n      connectionPreview.cleanUp(context);\n    }\n  });\n}\n\nBendpointMovePreview.$inject = [\n  'bendpointMove',\n  'injector',\n  'eventBus',\n  'canvas'\n];","import {\n  pointsAligned,\n  pointsOnLine\n} from '../../util/Geometry';\n\nimport {\n  addSegmentDragger,\n  getConnectionIntersection\n} from './BendpointUtil';\n\nimport {\n  getMid,\n  getOrientation\n} from '../../layout/LayoutUtil';\n\nvar MARKER_CONNECT_HOVER = 'connect-hover',\n    MARKER_CONNECT_UPDATING = 'djs-updating';\n\nimport {\n  classes as svgClasses,\n  remove as svgRemove\n} from 'tiny-svg';\n\nimport {\n  translate\n} from '../../util/SvgTransformUtil';\n\n\nfunction axisAdd(point, axis, delta) {\n  return axisSet(point, axis, point[axis] + delta);\n}\n\nfunction axisSet(point, axis, value) {\n  return {\n    x: (axis === 'x' ? value : point.x),\n    y: (axis === 'y' ? value : point.y)\n  };\n}\n\nfunction axisFenced(position, segmentStart, segmentEnd, axis) {\n\n  var maxValue = Math.max(segmentStart[axis], segmentEnd[axis]),\n      minValue = Math.min(segmentStart[axis], segmentEnd[axis]);\n\n  var padding = 20;\n\n  var fencedValue = Math.min(Math.max(minValue + padding, position[axis]), maxValue - padding);\n\n  return axisSet(segmentStart, axis, fencedValue);\n}\n\nfunction flipAxis(axis) {\n  return axis === 'x' ? 'y' : 'x';\n}\n\n/**\n * Get the docking point on the given element.\n *\n * Compute a reasonable docking, if non exists.\n *\n * @param  {Point} point\n * @param  {djs.model.Shape} referenceElement\n * @param  {string} moveAxis (x|y)\n *\n * @return {Point}\n */\nfunction getDocking(point, referenceElement, moveAxis) {\n\n  var referenceMid,\n      inverseAxis;\n\n  if (point.original) {\n    return point.original;\n  } else {\n    referenceMid = getMid(referenceElement);\n    inverseAxis = flipAxis(moveAxis);\n\n    return axisSet(point, inverseAxis, referenceMid[inverseAxis]);\n  }\n}\n\n/**\n * A component that implements moving of bendpoints\n */\nexport default function ConnectionSegmentMove(\n    injector, eventBus, canvas,\n    dragging, graphicsFactory, modeling) {\n\n  // optional connection docking integration\n  var connectionDocking = injector.get('connectionDocking', false);\n\n\n  // API\n\n  this.start = function(event, connection, idx) {\n\n    var context,\n        gfx = canvas.getGraphics(connection),\n        segmentStartIndex = idx - 1,\n        segmentEndIndex = idx,\n        waypoints = connection.waypoints,\n        segmentStart = waypoints[segmentStartIndex],\n        segmentEnd = waypoints[segmentEndIndex],\n        intersection = getConnectionIntersection(canvas, waypoints, event),\n        direction, axis, dragPosition;\n\n    direction = pointsAligned(segmentStart, segmentEnd);\n\n    // do not move diagonal connection\n    if (!direction) {\n      return;\n    }\n\n    // the axis where we are going to move things\n    axis = direction === 'v' ? 'x' : 'y';\n\n    if (segmentStartIndex === 0) {\n      segmentStart = getDocking(segmentStart, connection.source, axis);\n    }\n\n    if (segmentEndIndex === waypoints.length - 1) {\n      segmentEnd = getDocking(segmentEnd, connection.target, axis);\n    }\n\n    if (intersection) {\n      dragPosition = intersection.point;\n    } else {\n\n      // set to segment center as default\n      dragPosition = {\n        x: (segmentStart.x + segmentEnd.x) / 2,\n        y: (segmentStart.y + segmentEnd.y) / 2\n      };\n    }\n\n    context = {\n      connection: connection,\n      segmentStartIndex: segmentStartIndex,\n      segmentEndIndex: segmentEndIndex,\n      segmentStart: segmentStart,\n      segmentEnd: segmentEnd,\n      axis: axis,\n      dragPosition: dragPosition\n    };\n\n    dragging.init(event, dragPosition, 'connectionSegment.move', {\n      cursor: axis === 'x' ? 'resize-ew' : 'resize-ns',\n      data: {\n        connection: connection,\n        connectionGfx: gfx,\n        context: context\n      }\n    });\n  };\n\n  /**\n   * Crop connection if connection cropping is provided.\n   *\n   * @param {Connection} connection\n   * @param {Array<Point>} newWaypoints\n   *\n   * @return {Array<Point>} cropped connection waypoints\n   */\n  function cropConnection(connection, newWaypoints) {\n\n    // crop connection, if docking service is provided only\n    if (!connectionDocking) {\n      return newWaypoints;\n    }\n\n    var oldWaypoints = connection.waypoints,\n        croppedWaypoints;\n\n    // temporary set new waypoints\n    connection.waypoints = newWaypoints;\n\n    croppedWaypoints = connectionDocking.getCroppedWaypoints(connection);\n\n    // restore old waypoints\n    connection.waypoints = oldWaypoints;\n\n    return croppedWaypoints;\n  }\n\n  // DRAGGING IMPLEMENTATION\n\n  function redrawConnection(data) {\n    graphicsFactory.update('connection', data.connection, data.connectionGfx);\n  }\n\n  function updateDragger(context, segmentOffset, event) {\n\n    var newWaypoints = context.newWaypoints,\n        segmentStartIndex = context.segmentStartIndex + segmentOffset,\n        segmentStart = newWaypoints[segmentStartIndex],\n        segmentEndIndex = context.segmentEndIndex + segmentOffset,\n        segmentEnd = newWaypoints[segmentEndIndex],\n        axis = flipAxis(context.axis);\n\n    // make sure the dragger does not move\n    // outside the connection\n    var draggerPosition = axisFenced(event, segmentStart, segmentEnd, axis);\n\n    // update dragger\n    translate(context.draggerGfx, draggerPosition.x, draggerPosition.y);\n  }\n\n  /**\n   * Filter waypoints for redundant ones (i.e. on the same axis).\n   * Returns the filtered waypoints and the offset related to the segment move.\n   *\n   * @param {Array<Point>} waypoints\n   * @param {Integer} segmentStartIndex of moved segment start\n   *\n   * @return {Object} { filteredWaypoints, segmentOffset }\n   */\n  function filterRedundantWaypoints(waypoints, segmentStartIndex) {\n\n    var segmentOffset = 0;\n\n    var filteredWaypoints = waypoints.filter(function(r, idx) {\n      if (pointsOnLine(waypoints[idx - 1], waypoints[idx + 1], r)) {\n\n        // remove point and increment offset\n        segmentOffset = idx <= segmentStartIndex ? segmentOffset - 1 : segmentOffset;\n        return false;\n      }\n\n      // dont remove point\n      return true;\n    });\n\n    return {\n      waypoints: filteredWaypoints,\n      segmentOffset: segmentOffset\n    };\n  }\n\n  eventBus.on('connectionSegment.move.start', function(event) {\n\n    var context = event.context,\n        connection = event.connection,\n        layer = canvas.getLayer('overlays');\n\n    context.originalWaypoints = connection.waypoints.slice();\n\n    // add dragger gfx\n    context.draggerGfx = addSegmentDragger(layer, context.segmentStart, context.segmentEnd);\n    svgClasses(context.draggerGfx).add('djs-dragging');\n\n    canvas.addMarker(connection, MARKER_CONNECT_UPDATING);\n  });\n\n  eventBus.on('connectionSegment.move.move', function(event) {\n\n    var context = event.context,\n        connection = context.connection,\n        segmentStartIndex = context.segmentStartIndex,\n        segmentEndIndex = context.segmentEndIndex,\n        segmentStart = context.segmentStart,\n        segmentEnd = context.segmentEnd,\n        axis = context.axis;\n\n    var newWaypoints = context.originalWaypoints.slice(),\n        newSegmentStart = axisAdd(segmentStart, axis, event['d' + axis]),\n        newSegmentEnd = axisAdd(segmentEnd, axis, event['d' + axis]);\n\n    // original waypoint count and added / removed\n    // from start waypoint delta. We use the later\n    // to retrieve the updated segmentStartIndex / segmentEndIndex\n    var waypointCount = newWaypoints.length,\n        segmentOffset = 0;\n\n    // move segment start / end by axis delta\n    newWaypoints[segmentStartIndex] = newSegmentStart;\n    newWaypoints[segmentEndIndex] = newSegmentEnd;\n\n    var sourceToSegmentOrientation,\n        targetToSegmentOrientation;\n\n    // handle first segment\n    if (segmentStartIndex < 2) {\n      sourceToSegmentOrientation = getOrientation(connection.source, newSegmentStart);\n\n      // first bendpoint, remove first segment if intersecting\n      if (segmentStartIndex === 1) {\n\n        if (sourceToSegmentOrientation === 'intersect') {\n          newWaypoints.shift();\n          newWaypoints[0] = newSegmentStart;\n          segmentOffset--;\n        }\n      }\n\n      // docking point, add segment if not intersecting anymore\n      else {\n        if (sourceToSegmentOrientation !== 'intersect') {\n          newWaypoints.unshift(segmentStart);\n          segmentOffset++;\n        }\n      }\n    }\n\n    // handle last segment\n    if (segmentEndIndex > waypointCount - 3) {\n      targetToSegmentOrientation = getOrientation(connection.target, newSegmentEnd);\n\n      // last bendpoint, remove last segment if intersecting\n      if (segmentEndIndex === waypointCount - 2) {\n\n        if (targetToSegmentOrientation === 'intersect') {\n          newWaypoints.pop();\n          newWaypoints[newWaypoints.length - 1] = newSegmentEnd;\n        }\n      }\n\n      // last bendpoint, remove last segment if intersecting\n      else {\n        if (targetToSegmentOrientation !== 'intersect') {\n          newWaypoints.push(segmentEnd);\n        }\n      }\n    }\n\n    // update connection waypoints\n    context.newWaypoints = connection.waypoints = cropConnection(connection, newWaypoints);\n\n    // update dragger position\n    updateDragger(context, segmentOffset, event);\n\n    // save segmentOffset in context\n    context.newSegmentStartIndex = segmentStartIndex + segmentOffset;\n\n    // redraw connection\n    redrawConnection(event);\n  });\n\n  eventBus.on('connectionSegment.move.hover', function(event) {\n\n    event.context.hover = event.hover;\n    canvas.addMarker(event.hover, MARKER_CONNECT_HOVER);\n  });\n\n  eventBus.on([\n    'connectionSegment.move.out',\n    'connectionSegment.move.cleanup'\n  ], function(event) {\n\n    // remove connect marker\n    // if it was added\n    var hover = event.context.hover;\n\n    if (hover) {\n      canvas.removeMarker(hover, MARKER_CONNECT_HOVER);\n    }\n  });\n\n  eventBus.on('connectionSegment.move.cleanup', function(event) {\n\n    var context = event.context,\n        connection = context.connection;\n\n    // remove dragger gfx\n    if (context.draggerGfx) {\n      svgRemove(context.draggerGfx);\n    }\n\n    canvas.removeMarker(connection, MARKER_CONNECT_UPDATING);\n  });\n\n  eventBus.on([\n    'connectionSegment.move.cancel',\n    'connectionSegment.move.end'\n  ], function(event) {\n    var context = event.context,\n        connection = context.connection;\n\n    connection.waypoints = context.originalWaypoints;\n\n    redrawConnection(event);\n  });\n\n  eventBus.on('connectionSegment.move.end', function(event) {\n\n    var context = event.context,\n        connection = context.connection,\n        newWaypoints = context.newWaypoints,\n        newSegmentStartIndex = context.newSegmentStartIndex;\n\n    // ensure we have actual pixel values bendpoint\n    // coordinates (important when zoom level was > 1 during move)\n    newWaypoints = newWaypoints.map(function(p) {\n      return {\n        original: p.original,\n        x: Math.round(p.x),\n        y: Math.round(p.y)\n      };\n    });\n\n    // apply filter redunant waypoints\n    var filtered = filterRedundantWaypoints(newWaypoints, newSegmentStartIndex);\n\n    // get filtered waypoints\n    var filteredWaypoints = filtered.waypoints,\n        croppedWaypoints = cropConnection(connection, filteredWaypoints),\n        segmentOffset = filtered.segmentOffset;\n\n    var hints = {\n      segmentMove: {\n        segmentStartIndex: context.segmentStartIndex,\n        newSegmentStartIndex: newSegmentStartIndex + segmentOffset\n      }\n    };\n\n    modeling.updateWaypoints(connection, croppedWaypoints, hints);\n  });\n}\n\nConnectionSegmentMove.$inject = [\n  'injector',\n  'eventBus',\n  'canvas',\n  'dragging',\n  'graphicsFactory',\n  'modeling'\n];\n","var abs = Math.abs,\n    round = Math.round;\n\n\n/**\n * Snap value to a collection of reference values.\n *\n * @param  {number} value\n * @param  {Array<number>} values\n * @param  {number} [tolerance=10]\n *\n * @return {number} the value we snapped to or null, if none snapped\n */\nexport function snapTo(value, values, tolerance) {\n  tolerance = tolerance === undefined ? 10 : tolerance;\n\n  var idx, snapValue;\n\n  for (idx = 0; idx < values.length; idx++) {\n    snapValue = values[idx];\n\n    if (abs(snapValue - value) <= tolerance) {\n      return snapValue;\n    }\n  }\n}\n\n\nexport function topLeft(bounds) {\n  return {\n    x: bounds.x,\n    y: bounds.y\n  };\n}\n\nexport function topRight(bounds) {\n  return {\n    x: bounds.x + bounds.width,\n    y: bounds.y\n  };\n}\n\nexport function bottomLeft(bounds) {\n  return {\n    x: bounds.x,\n    y: bounds.y + bounds.height\n  };\n}\n\nexport function bottomRight(bounds) {\n  return {\n    x: bounds.x + bounds.width,\n    y: bounds.y + bounds.height\n  };\n}\n\nexport function mid(bounds, defaultValue) {\n\n  if (!bounds || isNaN(bounds.x) || isNaN(bounds.y)) {\n    return defaultValue;\n  }\n\n  return {\n    x: round(bounds.x + bounds.width / 2),\n    y: round(bounds.y + bounds.height / 2)\n  };\n}\n\n\n/**\n * Retrieve the snap state of the given event.\n *\n * @param  {Event} event\n * @param  {string} axis\n *\n * @return {boolean} the snapped state\n *\n */\nexport function isSnapped(event, axis) {\n  var snapped = event.snapped;\n\n  if (!snapped) {\n    return false;\n  }\n\n  if (typeof axis === 'string') {\n    return snapped[axis];\n  }\n\n  return snapped.x && snapped.y;\n}\n\n\n/**\n * Set the given event as snapped.\n *\n * This method may change the x and/or y position of the shape\n * from the given event!\n *\n * @param {Event} event\n * @param {string} axis\n * @param {number|boolean} value\n *\n * @return {number} old value\n */\nexport function setSnapped(event, axis, value) {\n  if (typeof axis !== 'string') {\n    throw new Error('axis must be in [x, y]');\n  }\n\n  if (typeof value !== 'number' && value !== false) {\n    throw new Error('value must be Number or false');\n  }\n\n  var delta,\n      previousValue = event[axis];\n\n  var snapped = event.snapped = (event.snapped || {});\n\n\n  if (value === false) {\n    snapped[axis] = false;\n  } else {\n    snapped[axis] = true;\n\n    delta = value - previousValue;\n\n    event[axis] += delta;\n    event['d' + axis] += delta;\n  }\n\n  return previousValue;\n}\n\n/**\n * Get children of a shape.\n *\n * @param {djs.model.Shape} parent\n *\n * @returns {Array<djs.model.Shape|djs.model.Connection>}\n */\nexport function getChildren(parent) {\n  return parent.children || [];\n}","import {\n  assign,\n  forEach,\n  isArray\n} from 'min-dash';\n\nimport { setSnapped } from '../snapping/SnapUtil';\n\nvar abs= Math.abs,\n    round = Math.round;\n\nvar TOLERANCE = 10;\n\n\nexport default function BendpointSnapping(eventBus) {\n\n  function snapTo(values, value) {\n\n    if (isArray(values)) {\n      var i = values.length;\n\n      while (i--) if (abs(values[i] - value) <= TOLERANCE) {\n        return values[i];\n      }\n    } else {\n      values = +values;\n      var rem = value % values;\n\n      if (rem < TOLERANCE) {\n        return value - rem;\n      }\n\n      if (rem > values - TOLERANCE) {\n        return value - rem + values;\n      }\n    }\n\n    return value;\n  }\n\n  function mid(element) {\n    if (element.width) {\n      return {\n        x: round(element.width / 2 + element.x),\n        y: round(element.height / 2 + element.y)\n      };\n    }\n  }\n\n  // connection segment snapping //////////////////////\n\n  function getConnectionSegmentSnaps(context) {\n\n    var snapPoints = context.snapPoints,\n        connection = context.connection,\n        waypoints = connection.waypoints,\n        segmentStart = context.segmentStart,\n        segmentStartIndex = context.segmentStartIndex,\n        segmentEnd = context.segmentEnd,\n        segmentEndIndex = context.segmentEndIndex,\n        axis = context.axis;\n\n    if (snapPoints) {\n      return snapPoints;\n    }\n\n    var referenceWaypoints = [\n      waypoints[segmentStartIndex - 1],\n      segmentStart,\n      segmentEnd,\n      waypoints[segmentEndIndex + 1]\n    ];\n\n    if (segmentStartIndex < 2) {\n      referenceWaypoints.unshift(mid(connection.source));\n    }\n\n    if (segmentEndIndex > waypoints.length - 3) {\n      referenceWaypoints.unshift(mid(connection.target));\n    }\n\n    context.snapPoints = snapPoints = { horizontal: [] , vertical: [] };\n\n    forEach(referenceWaypoints, function(p) {\n\n      // we snap on existing bendpoints only,\n      // not placeholders that are inserted during add\n      if (p) {\n        p = p.original || p;\n\n        if (axis === 'y') {\n          snapPoints.horizontal.push(p.y);\n        }\n\n        if (axis === 'x') {\n          snapPoints.vertical.push(p.x);\n        }\n      }\n    });\n\n    return snapPoints;\n  }\n\n  eventBus.on('connectionSegment.move.move', 1500, function(event) {\n    var context = event.context,\n        snapPoints = getConnectionSegmentSnaps(context),\n        x = event.x,\n        y = event.y,\n        sx, sy;\n\n    if (!snapPoints) {\n      return;\n    }\n\n    // snap\n    sx = snapTo(snapPoints.vertical, x);\n    sy = snapTo(snapPoints.horizontal, y);\n\n\n    // correction x/y\n    var cx = (x - sx),\n        cy = (y - sy);\n\n    // update delta\n    assign(event, {\n      dx: event.dx - cx,\n      dy: event.dy - cy,\n      x: sx,\n      y: sy\n    });\n\n    // only set snapped if actually snapped\n    if (cx || snapPoints.vertical.indexOf(x) !== -1) {\n      setSnapped(event, 'x', sx);\n    }\n\n    if (cy || snapPoints.horizontal.indexOf(y) !== -1) {\n      setSnapped(event, 'y', sy);\n    }\n  });\n\n\n  // bendpoint snapping //////////////////////\n\n  function getBendpointSnaps(context) {\n\n    var snapPoints = context.snapPoints,\n        waypoints = context.connection.waypoints,\n        bendpointIndex = context.bendpointIndex;\n\n    if (snapPoints) {\n      return snapPoints;\n    }\n\n    var referenceWaypoints = [ waypoints[bendpointIndex - 1], waypoints[bendpointIndex + 1] ];\n\n    context.snapPoints = snapPoints = { horizontal: [] , vertical: [] };\n\n    forEach(referenceWaypoints, function(p) {\n\n      // we snap on existing bendpoints only,\n      // not placeholders that are inserted during add\n      if (p) {\n        p = p.original || p;\n\n        snapPoints.horizontal.push(p.y);\n        snapPoints.vertical.push(p.x);\n      }\n    });\n\n    return snapPoints;\n  }\n\n\n  eventBus.on([ 'bendpoint.move.move', 'bendpoint.move.end' ], 1500, function(event) {\n\n    var context = event.context,\n        snapPoints = getBendpointSnaps(context),\n        hover = context.hover,\n        hoverMid = hover && mid(hover),\n        x = event.x,\n        y = event.y,\n        sx, sy;\n\n    if (!snapPoints) {\n      return;\n    }\n\n    // snap to hover mid\n    sx = snapTo(hoverMid ? snapPoints.vertical.concat([ hoverMid.x ]) : snapPoints.vertical, x);\n    sy = snapTo(hoverMid ? snapPoints.horizontal.concat([ hoverMid.y ]) : snapPoints.horizontal, y);\n\n    // correction x/y\n    var cx = (x - sx),\n        cy = (y - sy);\n\n    // update delta\n    assign(event, {\n      dx: event.dx - cx,\n      dy: event.dy - cy,\n      x: event.x - cx,\n      y: event.y - cy\n    });\n\n    // only set snapped if actually snapped\n    if (cx || snapPoints.vertical.indexOf(x) !== -1) {\n      setSnapped(event, 'x', sx);\n    }\n\n    if (cy || snapPoints.horizontal.indexOf(y) !== -1) {\n      setSnapped(event, 'y', sy);\n    }\n  });\n}\n\n\nBendpointSnapping.$inject = [ 'eventBus' ];","import DraggingModule from '../dragging';\nimport RulesModule from '../rules';\n\nimport Bendpoints from './Bendpoints';\nimport BendpointMove from './BendpointMove';\nimport BendpointMovePreview from './BendpointMovePreview';\nimport ConnectionSegmentMove from './ConnectionSegmentMove';\nimport BendpointSnapping from './BendpointSnapping';\n\n\nexport default {\n  __depends__: [\n    DraggingModule,\n    RulesModule\n  ],\n  __init__: [ 'bendpoints', 'bendpointSnapping', 'bendpointMovePreview' ],\n  bendpoints: [ 'type', Bendpoints ],\n  bendpointMove: [ 'type', BendpointMove ],\n  bendpointMovePreview: [ 'type', BendpointMovePreview ],\n  connectionSegmentMove: [ 'type', ConnectionSegmentMove ],\n  bendpointSnapping: [ 'type', BendpointSnapping ]\n};\n","export default {\n  GREEN: '#7EC845',\n  PINK: '#F46F60',\n  ICE_BLUE: '#B8D6F7',\n  BLUE: '#23BFE7',\n  ORANGE: '#FF9D48',\n  YELLOW: '#F5D128',\n  BLACK: 'black'\n};","import {\n  delegate as domDelegate\n} from 'min-dom';\n\nimport {\n  assign\n} from 'min-dash';\n\nimport {\n  getBusinessObject\n} from '../../util/ModelUtil';\n\nimport COLORS from '../../util/ColorUtil';\n\nimport {\n  toPoint\n} from 'diagram-js/lib/util/Event';\nimport { isAny } from '../modeling/util/ModelingUtil';\n\nvar DEFAULT_SHAPE = {\n  type: 'postit:SquarePostit',\n  color: COLORS.GREEN,\n  $instanceOf: function() { return true; }\n};\n\nexport default function CanvasCreate(\n    eventBus, elementFactory, canvas, directEditing, modeling) {\n\n  var lastCreatedShape = DEFAULT_SHAPE;\n\n  function _getNewShapePosition(event) {\n    var eventPoint = toPoint(event);\n\n    return {\n      x: eventPoint.x,\n      y: eventPoint.y\n    };\n  }\n\n  function _activateDirectEdit(element) {\n    if (isAny(element, [ 'postit:Postit', 'postit:Group', 'postit:TextBox' ])) {\n\n      directEditing.activate(element);\n    }\n  }\n\n  function _createShapeOnCanvas(event) {\n    var position = _getNewShapePosition(event);\n\n    var newShape = elementFactory.createPostitElement(\n      'shape', assign(lastCreatedShape, position));\n\n    var root = canvas.getRootElement();\n\n    var createdShape = modeling.createShape(newShape, position, root);\n\n    _activateDirectEdit(createdShape);\n  }\n\n  function _saveLastCreatedShape(shape) {\n    if (!shape) {\n      lastCreatedShape = DEFAULT_SHAPE;\n      return;\n    }\n\n    var bo = getBusinessObject(shape);\n\n    lastCreatedShape = {\n      type: shape.type,\n      color: shape.color || bo.color,\n      $instanceOf: function(type) {\n        return (typeof bo.$instanceOf === 'function') && bo.$instanceOf(type);\n      }\n    };\n  }\n\n\n  eventBus.on('canvas.init', function(context) {\n    var svg = context.svg;\n\n    domDelegate.bind(svg, 'svg', 'dblclick', function(event) {\n      if (event.target !== svg) {\n        return;\n      }\n\n      _createShapeOnCanvas(event);\n    });\n\n    eventBus.on('create.end', function(context) {\n      var shape = context.shape;\n      _saveLastCreatedShape(shape);\n    });\n  });\n}\n\nCanvasCreate.prototype.$inject = [\n  'eventBus',\n  'elementFactory',\n  'canvas',\n  'directEditing',\n  'modeling'\n];","import {\n  assign,\n  bind,\n  pick\n} from 'min-dash';\n\nimport {\n  domify,\n  query as domQuery,\n  event as domEvent,\n  remove as domRemove\n} from 'min-dom';\n\nvar min = Math.min,\n    max = Math.max;\n\nfunction preventDefault(e) {\n  e.preventDefault();\n}\n\nfunction stopPropagation(e) {\n  e.stopPropagation();\n}\n\nfunction isTextNode(node) {\n  return node.nodeType === Node.TEXT_NODE;\n}\n\nfunction toArray(nodeList) {\n  return [].slice.call(nodeList);\n}\n\n/**\n * Initializes a container for a content editable div.\n *\n * Structure:\n *\n * container\n *   parent\n *     content\n *     resize-handle\n *\n * @param {object} options\n * @param {DOMElement} options.container The DOM element to append the contentContainer to\n * @param {Function} options.keyHandler Handler for key events\n * @param {Function} options.resizeHandler Handler for resize events\n */\nexport default function TextBox(options) {\n  this.container = options.container;\n\n  this.parent = domify(\n    '<div class=\"djs-direct-editing-parent\">' +\n      '<div class=\"djs-direct-editing-content\" contenteditable=\"true\"></div>' +\n    '</div>'\n  );\n\n  this.content = domQuery('[contenteditable]', this.parent);\n\n  this.keyHandler = options.keyHandler || function() {};\n  this.resizeHandler = options.resizeHandler || function() {};\n\n  this.autoResize = bind(this.autoResize, this);\n  this.handlePaste = bind(this.handlePaste, this);\n}\n\n\n/**\n * Create a text box with the given position, size, style and text content\n *\n * @param {Object} bounds\n * @param {Number} bounds.x absolute x position\n * @param {Number} bounds.y absolute y position\n * @param {Number} [bounds.width] fixed width value\n * @param {Number} [bounds.height] fixed height value\n * @param {Number} [bounds.maxWidth] maximum width value\n * @param {Number} [bounds.maxHeight] maximum height value\n * @param {Number} [bounds.minWidth] minimum width value\n * @param {Number} [bounds.minHeight] minimum height value\n * @param {Object} [style]\n * @param {String} value text content\n *\n * @return {DOMElement} The created content DOM element\n */\nTextBox.prototype.create = function(bounds, style, value, options) {\n  var self = this;\n\n  var parent = this.parent,\n      content = this.content,\n      container = this.container;\n\n  options = this.options = options || {};\n\n  style = this.style = style || {};\n\n  var parentStyle = pick(style, [\n    'width',\n    'height',\n    'maxWidth',\n    'maxHeight',\n    'minWidth',\n    'minHeight',\n    'left',\n    'top',\n    'backgroundColor',\n    'position',\n    'overflow',\n    'border',\n    'wordWrap',\n    'textAlign',\n    'outline',\n    'transform'\n  ]);\n\n  assign(parent.style, {\n    width: bounds.width + 'px',\n    height: bounds.height + 'px',\n    maxWidth: bounds.maxWidth + 'px',\n    maxHeight: bounds.maxHeight + 'px',\n    minWidth: bounds.minWidth + 'px',\n    minHeight: bounds.minHeight + 'px',\n    left: bounds.x + 'px',\n    top: bounds.y + 'px',\n    backgroundColor: '#ffffff',\n    position: 'absolute',\n    overflow: 'visible',\n    border: '1px solid #ccc',\n    boxSizing: 'border-box',\n    wordWrap: 'normal',\n    textAlign: 'center',\n    outline: 'none'\n  }, parentStyle);\n\n  var contentStyle = pick(style, [\n    'fontFamily',\n    'fontSize',\n    'fontWeight',\n    'lineHeight',\n    'padding',\n    'paddingTop',\n    'paddingRight',\n    'paddingBottom',\n    'paddingLeft'\n  ]);\n\n  assign(content.style, {\n    boxSizing: 'border-box',\n    width: '100%',\n    outline: 'none',\n    wordWrap: 'break-word'\n  }, contentStyle);\n\n  if (options.centerVertically) {\n    assign(content.style, {\n      position: 'absolute',\n      top: '50%',\n      transform: 'translate(0, -50%)'\n    }, contentStyle);\n  }\n\n  content.innerText = value;\n\n  domEvent.bind(content, 'keydown', this.keyHandler);\n  domEvent.bind(content, 'mousedown', stopPropagation);\n  domEvent.bind(content, 'paste', self.handlePaste);\n\n  if (options.autoResize) {\n    domEvent.bind(content, 'input', this.autoResize);\n  }\n\n  if (options.resizable) {\n    this.resizable(style);\n  }\n\n  container.appendChild(parent);\n\n  // set selection to end of text\n  this.setSelection(content.lastChild, content.lastChild && content.lastChild.length);\n\n  return parent;\n};\n\n/**\n * Intercept paste events to remove formatting from pasted text.\n */\nTextBox.prototype.handlePaste = function(e) {\n  var options = this.options,\n      style = this.style;\n\n  e.preventDefault();\n\n  var text;\n\n  if (e.clipboardData) {\n\n    // Chrome, Firefox, Safari\n    text = e.clipboardData.getData('text/plain');\n  } else {\n\n    // Internet Explorer\n    text = window.clipboardData.getData('Text');\n  }\n\n  this.insertText(text);\n\n  if (options.autoResize) {\n    var hasResized = this.autoResize(style);\n\n    if (hasResized) {\n      this.resizeHandler(hasResized);\n    }\n  }\n};\n\nTextBox.prototype.insertText = function(text) {\n\n  // insertText command not supported by Internet Explorer\n  var success = document.execCommand('insertText', false, text);\n\n  if (success) {\n    return;\n  }\n\n  this._insertTextIE(text);\n};\n\nTextBox.prototype._insertTextIE = function(text) {\n\n  // Internet Explorer\n  var range = this.getSelection(),\n      startContainer = range.startContainer,\n      endContainer = range.endContainer,\n      startOffset = range.startOffset,\n      endOffset = range.endOffset,\n      commonAncestorContainer = range.commonAncestorContainer;\n\n  var childNodesArray = toArray(commonAncestorContainer.childNodes);\n\n  var container,\n      offset;\n\n  if (isTextNode(commonAncestorContainer)) {\n    var containerTextContent = startContainer.textContent;\n\n    startContainer.textContent =\n      containerTextContent.substring(0, startOffset)\n      + text\n      + containerTextContent.substring(endOffset);\n\n    container = startContainer;\n    offset = startOffset + text.length;\n\n  } else if (startContainer === this.content && endContainer === this.content) {\n    var textNode = document.createTextNode(text);\n\n    this.content.insertBefore(textNode, childNodesArray[startOffset]);\n\n    container = textNode;\n    offset = textNode.textContent.length;\n  } else {\n    var startContainerChildIndex = childNodesArray.indexOf(startContainer),\n        endContainerChildIndex = childNodesArray.indexOf(endContainer);\n\n    childNodesArray.forEach(function(childNode, index) {\n\n      if (index === startContainerChildIndex) {\n        childNode.textContent =\n          startContainer.textContent.substring(0, startOffset) +\n          text +\n          endContainer.textContent.substring(endOffset);\n      } else if (index > startContainerChildIndex && index <= endContainerChildIndex) {\n        domRemove(childNode);\n      }\n    });\n\n    container = startContainer;\n    offset = startOffset + text.length;\n  }\n\n  if (container && offset !== undefined) {\n\n    // is necessary in Internet Explorer\n    setTimeout(function() {\n      self.setSelection(container, offset);\n    });\n  }\n};\n\n/**\n * Automatically resize element vertically to fit its content.\n */\nTextBox.prototype.autoResize = function() {\n  var parent = this.parent,\n      content = this.content;\n\n  var fontSize = parseInt(this.style.fontSize) || 12;\n\n  if (content.scrollHeight > parent.offsetHeight ||\n      content.scrollHeight < parent.offsetHeight - fontSize) {\n    var bounds = parent.getBoundingClientRect();\n\n    var height = content.scrollHeight;\n    parent.style.height = height + 'px';\n\n    this.resizeHandler({\n      width: bounds.width,\n      height: bounds.height,\n      dx: 0,\n      dy: height - bounds.height\n    });\n  }\n};\n\n/**\n * Make an element resizable by adding a resize handle.\n */\nTextBox.prototype.resizable = function() {\n  var self = this;\n\n  var parent = this.parent,\n      resizeHandle = this.resizeHandle;\n\n  var minWidth = parseInt(this.style.minWidth) || 0,\n      minHeight = parseInt(this.style.minHeight) || 0,\n      maxWidth = parseInt(this.style.maxWidth) || Infinity,\n      maxHeight = parseInt(this.style.maxHeight) || Infinity;\n\n  if (!resizeHandle) {\n    resizeHandle = this.resizeHandle = domify(\n      '<div class=\"djs-direct-editing-resize-handle\"></div>'\n    );\n\n    var startX, startY, startWidth, startHeight;\n\n    var onMouseDown = function(e) {\n      preventDefault(e);\n      stopPropagation(e);\n\n      startX = e.clientX;\n      startY = e.clientY;\n\n      var bounds = parent.getBoundingClientRect();\n\n      startWidth = bounds.width;\n      startHeight = bounds.height;\n\n      domEvent.bind(document, 'mousemove', onMouseMove);\n      domEvent.bind(document, 'mouseup', onMouseUp);\n    };\n\n    var onMouseMove = function(e) {\n      preventDefault(e);\n      stopPropagation(e);\n\n      var newWidth = min(max(startWidth + e.clientX - startX, minWidth), maxWidth);\n      var newHeight = min(max(startHeight + e.clientY - startY, minHeight), maxHeight);\n\n      parent.style.width = newWidth + 'px';\n      parent.style.height = newHeight + 'px';\n\n      self.resizeHandler({\n        width: startWidth,\n        height: startHeight,\n        dx: e.clientX - startX,\n        dy: e.clientY - startY\n      });\n    };\n\n    var onMouseUp = function(e) {\n      preventDefault(e);\n      stopPropagation(e);\n\n      domEvent.unbind(document,'mousemove', onMouseMove, false);\n      domEvent.unbind(document, 'mouseup', onMouseUp, false);\n    };\n\n    domEvent.bind(resizeHandle, 'mousedown', onMouseDown);\n  }\n\n  assign(resizeHandle.style, {\n    position: 'absolute',\n    bottom: '0px',\n    right: '0px',\n    cursor: 'nwse-resize',\n    width: '0',\n    height: '0',\n    borderTop: (parseInt(this.style.fontSize) / 4 || 3) + 'px solid transparent',\n    borderRight: (parseInt(this.style.fontSize) / 4 || 3) + 'px solid #ccc',\n    borderBottom: (parseInt(this.style.fontSize) / 4 || 3) + 'px solid #ccc',\n    borderLeft: (parseInt(this.style.fontSize) / 4 || 3) + 'px solid transparent'\n  });\n\n  parent.appendChild(resizeHandle);\n};\n\n\n/**\n * Clear content and style of the textbox, unbind listeners and\n * reset CSS style.\n */\nTextBox.prototype.destroy = function() {\n  var parent = this.parent,\n      content = this.content,\n      resizeHandle = this.resizeHandle;\n\n  // clear content\n  content.innerText = '';\n\n  // clear styles\n  parent.removeAttribute('style');\n  content.removeAttribute('style');\n\n  domEvent.unbind(content, 'keydown', this.keyHandler);\n  domEvent.unbind(content, 'mousedown', stopPropagation);\n  domEvent.unbind(content, 'input', this.autoResize);\n  domEvent.unbind(content, 'paste', this.handlePaste);\n\n  if (resizeHandle) {\n    resizeHandle.removeAttribute('style');\n\n    domRemove(resizeHandle);\n  }\n\n  domRemove(parent);\n};\n\n\nTextBox.prototype.getValue = function() {\n  return this.content.innerText.trim();\n};\n\n\nTextBox.prototype.getSelection = function() {\n  var selection = window.getSelection(),\n      range = selection.getRangeAt(0);\n\n  return range;\n};\n\n\nTextBox.prototype.setSelection = function(container, offset) {\n  var range = document.createRange();\n\n  if (container === null) {\n    range.selectNodeContents(this.content);\n  } else {\n    range.setStart(container, offset);\n    range.setEnd(container, offset);\n  }\n\n  var selection = window.getSelection();\n\n  selection.removeAllRanges();\n  selection.addRange(range);\n};\n","import {\n  bind,\n  find\n} from 'min-dash';\n\nimport TextBox from './TextBox';\n\n\n/**\n * A direct editing component that allows users\n * to edit an elements text directly in the diagram\n *\n * @param {EventBus} eventBus the event bus\n */\nexport default function DirectEditing(eventBus, canvas) {\n\n  this._eventBus = eventBus;\n\n  this._providers = [];\n  this._textbox = new TextBox({\n    container: canvas.getContainer(),\n    keyHandler: bind(this._handleKey, this),\n    resizeHandler: bind(this._handleResize, this)\n  });\n}\n\nDirectEditing.$inject = [ 'eventBus', 'canvas' ];\n\n\n/**\n * Register a direct editing provider\n\n * @param {Object} provider the provider, must expose an #activate(element) method that returns\n *                          an activation context ({ bounds: {x, y, width, height }, text }) if\n *                          direct editing is available for the given element.\n *                          Additionally the provider must expose a #update(element, value) method\n *                          to receive direct editing updates.\n */\nDirectEditing.prototype.registerProvider = function(provider) {\n  this._providers.push(provider);\n};\n\n\n/**\n * Returns true if direct editing is currently active\n *\n * @return {Boolean}\n */\nDirectEditing.prototype.isActive = function() {\n  return !!this._active;\n};\n\n\n/**\n * Cancel direct editing, if it is currently active\n */\nDirectEditing.prototype.cancel = function() {\n  if (!this._active) {\n    return;\n  }\n\n  this._fire('cancel');\n  this.close();\n};\n\n\nDirectEditing.prototype._fire = function(event, context) {\n  this._eventBus.fire('directEditing.' + event, context || { active: this._active });\n};\n\nDirectEditing.prototype.close = function() {\n  this._textbox.destroy();\n\n  this._fire('deactivate');\n\n  this._active = null;\n\n  this.resizable = undefined;\n};\n\n\nDirectEditing.prototype.complete = function() {\n\n  var active = this._active;\n\n  if (!active) {\n    return;\n  }\n\n  var containerBounds,\n      previousBounds = active.context.bounds,\n      newBounds = this.$textbox.getBoundingClientRect(),\n      newText = this.getValue(),\n      previousText = active.context.text;\n\n  if (\n    newText !== previousText ||\n    newBounds.height !== previousBounds.height ||\n    newBounds.width !== previousBounds.width\n  ) {\n    containerBounds = this._textbox.container.getBoundingClientRect();\n\n    active.provider.update(active.element, newText, active.context.text, {\n      x: newBounds.left - containerBounds.left,\n      y: newBounds.top - containerBounds.top,\n      width: newBounds.width,\n      height: newBounds.height\n    });\n  }\n\n  this._fire('complete');\n\n  this.close();\n};\n\n\nDirectEditing.prototype.getValue = function() {\n  return this._textbox.getValue();\n};\n\n\nDirectEditing.prototype._handleKey = function(e) {\n\n  // stop bubble\n  e.stopPropagation();\n\n  var key = e.keyCode || e.charCode;\n\n  // ESC\n  if (key === 27) {\n    e.preventDefault();\n    return this.cancel();\n  }\n\n  // Enter\n  if (key === 13 && !e.shiftKey) {\n    e.preventDefault();\n    return this.complete();\n  }\n};\n\n\nDirectEditing.prototype._handleResize = function(event) {\n  this._fire('resize', event);\n};\n\n\n/**\n * Activate direct editing on the given element\n *\n * @param {Object} ElementDescriptor the descriptor for a shape or connection\n * @return {Boolean} true if the activation was possible\n */\nDirectEditing.prototype.activate = function(element) {\n  if (this.isActive()) {\n    this.cancel();\n  }\n\n  // the direct editing context\n  var context;\n\n  var provider = find(this._providers, function(p) {\n    return (context = p.activate(element)) ? p : null;\n  });\n\n  // check if activation took place\n  if (context) {\n    this.$textbox = this._textbox.create(\n      context.bounds,\n      context.style,\n      context.text,\n      context.options\n    );\n\n    this._active = {\n      element: element,\n      context: context,\n      provider: provider\n    };\n\n    if (context.options && context.options.resizable) {\n      this.resizable = true;\n    }\n\n    this._fire('activate');\n  }\n\n  return !!context;\n};\n","import InteractionEventsModule from 'diagram-js/lib/features/interaction-events';\n\nimport DirectEditing from './lib/DirectEditing';\n\nexport default {\n  __depends__: [\n    InteractionEventsModule\n  ],\n  __init__: [ 'directEditing' ],\n  directEditing: [ 'type', DirectEditing ]\n};","import CanvasCreate from './CanvasCreate';\nimport DirectEditingModule from 'diagram-js-direct-editing';\n\nexport default {\n  __depends__: [\n    DirectEditingModule\n  ],\n  __init__: [ 'canvasCreate' ],\n  canvasCreate: [ 'type', CanvasCreate ]\n};","import {\n  getMid\n} from '../../layout/LayoutUtil';\n\nimport {\n  isNil,\n  isObject\n} from 'min-dash';\n\n\nexport default function Connect(eventBus, dragging, modeling, rules) {\n\n  // rules\n\n  function canConnect(source, target) {\n    return rules.allowed('connection.create', {\n      source: source,\n      target: target\n    });\n  }\n\n  function canConnectReverse(source, target) {\n    return canConnect(target, source);\n  }\n\n\n  // event handlers\n\n  eventBus.on('connect.hover', function(event) {\n    var context = event.context,\n        start = context.start,\n        hover = event.hover,\n        canExecute;\n\n    // cache hover state\n    context.hover = hover;\n\n    canExecute = context.canExecute = canConnect(start, hover);\n\n    // ignore hover\n    if (isNil(canExecute)) {\n      return;\n    }\n\n    if (canExecute !== false) {\n      context.source = start;\n      context.target = hover;\n\n      return;\n    }\n\n    canExecute = context.canExecute = canConnectReverse(start, hover);\n\n    // ignore hover\n    if (isNil(canExecute)) {\n      return;\n    }\n\n    if (canExecute !== false) {\n      context.source = hover;\n      context.target = start;\n    }\n  });\n\n  eventBus.on([ 'connect.out', 'connect.cleanup' ], function(event) {\n    var context = event.context;\n\n    context.hover = null;\n    context.source = null;\n    context.target = null;\n\n    context.canExecute = false;\n  });\n\n  eventBus.on('connect.end', function(event) {\n    var context = event.context,\n        canExecute = context.canExecute,\n        connectionStart = context.connectionStart,\n        connectionEnd = {\n          x: event.x,\n          y: event.y\n        },\n        source = context.source,\n        target = context.target;\n\n    if (!canExecute) {\n      return false;\n    }\n\n    var attrs = null,\n        hints = {\n          connectionStart: isReverse(context) ? connectionEnd : connectionStart,\n          connectionEnd: isReverse(context) ? connectionStart : connectionEnd\n        };\n\n    if (isObject(canExecute)) {\n      attrs = canExecute;\n    }\n\n    modeling.connect(source, target, attrs, hints);\n  });\n\n\n  // API\n\n  /**\n   * Start connect operation.\n   *\n   * @param {DOMEvent} event\n   * @param {djs.model.Base} start\n   * @param {Point} [connectionStart]\n   * @param {boolean} [autoActivate=false]\n   */\n  this.start = function(event, start, connectionStart, autoActivate) {\n    if (!isObject(connectionStart)) {\n      autoActivate = connectionStart;\n      connectionStart = getMid(start);\n    }\n\n    dragging.init(event, 'connect', {\n      autoActivate: autoActivate,\n      data: {\n        shape: start,\n        context: {\n          start: start,\n          connectionStart: connectionStart\n        }\n      }\n    });\n  };\n}\n\nConnect.$inject = [\n  'eventBus',\n  'dragging',\n  'modeling',\n  'rules'\n];\n\n\n// helpers //////////\n\nexport function isReverse(context) {\n  var hover = context.hover,\n      source = context.source,\n      target = context.target;\n\n  return hover && source && hover === source && source !== target;\n}","import { isReverse } from './Connect';\n\nvar HIGH_PRIORITY = 1100,\n    LOW_PRIORITY = 900;\n\nvar MARKER_OK = 'connect-ok',\n    MARKER_NOT_OK = 'connect-not-ok';\n\n/**\n * Shows connection preview during connect.\n *\n * @param {didi.Injector} injector\n * @param {EventBus} eventBus\n * @param {Canvas} canvas\n */\nexport default function ConnectPreview(injector, eventBus, canvas) {\n  var connectionPreview = injector.get('connectionPreview', false);\n\n  connectionPreview && eventBus.on('connect.move', function(event) {\n    var context = event.context,\n        canConnect = context.canExecute,\n        hover = context.hover,\n        source = context.source,\n        start = context.start,\n        startPosition = context.startPosition,\n        connectionStart = context.connectionStart,\n        connectionEnd = context.connectionEnd,\n        target = context.target;\n\n    if (!connectionStart) {\n      connectionStart = isReverse(context) ? {\n        x: event.x,\n        y: event.y\n      } : startPosition;\n    }\n\n    if (!connectionEnd) {\n      connectionEnd = isReverse(context) ? startPosition : {\n        x: event.x,\n        y: event.y\n      };\n    }\n\n    connectionPreview.drawPreview(context, canConnect, {\n      source: source || start,\n      target: target || hover,\n      connectionStart: connectionStart,\n      connectionEnd: connectionEnd\n    });\n  });\n\n  eventBus.on('connect.hover', LOW_PRIORITY, function(event) {\n    var context = event.context,\n        hover = event.hover,\n        canExecute = context.canExecute;\n\n    // ignore hover\n    if (canExecute === null) {\n      return;\n    }\n\n    canvas.addMarker(hover, canExecute ? MARKER_OK : MARKER_NOT_OK);\n  });\n\n  eventBus.on([\n    'connect.out',\n    'connect.cleanup'\n  ], HIGH_PRIORITY, function(event) {\n    var hover = event.hover;\n\n    if (hover) {\n      canvas.removeMarker(hover, MARKER_OK);\n      canvas.removeMarker(hover, MARKER_NOT_OK);\n    }\n  });\n\n  connectionPreview && eventBus.on('connect.cleanup', function(event) {\n    connectionPreview.cleanUp(event.context);\n  });\n}\n\nConnectPreview.$inject = [\n  'injector',\n  'eventBus',\n  'canvas'\n];\n","import SelectionModule from '../selection';\nimport RulesModule from '../rules';\nimport DraggingModule from '../dragging';\n\nimport Connect from './Connect';\nimport ConnectPreview from './ConnectPreview';\n\nexport default {\n  __depends__: [\n    SelectionModule,\n    RulesModule,\n    DraggingModule\n  ],\n  __init__: [\n    'connectPreview'\n  ],\n  connect: [ 'type', Connect ],\n  connectPreview: [ 'type', ConnectPreview ]\n};\n","import {\n  append as svgAppend,\n  attr as svgAttr,\n  classes as svgClasses,\n  create as svgCreate,\n  remove as svgRemove,\n  clear as svgClear\n} from 'tiny-svg';\n\nimport {\n  isObject\n} from 'min-dash';\n\nimport {\n  getElementLineIntersection,\n  getMid\n} from '../../layout/LayoutUtil';\n\n\nvar MARKER_CONNECTION_PREVIEW = 'djs-connection-preview';\n\n/**\n * Draws connection preview. Optionally, this can use layouter and connection docking to draw\n * better looking previews.\n *\n * @param {didi.Injector} injector\n * @param {Canvas} canvas\n * @param {GraphicsFactory} graphicsFactory\n * @param {ElementFactory} elementFactory\n */\nexport default function ConnectionPreview(\n    injector,\n    canvas,\n    graphicsFactory,\n    elementFactory\n) {\n  this._canvas = canvas;\n  this._graphicsFactory = graphicsFactory;\n  this._elementFactory = elementFactory;\n\n  // optional components\n  this._connectionDocking = injector.get('connectionDocking', false);\n  this._layouter = injector.get('layouter', false);\n}\n\nConnectionPreview.$inject = [\n  'injector',\n  'canvas',\n  'graphicsFactory',\n  'elementFactory'\n];\n\n/**\n * Draw connection preview.\n *\n * Provide at least one of <source, connectionStart> and <target, connectionEnd> to create a preview.\n * In the clean up stage, call `connectionPreview#cleanUp` with the context to remove preview.\n *\n * @param {Object} context\n * @param {Object|boolean} canConnect\n * @param {Object} hints\n * @param {djs.model.shape} [hints.source] source element\n * @param {djs.model.shape} [hints.target] target element\n * @param {Point} [hints.connectionStart] connection preview start\n * @param {Point} [hints.connectionEnd] connection preview end\n * @param {Array<Point>} [hints.waypoints] provided waypoints for preview\n * @param {boolean} [hints.noLayout] true if preview should not be laid out\n * @param {boolean} [hints.noCropping] true if preview should not be cropped\n * @param {boolean} [hints.noNoop] true if simple connection should not be drawn\n */\nConnectionPreview.prototype.drawPreview = function(context, canConnect, hints) {\n\n  hints = hints || {};\n\n  var connectionPreviewGfx = context.connectionPreviewGfx,\n      getConnection = context.getConnection,\n      source = hints.source,\n      target = hints.target,\n      waypoints = hints.waypoints,\n      connectionStart = hints.connectionStart,\n      connectionEnd = hints.connectionEnd,\n      noLayout = hints.noLayout,\n      noCropping = hints.noCropping,\n      noNoop = hints.noNoop,\n      connection;\n\n  var self = this;\n\n  if (!connectionPreviewGfx) {\n    connectionPreviewGfx = context.connectionPreviewGfx = this.createConnectionPreviewGfx();\n  }\n\n  svgClear(connectionPreviewGfx);\n\n  if (!getConnection) {\n    getConnection = context.getConnection = cacheReturnValues(function(canConnect, source, target) {\n      return self.getConnection(canConnect, source, target);\n    });\n  }\n\n  if (canConnect) {\n    connection = getConnection(canConnect, source, target);\n  }\n\n  if (!connection) {\n    !noNoop && this.drawNoopPreview(connectionPreviewGfx, hints);\n    return;\n  }\n\n  connection.waypoints = waypoints || [];\n\n  // optional layout\n  if (this._layouter && !noLayout) {\n    connection.waypoints = this._layouter.layoutConnection(connection, {\n      source: source,\n      target: target,\n      connectionStart: connectionStart,\n      connectionEnd: connectionEnd,\n      waypoints: hints.waypoints || connection.waypoints\n    });\n  }\n\n  // fallback if no waypoints were provided nor created with layouter\n  if (!connection.waypoints || !connection.waypoints.length) {\n    connection.waypoints = [\n      source ? getMid(source) : connectionStart,\n      target ? getMid(target) : connectionEnd\n    ];\n  }\n\n  // optional cropping\n  if (this._connectionDocking && (source || target) && !noCropping) {\n    connection.waypoints = this._connectionDocking.getCroppedWaypoints(connection, source, target);\n  }\n\n  this._graphicsFactory.drawConnection(connectionPreviewGfx, connection);\n};\n\n/**\n * Draw simple connection between source and target or provided points.\n *\n * @param {SVGElement} connectionPreviewGfx container for the connection\n * @param {Object} hints\n * @param {djs.model.shape} [hints.source] source element\n * @param {djs.model.shape} [hints.target] target element\n * @param {Point} [hints.connectionStart] required if source is not provided\n * @param {Point} [hints.connectionEnd] required if target is not provided\n */\nConnectionPreview.prototype.drawNoopPreview = function(connectionPreviewGfx, hints) {\n  var source = hints.source,\n      target = hints.target,\n      start = hints.connectionStart || getMid(source),\n      end = hints.connectionEnd || getMid(target);\n\n  var waypoints = this.cropWaypoints(start, end, source, target);\n\n  var connection = this.createNoopConnection(waypoints[0], waypoints[1]);\n\n  svgAppend(connectionPreviewGfx, connection);\n};\n\n/**\n * Return cropped waypoints.\n *\n * @param {Point} start\n * @param {Point} end\n * @param {djs.model.shape} source\n * @param {djs.model.shape} target\n *\n * @returns {Array}\n */\nConnectionPreview.prototype.cropWaypoints = function(start, end, source, target) {\n  var graphicsFactory = this._graphicsFactory,\n      sourcePath = source && graphicsFactory.getShapePath(source),\n      targetPath = target && graphicsFactory.getShapePath(target),\n      connectionPath = graphicsFactory.getConnectionPath({ waypoints: [ start, end ] });\n\n  start = (source && getElementLineIntersection(sourcePath, connectionPath, true)) || start;\n  end = (target && getElementLineIntersection(targetPath, connectionPath, false)) || end;\n\n  return [ start, end ];\n};\n\n/**\n * Remove connection preview container if it exists.\n *\n * @param {Object} [context]\n * @param {SVGElement} [context.connectionPreviewGfx] preview container\n */\nConnectionPreview.prototype.cleanUp = function(context) {\n  if (context && context.connectionPreviewGfx) {\n    svgRemove(context.connectionPreviewGfx);\n  }\n};\n\n/**\n * Get connection that connects source and target.\n *\n * @param {Object|boolean} canConnect\n *\n * @returns {djs.model.connection}\n */\nConnectionPreview.prototype.getConnection = function(canConnect) {\n  var attrs = ensureConnectionAttrs(canConnect);\n\n  return this._elementFactory.createConnection(attrs);\n};\n\n\n/**\n * Add and return preview graphics.\n *\n * @returns {SVGElement}\n */\nConnectionPreview.prototype.createConnectionPreviewGfx = function() {\n  var gfx = svgCreate('g');\n\n  svgAttr(gfx, {\n    pointerEvents: 'none'\n  });\n\n  svgClasses(gfx).add(MARKER_CONNECTION_PREVIEW);\n\n  svgAppend(this._canvas.getDefaultLayer(), gfx);\n\n  return gfx;\n};\n\n/**\n * Create and return simple connection.\n *\n * @param {Point} start\n * @param {Point} end\n *\n * @returns {SVGElement}\n */\nConnectionPreview.prototype.createNoopConnection = function(start, end) {\n  var connection = svgCreate('polyline');\n\n  svgAttr(connection, {\n    'stroke': '#333',\n    'strokeDasharray': [ 1 ],\n    'strokeWidth': 2,\n    'pointer-events': 'none'\n  });\n\n  svgAttr(connection, { 'points': [ start.x, start.y, end.x, end.y ] });\n\n  return connection;\n};\n\n// helpers //////////\n\n/**\n * Returns function that returns cached return values referenced by stringified first argument.\n *\n * @param {Function} fn\n *\n * @return {Function}\n */\nfunction cacheReturnValues(fn) {\n  var returnValues = {};\n\n  /**\n   * Return cached return value referenced by stringified first argument.\n   *\n   * @returns {*}\n   */\n  return function(firstArgument) {\n    var key = JSON.stringify(firstArgument);\n\n    var returnValue = returnValues[key];\n\n    if (!returnValue) {\n      returnValue = returnValues[key] = fn.apply(null, arguments);\n    }\n\n    return returnValue;\n  };\n}\n\n/**\n * Ensure connection attributes is object.\n *\n * @param {Object|boolean} canConnect\n *\n * @returns {Object}\n */\nfunction ensureConnectionAttrs(canConnect) {\n  if (isObject(canConnect)) {\n    return canConnect;\n  } else {\n    return {};\n  }\n}\n","import ConnectionPreview from './ConnectionPreview';\n\nexport default {\n  __init__: [ 'connectionPreview' ],\n  connectionPreview: [ 'type', ConnectionPreview ]\n};\n","import {\n  assign,\n  isFunction,\n  isArray,\n  forEach,\n  isDefined\n} from 'min-dash';\n\nimport {\n  delegate as domDelegate,\n  event as domEvent,\n  attr as domAttr,\n  query as domQuery,\n  classes as domClasses,\n  domify as domify\n} from 'min-dom';\n\nvar entrySelector = '.entry';\n\nvar DEFAULT_PRIORITY = 1000;\n\n\n/**\n * A context pad that displays element specific, contextual actions next\n * to a diagram element.\n *\n * @param {Object} config\n * @param {boolean|Object} [config.scale={ min: 1.0, max: 1.5 }]\n * @param {number} [config.scale.min]\n * @param {number} [config.scale.max]\n * @param {EventBus} eventBus\n * @param {Overlays} overlays\n */\nexport default function ContextPad(config, eventBus, overlays) {\n\n  this._eventBus = eventBus;\n  this._overlays = overlays;\n\n  var scale = isDefined(config && config.scale) ? config.scale : {\n    min: 1,\n    max: 1.5\n  };\n\n  this._overlaysConfig = {\n    position: {\n      right: -9,\n      top: -6\n    },\n    scale: scale\n  };\n\n  this._current = null;\n\n  this._init();\n}\n\nContextPad.$inject = [\n  'config.contextPad',\n  'eventBus',\n  'overlays'\n];\n\n\n/**\n * Registers events needed for interaction with other components\n */\nContextPad.prototype._init = function() {\n\n  var eventBus = this._eventBus;\n\n  var self = this;\n\n  eventBus.on('selection.changed', function(e) {\n\n    var selection = e.newSelection;\n\n    if (selection.length === 1) {\n      self.open(selection[0]);\n    } else {\n      self.close();\n    }\n  });\n\n  eventBus.on('elements.delete', function(event) {\n    var elements = event.elements;\n\n    forEach(elements, function(e) {\n      if (self.isOpen(e)) {\n        self.close();\n      }\n    });\n  });\n\n  eventBus.on('element.changed', function(event) {\n    var element = event.element,\n        current = self._current;\n\n    // force reopen if element for which we are currently opened changed\n    if (current && current.element === element) {\n      self.open(element, true);\n    }\n  });\n};\n\n\n/**\n * Register a provider with the context pad\n *\n * @param  {number} [priority=1000]\n * @param  {ContextPadProvider} provider\n *\n * @example\n * const contextPadProvider = {\n  *   getContextPadEntries: function(element) {\n  *     return function(entries) {\n  *       return {\n  *         ...entries,\n  *         'entry-1': {\n  *           label: 'My Entry',\n  *           action: function() { alert(\"I have been clicked!\"); }\n  *         }\n  *       };\n  *     }\n  *   }\n  * };\n  *\n * contextPad.registerProvider(800, contextPadProvider);\n */\nContextPad.prototype.registerProvider = function(priority, provider) {\n  if (!provider) {\n    provider = priority;\n    priority = DEFAULT_PRIORITY;\n  }\n\n  this._eventBus.on('contextPad.getProviders', priority, function(event) {\n    event.providers.push(provider);\n  });\n};\n\n\n/**\n * Returns the context pad entries for a given element\n *\n * @param {djs.element.Base} element\n *\n * @return {Array<ContextPadEntryDescriptor>} list of entries\n */\nContextPad.prototype.getEntries = function(element) {\n  var providers = this._getProviders();\n\n  var entries = {};\n\n  // loop through all providers and their entries.\n  // group entries by id so that overriding an entry is possible\n  forEach(providers, function(provider) {\n    var entriesOrUpdater = provider.getContextPadEntries(element);\n\n    if (isFunction(entriesOrUpdater)) {\n      entries = entriesOrUpdater(entries);\n    } else {\n      forEach(entriesOrUpdater, function(entry, id) {\n        entries[id] = entry;\n      });\n    }\n  });\n\n  return entries;\n};\n\n\n/**\n * Trigger an action available on the opened context pad\n *\n * @param  {string} action\n * @param  {Event} event\n * @param  {boolean} [autoActivate=false]\n */\nContextPad.prototype.trigger = function(action, event, autoActivate) {\n\n  var element = this._current.element,\n      entries = this._current.entries,\n      entry,\n      handler,\n      originalEvent,\n      button = event.delegateTarget || event.target;\n\n  if (!button) {\n    return event.preventDefault();\n  }\n\n  entry = entries[domAttr(button, 'data-action')];\n  handler = entry.action;\n\n  originalEvent = event.originalEvent || event;\n\n  // simple action (via callback function)\n  if (isFunction(handler)) {\n    if (action === 'click') {\n      return handler(originalEvent, element, autoActivate);\n    }\n  } else {\n    if (handler[action]) {\n      return handler[action](originalEvent, element, autoActivate);\n    }\n  }\n\n  // silence other actions\n  event.preventDefault();\n};\n\n\n/**\n * Open the context pad for the given element\n *\n * @param {djs.model.Base} element\n * @param {boolean} force if true, force reopening the context pad\n */\nContextPad.prototype.open = function(element, force) {\n  if (!force && this.isOpen(element)) {\n    return;\n  }\n\n  this.close();\n  this._updateAndOpen(element);\n};\n\nContextPad.prototype._getProviders = function() {\n\n  var event = this._eventBus.createEvent({\n    type: 'contextPad.getProviders',\n    providers: []\n  });\n\n  this._eventBus.fire(event);\n\n  return event.providers;\n};\n\nContextPad.prototype._updateAndOpen = function(element) {\n\n  var entries = this.getEntries(element),\n      pad = this.getPad(element),\n      html = pad.html;\n\n  forEach(entries, function(entry, id) {\n    var grouping = entry.group || 'default',\n        control = domify(entry.html || '<div class=\"entry\" draggable=\"true\"></div>'),\n        container;\n\n    domAttr(control, 'data-action', id);\n\n    container = domQuery('[data-group=' + grouping + ']', html);\n    if (!container) {\n      container = domify('<div class=\"group\" data-group=\"' + grouping + '\"></div>');\n      html.appendChild(container);\n    }\n\n    container.appendChild(control);\n\n    if (entry.className) {\n      addClasses(control, entry.className);\n    }\n\n    if (entry.title) {\n      domAttr(control, 'title', entry.title);\n    }\n\n    if (entry.imageUrl) {\n      control.appendChild(domify('<img src=\"' + entry.imageUrl + '\">'));\n    }\n  });\n\n  domClasses(html).add('open');\n\n  this._current = {\n    element: element,\n    pad: pad,\n    entries: entries\n  };\n\n  this._eventBus.fire('contextPad.open', { current: this._current });\n};\n\n\nContextPad.prototype.getPad = function(element) {\n  if (this.isOpen()) {\n    return this._current.pad;\n  }\n\n  var self = this;\n\n  var overlays = this._overlays;\n\n  var html = domify('<div class=\"djs-context-pad\"></div>');\n\n  var overlaysConfig = assign({\n    html: html\n  }, this._overlaysConfig);\n\n  domDelegate.bind(html, entrySelector, 'click', function(event) {\n    self.trigger('click', event);\n  });\n\n  domDelegate.bind(html, entrySelector, 'dragstart', function(event) {\n    self.trigger('dragstart', event);\n  });\n\n  // stop propagation of mouse events\n  domEvent.bind(html, 'mousedown', function(event) {\n    event.stopPropagation();\n  });\n\n  this._overlayId = overlays.add(element, 'context-pad', overlaysConfig);\n\n  var pad = overlays.get(this._overlayId);\n\n  this._eventBus.fire('contextPad.create', { element: element, pad: pad });\n\n  return pad;\n};\n\n\n/**\n * Close the context pad\n */\nContextPad.prototype.close = function() {\n  if (!this.isOpen()) {\n    return;\n  }\n\n  this._overlays.remove(this._overlayId);\n\n  this._overlayId = null;\n\n  this._eventBus.fire('contextPad.close', { current: this._current });\n\n  this._current = null;\n};\n\n/**\n * Check if pad is open. If element is given, will check\n * if pad is opened with given element.\n *\n * @param {Element} element\n * @return {boolean}\n */\nContextPad.prototype.isOpen = function(element) {\n  return !!this._current && (!element ? true : this._current.element === element);\n};\n\n\n\n\n// helpers //////////////////////\n\nfunction addClasses(element, classNames) {\n\n  var classes = domClasses(element);\n\n  var actualClassNames = isArray(classNames) ? classNames : classNames.split(/\\s+/g);\n  actualClassNames.forEach(function(cls) {\n    classes.add(cls);\n  });\n}","import InteractionEventsModule from '../interaction-events';\nimport OverlaysModule from '../overlays';\n\nimport ContextPad from './ContextPad';\n\n\nexport default {\n  __depends__: [\n    InteractionEventsModule,\n    OverlaysModule\n  ],\n  contextPad: [ 'type', ContextPad ]\n};","import {\r\n  forEach\r\n} from 'min-dash';\r\n\r\nimport {\r\n  append as svgAppend,\r\n  attr as svgAttr,\r\n  classes as svgClasses,\r\n  clone as svgClone,\r\n  create as svgCreate,\r\n  remove as svgRemove\r\n} from 'tiny-svg';\r\n\r\nimport { query as domQuery } from 'min-dom';\r\n\r\nimport { getVisual } from '../../util/GraphicsUtil';\r\n\r\nvar MARKER_TYPES = [\r\n  'marker-start',\r\n  'marker-mid',\r\n  'marker-end'\r\n];\r\n\r\nvar NODES_CAN_HAVE_MARKER = [\r\n  'circle',\r\n  'ellipse',\r\n  'line',\r\n  'path',\r\n  'polygon',\r\n  'polyline',\r\n  'rect'\r\n];\r\n\r\n\r\n/**\r\n * Adds support for previews of moving/resizing elements.\r\n */\r\nexport default function PreviewSupport(elementRegistry, eventBus, canvas, styles) {\r\n  this._elementRegistry = elementRegistry;\r\n  this._canvas = canvas;\r\n  this._styles = styles;\r\n\r\n  this._clonedMarkers = {};\r\n\r\n  var self = this;\r\n\r\n  eventBus.on('drag.cleanup', function() {\r\n    forEach(self._clonedMarkers, function(clonedMarker) {\r\n      svgRemove(clonedMarker);\r\n    });\r\n\r\n    self._clonedMarkers = {};\r\n  });\r\n}\r\n\r\nPreviewSupport.$inject = [\r\n  'elementRegistry',\r\n  'eventBus',\r\n  'canvas',\r\n  'styles'\r\n];\r\n\r\n\r\n/**\r\n * Returns graphics of an element.\r\n *\r\n * @param {djs.model.Base} element\r\n *\r\n * @return {SVGElement}\r\n */\r\nPreviewSupport.prototype.getGfx = function(element) {\r\n  return this._elementRegistry.getGraphics(element);\r\n};\r\n\r\n/**\r\n * Adds a move preview of a given shape to a given svg group.\r\n *\r\n * @param {djs.model.Base} element\r\n * @param {SVGElement} group\r\n * @param {SVGElement} [gfx]\r\n *\r\n * @return {SVGElement} dragger\r\n */\r\nPreviewSupport.prototype.addDragger = function(element, group, gfx) {\r\n  gfx = gfx || this.getGfx(element);\r\n\r\n  var dragger = svgClone(gfx);\r\n  var bbox = gfx.getBoundingClientRect();\r\n\r\n  this._cloneMarkers(getVisual(dragger));\r\n\r\n  svgAttr(dragger, this._styles.cls('djs-dragger', [], {\r\n    x: bbox.top,\r\n    y: bbox.left\r\n  }));\r\n\r\n  svgAppend(group, dragger);\r\n\r\n  return dragger;\r\n};\r\n\r\n/**\r\n * Adds a resize preview of a given shape to a given svg group.\r\n *\r\n * @param {djs.model.Base} element\r\n * @param {SVGElement} group\r\n *\r\n * @return {SVGElement} frame\r\n */\r\nPreviewSupport.prototype.addFrame = function(shape, group) {\r\n\r\n  var frame = svgCreate('rect', {\r\n    class: 'djs-resize-overlay',\r\n    width:  shape.width,\r\n    height: shape.height,\r\n    x: shape.x,\r\n    y: shape.y\r\n  });\r\n\r\n  svgAppend(group, frame);\r\n\r\n  return frame;\r\n};\r\n\r\n/**\r\n * Clone all markers referenced by a node and its child nodes.\r\n *\r\n * @param {SVGElement} gfx\r\n */\r\nPreviewSupport.prototype._cloneMarkers = function(gfx) {\r\n  var self = this;\r\n\r\n  if (gfx.childNodes) {\r\n\r\n    // TODO: use forEach once we drop PhantomJS\r\n    for (var i = 0; i < gfx.childNodes.length; i++) {\r\n\r\n      // recursively clone markers of child nodes\r\n      self._cloneMarkers(gfx.childNodes[ i ]);\r\n    }\r\n  }\r\n\r\n  if (!canHaveMarker(gfx)) {\r\n    return;\r\n  }\r\n\r\n  MARKER_TYPES.forEach(function(markerType) {\r\n    if (svgAttr(gfx, markerType)) {\r\n      var marker = getMarker(gfx, markerType, self._canvas.getContainer());\r\n\r\n      self._cloneMarker(gfx, marker, markerType);\r\n    }\r\n  });\r\n};\r\n\r\n/**\r\n * Clone marker referenced by an element.\r\n *\r\n * @param {SVGElement} gfx\r\n * @param {SVGElement} marker\r\n * @param {string} markerType\r\n */\r\nPreviewSupport.prototype._cloneMarker = function(gfx, marker, markerType) {\r\n  var markerId = marker.id;\r\n\r\n  var clonedMarker = this._clonedMarkers[ markerId ];\r\n\r\n  if (!clonedMarker) {\r\n    clonedMarker = svgClone(marker);\r\n\r\n    var clonedMarkerId = markerId + '-clone';\r\n\r\n    clonedMarker.id = clonedMarkerId;\r\n\r\n    svgClasses(clonedMarker)\r\n      .add('djs-dragger')\r\n      .add('djs-dragger-marker');\r\n\r\n    this._clonedMarkers[ markerId ] = clonedMarker;\r\n\r\n    var defs = domQuery('defs', this._canvas._svg);\r\n\r\n    if (!defs) {\r\n      defs = svgCreate('defs');\r\n\r\n      svgAppend(this._canvas._svg, defs);\r\n    }\r\n\r\n    svgAppend(defs, clonedMarker);\r\n  }\r\n\r\n  var reference = idToReference(this._clonedMarkers[ markerId ].id);\r\n\r\n  svgAttr(gfx, markerType, reference);\r\n};\r\n\r\n// helpers //////////\r\n\r\n/**\r\n * Get marker of given type referenced by node.\r\n *\r\n * @param {Node} node\r\n * @param {string} markerType\r\n * @param {Node} [parentNode]\r\n *\r\n * @param {Node}\r\n */\r\nfunction getMarker(node, markerType, parentNode) {\r\n  var id = referenceToId(svgAttr(node, markerType));\r\n\r\n  return domQuery('marker#' + id, parentNode || document);\r\n}\r\n\r\n/**\r\n * Get ID of fragment within current document from its functional IRI reference.\r\n * References may use single or double quotes.\r\n *\r\n * @param {string} reference\r\n *\r\n * @returns {string}\r\n */\r\nfunction referenceToId(reference) {\r\n  return reference.match(/url\\(['\"]?#([^'\"]*)['\"]?\\)/)[1];\r\n}\r\n\r\n/**\r\n * Get functional IRI reference for given ID of fragment within current document.\r\n *\r\n * @param {string} id\r\n *\r\n * @returns {string}\r\n */\r\nfunction idToReference(id) {\r\n  return 'url(#' + id + ')';\r\n}\r\n\r\n/**\r\n * Check wether node type can have marker attributes.\r\n *\r\n * @param {Node} node\r\n *\r\n * @returns {boolean}\r\n */\r\nfunction canHaveMarker(node) {\r\n  return NODES_CAN_HAVE_MARKER.indexOf(node.nodeName) !== -1;\r\n}","import PreviewSupport from './PreviewSupport';\n\nexport default {\n  __init__: [ 'previewSupport' ],\n  previewSupport: [ 'type', PreviewSupport ]\n};\n","var MARKER_OK = 'drop-ok',\n    MARKER_NOT_OK = 'drop-not-ok',\n    MARKER_ATTACH = 'attach-ok',\n    MARKER_NEW_PARENT = 'new-parent';\n\nimport {\n  assign,\n  filter,\n  find,\n  forEach,\n  isArray,\n  isNumber,\n  map\n} from 'min-dash';\n\nimport { getBBox } from '../../util/Elements';\n\nvar PREFIX = 'create';\n\nvar HIGH_PRIORITY = 2000;\n\n\n/**\n * Create new elements through drag and drop.\n *\n * @param {Canvas} canvas\n * @param {Dragging} dragging\n * @param {EventBus} eventBus\n * @param {Modeling} modeling\n * @param {Rules} rules\n */\nexport default function Create(\n    canvas,\n    dragging,\n    eventBus,\n    modeling,\n    rules\n) {\n\n  // rules //////////\n\n  /**\n   * Check wether elements can be created.\n   *\n   * @param {Array<djs.model.Base>} elements\n   * @param {djs.model.Base} target\n   * @param {Point} position\n   * @param {djs.model.Base} [source]\n   *\n   * @returns {boolean|null|Object}\n   */\n  function canCreate(elements, target, position, source, hints) {\n    if (!target) {\n      return false;\n    }\n\n    // ignore child elements and external labels\n    elements = filter(elements, function(element) {\n      var labelTarget = element.labelTarget;\n\n      return !element.parent && !(isLabel(element) && elements.indexOf(labelTarget) !== -1);\n    });\n\n    var shape = find(elements, function(element) {\n      return !isConnection(element);\n    });\n\n    var attach = false,\n        connect = false,\n        create = false;\n\n    // (1) attaching single shapes\n    if (isSingleShape(elements)) {\n      attach = rules.allowed('shape.attach', {\n        position: position,\n        shape: shape,\n        target: target\n      });\n    }\n\n    if (!attach) {\n\n      // (2) creating elements\n      if (isSingleShape(elements)) {\n        create = rules.allowed('shape.create', {\n          position: position,\n          shape: shape,\n          source: source,\n          target: target\n        });\n      } else {\n        create = rules.allowed('elements.create', {\n          elements: elements,\n          position: position,\n          target: target\n        });\n      }\n\n    }\n\n    var connectionTarget = hints.connectionTarget;\n\n    // (3) appending single shapes\n    if (create || attach) {\n      if (shape && source) {\n        connect = rules.allowed('connection.create', {\n          source: connectionTarget === source ? shape : source,\n          target: connectionTarget === source ? source : shape,\n          hints: {\n            targetParent: target,\n            targetAttach: attach\n          }\n        });\n      }\n\n      return {\n        attach: attach,\n        connect: connect\n      };\n    }\n\n    // ignore wether or not elements can be created\n    if (create === null || attach === null) {\n      return null;\n    }\n\n    return false;\n  }\n\n  function setMarker(element, marker) {\n    [ MARKER_ATTACH, MARKER_OK, MARKER_NOT_OK, MARKER_NEW_PARENT ].forEach(function(m) {\n\n      if (m === marker) {\n        canvas.addMarker(element, m);\n      } else {\n        canvas.removeMarker(element, m);\n      }\n    });\n  }\n\n  // event handling //////////\n\n  eventBus.on([ 'create.move', 'create.hover' ], function(event) {\n    var context = event.context,\n        elements = context.elements,\n        hover = event.hover,\n        source = context.source,\n        hints = context.hints || {};\n\n    if (!hover) {\n      context.canExecute = false;\n      context.target = null;\n\n      return;\n    }\n\n    ensureConstraints(event);\n\n    var position = {\n      x: event.x,\n      y: event.y\n    };\n\n    var canExecute = context.canExecute = hover && canCreate(elements, hover, position, source, hints);\n\n    if (hover && canExecute !== null) {\n      context.target = hover;\n\n      if (canExecute && canExecute.attach) {\n        setMarker(hover, MARKER_ATTACH);\n      } else {\n        setMarker(hover, canExecute ? MARKER_NEW_PARENT : MARKER_NOT_OK);\n      }\n    }\n  });\n\n  eventBus.on([ 'create.end', 'create.out', 'create.cleanup' ], function(event) {\n    var hover = event.hover;\n\n    if (hover) {\n      setMarker(hover, null);\n    }\n  });\n\n  eventBus.on('create.end', function(event) {\n    var context = event.context,\n        source = context.source,\n        shape = context.shape,\n        elements = context.elements,\n        target = context.target,\n        canExecute = context.canExecute,\n        attach = canExecute && canExecute.attach,\n        connect = canExecute && canExecute.connect,\n        hints = context.hints || {};\n\n    if (canExecute === false || !target) {\n      return false;\n    }\n\n    ensureConstraints(event);\n\n    var position = {\n      x: event.x,\n      y: event.y\n    };\n\n    if (connect) {\n      shape = modeling.appendShape(source, shape, position, target, {\n        attach: attach,\n        connection: connect === true ? {} : connect,\n        connectionTarget: hints.connectionTarget\n      });\n    } else {\n      elements = modeling.createElements(elements, position, target, assign({}, hints, {\n        attach: attach\n      }));\n\n      // update shape\n      shape = find(elements, function(element) {\n        return !isConnection(element);\n      });\n    }\n\n    // update elements and shape\n    assign(context, {\n      elements: elements,\n      shape: shape\n    });\n\n    assign(event, {\n      elements: elements,\n      shape: shape\n    });\n  });\n\n  function cancel() {\n    var context = dragging.context();\n\n    if (context && context.prefix === PREFIX) {\n      dragging.cancel();\n    }\n  }\n\n  // cancel on <elements.changed> that is not result of <drag.end>\n  eventBus.on('create.init', function() {\n    eventBus.on('elements.changed', cancel);\n\n    eventBus.once([ 'create.cancel', 'create.end' ], HIGH_PRIORITY, function() {\n      eventBus.off('elements.changed', cancel);\n    });\n  });\n\n  // API //////////\n\n  this.start = function(event, elements, context) {\n    if (!isArray(elements)) {\n      elements = [ elements ];\n    }\n\n    var shape = find(elements, function(element) {\n      return !isConnection(element);\n    });\n\n    if (!shape) {\n\n      // at least one shape is required\n      return;\n    }\n\n    context = assign({\n      elements: elements,\n      hints: {},\n      shape: shape\n    }, context || {});\n\n    // make sure each element has x and y\n    forEach(elements, function(element) {\n      if (!isNumber(element.x)) {\n        element.x = 0;\n      }\n\n      if (!isNumber(element.y)) {\n        element.y = 0;\n      }\n    });\n\n    var bbox = getBBox(elements);\n\n    // center elements around cursor\n    forEach(elements, function(element) {\n      if (isConnection(element)) {\n        element.waypoints = map(element.waypoints, function(waypoint) {\n          return {\n            x: waypoint.x - bbox.x - bbox.width / 2,\n            y: waypoint.y - bbox.y - bbox.height / 2\n          };\n        });\n      }\n\n      assign(element, {\n        x: element.x - bbox.x - bbox.width / 2,\n        y: element.y - bbox.y - bbox.height / 2\n      });\n    });\n\n    dragging.init(event, PREFIX, {\n      cursor: 'grabbing',\n      autoActivate: true,\n      data: {\n        shape: shape,\n        elements: elements,\n        context: context\n      }\n    });\n  };\n}\n\nCreate.$inject = [\n  'canvas',\n  'dragging',\n  'eventBus',\n  'modeling',\n  'rules'\n];\n\n// helpers //////////\n\nfunction ensureConstraints(event) {\n  var context = event.context,\n      createConstraints = context.createConstraints;\n\n  if (!createConstraints) {\n    return;\n  }\n\n  if (createConstraints.left) {\n    event.x = Math.max(event.x, createConstraints.left);\n  }\n\n  if (createConstraints.right) {\n    event.x = Math.min(event.x, createConstraints.right);\n  }\n\n  if (createConstraints.top) {\n    event.y = Math.max(event.y, createConstraints.top);\n  }\n\n  if (createConstraints.bottom) {\n    event.y = Math.min(event.y, createConstraints.bottom);\n  }\n}\n\nfunction isConnection(element) {\n  return !!element.waypoints;\n}\n\nfunction isSingleShape(elements) {\n  return elements && elements.length === 1 && !isConnection(elements[0]);\n}\n\nfunction isLabel(element) {\n  return !!element.labelTarget;\n}\n","import {\r\n  translate\r\n} from '../../util/SvgTransformUtil';\r\n\r\nimport { getVisual } from '../../util/GraphicsUtil';\r\n\r\nimport {\r\n  append as svgAppend,\r\n  attr as svgAttr,\r\n  create as svgCreate,\r\n  remove as svgRemove\r\n} from 'tiny-svg';\r\n\r\nvar LOW_PRIORITY = 750;\r\n\r\n\r\nexport default function CreatePreview(\r\n    canvas,\r\n    eventBus,\r\n    graphicsFactory,\r\n    previewSupport,\r\n    styles\r\n) {\r\n  function createDragGroup(elements) {\r\n    var dragGroup = svgCreate('g');\r\n\r\n    svgAttr(dragGroup, styles.cls('djs-drag-group', [ 'no-events' ]));\r\n\r\n    var childrenGfx = svgCreate('g');\r\n\r\n    elements.forEach(function(element) {\r\n\r\n      // create graphics\r\n      var gfx;\r\n\r\n      if (element.hidden) {\r\n        return;\r\n      }\r\n\r\n      if (element.waypoints) {\r\n        gfx = graphicsFactory._createContainer('connection', childrenGfx);\r\n\r\n        graphicsFactory.drawConnection(getVisual(gfx), element);\r\n      } else {\r\n        gfx = graphicsFactory._createContainer('shape', childrenGfx);\r\n\r\n        graphicsFactory.drawShape(getVisual(gfx), element);\r\n\r\n        translate(gfx, element.x, element.y);\r\n      }\r\n\r\n      // add preview\r\n      previewSupport.addDragger(element, dragGroup, gfx);\r\n    });\r\n\r\n    return dragGroup;\r\n  }\r\n\r\n  eventBus.on('create.move', LOW_PRIORITY, function(event) {\r\n\r\n    var hover = event.hover,\r\n        context = event.context,\r\n        elements = context.elements,\r\n        dragGroup = context.dragGroup;\r\n\r\n    // lazily create previews\r\n    if (!dragGroup) {\r\n      dragGroup = context.dragGroup = createDragGroup(elements);\r\n    }\r\n\r\n    var defaultLayer;\r\n\r\n    if (hover) {\r\n      if (!dragGroup.parentNode) {\r\n        defaultLayer = canvas.getDefaultLayer();\r\n\r\n        svgAppend(defaultLayer, dragGroup);\r\n      }\r\n\r\n      translate(dragGroup, event.x, event.y);\r\n    } else {\r\n      svgRemove(dragGroup);\r\n    }\r\n  });\r\n\r\n  eventBus.on('create.cleanup', function(event) {\r\n    var context = event.context,\r\n        dragGroup = context.dragGroup;\r\n\r\n    if (dragGroup) {\r\n      svgRemove(dragGroup);\r\n    }\r\n  });\r\n}\r\n\r\nCreatePreview.$inject = [\r\n  'canvas',\r\n  'eventBus',\r\n  'graphicsFactory',\r\n  'previewSupport',\r\n  'styles'\r\n];\r\n","import DraggingModule from '../dragging';\nimport PreviewSupportModule from '../preview-support';\nimport RulesModule from '../rules';\nimport SelectionModule from '../selection';\n\nimport Create from './Create';\nimport CreatePreview from './CreatePreview';\n\n\nexport default {\n  __depends__: [\n    DraggingModule,\n    PreviewSupportModule,\n    RulesModule,\n    SelectionModule\n  ],\n  __init__: [\n    'create',\n    'createPreview'\n  ],\n  create: [ 'type', Create ],\n  createPreview: [ 'type', CreatePreview ]\n};\n","import {\n  assign,\n  forEach,\n  isFunction,\n  isDefined,\n  omit,\n  size\n} from 'min-dash';\n\nimport {\n  delegate as domDelegate,\n  domify as domify,\n  classes as domClasses,\n  attr as domAttr,\n  remove as domRemove\n} from 'min-dom';\n\nvar DATA_REF = 'data-id';\n\nvar CLOSE_EVENTS = [\n  'contextPad.close',\n  'canvas.viewbox.changing',\n  'commandStack.changed'\n];\n\nvar DEFAULT_PRIORITY = 1000;\n\n\n/**\n * A popup menu that can be used to display a list of actions anywhere in the canvas.\n *\n * @param {Object} config\n * @param {boolean|Object} [config.scale={ min: 1.0, max: 1.5 }]\n * @param {number} [config.scale.min]\n * @param {number} [config.scale.max]\n * @param {EventBus} eventBus\n * @param {Canvas} canvas\n *\n * @class\n * @constructor\n */\nexport default function PopupMenu(config, eventBus, canvas) {\n\n  var scale = isDefined(config && config.scale) ? config.scale : {\n    min: 1,\n    max: 1.5\n  };\n\n  this._config = {\n    scale: scale\n  };\n\n  this._eventBus = eventBus;\n  this._canvas = canvas;\n  this._providers = {};\n  this._current = {};\n}\n\nPopupMenu.$inject = [\n  'config.popupMenu',\n  'eventBus',\n  'canvas'\n];\n\n/**\n * Registers a popup menu provider\n *\n * @param  {string} id\n * @param {number} [priority=1000]\n * @param  {Object} provider\n *\n * @example\n * const popupMenuProvider = {\n *   getPopupMenuEntries: function(element) {\n *     return {\n *       'entry-1': {\n *         label: 'My Entry',\n *         action: function() { alert(\"I have been clicked!\"); }\n *       }\n *     }\n *   }\n * };\n *\n * popupMenu.registerProvider('myMenuID', popupMenuProvider);\n */\nPopupMenu.prototype.registerProvider = function(id, priority, provider) {\n  if (!provider) {\n    provider = priority;\n    priority = DEFAULT_PRIORITY;\n  }\n\n  this._eventBus.on('popupMenu.getProviders.' + id, priority, function(event) {\n    event.providers.push(provider);\n  });\n};\n\n/**\n * Determine if the popup menu has entries.\n *\n * @return {boolean} true if empty\n */\nPopupMenu.prototype.isEmpty = function(element, providerId) {\n  if (!element) {\n    throw new Error('element parameter is missing');\n  }\n\n  if (!providerId) {\n    throw new Error('providerId parameter is missing');\n  }\n\n  var providers = this._getProviders(providerId);\n\n  if (!providers) {\n    return true;\n  }\n\n  var entries = this._getEntries(element, providers),\n      headerEntries = this._getHeaderEntries(element, providers);\n\n  var hasEntries = size(entries) > 0,\n      hasHeaderEntries = headerEntries && size(headerEntries) > 0;\n\n  return !hasEntries && !hasHeaderEntries;\n};\n\n\n/**\n * Create entries and open popup menu at given position\n *\n * @param  {Object} element\n * @param  {string} id provider id\n * @param  {Object} position\n *\n * @return {Object} popup menu instance\n */\nPopupMenu.prototype.open = function(element, id, position) {\n\n  var providers = this._getProviders(id);\n\n  if (!element) {\n    throw new Error('Element is missing');\n  }\n\n  if (!providers || !providers.length) {\n    throw new Error('No registered providers for: ' + id);\n  }\n\n  if (!position) {\n    throw new Error('the position argument is missing');\n  }\n\n  if (this.isOpen()) {\n    this.close();\n  }\n\n  this._emit('open');\n\n  var current = this._current = {\n    className: id,\n    element: element,\n    position: position\n  };\n\n  var entries = this._getEntries(element, providers),\n      headerEntries = this._getHeaderEntries(element, providers);\n\n  current.entries = assign({}, entries, headerEntries);\n\n  current.container = this._createContainer();\n\n  if (size(headerEntries)) {\n    current.container.appendChild(\n      this._createEntries(headerEntries, 'djs-popup-header')\n    );\n  }\n\n  if (size(entries)) {\n    current.container.appendChild(\n      this._createEntries(entries, 'djs-popup-body')\n    );\n  }\n\n  var canvas = this._canvas,\n      parent = canvas.getContainer();\n\n  this._attachContainer(current.container, parent, position.cursor);\n  this._bindAutoClose();\n};\n\n\n/**\n * Removes the popup menu and unbinds the event handlers.\n */\nPopupMenu.prototype.close = function() {\n\n  if (!this.isOpen()) {\n    return;\n  }\n\n  this._emit('close');\n\n  this._unbindAutoClose();\n  domRemove(this._current.container);\n  this._current.container = null;\n};\n\n\n/**\n * Determine if an open popup menu exist.\n *\n * @return {boolean} true if open\n */\nPopupMenu.prototype.isOpen = function() {\n  return !!this._current.container;\n};\n\n\n/**\n * Trigger an action associated with an entry.\n *\n * @param {Object} event\n *\n * @return the result of the action callback, if any\n */\nPopupMenu.prototype.trigger = function(event) {\n\n  // silence other actions\n  event.preventDefault();\n\n  var element = event.delegateTarget || event.target,\n      entryId = domAttr(element, DATA_REF);\n\n  var entry = this._getEntry(entryId);\n\n  if (entry.action) {\n    return entry.action.call(null, event, entry);\n  }\n};\n\nPopupMenu.prototype._getProviders = function(id) {\n\n  var event = this._eventBus.createEvent({\n    type: 'popupMenu.getProviders.' + id,\n    providers: []\n  });\n\n  this._eventBus.fire(event);\n\n  return event.providers;\n};\n\nPopupMenu.prototype._getEntries = function(element, providers) {\n\n  var entries = {};\n\n  forEach(providers, function(provider) {\n\n    // handle legacy method\n    if (!provider.getPopupMenuEntries) {\n      forEach(provider.getEntries(element), function(entry) {\n        var id = entry.id;\n\n        if (!id) {\n          throw new Error('every entry must have the id property set');\n        }\n\n        entries[id] = omit(entry, [ 'id' ]);\n      });\n\n      return;\n    }\n\n    var entriesOrUpdater = provider.getPopupMenuEntries(element);\n\n    if (isFunction(entriesOrUpdater)) {\n      entries = entriesOrUpdater(entries);\n    } else {\n      forEach(entriesOrUpdater, function(entry, id) {\n        entries[id] = entry;\n      });\n    }\n  });\n\n  return entries;\n};\n\nPopupMenu.prototype._getHeaderEntries = function(element, providers) {\n\n  var entries = {};\n\n  forEach(providers, function(provider) {\n\n    // handle legacy method\n    if (!provider.getPopupMenuHeaderEntries) {\n      if (!provider.getHeaderEntries) {\n        return;\n      }\n\n      forEach(provider.getHeaderEntries(element), function(entry) {\n        var id = entry.id;\n\n        if (!id) {\n          throw new Error('every entry must have the id property set');\n        }\n\n        entries[id] = omit(entry, [ 'id' ]);\n      });\n\n      return;\n    }\n\n    var entriesOrUpdater = provider.getPopupMenuHeaderEntries(element);\n\n    if (isFunction(entriesOrUpdater)) {\n      entries = entriesOrUpdater(entries);\n    } else {\n      forEach(entriesOrUpdater, function(entry, id) {\n        entries[id] = entry;\n      });\n    }\n  });\n\n  return entries;\n\n\n};\n\n/**\n * Gets an entry instance (either entry or headerEntry) by id.\n *\n * @param  {string} entryId\n *\n * @return {Object} entry instance\n */\nPopupMenu.prototype._getEntry = function(entryId) {\n\n  var entry = this._current.entries[entryId];\n\n  if (!entry) {\n    throw new Error('entry not found');\n  }\n\n  return entry;\n};\n\nPopupMenu.prototype._emit = function(eventName) {\n  this._eventBus.fire('popupMenu.' + eventName);\n};\n\n/**\n * Creates the popup menu container.\n *\n * @return {Object} a DOM container\n */\nPopupMenu.prototype._createContainer = function() {\n  var container = domify('<div class=\"djs-popup\">'),\n      position = this._current.position,\n      className = this._current.className;\n\n  assign(container.style, {\n    position: 'absolute',\n    left: position.x + 'px',\n    top: position.y + 'px',\n    visibility: 'hidden'\n  });\n\n  domClasses(container).add(className);\n\n  return container;\n};\n\n\n/**\n * Attaches the container to the DOM.\n *\n * @param {Object} container\n * @param {Object} parent\n */\nPopupMenu.prototype._attachContainer = function(container, parent, cursor) {\n  var self = this;\n\n  // Event handler\n  domDelegate.bind(container, '.entry' ,'click', function(event) {\n    self.trigger(event);\n  });\n\n  this._updateScale(container);\n\n  // Attach to DOM\n  parent.appendChild(container);\n\n  if (cursor) {\n    this._assureIsInbounds(container, cursor);\n  }\n};\n\n\n/**\n * Updates popup style.transform with respect to the config and zoom level.\n *\n * @method _updateScale\n *\n * @param {Object} container\n */\nPopupMenu.prototype._updateScale = function(container) {\n  var zoom = this._canvas.zoom();\n\n  var scaleConfig = this._config.scale,\n      minScale,\n      maxScale,\n      scale = zoom;\n\n  if (scaleConfig !== true) {\n\n    if (scaleConfig === false) {\n      minScale = 1;\n      maxScale = 1;\n    } else {\n      minScale = scaleConfig.min;\n      maxScale = scaleConfig.max;\n    }\n\n    if (isDefined(minScale) && zoom < minScale) {\n      scale = minScale;\n    }\n\n    if (isDefined(maxScale) && zoom > maxScale) {\n      scale = maxScale;\n    }\n\n  }\n\n  setTransform(container, 'scale(' + scale + ')');\n};\n\n\n/**\n * Make sure that the menu is always fully shown\n *\n * @method function\n *\n * @param  {Object} container\n * @param  {Position} cursor {x, y}\n */\nPopupMenu.prototype._assureIsInbounds = function(container, cursor) {\n  var canvas = this._canvas,\n      clientRect = canvas._container.getBoundingClientRect();\n\n  var containerX = container.offsetLeft,\n      containerY = container.offsetTop,\n      containerWidth = container.scrollWidth,\n      containerHeight = container.scrollHeight,\n      overAxis = {},\n      left, top;\n\n  var cursorPosition = {\n    x: cursor.x - clientRect.left,\n    y: cursor.y - clientRect.top\n  };\n\n  if (containerX + containerWidth > clientRect.width) {\n    overAxis.x = true;\n  }\n\n  if (containerY + containerHeight > clientRect.height) {\n    overAxis.y = true;\n  }\n\n  if (overAxis.x && overAxis.y) {\n    left = cursorPosition.x - containerWidth + 'px';\n    top = cursorPosition.y - containerHeight + 'px';\n  } else if (overAxis.x) {\n    left = cursorPosition.x - containerWidth + 'px';\n    top = cursorPosition.y + 'px';\n  } else if (overAxis.y && cursorPosition.y < containerHeight) {\n    left = cursorPosition.x + 'px';\n    top = 10 + 'px';\n  } else if (overAxis.y) {\n    left = cursorPosition.x + 'px';\n    top = cursorPosition.y - containerHeight + 'px';\n  }\n\n  assign(container.style, { left: left, top: top }, { visibility: 'visible', 'z-index': 1000 });\n};\n\n\n/**\n * Creates a list of entries and returns them as a DOM container.\n *\n * @param {Array<Object>} entries an array of entry objects\n * @param {string} className the class name of the entry container\n *\n * @return {Object} a DOM container\n */\nPopupMenu.prototype._createEntries = function(entries, className) {\n\n  var entriesContainer = domify('<div>'),\n      self = this;\n\n  domClasses(entriesContainer).add(className);\n\n  forEach(entries, function(entry, id) {\n    var entryContainer = self._createEntry(entry, id);\n    entriesContainer.appendChild(entryContainer);\n  });\n\n  return entriesContainer;\n};\n\n\n/**\n * Creates a single entry and returns it as a DOM container.\n *\n * @param  {Object} entry\n *\n * @return {Object} a DOM container\n */\nPopupMenu.prototype._createEntry = function(entry, id) {\n\n  var entryContainer = domify('<div>'),\n      entryClasses = domClasses(entryContainer);\n\n  entryClasses.add('entry');\n\n  if (entry.className) {\n    entry.className.split(' ').forEach(function(className) {\n      entryClasses.add(className);\n    });\n  }\n\n  domAttr(entryContainer, DATA_REF, id);\n\n  if (entry.label) {\n    var label = domify('<span>');\n    label.textContent = entry.label;\n    entryContainer.appendChild(label);\n  }\n\n  if (entry.imageUrl) {\n    entryContainer.appendChild(domify('<img src=\"' + entry.imageUrl + '\" />'));\n  }\n\n  if (entry.active === true) {\n    entryClasses.add('active');\n  }\n\n  if (entry.disabled === true) {\n    entryClasses.add('disabled');\n  }\n\n  if (entry.title) {\n    entryContainer.title = entry.title;\n  }\n\n  return entryContainer;\n};\n\n\n/**\n * Set up listener to close popup automatically on certain events.\n */\nPopupMenu.prototype._bindAutoClose = function() {\n  this._eventBus.once(CLOSE_EVENTS, this.close, this);\n};\n\n\n/**\n * Remove the auto-closing listener.\n */\nPopupMenu.prototype._unbindAutoClose = function() {\n  this._eventBus.off(CLOSE_EVENTS, this.close, this);\n};\n\n\n\n// helpers /////////////////////////////\n\nfunction setTransform(element, transform) {\n  element.style['transform-origin'] = 'top left';\n\n  [ '', '-ms-', '-webkit-' ].forEach(function(prefix) {\n    element.style[prefix + 'transform'] = transform;\n  });\n}","import PopupMenu from './PopupMenu';\n\nexport default {\n  __init__: [ 'popupMenu' ],\n  popupMenu: [ 'type', PopupMenu ]\n};\n","/**\n * A clip board stub\n */\nexport default function Clipboard() {}\n\n\nClipboard.prototype.get = function() {\n  return this._data;\n};\n\nClipboard.prototype.set = function(data) {\n  this._data = data;\n};\n\nClipboard.prototype.clear = function() {\n  var data = this._data;\n\n  delete this._data;\n\n  return data;\n};\n\nClipboard.prototype.isEmpty = function() {\n  return !this._data;\n};","import Clipboard from './Clipboard';\n\nexport default {\n  clipboard: [ 'type', Clipboard ]\n};\n","export default function Mouse(eventBus) {\r\n  var self = this;\r\n\r\n  this._lastMoveEvent = null;\r\n\r\n  function setLastMoveEvent(mousemoveEvent) {\r\n    self._lastMoveEvent = mousemoveEvent;\r\n  }\r\n\r\n  eventBus.on('canvas.init', function(context) {\r\n    var svg = self._svg = context.svg;\r\n\r\n    svg.addEventListener('mousemove', setLastMoveEvent);\r\n  });\r\n\r\n  eventBus.on('canvas.destroy', function() {\r\n    self._lastMouseEvent = null;\r\n\r\n    self._svg.removeEventListener('mousemove', setLastMoveEvent);\r\n  });\r\n}\r\n\r\nMouse.$inject = [ 'eventBus' ];\r\n\r\nMouse.prototype.getLastMoveEvent = function() {\r\n  return this._lastMoveEvent || createMoveEvent(0, 0);\r\n};\r\n\r\n// helpers //////////\r\n\r\nexport function createMoveEvent(x, y) {\r\n  var event = document.createEvent('MouseEvent');\r\n\r\n  var screenX = x,\r\n      screenY = y,\r\n      clientX = x,\r\n      clientY = y;\r\n\r\n  if (event.initMouseEvent) {\r\n    event.initMouseEvent(\r\n      'mousemove',\r\n      true,\r\n      true,\r\n      window,\r\n      0,\r\n      screenX,\r\n      screenY,\r\n      clientX,\r\n      clientY,\r\n      false,\r\n      false,\r\n      false,\r\n      false,\r\n      0,\r\n      null\r\n    );\r\n  }\r\n\r\n  return event;\r\n}","import Mouse from './Mouse';\n\nexport default {\n  __init__: [ 'mouse' ],\n  mouse: [ 'type', Mouse ]\n};\n","import {\n  assign,\n  find,\n  forEach,\n  isArray,\n  isNumber,\n  map,\n  matchPattern,\n  omit,\n  sortBy\n} from 'min-dash';\n\nimport {\n  getBBox,\n  getParents\n} from '../../util/Elements';\n\nimport { eachElement } from '../../util/Elements';\n\n/**\n * @typedef {Function} <copyPaste.canCopyElements> listener\n *\n * @param {Object} context\n * @param {Array<djs.model.Base>} context.elements\n *\n * @returns {Array<djs.model.Base>|boolean} - Return elements to be copied or false to disallow\n * copying.\n */\n\n/**\n * @typedef {Function} <copyPaste.copyElement> listener\n *\n * @param {Object} context\n * @param {Object} context.descriptor\n * @param {djs.model.Base} context.element\n * @param {Array<djs.model.Base>} context.elements\n */\n\n/**\n * @typedef {Function} <copyPaste.elementsCopied> listener\n *\n * @param {Object} context\n * @param {Object} context.elements\n * @param {Object} context.tree\n */\n\n/**\n * @typedef {Function} <copyPaste.pasteElement> listener\n *\n * @param {Object} context\n * @param {Object} context.cache - Already created elements.\n * @param {Object} context.descriptor\n */\n\n/**\n * @typedef {Function} <copyPaste.pasteElements> listener\n *\n * @param {Object} context\n * @param {Object} context.hints - Add hints before pasting.\n */\n\n/**\n * Copy and paste elements.\n *\n * @param {Canvas} canvas\n * @param {Create} create\n * @param {Clipboard} clipboard\n * @param {ElementFactory} elementFactory\n * @param {EventBus} eventBus\n * @param {Modeling} modeling\n * @param {Mouse} mouse\n * @param {Rules} rules\n */\nexport default function CopyPaste(\n    canvas,\n    create,\n    clipboard,\n    elementFactory,\n    eventBus,\n    modeling,\n    mouse,\n    rules\n) {\n\n  this._canvas = canvas;\n  this._create = create;\n  this._clipboard = clipboard;\n  this._elementFactory = elementFactory;\n  this._eventBus = eventBus;\n  this._modeling = modeling;\n  this._mouse = mouse;\n  this._rules = rules;\n\n  eventBus.on('copyPaste.copyElement', function(context) {\n    var descriptor = context.descriptor,\n        element = context.element,\n        elements = context.elements;\n\n    // default priority (priority = 1)\n    descriptor.priority = 1;\n\n    descriptor.id = element.id;\n\n    var parentCopied = find(elements, function(e) {\n      return e === element.parent;\n    });\n\n    // do NOT reference parent if parent wasn't copied\n    if (parentCopied) {\n      descriptor.parent = element.parent.id;\n    }\n\n    // attachers (priority = 2)\n    if (isAttacher(element)) {\n      descriptor.priority = 2;\n\n      descriptor.host = element.host.id;\n    }\n\n    // connections (priority = 3)\n    if (isConnection(element)) {\n      descriptor.priority = 3;\n\n      descriptor.source = element.source.id;\n      descriptor.target = element.target.id;\n\n      descriptor.waypoints = copyWaypoints(element);\n    }\n\n    // labels (priority = 4)\n    if (isLabel(element)) {\n      descriptor.priority = 4;\n\n      descriptor.labelTarget = element.labelTarget.id;\n    }\n\n    forEach([ 'x', 'y', 'width', 'height' ], function(property) {\n      if (isNumber(element[ property ])) {\n        descriptor[ property ] = element[ property ];\n      }\n    });\n\n    descriptor.hidden = element.hidden;\n    descriptor.collapsed = element.collapsed;\n\n  });\n\n  eventBus.on('copyPaste.pasteElements', function(context) {\n    var hints = context.hints;\n\n    assign(hints, {\n      createElementsBehavior: false\n    });\n  });\n}\n\nCopyPaste.$inject = [\n  'canvas',\n  'create',\n  'clipboard',\n  'elementFactory',\n  'eventBus',\n  'modeling',\n  'mouse',\n  'rules'\n];\n\n\n/**\n * Copy elements.\n *\n * @param {Array<djs.model.Base>} elements\n *\n * @returns {Object}\n */\nCopyPaste.prototype.copy = function(elements) {\n  var allowed,\n      tree;\n\n  if (!isArray(elements)) {\n    elements = elements ? [ elements ] : [];\n  }\n\n  allowed = this._eventBus.fire('copyPaste.canCopyElements', {\n    elements: elements\n  });\n\n  if (allowed === false) {\n    tree = {};\n  } else {\n    tree = this.createTree(isArray(allowed) ? allowed : elements);\n  }\n\n  // we set an empty tree, selection of elements\n  // to copy was empty.\n  this._clipboard.set(tree);\n\n  this._eventBus.fire('copyPaste.elementsCopied', {\n    elements: elements,\n    tree: tree\n  });\n\n  return tree;\n};\n\n/**\n * Paste elements.\n *\n * @param {Object} [context]\n * @param {djs.model.base} [context.element] - Parent.\n * @param {Point} [context.point] - Position.\n * @param {Object} [context.hints] - Hints.\n */\nCopyPaste.prototype.paste = function(context) {\n  var tree = this._clipboard.get();\n\n  if (this._clipboard.isEmpty()) {\n    return;\n  }\n\n  var hints = context && context.hints || {};\n\n  this._eventBus.fire('copyPaste.pasteElements', {\n    hints: hints\n  });\n\n  var elements = this._createElements(tree);\n\n  // paste directly\n  if (context && context.element && context.point) {\n    return this._paste(elements, context.element, context.point, hints);\n  }\n\n  this._create.start(this._mouse.getLastMoveEvent(), elements, {\n    hints: hints || {}\n  });\n};\n\n/**\n * Paste elements directly.\n *\n * @param {Array<djs.model.Base>} elements\n * @param {djs.model.base} target\n * @param {Point} position\n * @param {Object} [hints]\n */\nCopyPaste.prototype._paste = function(elements, target, position, hints) {\n\n  // make sure each element has x and y\n  forEach(elements, function(element) {\n    if (!isNumber(element.x)) {\n      element.x = 0;\n    }\n\n    if (!isNumber(element.y)) {\n      element.y = 0;\n    }\n  });\n\n  var bbox = getBBox(elements);\n\n  // center elements around cursor\n  forEach(elements, function(element) {\n    if (isConnection(element)) {\n      element.waypoints = map(element.waypoints, function(waypoint) {\n        return {\n          x: waypoint.x - bbox.x - bbox.width / 2,\n          y: waypoint.y - bbox.y - bbox.height / 2\n        };\n      });\n    }\n\n    assign(element, {\n      x: element.x - bbox.x - bbox.width / 2,\n      y: element.y - bbox.y - bbox.height / 2\n    });\n  });\n\n  return this._modeling.createElements(elements, position, target, assign({}, hints));\n};\n\n/**\n * Create elements from tree.\n */\nCopyPaste.prototype._createElements = function(tree) {\n  var self = this;\n\n  var eventBus = this._eventBus;\n\n  var cache = {};\n\n  var elements = [];\n\n  forEach(tree, function(branch, depth) {\n\n    depth = parseInt(depth, 10);\n\n    // sort by priority\n    branch = sortBy(branch, 'priority');\n\n    forEach(branch, function(descriptor) {\n\n      // remove priority\n      var attrs = assign({}, omit(descriptor, [ 'priority' ]));\n\n      if (cache[ descriptor.parent ]) {\n        attrs.parent = cache[ descriptor.parent ];\n      } else {\n        delete attrs.parent;\n      }\n\n      eventBus.fire('copyPaste.pasteElement', {\n        cache: cache,\n        descriptor: attrs\n      });\n\n      var element;\n\n      if (isConnection(attrs)) {\n        attrs.source = cache[ descriptor.source ];\n        attrs.target = cache[ descriptor.target ];\n\n        element = cache[ descriptor.id ] = self.createConnection(attrs);\n\n        elements.push(element);\n\n        return;\n      }\n\n      if (isLabel(attrs)) {\n        attrs.labelTarget = cache[ attrs.labelTarget ];\n\n        element = cache[ descriptor.id ] = self.createLabel(attrs);\n\n        elements.push(element);\n\n        return;\n      }\n\n      if (attrs.host) {\n        attrs.host = cache[ attrs.host ];\n      }\n\n      element = cache[ descriptor.id ] = self.createShape(attrs);\n\n      elements.push(element);\n    });\n\n  });\n\n  return elements;\n};\n\nCopyPaste.prototype.createConnection = function(attrs) {\n  var connection = this._elementFactory.createConnection(omit(attrs, [ 'id' ]));\n\n  return connection;\n};\n\nCopyPaste.prototype.createLabel = function(attrs) {\n  var label = this._elementFactory.createLabel(omit(attrs, [ 'id' ]));\n\n  return label;\n};\n\nCopyPaste.prototype.createShape = function(attrs) {\n  var shape = this._elementFactory.createShape(omit(attrs, [ 'id' ]));\n\n  return shape;\n};\n\n/**\n * Check wether element has relations to other elements e.g. attachers, labels and connections.\n *\n * @param  {Object} element\n * @param  {Array<djs.model.Base>} elements\n *\n * @returns {boolean}\n */\nCopyPaste.prototype.hasRelations = function(element, elements) {\n  var labelTarget,\n      source,\n      target;\n\n  if (isConnection(element)) {\n    source = find(elements, matchPattern({ id: element.source.id }));\n    target = find(elements, matchPattern({ id: element.target.id }));\n\n    if (!source || !target) {\n      return false;\n    }\n  }\n\n  if (isLabel(element)) {\n    labelTarget = find(elements, matchPattern({ id: element.labelTarget.id }));\n\n    if (!labelTarget) {\n      return false;\n    }\n  }\n\n  return true;\n};\n\n/**\n * Create a tree-like structure from elements.\n *\n * @example\n * tree: {\n  *  0: [\n  *    { id: 'Shape_1', priority: 1, ... },\n  *    { id: 'Shape_2', priority: 1, ... },\n  *    { id: 'Connection_1', source: 'Shape_1', target: 'Shape_2', priority: 3, ... },\n  *    ...\n  *  ],\n  *  1: [\n  *    { id: 'Shape_3', parent: 'Shape1', priority: 1, ... },\n  *    ...\n  *  ]\n  * };\n  *\n  * @param  {Array<djs.model.base>} elements\n  *\n  * @return {Object}\n  */\nCopyPaste.prototype.createTree = function(elements) {\n  var rules = this._rules,\n      self = this;\n\n  var tree = {},\n      elementsData = [];\n\n  var parents = getParents(elements);\n\n  function canCopy(element, elements) {\n    return rules.allowed('element.copy', {\n      element: element,\n      elements: elements\n    });\n  }\n\n  function addElementData(element, depth) {\n\n    // (1) check wether element has already been added\n    var foundElementData = find(elementsData, function(elementsData) {\n      return element === elementsData.element;\n    });\n\n    // (2) add element if not already added\n    if (!foundElementData) {\n      elementsData.push({\n        element: element,\n        depth: depth\n      });\n\n      return;\n    }\n\n    // (3) update depth\n    if (foundElementData.depth < depth) {\n      elementsData = removeElementData(foundElementData, elementsData);\n\n      elementsData.push({\n        element: foundElementData.element,\n        depth: depth\n      });\n    }\n  }\n\n  function removeElementData(elementData, elementsData) {\n    var index = elementsData.indexOf(elementData);\n\n    if (index !== -1) {\n      elementsData.splice(index, 1);\n    }\n\n    return elementsData;\n  }\n\n  // (1) add elements\n  eachElement(parents, function(element, _index, depth) {\n\n    // do NOT add external labels directly\n    if (isLabel(element)) {\n      return;\n    }\n\n    // always copy external labels\n    forEach(element.labels, function(label) {\n      addElementData(label, depth);\n    });\n\n    function addRelatedElements(elements) {\n      elements && elements.length && forEach(elements, function(element) {\n\n        // add external labels\n        forEach(element.labels, function(label) {\n          addElementData(label, depth);\n        });\n\n        addElementData(element, depth);\n      });\n    }\n\n    forEach([ element.attachers, element.incoming, element.outgoing ], addRelatedElements);\n\n    addElementData(element, depth);\n\n    return element.children;\n  });\n\n  elements = map(elementsData, function(elementData) {\n    return elementData.element;\n  });\n\n  // (2) copy elements\n  elementsData = map(elementsData, function(elementData) {\n    elementData.descriptor = {};\n\n    self._eventBus.fire('copyPaste.copyElement', {\n      descriptor: elementData.descriptor,\n      element: elementData.element,\n      elements: elements\n    });\n\n    return elementData;\n  });\n\n  // (3) sort elements by priority\n  elementsData = sortBy(elementsData, function(elementData) {\n    return elementData.descriptor.priority;\n  });\n\n  elements = map(elementsData, function(elementData) {\n    return elementData.element;\n  });\n\n  // (4) create tree\n  forEach(elementsData, function(elementData) {\n    var depth = elementData.depth;\n\n    if (!self.hasRelations(elementData.element, elements)) {\n      removeElement(elementData.element, elements);\n\n      return;\n    }\n\n    if (!canCopy(elementData.element, elements)) {\n      removeElement(elementData.element, elements);\n\n      return;\n    }\n\n    if (!tree[depth]) {\n      tree[depth] = [];\n    }\n\n    tree[depth].push(elementData.descriptor);\n  });\n\n  return tree;\n};\n\n// helpers //////////\n\nfunction isAttacher(element) {\n  return !!element.host;\n}\n\nfunction isConnection(element) {\n  return !!element.waypoints;\n}\n\nfunction isLabel(element) {\n  return !!element.labelTarget;\n}\n\nfunction copyWaypoints(element) {\n  return map(element.waypoints, function(waypoint) {\n\n    waypoint = copyWaypoint(waypoint);\n\n    if (waypoint.original) {\n      waypoint.original = copyWaypoint(waypoint.original);\n    }\n\n    return waypoint;\n  });\n}\n\nfunction copyWaypoint(waypoint) {\n  return assign({}, waypoint);\n}\n\nfunction removeElement(element, elements) {\n  var index = elements.indexOf(element);\n\n  if (index === -1) {\n    return elements;\n  }\n\n  return elements.splice(index, 1);\n}\n","import ClipboardModule from '../clipboard';\nimport CreateModule from '../create';\nimport MouseModule from '../mouse';\nimport RulesModule from '../rules';\n\nimport CopyPaste from './CopyPaste';\n\n\nexport default {\n  __depends__: [\n    ClipboardModule,\n    CreateModule,\n    MouseModule,\n    RulesModule\n  ],\n  __init__: [ 'copyPaste' ],\n  copyPaste: [ 'type', CopyPaste ]\n};\n","import {\n  getBusinessObject\n} from '../../util/ModelUtil';\n\nimport {\n  forEach,\n  isArray,\n  isUndefined,\n  omit,\n  reduce\n} from 'min-dash';\n\nfunction copyProperties(source, target, properties) {\n  if (!isArray(properties)) {\n    properties = [ properties ];\n  }\n\n  forEach(properties, function(property) {\n    if (!isUndefined(source[property])) {\n      target[property] = source[property];\n    }\n  });\n}\n\nfunction removeProperties(element, properties) {\n  if (!isArray(properties)) {\n    properties = [ properties ];\n  }\n\n  forEach(properties, function(property) {\n    if (element[property]) {\n      delete element[property];\n    }\n  });\n}\n\nvar LOW_PRIORITY = 750;\n\n\nexport default function PostitCopyPaste(postitFactory, eventBus, moddleCopy) {\n\n  eventBus.on('copyPaste.copyElement', LOW_PRIORITY, function(context) {\n    var descriptor = context.descriptor,\n        element = context.element;\n\n    var businessObject = descriptor.oldBusinessObject = getBusinessObject(element);\n\n    descriptor.type = element.type;\n\n    copyProperties(businessObject, descriptor, 'name');\n\n    descriptor.di = {};\n\n    // fill and stroke will be set to DI\n    copyProperties(businessObject.di, descriptor.di, [\n      'fill',\n      'stroke'\n    ]);\n\n    if (isLabel(descriptor)) {\n      return descriptor;\n    }\n\n  });\n\n  var references;\n\n  function resolveReferences(descriptor, cache) {\n    var businessObject = getBusinessObject(descriptor);\n\n    // default sequence flows\n    if (descriptor.default) {\n\n      // relationship cannot be resolved immediately\n      references[ descriptor.default ] = {\n        element: businessObject,\n        property: 'default'\n      };\n    }\n\n    references = omit(references, reduce(references, function(array, reference, key) {\n      var element = reference.element,\n          property = reference.property;\n\n      if (key === descriptor.id) {\n        element[ property ] = businessObject;\n\n        array.push(descriptor.id);\n      }\n\n      return array;\n    }, []));\n  }\n\n  eventBus.on('copyPaste.pasteElements', function() {\n    references = {};\n  });\n\n  eventBus.on('copyPaste.pasteElement', function(context) {\n    var cache = context.cache,\n        descriptor = context.descriptor,\n        oldBusinessObject = descriptor.oldBusinessObject,\n        newBusinessObject;\n\n    // do NOT copy business object if external label\n    if (isLabel(descriptor)) {\n      descriptor.businessObject = getBusinessObject(cache[ descriptor.labelTarget ]);\n\n      return;\n    }\n\n    newBusinessObject = postitFactory.create(oldBusinessObject.$type);\n\n    descriptor.businessObject = moddleCopy.copyElement(\n      oldBusinessObject,\n      newBusinessObject\n    );\n\n    // resolve references e.g. default sequence flow\n    resolveReferences(descriptor, cache);\n\n    copyProperties(descriptor, newBusinessObject, [\n      'color',\n      'name'\n    ]);\n\n    removeProperties(descriptor, 'oldBusinessObject');\n  });\n\n}\n\n\nPostitCopyPaste.$inject = [\n  'postitFactory',\n  'eventBus',\n  'moddleCopy'\n];\n\n// helpers //////////\n\nfunction isLabel(element) {\n  return !!element.labelTarget;\n}\n","import {\n  find,\n  forEach,\n  isArray,\n  isDefined,\n  isObject,\n  matchPattern,\n  reduce,\n  has,\n  sortBy\n} from 'min-dash';\n\nvar DISALLOWED_PROPERTIES = [\n  'boardElements'\n];\n\n/**\n * @typedef {Function} <moddleCopy.canCopyProperties> listener\n *\n * @param {Object} context\n * @param {Array<string>} context.propertyNames\n * @param {ModdleElement} context.sourceElement\n * @param {ModdleElement} context.targetElement\n *\n * @returns {Array<string>|boolean} - Return properties to be copied or false to disallow\n * copying.\n */\n\n/**\n * @typedef {Function} <moddleCopy.canCopyProperty> listener\n *\n * @param {Object} context\n * @param {ModdleElement} context.parent\n * @param {*} context.property\n * @param {string} context.propertyName\n *\n * @returns {*|boolean} - Return copied property or false to disallow\n * copying.\n */\n\n/**\n * @typedef {Function} <moddleCopy.canSetCopiedProperty> listener\n *\n * @param {Object} context\n * @param {ModdleElement} context.parent\n * @param {*} context.property\n * @param {string} context.propertyName\n *\n * @returns {boolean} - Return false to disallow\n * setting copied property.\n */\n\n/**\n * Utility for copying model properties from source element to target element.\n *\n * @param {EventBus} eventBus\n * @param {PostitFactory} postitFactory\n * @param {PostitModdle} moddle\n */\nexport default function ModdleCopy(eventBus, postitFactory, moddle) {\n  this._postitFactory = postitFactory;\n  this._eventBus = eventBus;\n  this._moddle = moddle;\n\n  // copy extension elements last\n  eventBus.on('moddleCopy.canCopyProperties', function(context) {\n    var propertyNames = context.propertyNames;\n\n    if (!propertyNames || !propertyNames.length) {\n      return;\n    }\n\n    return sortBy(propertyNames, function(propertyName) {\n      return propertyName === 'extensionElements';\n    });\n  });\n\n  // default check whether property can be copied\n  eventBus.on('moddleCopy.canCopyProperty', function(context) {\n    var parent = context.parent,\n        parentDescriptor = isObject(parent) && parent.$descriptor,\n        propertyName = context.propertyName;\n\n    if (propertyName && DISALLOWED_PROPERTIES.indexOf(propertyName) !== -1) {\n\n      // disallow copying property\n      return false;\n    }\n\n    if (propertyName &&\n      parentDescriptor &&\n      !find(parentDescriptor.properties, matchPattern({ name: propertyName }))) {\n\n      // disallow copying property\n      return false;\n    }\n  });\n}\n\nModdleCopy.$inject = [\n  'eventBus',\n  'postitFactory',\n  'moddle'\n];\n\n/**\n * Copy model properties of source element to target element.\n *\n * @param {ModdleElement} sourceElement\n * @param {ModdleElement} targetElement\n * @param {Array<string>} [propertyNames]\n *\n * @param {ModdleElement}\n */\nModdleCopy.prototype.copyElement = function(sourceElement, targetElement, propertyNames) {\n  var self = this;\n\n  if (propertyNames && !isArray(propertyNames)) {\n    propertyNames = [ propertyNames ];\n  }\n\n  propertyNames = propertyNames || getPropertyNames(sourceElement.$descriptor);\n\n  var canCopyProperties = this._eventBus.fire('moddleCopy.canCopyProperties', {\n    propertyNames: propertyNames,\n    sourceElement: sourceElement,\n    targetElement: targetElement\n  });\n\n  if (canCopyProperties === false) {\n    return targetElement;\n  }\n\n  if (isArray(canCopyProperties)) {\n    propertyNames = canCopyProperties;\n  }\n\n  // copy properties\n  forEach(propertyNames, function(propertyName) {\n    var sourceProperty;\n\n    if (has(sourceElement, propertyName)) {\n      sourceProperty = sourceElement.get(propertyName);\n    }\n\n    var copiedProperty = self.copyProperty(sourceProperty, targetElement, propertyName);\n\n    var canSetProperty = self._eventBus.fire('moddleCopy.canSetCopiedProperty', {\n      parent: targetElement,\n      property: copiedProperty,\n      propertyName: propertyName\n    });\n\n    if (canSetProperty === false) {\n      return;\n    }\n\n    if (isDefined(copiedProperty)) {\n      targetElement.set(propertyName, copiedProperty);\n    }\n  });\n\n  return targetElement;\n};\n\n/**\n * Copy model property.\n *\n * @param {*} property\n * @param {ModdleElement} parent\n * @param {string} propertyName\n *\n * @returns {*}\n */\nModdleCopy.prototype.copyProperty = function(property, parent, propertyName) {\n  var self = this;\n\n  // allow others to copy property\n  var copiedProperty = this._eventBus.fire('moddleCopy.canCopyProperty', {\n    parent: parent,\n    property: property,\n    propertyName: propertyName\n  });\n\n  // return if copying is NOT allowed\n  if (copiedProperty === false) {\n    return;\n  }\n\n  if (copiedProperty) {\n    if (isObject(copiedProperty) && copiedProperty.$type && !copiedProperty.$parent) {\n      copiedProperty.$parent = parent;\n    }\n\n    return copiedProperty;\n  }\n\n  var propertyDescriptor = this._moddle.getPropertyDescriptor(parent, propertyName);\n\n  // do NOT copy Ids and references\n  if (propertyDescriptor.isId || propertyDescriptor.isReference) {\n    return;\n  }\n\n  // copy arrays\n  if (isArray(property)) {\n    return reduce(property, function(childProperties, childProperty) {\n\n      // recursion\n      copiedProperty = self.copyProperty(childProperty, parent, propertyName);\n\n      // copying might NOT be allowed\n      if (copiedProperty) {\n        copiedProperty.$parent = parent;\n\n        return childProperties.concat(copiedProperty);\n      }\n\n      return childProperties;\n    }, []);\n  }\n\n  // copy model elements\n  if (isObject(property) && property.$type) {\n    if (this._moddle.getElementDescriptor(property).isGeneric) {\n      return;\n    }\n\n    copiedProperty = self._postitFactory.create(property.$type);\n\n    copiedProperty.$parent = parent;\n\n    // recursion\n    copiedProperty = self.copyElement(property, copiedProperty);\n\n    return copiedProperty;\n  }\n\n  // copy primitive properties\n  return property;\n};\n\n// helpers //////////\n\nexport function getPropertyNames(descriptor, keepDefaultProperties) {\n  return reduce(descriptor.properties, function(properties, property) {\n\n    if (keepDefaultProperties && property.default) {\n      return properties;\n    }\n\n    return properties.concat(property.name);\n  }, []);\n}","import CopyPasteModule from 'diagram-js/lib/features/copy-paste';\n\nimport PostitCopyPaste from './PostitCopyPaste';\nimport ModdleCopy from './ModdleCopy';\n\nexport default {\n  __depends__: [\n    CopyPasteModule\n  ],\n  __init__: [ 'postitCopyPaste', 'moddleCopy' ],\n  postitCopyPaste: [ 'type', PostitCopyPaste ],\n  moddleCopy: [ 'type', ModdleCopy ]\n};\n","import {\n  assign\n} from 'min-dash';\n\nvar round = Math.round;\n\n/**\n * Service that allow replacing of elements.\n */\nexport default function Replace(modeling) {\n\n  this._modeling = modeling;\n}\n\nReplace.$inject = [ 'modeling' ];\n\n/**\n * @param {Element} oldElement - Element to be replaced\n * @param {Object}  newElementData - Containing information about the new element,\n *                                   for example the new bounds and type.\n * @param {Object}  options - Custom options that will be attached to the context. It can be used to inject data\n *                            that is needed in the command chain. For example it could be used in\n *                            eventbus.on('commandStack.shape.replace.postExecute') to change shape attributes after\n *                            shape creation.\n */\nReplace.prototype.replaceElement = function(oldElement, newElementData, options) {\n\n  if (oldElement.waypoints) {\n\n    // TODO(nikku): we do not replace connections, yet\n    return null;\n  }\n\n  var modeling = this._modeling;\n\n  var width = newElementData.width || oldElement.width,\n      height = newElementData.height || oldElement.height,\n      x = newElementData.x || oldElement.x,\n      y = newElementData.y || oldElement.y,\n      centerX = round(x + width / 2),\n      centerY = round(y + height / 2);\n\n  // modeling API requires center coordinates,\n  // account for that when handling shape bounds\n\n  return modeling.replaceShape(\n    oldElement,\n    assign(\n      {},\n      newElementData,\n      {\n        x: centerX,\n        y: centerY,\n        width: width,\n        height: height\n      }\n    ),\n    options\n  );\n};\n","import Replace from './Replace';\n\nexport default {\n  __init__: [ 'replace' ],\n  replace: [ 'type', Replace ]\n};","import {\n  pick,\n  assign,\n  forEach,\n  isArray,\n  isUndefined\n} from 'min-dash';\n\nimport { getPropertyNames } from '../copy-paste/ModdleCopy';\n\nfunction copyProperties(source, target, properties) {\n  if (!isArray(properties)) {\n    properties = [ properties ];\n  }\n\n  forEach(properties, function(property) {\n    if (!isUndefined(source[property])) {\n      target[property] = source[property];\n    }\n  });\n}\n\nvar CUSTOM_PROPERTIES = [\n  'cancelActivity',\n  'instantiate',\n  'eventGatewayType',\n  'triggeredByEvent',\n  'isInterrupting'\n];\n\n\n\n/**\n * This module takes care of replacing postit elements\n */\nexport default function PostitReplace(\n    postitFactory,\n    elementFactory,\n    moddleCopy,\n    modeling,\n    replace,\n    selection\n) {\n\n  /**\n   * Prepares a new business object for the replacement element\n   * and triggers the replace operation.\n   *\n   * @param  {djs.model.Base} element\n   * @param  {Object} target\n   * @param  {Object} [hints]\n   *\n   * @return {djs.model.Base} the newly created element\n   */\n  function replaceElement(element, target, hints) {\n\n    hints = hints || {};\n\n    var type = target.type,\n        oldBusinessObject = element.businessObject;\n\n    var newBusinessObject = postitFactory.create(type);\n\n    var newElement = {\n      type: type,\n      businessObject: newBusinessObject\n    };\n\n    var elementProps = getPropertyNames(oldBusinessObject.$descriptor),\n        newElementProps = getPropertyNames(newBusinessObject.$descriptor, true),\n        copyProps = intersection(elementProps, newElementProps);\n\n    // initialize special properties defined in target definition\n    assign(newBusinessObject, pick(target, CUSTOM_PROPERTIES));\n\n    var properties = copyProps;\n\n    newBusinessObject = moddleCopy.copyElement(\n      oldBusinessObject,\n      newBusinessObject,\n      properties\n    );\n\n    newBusinessObject.name = oldBusinessObject.name;\n\n    newElement.di = {};\n\n    // fill and stroke will be set to DI\n    copyProperties(oldBusinessObject.di, newElement.di, [\n      'fill',\n      'stroke'\n    ]);\n\n    newElement = replace.replaceElement(element, newElement, hints);\n\n    if (hints.select !== false) {\n      selection.select(newElement);\n    }\n\n    return newElement;\n  }\n\n  this.replaceElement = replaceElement;\n}\n\nPostitReplace.$inject = [\n  'postitFactory',\n  'elementFactory',\n  'moddleCopy',\n  'modeling',\n  'replace',\n  'selection'\n];\n\n/**\n * Compute intersection between two arrays.\n */\nfunction intersection(a1, a2) {\n  return a1.filter(function(el) {\n    return a2.indexOf(el) !== -1;\n  });\n}\n","import CopyPasteModule from '../copy-paste';\nimport ReplaceModule from 'diagram-js/lib/features/replace';\nimport SelectionModule from 'diagram-js/lib/features/selection';\n\nimport PostitReplace from './PostitReplace';\n\nexport default {\n  __depends__: [\n    CopyPasteModule,\n    ReplaceModule,\n    SelectionModule\n  ],\n  postitReplace: [ 'type', PostitReplace ]\n};\n","import {\n  forEach\n} from 'min-dash';\n\n\n/**\n * This module is an element agnostic replace menu provider for the popup menu.\n */\nexport default function ReplaceMenuProvider(\n    popupMenu, modeling, moddle,\n    postitReplace, rules, translate) {\n\n  this._popupMenu = popupMenu;\n  this._modeling = modeling;\n  this._moddle = moddle;\n  this._postitReplace = postitReplace;\n  this._rules = rules;\n  this._translate = translate;\n\n  this.register();\n}\n\nReplaceMenuProvider.$inject = [\n  'popupMenu',\n  'modeling',\n  'moddle',\n  'postitReplace',\n  'rules',\n  'translate'\n];\n\n\n/**\n * Register replace menu provider in the popup menu\n */\nReplaceMenuProvider.prototype.register = function() {\n  this._popupMenu.registerProvider('postit-replace', this);\n};\n\n\n/**\n * Get all entries from replaceOptions for the given element and apply filters\n * on them. Get for example only elements, which are different from the current one.\n *\n * @param {djs.model.Base} element\n *\n * @return {Array<Object>} a list of menu entry items\n */\nReplaceMenuProvider.prototype.getEntries = function(element) {\n\n  var rules = this._rules;\n\n  var entries = [];\n\n  if (!rules.allowed('shape.replace', { element: element })) {\n    return [];\n  }\n\n  return entries;\n};\n\n\n/**\n * Get a list of header items for the given element. This includes buttons\n * for multi instance markers and for the ad hoc marker.\n *\n * @param {djs.model.Base} element\n *\n * @return {Array<Object>} a list of menu entry items\n */\nReplaceMenuProvider.prototype.getHeaderEntries = function(element) {\n\n  var headerEntries = [];\n\n  return headerEntries;\n};\n\n\n/**\n * Creates an array of menu entry objects for a given element and filters the replaceOptions\n * according to a filter function.\n *\n * @param  {djs.model.Base} element\n * @param  {Object} replaceOptions\n *\n * @return {Array<Object>} a list of menu items\n */\nReplaceMenuProvider.prototype._createEntries = function(element, replaceOptions) {\n  var menuEntries = [];\n\n  var self = this;\n\n  forEach(replaceOptions, function(definition) {\n    var entry = self._createMenuEntry(definition, element);\n\n    menuEntries.push(entry);\n  });\n\n  return menuEntries;\n};\n\n\n/**\n * Creates and returns a single menu entry item.\n *\n * @param  {Object} definition a single replace options definition object\n * @param  {djs.model.Base} element\n * @param  {Function} [action] an action callback function which gets called when\n *                             the menu entry is being triggered.\n *\n * @return {Object} menu entry item\n */\nReplaceMenuProvider.prototype._createMenuEntry = function(definition, element, action) {\n  var translate = this._translate;\n  var replaceElement = this._postitReplace.replaceElement;\n\n  var replaceAction = function() {\n    return replaceElement(element, definition.target);\n  };\n\n  action = action || replaceAction;\n\n  var menuEntry = {\n    label: translate(definition.label),\n    className: definition.className,\n    id: definition.actionName,\n    action: action\n  };\n\n  return menuEntry;\n};\n","import PopupMenuModule from 'diagram-js/lib/features/popup-menu';\nimport ReplaceModule from '../replace';\n\nimport ReplaceMenuProvider from './ReplaceMenuProvider';\n\n\nexport default {\n  __depends__: [\n    PopupMenuModule,\n    ReplaceModule\n  ],\n  __init__: [ 'replaceMenuProvider' ],\n  replaceMenuProvider: [ 'type', ReplaceMenuProvider ]\n};","import {\n  assign,\n  isArray,\n  keys,\n  forEach\n} from 'min-dash';\n\nimport {\n  hasPrimaryModifier\n} from 'diagram-js/lib/util/Mouse';\n\nimport COLORS from '../../util/ColorUtil';\nimport { is, getBusinessObject } from '../../util/ModelUtil';\n\n\n/**\n * A provider for postit elements context pad\n */\nexport default function ContextPadProvider(\n    config, injector, eventBus,\n    contextPad, modeling, rules,\n    imageSelection, translate) {\n\n  config = config || {};\n\n  contextPad.registerProvider(this);\n\n  this._contextPad = contextPad;\n\n  this._modeling = modeling;\n\n  this._rules = rules;\n  this._imageSelection = imageSelection;\n  this._translate = translate;\n\n  if (config.autoPlace !== false) {\n    this._autoPlace = injector.get('autoPlace', false);\n  }\n\n  eventBus.on('create.end', 250, function(event) {\n    var context = event.context,\n        shape = context.shape;\n\n    if (!hasPrimaryModifier(event) || !contextPad.isOpen(shape)) {\n      return;\n    }\n\n    var entries = contextPad.getEntries(shape);\n\n    if (entries.replace) {\n      entries.replace.action.click(event, shape);\n    }\n  });\n}\n\nContextPadProvider.$inject = [\n  'config.contextPad',\n  'injector',\n  'eventBus',\n  'contextPad',\n  'modeling',\n  'rules',\n  'imageSelection',\n  'translate'\n];\n\n\nContextPadProvider.prototype.getContextPadEntries = function(element) {\n\n  const {\n    _rules: rules,\n    _modeling: modeling,\n    _imageSelection: imageSelection,\n    _translate: translate\n  } = this;\n\n  let actions = {};\n\n  function removeElement(e) {\n    modeling.removeElements([ element ]);\n  }\n\n  function setColor(color) {\n    modeling.setColor(element, color);\n  }\n\n  function createDeleteEntry(actions) {\n\n    // delete element entry, only show if allowed by rules\n    let deleteAllowed = rules.allowed('elements.delete', { elements: [ element ] });\n\n    if (isArray(deleteAllowed)) {\n\n      // was the element returned as a deletion candidate?\n      deleteAllowed = deleteAllowed[0] === element;\n    }\n\n    if (deleteAllowed) {\n      assign(actions, {\n        'delete': {\n          group: 'edit',\n          className: 'bpmn-icon-trash',\n          title: translate('Remove'),\n          action: {\n            click: removeElement\n          }\n        }\n      });\n    }\n  }\n\n  function createColoringEntries(actions) {\n    forEach(keys(COLORS), key => {\n      var color = COLORS[key];\n\n      function getClassNames() {\n        var classNames = [];\n\n        if (color === getColor(element)) {\n\n          classNames.push('pjs-color-entry-disabled');\n        }\n\n        classNames.push('pjs-color-entry-' + key);\n\n        return classNames;\n      }\n\n      assign(actions, {\n        ['color-' + key]: {\n          group: 'color',\n          className: getClassNames(),\n          title: translate('Set Color'),\n          action: {\n            click: (event) => setColor(color)\n          }\n        }\n      });\n    });\n  }\n\n  if (element.type === 'label') {\n    return actions;\n  }\n\n  if (is(element, 'postit:Postit')) {\n    createColoringEntries(actions);\n  }\n\n  if (is(element, 'postit:Image')) {\n    assign(actions, {\n      'replace.image': {\n        group: 'replace',\n        className: 'bpmn-icon-screw-wrench',\n        title: translate('Change image source'),\n        action: {\n          click: (event) => imageSelection.select(element)\n        }\n      }\n    });\n  }\n\n  createDeleteEntry(actions);\n\n  return actions;\n};\n\n// helpers //////////\n\nfunction getColor(element) {\n  var bo = getBusinessObject(element);\n\n  return bo.color || element.color;\n}\n","import DirectEditingModule from 'diagram-js-direct-editing';\nimport ContextPadModule from 'diagram-js/lib/features/context-pad';\nimport SelectionModule from 'diagram-js/lib/features/selection';\nimport ConnectModule from 'diagram-js/lib/features/connect';\nimport CreateModule from 'diagram-js/lib/features/create';\nimport PopupMenuModule from '../popup-menu';\n\nimport ContextPadProvider from './ContextPadProvider';\n\nexport default {\n  __depends__: [\n    DirectEditingModule,\n    ContextPadModule,\n    SelectionModule,\n    ConnectModule,\n    CreateModule,\n    PopupMenuModule\n  ],\n  __init__: [ 'contextPadProvider' ],\n  contextPadProvider: [ 'type', ContextPadProvider ]\n};","import {\n  forEach,\n  isArray\n} from 'min-dash';\n\nvar NOT_REGISTERED_ERROR = 'is not a registered action',\n    IS_REGISTERED_ERROR = 'is already registered';\n\n\n/**\n * An interface that provides access to modeling actions by decoupling\n * the one who requests the action to be triggered and the trigger itself.\n *\n * It's possible to add new actions by registering them with registerAction\n * and likewise unregister existing ones with unregisterAction.\n *\n *\n * ## Life-Cycle and configuration\n *\n * The editor actions will wait for diagram initialization before\n * registering default actions _and_ firing an `editorActions.init` event.\n *\n * Interested parties may listen to the `editorActions.init` event with\n * low priority to check, which actions got registered. Other components\n * may use the event to register their own actions via `registerAction`.\n *\n * @param {EventBus} eventBus\n * @param {Injector} injector\n */\nexport default function EditorActions(eventBus, injector) {\n\n  // initialize actions\n  this._actions = {};\n\n  var self = this;\n\n  eventBus.on('diagram.init', function() {\n\n    // all diagram modules got loaded; check which ones\n    // are available and register the respective default actions\n    self._registerDefaultActions(injector);\n\n    // ask interested parties to register available editor\n    // actions on diagram initialization\n    eventBus.fire('editorActions.init', {\n      editorActions: self\n    });\n  });\n\n}\n\nEditorActions.$inject = [\n  'eventBus',\n  'injector'\n];\n\n/**\n * Register default actions.\n *\n * @param {Injector} injector\n */\nEditorActions.prototype._registerDefaultActions = function(injector) {\n\n  // (1) retrieve optional components to integrate with\n\n  var commandStack = injector.get('commandStack', false);\n  var modeling = injector.get('modeling', false);\n  var selection = injector.get('selection', false);\n  var zoomScroll = injector.get('zoomScroll', false);\n  var copyPaste = injector.get('copyPaste', false);\n  var canvas = injector.get('canvas', false);\n  var rules = injector.get('rules', false);\n  var keyboardMove = injector.get('keyboardMove', false);\n  var keyboardMoveSelection = injector.get('keyboardMoveSelection', false);\n\n  // (2) check components and register actions\n\n  if (commandStack) {\n    this.register('undo', function() {\n      commandStack.undo();\n    });\n\n    this.register('redo', function() {\n      commandStack.redo();\n    });\n  }\n\n  if (copyPaste && selection) {\n    this.register('copy', function() {\n      var selectedElements = selection.get();\n\n      copyPaste.copy(selectedElements);\n    });\n  }\n\n  if (copyPaste) {\n    this.register('paste', function() {\n      copyPaste.paste();\n    });\n  }\n\n  if (zoomScroll) {\n    this.register('stepZoom', function(opts) {\n      zoomScroll.stepZoom(opts.value);\n    });\n  }\n\n  if (canvas) {\n    this.register('zoom', function(opts) {\n      canvas.zoom(opts.value);\n    });\n  }\n\n  if (modeling && selection && rules) {\n    this.register('removeSelection', function() {\n\n      var selectedElements = selection.get();\n\n      if (!selectedElements.length) {\n        return;\n      }\n\n      var allowed = rules.allowed('elements.delete', { elements: selectedElements }),\n          removableElements;\n\n      if (allowed === false) {\n        return;\n      }\n      else if (isArray(allowed)) {\n        removableElements = allowed;\n      }\n      else {\n        removableElements = selectedElements;\n      }\n\n      if (removableElements.length) {\n        modeling.removeElements(removableElements.slice());\n      }\n    });\n  }\n\n  if (keyboardMove) {\n    this.register('moveCanvas', function(opts) {\n      keyboardMove.moveCanvas(opts);\n    });\n  }\n\n  if (keyboardMoveSelection) {\n    this.register('moveSelection', function(opts) {\n      keyboardMoveSelection.moveSelection(opts.direction, opts.accelerated);\n    });\n  }\n\n};\n\n\n/**\n * Triggers a registered action\n *\n * @param  {string} action\n * @param  {Object} opts\n *\n * @return {Unknown} Returns what the registered listener returns\n */\nEditorActions.prototype.trigger = function(action, opts) {\n  if (!this._actions[action]) {\n    throw error(action, NOT_REGISTERED_ERROR);\n  }\n\n  return this._actions[action](opts);\n};\n\n\n/**\n * Registers a collections of actions.\n * The key of the object will be the name of the action.\n *\n * @example\n * \n * var actions = {\n *   spaceTool: function() {\n *     spaceTool.activateSelection();\n *   },\n *   lassoTool: function() {\n *     lassoTool.activateSelection();\n *   }\n * ];\n *\n * editorActions.register(actions);\n *\n * editorActions.isRegistered('spaceTool'); // true\n * \n *\n * @param  {Object} actions\n */\nEditorActions.prototype.register = function(actions, listener) {\n  var self = this;\n\n  if (typeof actions === 'string') {\n    return this._registerAction(actions, listener);\n  }\n\n  forEach(actions, function(listener, action) {\n    self._registerAction(action, listener);\n  });\n};\n\n/**\n * Registers a listener to an action key\n *\n * @param  {string} action\n * @param  {Function} listener\n */\nEditorActions.prototype._registerAction = function(action, listener) {\n  if (this.isRegistered(action)) {\n    throw error(action, IS_REGISTERED_ERROR);\n  }\n\n  this._actions[action] = listener;\n};\n\n/**\n * Unregister an existing action\n *\n * @param {string} action\n */\nEditorActions.prototype.unregister = function(action) {\n  if (!this.isRegistered(action)) {\n    throw error(action, NOT_REGISTERED_ERROR);\n  }\n\n  this._actions[action] = undefined;\n};\n\n/**\n * Returns the number of actions that are currently registered\n *\n * @return {number}\n */\nEditorActions.prototype.getActions = function() {\n  return Object.keys(this._actions);\n};\n\n/**\n * Checks wether the given action is registered\n *\n * @param {string} action\n *\n * @return {boolean}\n */\nEditorActions.prototype.isRegistered = function(action) {\n  return !!this._actions[action];\n};\n\n\nfunction error(action, message) {\n  return new Error(action + ' ' + message);\n}\n","import EditorActions from './EditorActions';\n\nexport default {\n  __init__: [ 'editorActions' ],\n  editorActions: [ 'type', EditorActions ]\n};\n","import inherits from 'inherits';\n\nimport EditorActions from 'diagram-js/lib/features/editor-actions/EditorActions';\n\nimport {\n  getBBox\n} from 'diagram-js/lib/util/Elements';\n\n\n/**\n * Registers and executes Postit specific editor actions.\n *\n * @param {Injector} injector\n */\nexport default function PostitEditorActions(injector) {\n  injector.invoke(EditorActions, this);\n}\n\ninherits(PostitEditorActions, EditorActions);\n\nPostitEditorActions.$inject = [\n  'injector'\n];\n\n/**\n * Register default actions.\n *\n * @param {Injector} injector\n */\nPostitEditorActions.prototype._registerDefaultActions = function(injector) {\n\n  // (0) invoke super method\n\n  EditorActions.prototype._registerDefaultActions.call(this, injector);\n\n  // (1) retrieve optional components to integrate with\n\n  var canvas = injector.get('canvas', false);\n  var elementRegistry = injector.get('elementRegistry', false);\n  var selection = injector.get('selection', false);\n  var spaceTool = injector.get('spaceTool', false);\n  var lassoTool = injector.get('lassoTool', false);\n  var handTool = injector.get('handTool', false);\n  var distributeElements = injector.get('distributeElements', false);\n  var alignElements = injector.get('alignElements', false);\n  var directEditing = injector.get('directEditing', false);\n  var searchPad = injector.get('searchPad', false);\n  var modeling = injector.get('modeling', false);\n\n  // (2) check components and register actions\n\n  if (canvas && elementRegistry && selection) {\n    this._registerAction('selectElements', function() {\n\n      // select all elements except for the invisible\n      // root element\n      var rootElement = canvas.getRootElement();\n\n      var elements = elementRegistry.filter(function(element) {\n        return element !== rootElement;\n      });\n\n      selection.select(elements);\n\n      return elements;\n    });\n  }\n\n  if (spaceTool) {\n    this._registerAction('spaceTool', function() {\n      spaceTool.toggle();\n    });\n  }\n\n  if (lassoTool) {\n    this._registerAction('lassoTool', function() {\n      lassoTool.toggle();\n    });\n  }\n\n  if (handTool) {\n    this._registerAction('handTool', function() {\n      handTool.toggle();\n    });\n  }\n\n  if (selection && distributeElements) {\n    this._registerAction('distributeElements', function(opts) {\n      var currentSelection = selection.get(),\n          type = opts.type;\n\n      if (currentSelection.length) {\n        distributeElements.trigger(currentSelection, type);\n      }\n    });\n  }\n\n  if (selection && alignElements) {\n    this._registerAction('alignElements', function(opts) {\n      var currentSelection = selection.get(),\n          type = opts.type;\n\n      if (currentSelection.length) {\n        alignElements.trigger(currentSelection, type);\n      }\n    });\n  }\n\n  if (selection && modeling) {\n    this._registerAction('setColor', function(opts) {\n      var currentSelection = selection.get();\n\n      if (currentSelection.length) {\n        modeling.setColor(currentSelection, opts);\n      }\n    });\n  }\n\n  if (selection && directEditing) {\n    this._registerAction('directEditing', function() {\n      var currentSelection = selection.get();\n\n      if (currentSelection.length) {\n        directEditing.activate(currentSelection[0]);\n      }\n    });\n  }\n\n  if (searchPad) {\n    this._registerAction('find', function() {\n      searchPad.toggle();\n    });\n  }\n\n  if (canvas && modeling) {\n    this._registerAction('moveToOrigin', function() {\n      var rootElement = canvas.getRootElement(),\n          boundingBox;\n\n\n      var elements = elementRegistry.filter(function(element) {\n        return element !== rootElement;\n      });\n\n      boundingBox = getBBox(elements);\n\n      modeling.moveElements(\n        elements,\n        { x: -boundingBox.x, y: -boundingBox.y },\n        rootElement\n      );\n    });\n  }\n\n};","import EditorActionsModule from 'diagram-js/lib/features/editor-actions';\n\nimport PostitEditorActions from './PostitEditorActions';\n\nexport default {\n  __depends__: [\n    EditorActionsModule\n  ],\n  editorActions: [ 'type', PostitEditorActions ]\n};\n","export function fileToDataURL(file) {\n  return new Promise((resolve, reject) => {\n    try {\n      var reader = new FileReader();\n      reader.onloadend = function() {\n        resolve(reader.result);\n      };\n      reader.readAsDataURL(file);\n    } catch (e) {\n      reject(e);\n    }\n  });\n}\n\n\nexport async function imageProcessor(ev, file) {\n  const base64file = await fileToDataURL(file);\n\n  // createImage(ev, base64file);\n  return base64file; // passing any errors through\n}\n\nexport async function fileReader(ev, files) {\n  let uploadResult = [];\n  let errors;\n  let fileItems = files;\n  if (ev && (ev.dataTransfer.items || ev.dataTransfer.files)) {\n    fileItems = ev.dataTransfer.items || ev.dataTransfer.files;\n  }\n  try {\n    if (fileItems) {\n      for (var i = 0; i < fileItems.length; i++) {\n        if (ev && ev.dataTransfer.items) {\n          if (fileItems[i].kind === 'file') {\n            var file = fileItems[i].getAsFile();\n            uploadResult.push(await imageProcessor(ev, file));\n          }\n        } else {\n          uploadResult.push(await imageProcessor(ev, fileItems[i]));\n        }\n      }\n    }\n  } catch (e) {\n    errors = e;\n    uploadResult = null;\n  }\n  return { uploadResult, errors };\n}\n\n","export function getMousePosition(event) {\n  event = event || window.event;\n\n  var pageX = event.pageX;\n  var pageY = event.pageY;\n\n  // IE 8\n  if (pageX === undefined) {\n    pageX = event.clientX + document.body.scrollLeft + document.documentElement.scrollLeft;\n    pageY = event.clientY + document.body.scrollTop + document.documentElement.scrollTop;\n  }\n\n  return { pageX, pageY };\n}\n\n","import {\n  domify,\n  event as domEvent\n} from 'min-dom';\n\nimport {\n  fileReader\n} from '../../util/FileUtil.js';\n\nimport {\n  getMousePosition\n} from '../../util/ScreenUtil.js';\n\nvar LOW_PRIORITY = 500;\nvar text;\n\nexport default function ImageSelection(canvas, eventBus, modeling, translate) {\n\n  this._canvas = canvas;\n  this._eventBus = eventBus;\n  this._modeling = modeling;\n  this._translate = translate;\n\n  var self = this;\n\n  eventBus.on('create.end', LOW_PRIORITY, function(event) {\n    var context = event.context,\n        element = context.shape,\n        hints = context.hints;\n\n    if (hints.selectImage) {\n      self.select(element);\n    }\n  });\n\n  text = { 'URL': this._translate('URL'),\n    'An error occured during the file upload': this._translate('An error occured during the file upload'),\n    'Upload files here': this._translate('Upload files here'),\n    'Upload from local is for demo purposes only. It slows down the page and increases the file size.': this._translate('Upload from local is for demo purposes only. It slows down the page and increases the file size.'),\n    'Upload': this._translate('Upload'),\n    'file': this._translate('file'),\n    'files': this._translate('files'),\n    'selected': this._translate('selected'),\n    'Upload again': this._translate('Upload again'),\n  };\n\n  ImageSelection.IMAGE_SELECTION_MARKUP = '<div id=\"pjs-image-selection-modal\" class=\"pjs-io-dialog-local\">'+\n    '<div class=\"pjs-io-dialog-section pjs-first\">'+\n      '<div id=\"pjs-image-selection-input-wrapper\"><input id=\"pjs-image-selection-input\" class=\"pjs-ui-element-bordered\"></input></div>'+\n      '<div class=\"pjs-labeled-input\">'+\n      '<label for=\"pjs-image-selection-input\" class=\"pjs-input-text-static\"><!--Search / -->'+text['URL']+':</label>'+\n      '</div>'+\n    '</div\">'+\n    '<div class=\"pjs-io-dialog-section\">'+\n    '<div class=\"pjs-section-spacer\"></div>'+\n    '<label for=\"pjs-image-upload\"><div class=\"pjs-io-dialog-text-hint\">'+\n      '<a style=\"display:block\"><ul id=\"pjs-image-dialog-text-hint-list\" class=\"pjs-horizontal\">'+\n        '<li><div class=\"pjs-general-icon pjs-image-dialog-upload-icon\"></div></li>'+\n        '<li id=\"pjs-image-selection-files-text-error\">'+text['An error occured during the file upload']+'</li>'+\n        '<li id=\"pjs-image-selection-files-text-upload\">'+text['Upload files here']+'</li>'+\n        '<li><div class=\"pjs-general-icon pjs-image-dialog-upload-icon-warning pjs-tooltip\">'+\n          '<span class=\"pjs-tooltiptext\">'+text['Upload from local is for demo purposes only. It slows down the page and increases the file size.']+'</span>'+\n        '</div></li>'+\n      '</ul></a>'+\n    '</div></label>'+\n    '<input type=\"file\" id=\"pjs-image-upload\" style=\"display:none\" multiple/>'+\n    '<div class=\"pjs-io-dialog-section\">'+\n    '<div class=\"pjs-buttons pjs-image-selection-submit-wrapper\"><button id=\"pjs-image-selection-submit\">'+text['Upload']+'</button></div>'+\n    '</div>'+\n    '</div>'+\n  '</div>';\n\n}\n\nImageSelection.prototype._getParentContainer = function() {\n  return this._canvas.getContainer();\n};\n\nImageSelection.prototype.select = function(element, callback) {\n\n  const self = this;\n\n  const container = this._container = domify(ImageSelection.IMAGE_SELECTION_MARKUP);\n\n  const canvas = document.getElementById('canvas');\n  canvas.insertBefore(container, canvas.firstChild);\n\n  const mousePosition = getMousePosition(null);\n  container.style.left = mousePosition.pageX + 'px';\n  container.style.top = mousePosition.pageY + 'px';\n\n  const inputField = document.getElementById('pjs-image-selection-input'),\n        submitButton = document.getElementById('pjs-image-selection-submit'),\n        imageUploadTextError = document.getElementById('pjs-image-selection-files-text-error'),\n        imageUploadTextUpload = document.getElementById('pjs-image-selection-files-text-upload'),\n        imageUploadTextList = document.getElementById('pjs-image-dialog-text-hint-list'),\n        imageUploadReader = document.getElementById('pjs-image-upload'),\n        modal = document.getElementById('pjs-image-selection-modal');\n\n  var uploadTextListHeight = imageUploadTextList.style.height;\n\n  var source, filesToUpload;\n\n  // focus url input field on modal open\n  inputField.focus();\n\n  // remove modal by clicking anywhere else\n  const canvasDefaultClick = domEvent.bind(canvas, 'click', function(ev) {\n    if (modal) {\n      const mousePos = getMousePosition(ev);\n      if ((mousePos.pageX > modal.offsetLeft+modal.clientWidth\n          || mousePos.pageX < modal.offsetLeft)\n          || (mousePos.pageY > modal.offsetTop+modal.clientHeight\n          || mousePos.pageY < modal.offsetTop)) {\n        removeImageSelectionModal();\n      }\n    }\n  });\n\n  // open file dialog\n  domEvent.bind(imageUploadReader, 'change', async function() {\n    inputField.disabled = 'true';\n\n    let uploadDisplayText;\n\n    let uploadResultObj = await fileReader(null, imageUploadReader.files),\n        uploadResult = uploadResultObj.uploadResult,\n        errors = uploadResultObj.errors;\n\n    if (!errors) {\n      let uploadedFilesCount = (uploadResult.length) ? uploadResult.length : null;\n      uploadDisplayText = uploadedFilesCount;\n\n      if (isNaN(uploadedFilesCount) === false) {\n\n        const filePluralText =+ (uploadResult.length == 1) ? text['file'] : text['files'];\n        uploadDisplayText += ' ' + filePluralText + ' ' + text['selected'];\n\n        // uploaded files are saved in global var\n        filesToUpload = uploadResult;\n      }\n\n      displayUploadStaging(uploadDisplayText);\n    } else {\n      displayError();\n    }\n  });\n\n  // upload button\n  domEvent.bind(submitButton, 'click', async function() {\n    source = filesToUpload;\n\n    // (1) call from canvas, providing a target element\n    if (element !== null) {\n\n      // (1.1) local file selection upload\n      if (source) {\n        for (const f in filesToUpload) {\n          updateImageSource(self, filesToUpload[f]);\n        }\n\n      // (1.2) url upload\n      } else {\n        source = inputField.value;\n        updateImageSource(self, source);\n      }\n\n      self._eventBus.fire('imageSelection.complete', { element: element });\n\n    // (2) external call w/o canvas target\n    } else {\n\n      // (2.1 default) local file selection data is used\n\n      // (2.2) url upload\n      if (!source) {\n        source = inputField.value;\n      }\n\n      callback(source);\n    }\n\n    // error handling not necessary as default img will be shown in error situation\n    removeImageSelectionModal();\n  });\n\n  // enter pressed\n  domEvent.bind(inputField, 'keyup', function(esvent) {\n    if (event.keyCode === 13) {\n      event.preventDefault();\n      submitButton.click();\n    }\n  });\n\n  function displayUploadStaging(text) {\n    imageUploadTextList.style.height = uploadTextListHeight;\n    imageUploadTextError.style.display = 'none';\n    imageUploadTextUpload.innerHTML = text;\n\n    document.getElementsByClassName('pjs-image-dialog-upload-icon')[0].classList.remove('pjs-image-dialog-upload-icon-error');\n  }\n\n  function displayError() {\n    uploadTextListHeight = imageUploadTextList.style.height;\n\n    imageUploadTextList.style.height = 'auto';\n    imageUploadTextError.style.display = 'block';\n    imageUploadTextUpload.innerHTML = text['Upload again'];\n\n    document.getElementsByClassName('pjs-image-dialog-upload-icon')[0].classList.add('pjs-image-dialog-upload-icon-error');\n  }\n\n  function updateImageSource(self, source) {\n    self._modeling.updateProperties(element, {\n      source: source\n    });\n  }\n\n  function removeImageSelectionModal() {\n    if (modal && modal.parentNode) {\n      modal.parentNode.removeChild(modal);\n      if (canvasDefaultClick) {\n        canvas.removeEventListener('click', canvasDefaultClick);\n      }\n    }\n  }\n\n};\n\nImageSelection.prototype.$inject = [\n  'canvas',\n  'eventBus',\n  'modelng',\n  'translate'\n];\n","import ImageSelection from './ImageSelection';\n\nexport default {\n  __init__: [ 'imageSelection' ],\n  imageSelection: [ 'type', ImageSelection ]\n};\n","import inherits from 'inherits';\n\nimport KeyboardBindings from 'diagram-js/lib/features/keyboard/KeyboardBindings';\n\n\n/**\n * Postit specific keyboard bindings.\n *\n * @param {Injector} injector\n */\nexport default function PostitKeyboardBindings(injector) {\n  injector.invoke(KeyboardBindings, this);\n}\n\ninherits(PostitKeyboardBindings, KeyboardBindings);\n\nPostitKeyboardBindings.$inject = [\n  'injector'\n];\n\n\n/**\n * Register available keyboard bindings.\n *\n * @param {Keyboard} keyboard\n * @param {EditorActions} editorActions\n */\nPostitKeyboardBindings.prototype.registerBindings = function(keyboard, editorActions) {\n\n  // inherit default bindings\n  KeyboardBindings.prototype.registerBindings.call(this, keyboard, editorActions);\n\n  /**\n   * Add keyboard binding if respective editor action\n   * is registered.\n   *\n   * @param {String} action name\n   * @param {Function} fn that implements the key binding\n   */\n  function addListener(action, fn) {\n\n    if (editorActions.isRegistered(action)) {\n      keyboard.addListener(fn);\n    }\n  }\n\n  // select all elements\n  // CTRL + A\n  addListener('selectElements', function(context) {\n\n    var event = context.keyEvent;\n\n    if (keyboard.isKey(['a', 'A'], event) && keyboard.isCmd(event)) {\n      editorActions.trigger('selectElements');\n\n      return true;\n    }\n  });\n\n  // search labels\n  // CTRL + F\n  addListener('find', function(context) {\n\n    var event = context.keyEvent;\n\n    if (keyboard.isKey(['f', 'F'], event) && keyboard.isCmd(event)) {\n      editorActions.trigger('find');\n\n      return true;\n    }\n  });\n\n  // activate space tool\n  // S\n  addListener('spaceTool', function(context) {\n\n    var event = context.keyEvent;\n\n    if (keyboard.hasModifier(event)) {\n      return;\n    }\n\n    if (keyboard.isKey(['s', 'S'], event)) {\n      editorActions.trigger('spaceTool');\n\n      return true;\n    }\n  });\n\n  // activate lasso tool\n  // L\n  addListener('lassoTool', function(context) {\n\n    var event = context.keyEvent;\n\n    if (keyboard.hasModifier(event)) {\n      return;\n    }\n\n    if (keyboard.isKey(['l', 'L'], event)) {\n      editorActions.trigger('lassoTool');\n\n      return true;\n    }\n  });\n\n  // activate hand tool\n  // H\n  addListener('handTool', function(context) {\n\n    var event = context.keyEvent;\n\n    if (keyboard.hasModifier(event)) {\n      return;\n    }\n\n    if (keyboard.isKey(['h', 'H'], event)) {\n      editorActions.trigger('handTool');\n\n      return true;\n    }\n  });\n\n  // activate direct editing\n  // E\n  addListener('directEditing', function(context) {\n\n    var event = context.keyEvent;\n\n    if (keyboard.hasModifier(event)) {\n      return;\n    }\n\n    if (keyboard.isKey(['e', 'E'], event)) {\n      editorActions.trigger('directEditing');\n\n      return true;\n    }\n  });\n\n};","import KeyboardModule from 'diagram-js/lib/features/keyboard';\n\nimport PostitKeyboardBindings from './PostitKeyboardBindings';\n\nexport default {\n  __depends__: [\n    KeyboardModule\n  ],\n  __init__: [ 'keyboardBindings' ],\n  keyboardBindings: [ 'type', PostitKeyboardBindings ]\n};\n","import {\n  assign\n} from 'min-dash';\n\n\nvar DEFAULT_CONFIG = {\n  moveSpeed: 1,\n  moveSpeedAccelerated: 10\n};\n\nvar HIGHER_PRIORITY = 1500;\n\nvar LEFT = 'left';\nvar UP = 'up';\nvar RIGHT = 'right';\nvar DOWN = 'down';\n\nvar KEY_TO_DIRECTION = {\n  ArrowLeft: LEFT,\n  Left: LEFT,\n  ArrowUp: UP,\n  Up: UP,\n  ArrowRight: RIGHT,\n  Right: RIGHT,\n  ArrowDown: DOWN,\n  Down: DOWN\n};\n\nvar DIRECTIONS_DELTA = {\n  left: function(speed) {\n    return {\n      x: -speed,\n      y: 0\n    };\n  },\n  up: function(speed) {\n    return {\n      x: 0,\n      y: -speed\n    };\n  },\n  right: function(speed) {\n    return {\n      x: speed,\n      y: 0\n    };\n  },\n  down: function(speed) {\n    return {\n      x: 0,\n      y: speed\n    };\n  }\n};\n\n\n/**\n * Enables to move selection with keyboard arrows.\n * Use with Shift for modified speed (default=1, with Shift=10).\n * Pressed Cmd/Ctrl turns the feature off.\n *\n * @param {Object} config\n * @param {number} [config.moveSpeed=1]\n * @param {number} [config.moveSpeedAccelerated=10]\n * @param {Keyboard} keyboard\n * @param {Modeling} modeling\n * @param {Selection} selection\n */\nexport default function KeyboardMoveSelection(\n    config,\n    keyboard,\n    modeling,\n    rules,\n    selection\n) {\n\n  var self = this;\n\n  this._config = assign({}, DEFAULT_CONFIG, config || {});\n\n  keyboard.addListener(HIGHER_PRIORITY, function(event) {\n\n    var keyEvent = event.keyEvent;\n\n    var direction = KEY_TO_DIRECTION[keyEvent.key];\n\n    if (!direction) {\n      return;\n    }\n\n    if (keyboard.isCmd(keyEvent)) {\n      return;\n    }\n\n    var accelerated = keyboard.isShift(keyEvent);\n\n    self.moveSelection(direction, accelerated);\n\n    return true;\n  });\n\n\n  /**\n   * Move selected elements in the given direction,\n   * optionally specifying accelerated movement.\n   *\n   * @param {string} direction\n   * @param {boolean} [accelerated=false]\n   */\n  this.moveSelection = function(direction, accelerated) {\n\n    var selectedElements = selection.get();\n\n    if (!selectedElements.length) {\n      return;\n    }\n\n    var speed = this._config[\n      accelerated ?\n        'moveSpeedAccelerated' :\n        'moveSpeed'\n    ];\n\n    var delta = DIRECTIONS_DELTA[direction](speed);\n\n    var canMove = rules.allowed('elements.move', {\n      shapes: selectedElements\n    });\n\n    if (canMove) {\n      modeling.moveElements(selectedElements, delta);\n    }\n  };\n\n}\n\nKeyboardMoveSelection.$inject = [\n  'config.keyboardMoveSelection',\n  'keyboard',\n  'modeling',\n  'rules',\n  'selection'\n];","import KeyboardModule from '../keyboard';\nimport SelectionModule from '../selection';\n\nimport KeyboardMoveSelection from './KeyboardMoveSelection';\n\nexport default {\n  __depends__: [\n    KeyboardModule,\n    SelectionModule\n  ],\n  __init__: [\n    'keyboardMoveSelection'\n  ],\n  keyboardMoveSelection: [ 'type', KeyboardMoveSelection ]\n};\n","import {\n  getType as getElementType\n} from '../../util/Elements';\n\n/**\n * Adds change support to the diagram, including\n *\n * <ul>\n *   <li>redrawing shapes and connections on change</li>\n * </ul>\n *\n * @param {EventBus} eventBus\n * @param {Canvas} canvas\n * @param {ElementRegistry} elementRegistry\n * @param {GraphicsFactory} graphicsFactory\n */\nexport default function ChangeSupport(\n    eventBus, canvas, elementRegistry,\n    graphicsFactory) {\n\n\n  // redraw shapes / connections on change\n\n  eventBus.on('element.changed', function(event) {\n\n    var element = event.element;\n\n    // element might have been deleted and replaced by new element with same ID\n    // thus check for parent of element except for root element\n    if (element.parent || element === canvas.getRootElement()) {\n      event.gfx = elementRegistry.getGraphics(element);\n    }\n\n    // shape + gfx may have been deleted\n    if (!event.gfx) {\n      return;\n    }\n\n    eventBus.fire(getElementType(element) + '.changed', event);\n  });\n\n  eventBus.on('elements.changed', function(event) {\n\n    var elements = event.elements;\n\n    elements.forEach(function(e) {\n      eventBus.fire('element.changed', { element: e });\n    });\n\n    graphicsFactory.updateContainments(elements);\n  });\n\n  eventBus.on('shape.changed', function(event) {\n    graphicsFactory.update('shape', event.element, event.gfx);\n  });\n\n  eventBus.on('connection.changed', function(event) {\n    graphicsFactory.update('connection', event.element, event.gfx);\n  });\n}\n\nChangeSupport.$inject = [\n  'eventBus',\n  'canvas',\n  'elementRegistry',\n  'graphicsFactory'\n];","import ChangeSupport from './ChangeSupport';\n\nexport default {\n  __init__: [ 'changeSupport'],\n  changeSupport: [ 'type', ChangeSupport ]\n};","import {\n  filter,\n  isNumber\n} from 'min-dash';\n\nvar max = Math.max,\n    min = Math.min;\n\nvar DEFAULT_CHILD_BOX_PADDING = 20;\n\nimport {\n  getBBox\n} from '../../util/Elements';\n\nimport {\n  asTRBL,\n  asBounds\n} from '../../layout/LayoutUtil';\n\n\n/**\n * Substract a TRBL from another\n *\n * @param  {TRBL} trblA\n * @param  {TRBL} trblB\n *\n * @return {TRBL}\n */\nexport function substractTRBL(trblA, trblB) {\n  return {\n    top: trblA.top - trblB.top,\n    right: trblA.right - trblB.right,\n    bottom: trblA.bottom - trblB.bottom,\n    left: trblA.left - trblB.left\n  };\n}\n\n/**\n * Resize the given bounds by the specified delta from a given anchor point.\n *\n * @param {Bounds} bounds the bounding box that should be resized\n * @param {string} direction in which the element is resized (nw, ne, se, sw)\n * @param {Point} delta of the resize operation\n *\n * @return {Bounds} resized bounding box\n */\nexport function resizeBounds(bounds, direction, delta) {\n  var dx = delta.x,\n      dy = delta.y;\n\n  var newBounds = {\n    x: bounds.x,\n    y: bounds.y,\n    width: bounds.width,\n    height: bounds.height\n  };\n\n  if (direction.indexOf('n') !== -1) {\n    newBounds.y = bounds.y + dy;\n    newBounds.height = bounds.height - dy;\n  } else if (direction.indexOf('s') !== -1) {\n    newBounds.height = bounds.height + dy;\n  }\n\n  if (direction.indexOf('e') !== -1) {\n    newBounds.width = bounds.width + dx;\n  } else if (direction.indexOf('w') !== -1) {\n    newBounds.x = bounds.x + dx;\n    newBounds.width = bounds.width - dx;\n  }\n\n  return newBounds;\n}\n\n\n/**\n * Resize the given bounds by applying the passed\n * { top, right, bottom, left } delta.\n *\n * @param {Bounds} bounds\n * @param {TRBL} trblResize\n *\n * @return {Bounds}\n */\nexport function resizeTRBL(bounds, resize) {\n  return {\n    x: bounds.x + (resize.left || 0),\n    y: bounds.y + (resize.top || 0),\n    width: bounds.width - (resize.left || 0) + (resize.right || 0),\n    height: bounds.height - (resize.top || 0) + (resize.bottom || 0)\n  };\n}\n\n\nexport function reattachPoint(bounds, newBounds, point) {\n\n  var sx = bounds.width / newBounds.width,\n      sy = bounds.height / newBounds.height;\n\n  return {\n    x: Math.round((newBounds.x + newBounds.width / 2)) - Math.floor(((bounds.x + bounds.width / 2) - point.x) / sx),\n    y: Math.round((newBounds.y + newBounds.height / 2)) - Math.floor(((bounds.y + bounds.height / 2) - point.y) / sy)\n  };\n}\n\n\nfunction applyConstraints(attr, trbl, resizeConstraints) {\n\n  var value = trbl[attr],\n      minValue = resizeConstraints.min && resizeConstraints.min[attr],\n      maxValue = resizeConstraints.max && resizeConstraints.max[attr];\n\n  if (isNumber(minValue)) {\n    value = (/top|left/.test(attr) ? min : max)(value, minValue);\n  }\n\n  if (isNumber(maxValue)) {\n    value = (/top|left/.test(attr) ? max : min)(value, maxValue);\n  }\n\n  return value;\n}\n\nexport function ensureConstraints(currentBounds, resizeConstraints) {\n\n  if (!resizeConstraints) {\n    return currentBounds;\n  }\n\n  var currentTrbl = asTRBL(currentBounds);\n\n  return asBounds({\n    top: applyConstraints('top', currentTrbl, resizeConstraints),\n    right: applyConstraints('right', currentTrbl, resizeConstraints),\n    bottom: applyConstraints('bottom', currentTrbl, resizeConstraints),\n    left: applyConstraints('left', currentTrbl, resizeConstraints)\n  });\n}\n\n\nexport function getMinResizeBounds(direction, currentBounds, minDimensions, childrenBounds) {\n\n  var currentBox = asTRBL(currentBounds);\n\n  var minBox = {\n    top: /n/.test(direction) ? currentBox.bottom - minDimensions.height : currentBox.top,\n    left: /w/.test(direction) ? currentBox.right - minDimensions.width : currentBox.left,\n    bottom: /s/.test(direction) ? currentBox.top + minDimensions.height : currentBox.bottom,\n    right: /e/.test(direction) ? currentBox.left + minDimensions.width : currentBox.right\n  };\n\n  var childrenBox = childrenBounds ? asTRBL(childrenBounds) : minBox;\n\n  var combinedBox = {\n    top: min(minBox.top, childrenBox.top),\n    left: min(minBox.left, childrenBox.left),\n    bottom: max(minBox.bottom, childrenBox.bottom),\n    right: max(minBox.right, childrenBox.right)\n  };\n\n  return asBounds(combinedBox);\n}\n\nfunction asPadding(mayBePadding, defaultValue) {\n  if (typeof mayBePadding !== 'undefined') {\n    return mayBePadding;\n  } else {\n    return DEFAULT_CHILD_BOX_PADDING;\n  }\n}\n\nexport function addPadding(bbox, padding) {\n  var left, right, top, bottom;\n\n  if (typeof padding === 'object') {\n    left = asPadding(padding.left);\n    right = asPadding(padding.right);\n    top = asPadding(padding.top);\n    bottom = asPadding(padding.bottom);\n  } else {\n    left = right = top = bottom = asPadding(padding);\n  }\n\n  return {\n    x: bbox.x - left,\n    y: bbox.y - top,\n    width: bbox.width + left + right,\n    height: bbox.height + top + bottom\n  };\n}\n\n\n/**\n * Is the given element part of the resize\n * targets min boundary box?\n *\n * This is the default implementation which excludes\n * connections and labels.\n *\n * @param {djs.model.Base} element\n */\nfunction isBBoxChild(element) {\n\n  // exclude connections\n  if (element.waypoints) {\n    return false;\n  }\n\n  // exclude labels\n  if (element.type === 'label') {\n    return false;\n  }\n\n  return true;\n}\n\n/**\n * Return children bounding computed from a shapes children\n * or a list of prefiltered children.\n *\n * @param  {djs.model.Shape|Array<djs.model.Shape>} shapeOrChildren\n * @param  {number|Object} padding\n *\n * @return {Bounds}\n */\nexport function computeChildrenBBox(shapeOrChildren, padding) {\n\n  var elements;\n\n  // compute based on shape\n  if (shapeOrChildren.length === undefined) {\n\n    // grab all the children that are part of the\n    // parents children box\n    elements = filter(shapeOrChildren.children, isBBoxChild);\n\n  } else {\n    elements = shapeOrChildren;\n  }\n\n  if (elements.length) {\n    return addPadding(getBBox(elements), padding);\n  }\n}\n","import {\n  pick,\n  assign\n} from 'min-dash';\n\nimport {\n  resizeBounds,\n  ensureConstraints,\n  computeChildrenBBox,\n  getMinResizeBounds\n} from './ResizeUtil';\n\nimport {\n  asTRBL,\n  getMid,\n  roundBounds\n} from '../../layout/LayoutUtil';\n\nvar DEFAULT_MIN_WIDTH = 10;\n\n\n/**\n * A component that provides resizing of shapes on the canvas.\n *\n * The following components are part of shape resize:\n *\n *  * adding resize handles,\n *  * creating a visual during resize\n *  * checking resize rules\n *  * committing a change once finished\n *\n *\n * ## Customizing\n *\n * It's possible to customize the resizing behaviour by intercepting 'resize.start'\n * and providing the following parameters through the 'context':\n *\n *   * minDimensions ({ width, height }): minimum shape dimensions\n *\n *   * childrenBoxPadding ({ left, top, bottom, right } || number):\n *     gap between the minimum bounding box and the container\n *\n * f.ex:\n *\n * ```javascript\n * eventBus.on('resize.start', 1500, function(event) {\n *   var context = event.context,\n *\n *  context.minDimensions = { width: 140, height: 120 };\n *\n *  // Passing general padding\n *  context.childrenBoxPadding = 30;\n *\n *  // Passing padding to a specific side\n *  context.childrenBoxPadding.left = 20;\n * });\n * ```\n */\nexport default function Resize(eventBus, rules, modeling, dragging) {\n\n  this._dragging = dragging;\n  this._rules = rules;\n\n  var self = this;\n\n\n  /**\n   * Handle resize move by specified delta.\n   *\n   * @param {Object} context\n   * @param {Point} delta\n   */\n  function handleMove(context, delta) {\n\n    var shape = context.shape,\n        direction = context.direction,\n        resizeConstraints = context.resizeConstraints,\n        newBounds;\n\n    context.delta = delta;\n\n    newBounds = resizeBounds(shape, direction, delta);\n\n    // ensure constraints during resize\n    context.newBounds = ensureConstraints(newBounds, resizeConstraints);\n\n    // update + cache executable state\n    context.canExecute = self.canResize(context);\n  }\n\n  /**\n   * Handle resize start.\n   *\n   * @param  {Object} context\n   */\n  function handleStart(context) {\n\n    var resizeConstraints = context.resizeConstraints,\n\n        // evaluate minBounds for backwards compatibility\n        minBounds = context.minBounds;\n\n    if (resizeConstraints !== undefined) {\n      return;\n    }\n\n    if (minBounds === undefined) {\n      minBounds = self.computeMinResizeBox(context);\n    }\n\n    context.resizeConstraints = {\n      min: asTRBL(minBounds)\n    };\n  }\n\n  /**\n   * Handle resize end.\n   *\n   * @param  {Object} context\n   */\n  function handleEnd(context) {\n    var shape = context.shape,\n        canExecute = context.canExecute,\n        newBounds = context.newBounds;\n\n    if (canExecute) {\n\n      // ensure we have actual pixel values for new bounds\n      // (important when zoom level was > 1 during move)\n      newBounds = roundBounds(newBounds);\n\n      if (!boundsChanged(shape, newBounds)) {\n\n        // no resize necessary\n        return;\n      }\n\n      // perform the actual resize\n      modeling.resizeShape(shape, newBounds);\n    }\n  }\n\n\n  eventBus.on('resize.start', function(event) {\n    handleStart(event.context);\n  });\n\n  eventBus.on('resize.move', function(event) {\n    var delta = {\n      x: event.dx,\n      y: event.dy\n    };\n\n    handleMove(event.context, delta);\n  });\n\n  eventBus.on('resize.end', function(event) {\n    handleEnd(event.context);\n  });\n\n}\n\n\nResize.prototype.canResize = function(context) {\n  var rules = this._rules;\n\n  var ctx = pick(context, [ 'newBounds', 'shape', 'delta', 'direction' ]);\n\n  return rules.allowed('shape.resize', ctx);\n};\n\n/**\n * Activate a resize operation.\n *\n * You may specify additional contextual information and must specify a\n * resize direction during activation of the resize event.\n *\n * @param {MouseEvent} event\n * @param {djs.model.Shape} shape\n * @param {Object|string} contextOrDirection\n */\nResize.prototype.activate = function(event, shape, contextOrDirection) {\n  var dragging = this._dragging,\n      context,\n      direction;\n\n  if (typeof contextOrDirection === 'string') {\n    contextOrDirection = {\n      direction: contextOrDirection\n    };\n  }\n\n  context = assign({ shape: shape }, contextOrDirection);\n\n  direction = context.direction;\n\n  if (!direction) {\n    throw new Error('must provide a direction (n|w|s|e|nw|se|ne|sw)');\n  }\n\n  dragging.init(event, getReferencePoint(shape, direction), 'resize', {\n    autoActivate: true,\n    cursor: getCursor(direction),\n    data: {\n      shape: shape,\n      context: context\n    }\n  });\n};\n\nResize.prototype.computeMinResizeBox = function(context) {\n  var shape = context.shape,\n      direction = context.direction,\n      minDimensions,\n      childrenBounds;\n\n  minDimensions = context.minDimensions || {\n    width: DEFAULT_MIN_WIDTH,\n    height: DEFAULT_MIN_WIDTH\n  };\n\n  // get children bounds\n  childrenBounds = computeChildrenBBox(shape, context.childrenBoxPadding);\n\n  // get correct minimum bounds from given resize direction\n  // basically ensures that the minBounds is max(childrenBounds, minDimensions)\n  return getMinResizeBounds(direction, shape, minDimensions, childrenBounds);\n};\n\n\nResize.$inject = [\n  'eventBus',\n  'rules',\n  'modeling',\n  'dragging'\n];\n\n// helpers //////////\n\nfunction boundsChanged(shape, newBounds) {\n  return shape.x !== newBounds.x ||\n    shape.y !== newBounds.y ||\n    shape.width !== newBounds.width ||\n    shape.height !== newBounds.height;\n}\n\nexport function getReferencePoint(shape, direction) {\n  var mid = getMid(shape),\n      trbl = asTRBL(shape);\n\n  var referencePoint = {\n    x: mid.x,\n    y: mid.y\n  };\n\n  if (direction.indexOf('n') !== -1) {\n    referencePoint.y = trbl.top;\n  } else if (direction.indexOf('s') !== -1) {\n    referencePoint.y = trbl.bottom;\n  }\n\n  if (direction.indexOf('e') !== -1) {\n    referencePoint.x = trbl.right;\n  } else if (direction.indexOf('w') !== -1) {\n    referencePoint.x = trbl.left;\n  }\n\n  return referencePoint;\n}\n\nfunction getCursor(direction) {\n  var prefix = 'resize-';\n\n  if (direction === 'n' || direction === 's') {\n    return prefix + 'ns';\n  } else if (direction === 'e' || direction === 'w') {\n    return prefix + 'ew';\n  } else if (direction === 'nw' || direction === 'se') {\n    return prefix + 'nwse';\n  } else {\n    return prefix + 'nesw';\n  }\n}","var MARKER_RESIZING = 'djs-resizing',\n    MARKER_RESIZE_NOT_OK = 'resize-not-ok';\n\nvar LOW_PRIORITY = 500;\n\nimport {\n  attr as svgAttr,\n  remove as svgRemove,\n  classes as svgClasses\n} from 'tiny-svg';\n\n\n/**\n * Provides previews for resizing shapes when resizing.\n *\n * @param {EventBus} eventBus\n * @param {Canvas} canvas\n * @param {PreviewSupport} previewSupport\n */\nexport default function ResizePreview(eventBus, canvas, previewSupport) {\n\n  /**\n   * Update resizer frame.\n   *\n   * @param {Object} context\n   */\n  function updateFrame(context) {\n\n    var shape = context.shape,\n        bounds = context.newBounds,\n        frame = context.frame;\n\n    if (!frame) {\n      frame = context.frame = previewSupport.addFrame(shape, canvas.getDefaultLayer());\n\n      canvas.addMarker(shape, MARKER_RESIZING);\n    }\n\n    if (bounds.width > 5) {\n      svgAttr(frame, { x: bounds.x, width: bounds.width });\n    }\n\n    if (bounds.height > 5) {\n      svgAttr(frame, { y: bounds.y, height: bounds.height });\n    }\n\n    if (context.canExecute) {\n      svgClasses(frame).remove(MARKER_RESIZE_NOT_OK);\n    } else {\n      svgClasses(frame).add(MARKER_RESIZE_NOT_OK);\n    }\n  }\n\n  /**\n   * Remove resizer frame.\n   *\n   * @param {Object} context\n   */\n  function removeFrame(context) {\n    var shape = context.shape,\n        frame = context.frame;\n\n    if (frame) {\n      svgRemove(context.frame);\n    }\n\n    canvas.removeMarker(shape, MARKER_RESIZING);\n  }\n\n  // add and update previews\n  eventBus.on('resize.move', LOW_PRIORITY, function(event) {\n    updateFrame(event.context);\n  });\n\n  // remove previews\n  eventBus.on('resize.cleanup', function(event) {\n    removeFrame(event.context);\n  });\n\n}\n\nResizePreview.$inject = [\n  'eventBus',\n  'canvas',\n  'previewSupport'\n];","import {\n  bind,\n  forEach\n} from 'min-dash';\n\nimport {\n  append as svgAppend,\n  attr as svgAttr,\n  classes as svgClasses,\n  clear as svgClear,\n  create as svgCreate\n} from 'tiny-svg';\n\nimport {\n  event as domEvent\n} from 'min-dom';\n\nimport {\n  isPrimaryButton\n} from '../../util/Mouse';\n\nimport {\n  transform\n} from '../../util/SvgTransformUtil';\n\nimport { getReferencePoint } from './Resize';\n\nvar HANDLE_OFFSET = -6,\n    HANDLE_SIZE = 4,\n    HANDLE_HIT_SIZE = 20;\n\nvar CLS_RESIZER = 'djs-resizer';\n\nvar directions = [ 'n', 'w', 's', 'e', 'nw', 'ne', 'se', 'sw' ];\n\n\n/**\n * This component is responsible for adding resize handles.\n *\n * @param {EventBus} eventBus\n * @param {Canvas} canvas\n * @param {Selection} selection\n * @param {Resize} resize\n */\nexport default function ResizeHandles(eventBus, canvas, selection, resize) {\n\n  this._resize = resize;\n  this._canvas = canvas;\n\n  var self = this;\n\n  eventBus.on('selection.changed', function(e) {\n    var newSelection = e.newSelection;\n\n    // remove old selection markers\n    self.removeResizers();\n\n    // add new selection markers ONLY if single selection\n    if (newSelection.length === 1) {\n      forEach(newSelection, bind(self.addResizer, self));\n    }\n  });\n\n  eventBus.on('shape.changed', function(e) {\n    var shape = e.element;\n\n    if (selection.isSelected(shape)) {\n      self.removeResizers();\n\n      self.addResizer(shape);\n    }\n  });\n}\n\n\nResizeHandles.prototype.makeDraggable = function(element, gfx, direction) {\n  var resize = this._resize;\n\n  function startResize(event) {\n\n    // only trigger on left mouse button\n    if (isPrimaryButton(event)) {\n      resize.activate(event, element, direction);\n    }\n  }\n\n  domEvent.bind(gfx, 'mousedown', startResize);\n  domEvent.bind(gfx, 'touchstart', startResize);\n};\n\n\nResizeHandles.prototype._createResizer = function(element, x, y, direction) {\n  var resizersParent = this._getResizersParent();\n\n  var offset = getHandleOffset(direction);\n\n  var group = svgCreate('g');\n\n  svgClasses(group).add(CLS_RESIZER);\n  svgClasses(group).add(CLS_RESIZER + '-' + element.id);\n  svgClasses(group).add(CLS_RESIZER + '-' + direction);\n\n  svgAppend(resizersParent, group);\n\n  var visual = svgCreate('rect');\n\n  svgAttr(visual, {\n    x: -HANDLE_SIZE / 2 + offset.x,\n    y: -HANDLE_SIZE / 2 + offset.y,\n    width: HANDLE_SIZE,\n    height: HANDLE_SIZE\n  });\n\n  svgClasses(visual).add(CLS_RESIZER + '-visual');\n\n  svgAppend(group, visual);\n\n  var hit = svgCreate('rect');\n\n  svgAttr(hit, {\n    x: -HANDLE_HIT_SIZE / 2 + offset.x,\n    y: -HANDLE_HIT_SIZE / 2 + offset.y,\n    width: HANDLE_HIT_SIZE,\n    height: HANDLE_HIT_SIZE\n  });\n\n  svgClasses(hit).add(CLS_RESIZER + '-hit');\n\n  svgAppend(group, hit);\n\n  transform(group, x, y);\n\n  return group;\n};\n\nResizeHandles.prototype.createResizer = function(element, direction) {\n  var point = getReferencePoint(element, direction);\n\n  var resizer = this._createResizer(element, point.x, point.y, direction);\n\n  this.makeDraggable(element, resizer, direction);\n};\n\n// resize handles implementation ///////////////////////////////\n\n/**\n * Add resizers for a given element.\n *\n * @param {djs.model.Shape} shape\n */\nResizeHandles.prototype.addResizer = function(shape) {\n  var self = this;\n\n  var resize = this._resize;\n\n  if (!resize.canResize({ shape: shape })) {\n    return;\n  }\n\n  forEach(directions, function(direction) {\n    self.createResizer(shape, direction);\n  });\n};\n\n/**\n * Remove all resizers\n */\nResizeHandles.prototype.removeResizers = function() {\n  var resizersParent = this._getResizersParent();\n\n  svgClear(resizersParent);\n};\n\nResizeHandles.prototype._getResizersParent = function() {\n  return this._canvas.getLayer('resizers');\n};\n\nResizeHandles.$inject = [\n  'eventBus',\n  'canvas',\n  'selection',\n  'resize'\n];\n\n// helpers //////////\n\nfunction getHandleOffset(direction) {\n  var offset = {\n    x: 0,\n    y: 0\n  };\n\n  if (direction.indexOf('e') !== -1) {\n    offset.x = -HANDLE_OFFSET;\n  } else if (direction.indexOf('w') !== -1) {\n    offset.x = HANDLE_OFFSET;\n  }\n\n  if (direction.indexOf('s') !== -1) {\n    offset.y = -HANDLE_OFFSET;\n  } else if (direction.indexOf('n') !== -1) {\n    offset.y = HANDLE_OFFSET;\n  }\n\n  return offset;\n}","import RulesModule from '../rules';\nimport DraggingModule from '../dragging';\nimport PreviewSupportModule from '../preview-support';\n\nimport Resize from './Resize';\nimport ResizePreview from './ResizePreview';\nimport ResizeHandles from './ResizeHandles';\n\nexport default {\n  __depends__: [\n    RulesModule,\n    DraggingModule,\n    PreviewSupportModule\n  ],\n  __init__: [\n    'resize',\n    'resizePreview',\n    'resizeHandles'\n  ],\n  resize: [ 'type', Resize ],\n  resizePreview: [ 'type', ResizePreview ],\n  resizeHandles: [ 'type', ResizeHandles ]\n};\n","import {\n  assign\n} from 'min-dash';\n\nimport {\n  getLabel\n} from './LabelUtil';\n\nimport { isAny } from '../modeling/util/ModelingUtil';\n\nimport {\n  getExternalLabelMid,\n  isLabelExternal,\n  hasExternalLabel,\n  isLabel\n} from '../../util/LabelUtil';\n\n\nexport default function LabelEditingProvider(\n    eventBus, postitFactory, canvas, directEditing,\n    modeling, resizeHandles, textRenderer) {\n\n  this._postitFactory = postitFactory;\n  this._canvas = canvas;\n  this._modeling = modeling;\n  this._textRenderer = textRenderer;\n\n  directEditing.registerProvider(this);\n\n  // listen to dblclick on non-root elements\n  eventBus.on('element.dblclick', function(event) {\n    activateDirectEdit(event.element, true);\n  });\n\n  // complete on followup canvas operation\n  eventBus.on([\n    'autoPlace.start',\n    'canvas.viewbox.changing',\n    'drag.init',\n    'element.mousedown',\n    'popupMenu.open'\n  ], function(event) {\n\n    if (directEditing.isActive()) {\n      directEditing.complete();\n    }\n  });\n\n  // cancel on command stack changes\n  eventBus.on([ 'commandStack.changed' ], function(e) {\n    if (directEditing.isActive()) {\n      directEditing.cancel();\n    }\n  });\n\n\n  eventBus.on('directEditing.activate', function(event) {\n    resizeHandles.removeResizers();\n  });\n\n  eventBus.on('create.end', 500, function(event) {\n\n    var context = event.context,\n        element = context.shape,\n        canExecute = event.context.canExecute,\n        isTouch = event.isTouch;\n\n    // TODO(nikku): we need to find a way to support the\n    // direct editing on mobile devices; right now this will\n    // break for desworkflowediting on mobile devices\n    // as it breaks the user interaction workflow\n\n    // TODO(nre): we should temporarily focus the edited element\n    // here and release the focused viewport after the direct edit\n    // operation is finished\n    if (isTouch) {\n      return;\n    }\n\n    if (!canExecute) {\n      return;\n    }\n\n    if (context.hints && context.hints.createElementsBehavior === false) {\n      return;\n    }\n\n    activateDirectEdit(element);\n  });\n\n  eventBus.on('autoPlace.end', 500, function(event) {\n    activateDirectEdit(event.shape);\n  });\n\n\n  function activateDirectEdit(element, force) {\n    if (force ||\n        isAny(element, [ 'postit:Postit', 'postit:Group', 'postit:TextBox' ])) {\n\n      directEditing.activate(element);\n    }\n  }\n\n}\n\nLabelEditingProvider.$inject = [\n  'eventBus',\n  'postitFactory',\n  'canvas',\n  'directEditing',\n  'modeling',\n  'resizeHandles',\n  'textRenderer'\n];\n\n\n/**\n * Activate direct editing for activities and text annotations.\n *\n * @param  {djs.model.Base} element\n *\n * @return {Object} an object with properties bounds (position and size), text and options\n */\nLabelEditingProvider.prototype.activate = function(element) {\n\n  // text\n  var text = getLabel(element);\n\n  if (text === undefined) {\n    return;\n  }\n\n  var context = {\n    text: text\n  };\n\n  // bounds\n  var bounds = this.getEditingBBox(element);\n\n  assign(context, bounds);\n\n  var options = {};\n\n  // postits and text boxes\n  if (isAny(element, ['postit:Postit', 'postit:TextBox'])) {\n    assign(options, {\n      centerVertically: true\n    });\n  }\n\n  // external labels\n  if (isLabelExternal(element)) {\n    assign(options, {\n      autoResize: true\n    });\n  }\n\n\n  assign(context, {\n    options: options\n  });\n\n  return context;\n};\n\n\n/**\n * Get the editing bounding box based on the element's size and position\n *\n * @param  {djs.model.Base} element\n *\n * @return {Object} an object containing information about position\n *                  and size (fixed or minimum and/or maximum)\n */\nLabelEditingProvider.prototype.getEditingBBox = function(element) {\n  var canvas = this._canvas;\n\n  var target = element.label || element;\n\n  var bbox = canvas.getAbsoluteBBox(target);\n\n  var mid = {\n    x: bbox.x + bbox.width / 2,\n    y: bbox.y + bbox.height / 2\n  };\n\n  // default position\n  var bounds = { x: bbox.x, y: bbox.y };\n\n  var zoom = canvas.zoom();\n\n  var defaultStyle = this._textRenderer.getDefaultStyle(),\n      externalStyle = this._textRenderer.getExternalStyle();\n\n  // take zoom into account\n  var externalFontSize = externalStyle.fontSize * zoom,\n      externalLineHeight = externalStyle.lineHeight,\n      defaultFontSize = defaultStyle.fontSize * zoom,\n      defaultLineHeight = defaultStyle.lineHeight;\n\n  var style = {\n    fontFamily: this._textRenderer.getDefaultStyle().fontFamily,\n    fontWeight: this._textRenderer.getDefaultStyle().fontWeight\n  };\n\n\n  if (isAny(element, [ 'postit:Postit', 'postit:TextBox', 'postit:Group'])) {\n\n    assign(bounds, {\n      width: bbox.width,\n      height: bbox.height\n    });\n\n    assign(style, {\n      fontSize: defaultFontSize + 'px',\n      lineHeight: defaultLineHeight,\n      paddingTop: (7 * zoom) + 'px',\n      paddingBottom: (7 * zoom) + 'px',\n      paddingLeft: (5 * zoom) + 'px',\n      paddingRight: (5 * zoom) + 'px'\n    });\n  }\n\n  var width = 90 * zoom,\n      paddingTop = 7 * zoom,\n      paddingBottom = 4 * zoom;\n\n  // external labels for events, data elements, gateways, groups and connections\n  if (target.labelTarget) {\n    assign(bounds, {\n      width: width,\n      height: bbox.height + paddingTop + paddingBottom,\n      x: mid.x - width / 2,\n      y: bbox.y - paddingTop\n    });\n\n    assign(style, {\n      fontSize: externalFontSize + 'px',\n      lineHeight: externalLineHeight,\n      paddingTop: paddingTop + 'px',\n      paddingBottom: paddingBottom + 'px'\n    });\n  }\n\n  // external label not yet created\n  if (isLabelExternal(target)\n      && !hasExternalLabel(target)\n      && !isLabel(target)) {\n\n    var externalLabelMid = getExternalLabelMid(element);\n\n    var absoluteBBox = canvas.getAbsoluteBBox({\n      x: externalLabelMid.x,\n      y: externalLabelMid.y,\n      width: 0,\n      height: 0\n    });\n\n    var height = externalFontSize + paddingTop + paddingBottom;\n\n    assign(bounds, {\n      width: width,\n      height: height,\n      x: absoluteBBox.x - width / 2,\n      y: absoluteBBox.y - height / 2\n    });\n\n    assign(style, {\n      fontSize: externalFontSize + 'px',\n      lineHeight: externalLineHeight,\n      paddingTop: paddingTop + 'px',\n      paddingBottom: paddingBottom + 'px'\n    });\n  }\n\n\n  // transparent edit box\n  if (isAny(element, [ 'postit:Postit' ])) {\n    assign(style, {\n      backgroundColor: 'transparent'\n    });\n  }\n\n  return { bounds: bounds, style: style };\n};\n\n\nLabelEditingProvider.prototype.update = function(element, newLabel) {\n\n  if (isEmptyText(newLabel)) {\n    newLabel = null;\n  }\n\n  this._modeling.updateLabel(element, newLabel);\n};\n\n\n\n// helpers //////////////////////\n\nfunction isEmptyText(label) {\n  return !label || !label.trim();\n}","import {\n  remove as svgRemove\n} from 'tiny-svg';\n\nimport {\n  is\n} from '../../util/ModelUtil';\n\nvar MARKER_HIDDEN = 'djs-element-hidden',\n    MARKER_LABEL_HIDDEN = 'djs-label-hidden';\n\n\nexport default function LabelEditingPreview(\n    eventBus, canvas, elementRegistry,\n    pathMap) {\n\n\n  var element, gfx;\n\n  eventBus.on('directEditing.activate', function(context) {\n    var activeProvider = context.active;\n\n    element = activeProvider.element.label || activeProvider.element;\n\n\n    if (element.labelTarget) {\n      canvas.addMarker(element, MARKER_HIDDEN);\n    } else if (is(element, 'postit:Postit')) {\n      canvas.addMarker(element, MARKER_LABEL_HIDDEN);\n    }\n  });\n\n\n  eventBus.on([ 'directEditing.complete', 'directEditing.cancel' ], function(context) {\n    var activeProvider = context.active;\n\n    if (activeProvider) {\n      canvas.removeMarker(activeProvider.element.label || activeProvider.element, MARKER_HIDDEN);\n      canvas.removeMarker(element, MARKER_LABEL_HIDDEN);\n    }\n\n    element = undefined;\n\n    if (gfx) {\n      svgRemove(gfx);\n\n      gfx = undefined;\n    }\n  });\n}\n\nLabelEditingPreview.$inject = [\n  'eventBus',\n  'canvas',\n  'elementRegistry',\n  'pathMap'\n];","import ChangeSupportModule from 'diagram-js/lib/features/change-support';\nimport ResizeModule from 'diagram-js/lib/features/resize';\nimport DirectEditingModule from 'diagram-js-direct-editing';\n\nimport LabelEditingProvider from './LabelEditingProvider';\nimport LabelEditingPreview from './LabelEditingPreview';\n\n\nexport default {\n  __depends__: [\n    ChangeSupportModule,\n    ResizeModule,\n    DirectEditingModule\n  ],\n  __init__: [\n    'labelEditingProvider',\n    'labelEditingPreview'\n  ],\n  labelEditingProvider: [ 'type', LabelEditingProvider ],\n  labelEditingPreview: [ 'type', LabelEditingPreview ]\n};\n","import {\n  forEach,\n  isFunction,\n  isArray,\n  isNumber,\n  isObject\n} from 'min-dash';\n\n\nvar DEFAULT_PRIORITY = 1000;\n\n/**\n * A utility that can be used to plug-in into the command execution for\n * extension and/or validation.\n *\n * @param {EventBus} eventBus\n *\n * @example\n *\n * import inherits from 'inherits';\n *\n * import CommandInterceptor from 'diagram-js/lib/command/CommandInterceptor';\n *\n * function CommandLogger(eventBus) {\n *   CommandInterceptor.call(this, eventBus);\n *\n *   this.preExecute(function(event) {\n *     console.log('command pre-execute', event);\n *   });\n * }\n *\n * inherits(CommandLogger, CommandInterceptor);\n *\n */\nexport default function CommandInterceptor(eventBus) {\n  this._eventBus = eventBus;\n}\n\nCommandInterceptor.$inject = [ 'eventBus' ];\n\nfunction unwrapEvent(fn, that) {\n  return function(event) {\n    return fn.call(that || null, event.context, event.command, event);\n  };\n}\n\n/**\n * Register an interceptor for a command execution\n *\n * @param {string|Array<string>} [events] list of commands to register on\n * @param {string} [hook] command hook, i.e. preExecute, executed to listen on\n * @param {number} [priority] the priority on which to hook into the execution\n * @param {Function} handlerFn interceptor to be invoked with (event)\n * @param {boolean} unwrap if true, unwrap the event and pass (context, command, event) to the\n *                          listener instead\n * @param {Object} [that] Pass context (`this`) to the handler function\n */\nCommandInterceptor.prototype.on = function(events, hook, priority, handlerFn, unwrap, that) {\n\n  if (isFunction(hook) || isNumber(hook)) {\n    that = unwrap;\n    unwrap = handlerFn;\n    handlerFn = priority;\n    priority = hook;\n    hook = null;\n  }\n\n  if (isFunction(priority)) {\n    that = unwrap;\n    unwrap = handlerFn;\n    handlerFn = priority;\n    priority = DEFAULT_PRIORITY;\n  }\n\n  if (isObject(unwrap)) {\n    that = unwrap;\n    unwrap = false;\n  }\n\n  if (!isFunction(handlerFn)) {\n    throw new Error('handlerFn must be a function');\n  }\n\n  if (!isArray(events)) {\n    events = [ events ];\n  }\n\n  var eventBus = this._eventBus;\n\n  forEach(events, function(event) {\n\n    // concat commandStack(.event)?(.hook)?\n    var fullEvent = [ 'commandStack', event, hook ].filter(function(e) { return e; }).join('.');\n\n    eventBus.on(fullEvent, priority, unwrap ? unwrapEvent(handlerFn, that) : handlerFn, that);\n  });\n};\n\n\nvar hooks = [\n  'canExecute',\n  'preExecute',\n  'preExecuted',\n  'execute',\n  'executed',\n  'postExecute',\n  'postExecuted',\n  'revert',\n  'reverted'\n];\n\n/*\n * Install hook shortcuts\n *\n * This will generate the CommandInterceptor#(preExecute|...|reverted) methods\n * which will in term forward to CommandInterceptor#on.\n */\nforEach(hooks, function(hook) {\n\n  /**\n   * {canExecute|preExecute|preExecuted|execute|executed|postExecute|postExecuted|revert|reverted}\n   *\n   * A named hook for plugging into the command execution\n   *\n   * @param {string|Array<string>} [events] list of commands to register on\n   * @param {number} [priority] the priority on which to hook into the execution\n   * @param {Function} handlerFn interceptor to be invoked with (event)\n   * @param {boolean} [unwrap=false] if true, unwrap the event and pass (context, command, event) to the\n   *                          listener instead\n   * @param {Object} [that] Pass context (`this`) to the handler function\n   */\n  CommandInterceptor.prototype[hook] = function(events, priority, handlerFn, unwrap, that) {\n\n    if (isFunction(events) || isNumber(events)) {\n      that = unwrap;\n      unwrap = handlerFn;\n      handlerFn = priority;\n      priority = events;\n      events = null;\n    }\n\n    this.on(events, hook, priority, handlerFn, unwrap, that);\n  };\n});\n","import inherits from 'inherits';\n\nimport {\n  getOrientation,\n  getMid,\n  asTRBL\n} from 'diagram-js/lib/layout/LayoutUtil';\n\nimport {\n  substract\n} from 'diagram-js/lib/util/Math';\n\nimport {\n  hasExternalLabel\n} from '../../../util/LabelUtil';\n\nimport CommandInterceptor from 'diagram-js/lib/command/CommandInterceptor';\n\nvar ALIGNMENTS = [\n  'top',\n  'bottom',\n  'left',\n  'right'\n];\n\nvar ELEMENT_LABEL_DISTANCE = 10;\n\n/**\n * A component that makes sure that external labels are added\n * together with respective elements and properly updated (DI wise)\n * during move.\n *\n * @param {EventBus} eventBus\n * @param {Modeling} modeling\n */\nexport default function AdaptiveLabelPositioningBehavior(eventBus, modeling) {\n\n  CommandInterceptor.call(this, eventBus);\n\n  this.postExecuted([\n    'connection.create',\n    'connection.layout',\n    'connection.updateWaypoints'\n  ], function(event) {\n    var context = event.context,\n        connection = context.connection,\n        source = connection.source,\n        target = connection.target,\n        hints = context.hints || {};\n\n    if (hints.createElementsBehavior !== false) {\n      checkLabelAdjustment(source);\n      checkLabelAdjustment(target);\n    }\n  });\n\n\n  this.postExecuted([\n    'label.create'\n  ], function(event) {\n    var context = event.context,\n        shape = context.shape,\n        hints = context.hints || {};\n\n    if (hints.createElementsBehavior !== false) {\n      checkLabelAdjustment(shape.labelTarget);\n    }\n  });\n\n\n  this.postExecuted([\n    'elements.create'\n  ], function(event) {\n    var context = event.context,\n        elements = context.elements,\n        hints = context.hints || {};\n\n    if (hints.createElementsBehavior !== false) {\n      elements.forEach(function(element) {\n        checkLabelAdjustment(element);\n      });\n    }\n  });\n\n  function checkLabelAdjustment(element) {\n\n    // skip non-existing labels\n    if (!hasExternalLabel(element)) {\n      return;\n    }\n\n    var optimalPosition = getOptimalPosition(element);\n\n    // no optimal position found\n    if (!optimalPosition) {\n      return;\n    }\n\n    adjustLabelPosition(element, optimalPosition);\n  }\n\n  function adjustLabelPosition(element, orientation) {\n\n    var elementMid = getMid(element),\n        label = element.label,\n        labelMid = getMid(label);\n\n    // ignore labels that are being created\n    if (!label.parent) {\n      return;\n    }\n\n    var elementTrbl = asTRBL(element);\n\n    var newLabelMid;\n\n    switch (orientation) {\n    case 'top':\n      newLabelMid = {\n        x: elementMid.x,\n        y: elementTrbl.top - ELEMENT_LABEL_DISTANCE - label.height / 2\n      };\n\n      break;\n\n    case 'left':\n\n      newLabelMid = {\n        x: elementTrbl.left - ELEMENT_LABEL_DISTANCE - label.width / 2,\n        y: elementMid.y\n      };\n\n      break;\n\n    case 'bottom':\n\n      newLabelMid = {\n        x: elementMid.x,\n        y: elementTrbl.bottom + ELEMENT_LABEL_DISTANCE + label.height / 2\n      };\n\n      break;\n\n    case 'right':\n\n      newLabelMid = {\n        x: elementTrbl.right + ELEMENT_LABEL_DISTANCE + label.width / 2,\n        y: elementMid.y\n      };\n\n      break;\n    }\n\n    var delta = substract(newLabelMid, labelMid);\n\n    modeling.moveShape(label, delta);\n  }\n\n}\n\ninherits(AdaptiveLabelPositioningBehavior, CommandInterceptor);\n\nAdaptiveLabelPositioningBehavior.$inject = [\n  'eventBus',\n  'modeling'\n];\n\n\n// helpers //////////////////////\n\n/**\n * Return alignments which are taken by a boundary's host element\n *\n * @param {Shape} element\n *\n * @return {Array<String>}\n */\nfunction getTakenHostAlignments(element) {\n\n  var hostElement = element.host,\n      elementMid = getMid(element),\n      hostOrientation = getOrientation(elementMid, hostElement);\n\n  var freeAlignments;\n\n  // check whether there is a multi-orientation, e.g. 'top-left'\n  if (hostOrientation.indexOf('-') >= 0) {\n    freeAlignments = hostOrientation.split('-');\n  } else {\n    freeAlignments = [ hostOrientation ];\n  }\n\n  var takenAlignments = ALIGNMENTS.filter(function(alignment) {\n\n    return freeAlignments.indexOf(alignment) === -1;\n  });\n\n  return takenAlignments;\n\n}\n\n/**\n * Return alignments which are taken by related connections\n *\n * @param {Shape} element\n *\n * @return {Array<String>}\n */\nfunction getTakenConnectionAlignments(element) {\n\n  var elementMid = getMid(element);\n\n  var takenAlignments = [].concat(\n    element.incoming.map(function(c) {\n      return c.waypoints[c.waypoints.length - 2 ];\n    }),\n    element.outgoing.map(function(c) {\n      return c.waypoints[1];\n    })\n  ).map(function(point) {\n    return getApproximateOrientation(elementMid, point);\n  });\n\n  return takenAlignments;\n}\n\n/**\n * Return the optimal label position around an element\n * or _undefined_, if none was found.\n *\n * @param  {Shape} element\n *\n * @return {String} positioning identifier\n */\nfunction getOptimalPosition(element) {\n\n  var labelMid = getMid(element.label);\n\n  var elementMid = getMid(element);\n\n  var labelOrientation = getApproximateOrientation(elementMid, labelMid);\n\n  if (!isAligned(labelOrientation)) {\n    return;\n  }\n\n  var takenAlignments = getTakenConnectionAlignments(element);\n\n  if (element.host) {\n    var takenHostAlignments = getTakenHostAlignments(element);\n\n    takenAlignments = takenAlignments.concat(takenHostAlignments);\n  }\n\n  var freeAlignments = ALIGNMENTS.filter(function(alignment) {\n\n    return takenAlignments.indexOf(alignment) === -1;\n  });\n\n  // NOTHING TO DO; label already aligned a.O.K.\n  if (freeAlignments.indexOf(labelOrientation) !== -1) {\n    return;\n  }\n\n  return freeAlignments[0];\n}\n\nfunction getApproximateOrientation(p0, p1) {\n  return getOrientation(p1, p0, 5);\n}\n\nfunction isAligned(orientation) {\n  return ALIGNMENTS.indexOf(orientation) !== -1;\n}\n","import inherits from 'inherits';\n\nimport CommandInterceptor from 'diagram-js/lib/command/CommandInterceptor';\n\n\nexport default function AppendBehavior(eventBus) {\n\n  CommandInterceptor.call(this, eventBus);\n\n  // assign correct shape position unless already set\n\n  this.preExecute('shape.append', function(context) {\n\n    var source = context.source,\n        shape = context.shape;\n\n    if (!context.position) {\n\n      context.position = {\n        x: source.x + source.width + 80 + shape.width / 2,\n        y: source.y + source.height / 2\n      };\n\n    }\n  }, true);\n}\n\ninherits(AppendBehavior, CommandInterceptor);\n\nAppendBehavior.$inject = [\n  'eventBus'\n];","import { is } from '../../../util/ModelUtil';\r\n\r\nvar HIGH_PRIORITY = 1500;\r\n\r\n\r\n/**\r\n * Correct hover targets in certain situations to improve diagram interaction.\r\n *\r\n * @param {ElementRegistry} elementRegistry\r\n * @param {EventBus} eventBus\r\n * @param {Canvas} canvas\r\n */\r\nexport default function FixHoverBehavior(elementRegistry, eventBus, canvas) {\r\n\r\n  eventBus.on([\r\n    'create.hover',\r\n    'create.move',\r\n    'create.end',\r\n    'shape.move.hover',\r\n    'shape.move.move',\r\n    'shape.move.end'\r\n  ], HIGH_PRIORITY, function(event) {\r\n    var context = event.context,\r\n        shape = context.shape || event.shape,\r\n        hover = event.hover;\r\n\r\n    var rootElement = canvas.getRootElement();\r\n\r\n    // ensure group & label elements are dropped always onto the root\r\n    if (hover !== rootElement && (shape.labelTarget || is(shape, 'postit:Group'))) {\r\n      event.hover = rootElement;\r\n      event.hoverGfx = elementRegistry.getGraphics(event.hover);\r\n    }\r\n  });\r\n\r\n}\r\n\r\nFixHoverBehavior.$inject = [\r\n  'elementRegistry',\r\n  'eventBus',\r\n  'canvas'\r\n];","/**\n * Returns the intersection between two line segments a and b.\n *\n * @param {Point} l1s\n * @param {Point} l1e\n * @param {Point} l2s\n * @param {Point} l2e\n *\n * @return {Point}\n */\nexport default function lineIntersect(l1s, l1e, l2s, l2e) {\n\n  // if the lines intersect, the result contains the x and y of the\n  // intersection (treating the lines as infinite) and booleans for\n  // whether line segment 1 or line segment 2 contain the point\n  var denominator, a, b, c, numerator;\n\n  denominator = ((l2e.y - l2s.y) * (l1e.x - l1s.x)) - ((l2e.x - l2s.x) * (l1e.y - l1s.y));\n\n  if (denominator == 0) {\n    return null;\n  }\n\n  a = l1s.y - l2s.y;\n  b = l1s.x - l2s.x;\n  numerator = ((l2e.x - l2s.x) * a) - ((l2e.y - l2s.y) * b);\n\n  c = numerator / denominator;\n\n  // if we cast these lines infinitely in\n  // both directions, they intersect here\n  return {\n    x: Math.round(l1s.x + (c * (l1e.x - l1s.x))),\n    y: Math.round(l1s.y + (c * (l1e.y - l1s.y)))\n  };\n}","import {\n  getMid\n} from 'diagram-js/lib/layout/LayoutUtil';\n\nimport lineIntersect from './util/LineIntersect';\n\n\n/**\n * Fix broken dockings after DI imports.\n *\n * @param {EventBus} eventBus\n */\nexport default function ImportDockingFix(eventBus) {\n\n  function adjustDocking(startPoint, nextPoint, elementMid) {\n\n    var elementTop = {\n      x: elementMid.x,\n      y: elementMid.y - 50\n    };\n\n    var elementLeft = {\n      x: elementMid.x - 50,\n      y: elementMid.y\n    };\n\n    var verticalIntersect = lineIntersect(startPoint, nextPoint, elementMid, elementTop),\n        horizontalIntersect = lineIntersect(startPoint, nextPoint, elementMid, elementLeft);\n\n    // original is horizontal or vertical center cross intersection\n    var centerIntersect;\n\n    if (verticalIntersect && horizontalIntersect) {\n      if (getDistance(verticalIntersect, elementMid) > getDistance(horizontalIntersect, elementMid)) {\n        centerIntersect = horizontalIntersect;\n      } else {\n        centerIntersect = verticalIntersect;\n      }\n    } else {\n      centerIntersect = verticalIntersect || horizontalIntersect;\n    }\n\n    startPoint.original = centerIntersect;\n  }\n\n  function fixDockings(connection) {\n    var waypoints = connection.waypoints;\n\n    adjustDocking(\n      waypoints[0],\n      waypoints[1],\n      getMid(connection.source)\n    );\n\n    adjustDocking(\n      waypoints[waypoints.length - 1],\n      waypoints[waypoints.length - 2],\n      getMid(connection.target)\n    );\n  }\n\n  eventBus.on('boardElement.added', function(e) {\n\n    var element = e.element;\n\n    if (element.waypoints) {\n      fixDockings(element);\n    }\n  });\n}\n\nImportDockingFix.$inject = [\n  'eventBus'\n];\n\n\n// helpers //////////////////////\n\nfunction getDistance(p1, p2) {\n  return Math.sqrt(Math.pow(p1.x - p2.x, 2) + Math.pow(p1.y - p2.y, 2));\n}","/**\n * Returns the length of a vector\n *\n * @param {Vector}\n * @return {Float}\n */\nexport function vectorLength(v) {\n  return Math.sqrt(Math.pow(v.x, 2) + Math.pow(v.y, 2));\n}\n\n\n/**\n * Calculates the angle between a line a the yAxis\n *\n * @param {Array}\n * @return {Float}\n */\nexport function getAngle(line) {\n\n  // return value is between 0, 180 and -180, -0\n  // @janstuemmel: maybe replace return a/b with b/a\n  return Math.atan((line[1].y - line[0].y) / (line[1].x - line[0].x));\n}\n\n\n/**\n * Rotates a vector by a given angle\n *\n * @param {Vector}\n * @param {Float} Angle in radians\n * @return {Vector}\n */\nexport function rotateVector(vector, angle) {\n  return (!angle) ? vector : {\n    x: Math.cos(angle) * vector.x - Math.sin(angle) * vector.y,\n    y: Math.sin(angle) * vector.x + Math.cos(angle) * vector.y\n  };\n}\n\n\n/**\n * Solves a 2D equation system\n * a + r*b = c, where a,b,c are 2D vectors\n *\n * @param {Vector}\n * @param {Vector}\n * @param {Vector}\n * @return {Float}\n */\nfunction solveLambaSystem(a, b, c) {\n\n  // the 2d system\n  var system = [\n    { n: a[0] - c[0], lambda: b[0] },\n    { n: a[1] - c[1], lambda: b[1] }\n  ];\n\n  // solve\n  var n = system[0].n * b[0] + system[1].n * b[1],\n      l = system[0].lambda * b[0] + system[1].lambda * b[1];\n\n  return -n/l;\n}\n\n\n/**\n * Position of perpendicular foot\n *\n * @param {Point}\n * @param [ {Point}, {Point} ] line defined through two points\n * @return {Point} the perpendicular foot position\n */\nexport function perpendicularFoot(point, line) {\n\n  var a = line[0], b = line[1];\n\n  // relative position of b from a\n  var bd = { x: b.x - a.x, y: b.y - a.y };\n\n  // solve equation system to the parametrized vectors param real value\n  var r = solveLambaSystem([ a.x, a.y ], [ bd.x, bd.y ], [ point.x, point.y ]);\n\n  return { x: a.x + r*bd.x, y: a.y + r*bd.y };\n}\n\n\n/**\n * Calculates the distance between a point and a line\n *\n * @param {Point}\n * @param [ {Point}, {Point} ] line defined through two points\n * @return {Float} distance\n */\nexport function getDistancePointLine(point, line) {\n\n  var pfPoint = perpendicularFoot(point, line);\n\n  // distance vector\n  var connectionVector = {\n    x: pfPoint.x - point.x,\n    y: pfPoint.y - point.y\n  };\n\n  return vectorLength(connectionVector);\n}\n\n\n/**\n * Calculates the distance between two points\n *\n * @param {Point}\n * @param {Point}\n * @return {Float} distance\n */\nexport function getDistancePointPoint(point1, point2) {\n\n  return vectorLength({\n    x: point1.x - point2.x,\n    y: point1.y - point2.y\n  });\n}","var sqrt = Math.sqrt,\n    min = Math.min,\n    max = Math.max,\n    abs = Math.abs;\n\n/**\n * Calculate the square (power to two) of a number.\n *\n * @param {Number} n\n *\n * @return {Number}\n */\nfunction sq(n) {\n  return Math.pow(n, 2);\n}\n\n/**\n * Get distance between two points.\n *\n * @param {Point} p1\n * @param {Point} p2\n *\n * @return {Number}\n */\nfunction getDistance(p1, p2) {\n  return sqrt(sq(p1.x - p2.x) + sq(p1.y - p2.y));\n}\n\n/**\n * Return the attachment of the given point on the specified line.\n *\n * The attachment is either a bendpoint (attached to the given point)\n * or segment (attached to a location on a line segment) attachment:\n *\n * ```javascript\n * var pointAttachment = {\n *   type: 'bendpoint',\n *   bendpointIndex: 3,\n *   position: { x: 10, y: 10 } // the attach point on the line\n * };\n *\n * var segmentAttachment = {\n *   type: 'segment',\n *   segmentIndex: 2,\n *   relativeLocation: 0.31, // attach point location between 0 (at start) and 1 (at end)\n *   position: { x: 10, y: 10 } // the attach point on the line\n * };\n * ```\n *\n * @param {Point} point\n * @param {Array<Point>} line\n *\n * @return {Object} attachment\n */\nexport function getAttachment(point, line) {\n\n  var idx = 0,\n      segmentStart,\n      segmentEnd,\n      segmentStartDistance,\n      segmentEndDistance,\n      attachmentPosition,\n      minDistance,\n      intersections,\n      attachment,\n      attachmentDistance,\n      closestAttachmentDistance,\n      closestAttachment;\n\n  for (idx = 0; idx < line.length - 1; idx++) {\n\n    segmentStart = line[idx];\n    segmentEnd = line[idx + 1];\n\n    if (pointsEqual(segmentStart, segmentEnd)) {\n      intersections = [ segmentStart ];\n    } else {\n      segmentStartDistance = getDistance(point, segmentStart);\n      segmentEndDistance = getDistance(point, segmentEnd);\n\n      minDistance = min(segmentStartDistance, segmentEndDistance);\n\n      intersections = getCircleSegmentIntersections(segmentStart, segmentEnd, point, minDistance);\n    }\n\n    if (intersections.length < 1) {\n      throw new Error('expected between [1, 2] circle -> line intersections');\n    }\n\n    // one intersection -> bendpoint attachment\n    if (intersections.length === 1) {\n      attachment = {\n        type: 'bendpoint',\n        position: intersections[0],\n        segmentIndex: idx,\n        bendpointIndex: pointsEqual(segmentStart, intersections[0]) ? idx : idx + 1\n      };\n    }\n\n    // two intersections -> segment attachment\n    if (intersections.length === 2) {\n\n      attachmentPosition = mid(intersections[0], intersections[1]);\n\n      attachment = {\n        type: 'segment',\n        position: attachmentPosition,\n        segmentIndex: idx,\n        relativeLocation: getDistance(segmentStart, attachmentPosition) / getDistance(segmentStart, segmentEnd)\n      };\n    }\n\n    attachmentDistance = getDistance(attachment.position, point);\n\n    if (!closestAttachment || closestAttachmentDistance > attachmentDistance) {\n      closestAttachment = attachment;\n      closestAttachmentDistance = attachmentDistance;\n    }\n  }\n\n  return closestAttachment;\n}\n\n/**\n * Gets the intersection between a circle and a line segment.\n *\n * @param {Point} s1 segment start\n * @param {Point} s2 segment end\n * @param {Point} cc circle center\n * @param {Number} cr circle radius\n *\n * @return {Array<Point>} intersections\n */\nfunction getCircleSegmentIntersections(s1, s2, cc, cr) {\n\n  var baX = s2.x - s1.x;\n  var baY = s2.y - s1.y;\n  var caX = cc.x - s1.x;\n  var caY = cc.y - s1.y;\n\n  var a = baX * baX + baY * baY;\n  var bBy2 = baX * caX + baY * caY;\n  var c = caX * caX + caY * caY - cr * cr;\n\n  var pBy2 = bBy2 / a;\n  var q = c / a;\n\n  var disc = pBy2 * pBy2 - q;\n\n  // check against negative value to work around\n  // negative, very close to zero results (-4e-15)\n  // being produced in some environments\n  if (disc < 0 && disc > -0.000001) {\n    disc = 0;\n  }\n\n  if (disc < 0) {\n    return [];\n  }\n\n  // if disc == 0 ... dealt with later\n  var tmpSqrt = sqrt(disc);\n  var abScalingFactor1 = -pBy2 + tmpSqrt;\n  var abScalingFactor2 = -pBy2 - tmpSqrt;\n\n  var i1 = {\n    x: s1.x - baX * abScalingFactor1,\n    y: s1.y - baY * abScalingFactor1\n  };\n\n  if (disc === 0) { // abScalingFactor1 == abScalingFactor2\n    return [ i1 ];\n  }\n\n  var i2 = {\n    x: s1.x - baX * abScalingFactor2,\n    y: s1.y - baY * abScalingFactor2\n  };\n\n  // return only points on line segment\n  return [ i1, i2 ].filter(function(p) {\n    return isPointInSegment(p, s1, s2);\n  });\n}\n\n\nfunction isPointInSegment(p, segmentStart, segmentEnd) {\n  return (\n    fenced(p.x, segmentStart.x, segmentEnd.x) &&\n    fenced(p.y, segmentStart.y, segmentEnd.y)\n  );\n}\n\nfunction fenced(n, rangeStart, rangeEnd) {\n\n  // use matching threshold to work around\n  // precision errors in intersection computation\n\n  return (\n    n >= min(rangeStart, rangeEnd) - EQUAL_THRESHOLD &&\n    n <= max(rangeStart, rangeEnd) + EQUAL_THRESHOLD\n  );\n}\n\n/**\n * Calculate mid of two points.\n *\n * @param {Point} p1\n * @param {Point} p2\n *\n * @return {Point}\n */\nfunction mid(p1, p2) {\n\n  return {\n    x: (p1.x + p2.x) / 2,\n    y: (p1.y + p2.y) / 2\n  };\n}\n\nvar EQUAL_THRESHOLD = 0.1;\n\nfunction pointsEqual(p1, p2) {\n\n  return (\n    abs(p1.x - p2.x) <= EQUAL_THRESHOLD &&\n    abs(p1.y - p2.y) <= EQUAL_THRESHOLD\n  );\n}\n","import {\n  getDistancePointPoint,\n  rotateVector,\n  getAngle\n} from './GeometricUtil';\n\nimport {\n  getAttachment\n} from './LineAttachmentUtil';\n\nimport {\n  roundPoint\n} from 'diagram-js/lib/layout/LayoutUtil';\n\n\nexport function findNewLabelLineStartIndex(oldWaypoints, newWaypoints, attachment, hints) {\n\n  var index = attachment.segmentIndex;\n\n  var offset = newWaypoints.length - oldWaypoints.length;\n\n  // segmentMove happened\n  if (hints.segmentMove) {\n\n    var oldSegmentStartIndex = hints.segmentMove.segmentStartIndex,\n        newSegmentStartIndex = hints.segmentMove.newSegmentStartIndex;\n\n    // if label was on moved segment return new segment index\n    if (index === oldSegmentStartIndex) {\n      return newSegmentStartIndex;\n    }\n\n    // label is after new segment index\n    if (index >= newSegmentStartIndex) {\n      return (index+offset < newSegmentStartIndex) ? newSegmentStartIndex : index+offset;\n    }\n\n    // if label is before new segment index\n    return index;\n  }\n\n  // bendpointMove happened\n  if (hints.bendpointMove) {\n\n    var insert = hints.bendpointMove.insert,\n        bendpointIndex = hints.bendpointMove.bendpointIndex,\n        newIndex;\n\n    // waypoints length didnt change\n    if (offset === 0) {\n      return index;\n    }\n\n    // label behind new/removed bendpoint\n    if (index >= bendpointIndex) {\n      newIndex = insert ? index + 1 : index - 1;\n    }\n\n    // label before new/removed bendpoint\n    if (index < bendpointIndex) {\n\n      newIndex = index;\n\n      // decide label should take right or left segment\n      if (insert && attachment.type !== 'bendpoint' && bendpointIndex-1 === index) {\n\n        var rel = relativePositionMidWaypoint(newWaypoints, bendpointIndex);\n\n        if (rel < attachment.relativeLocation) {\n          newIndex++;\n        }\n      }\n    }\n\n    return newIndex;\n  }\n\n  // start/end changed\n  if (offset === 0) {\n    return index;\n  }\n\n  if (hints.connectionStart) {\n    return (index === 0) ? 0 : null;\n  }\n\n  if (hints.connectionEnd) {\n    return (index === oldWaypoints.length - 2) ? newWaypoints.length - 2 : null;\n  }\n\n  // if nothing fits, return null\n  return null;\n}\n\n\n/**\n * Calculate the required adjustment (move delta) for the given label\n * after the connection waypoints got updated.\n *\n * @param {djs.model.Label} label\n * @param {Array<Point>} newWaypoints\n * @param {Array<Point>} oldWaypoints\n * @param {Object} hints\n *\n * @return {Point} delta\n */\nexport function getLabelAdjustment(label, newWaypoints, oldWaypoints, hints) {\n\n  var x = 0,\n      y = 0;\n\n  var labelPosition = getLabelMid(label);\n\n  // get closest attachment\n  var attachment = getAttachment(labelPosition, oldWaypoints),\n      oldLabelLineIndex = attachment.segmentIndex,\n      newLabelLineIndex = findNewLabelLineStartIndex(oldWaypoints, newWaypoints, attachment, hints);\n\n  if (newLabelLineIndex === null) {\n    return { x: x, y: y };\n  }\n\n  // should never happen\n  // TODO(@janstuemmel): throw an error here when connectionSegmentMove is refactored\n  if (newLabelLineIndex < 0 ||\n      newLabelLineIndex > newWaypoints.length - 2) {\n    return { x: x, y: y };\n  }\n\n  var oldLabelLine = getLine(oldWaypoints, oldLabelLineIndex),\n      newLabelLine = getLine(newWaypoints, newLabelLineIndex),\n      oldFoot = attachment.position;\n\n  var relativeFootPosition = getRelativeFootPosition(oldLabelLine, oldFoot),\n      angleDelta = getAngleDelta(oldLabelLine, newLabelLine);\n\n  // special rule if label on bendpoint\n  if (attachment.type === 'bendpoint') {\n\n    var offset = newWaypoints.length - oldWaypoints.length,\n        oldBendpointIndex = attachment.bendpointIndex,\n        oldBendpoint = oldWaypoints[oldBendpointIndex];\n\n    // bendpoint position hasn't changed, return same position\n    if (newWaypoints.indexOf(oldBendpoint) !== -1) {\n      return { x: x, y: y };\n    }\n\n    // new bendpoint and old bendpoint have same index, then just return the offset\n    if (offset === 0) {\n      var newBendpoint = newWaypoints[oldBendpointIndex];\n\n      return {\n        x: newBendpoint.x - attachment.position.x,\n        y: newBendpoint.y - attachment.position.y\n      };\n    }\n\n    // if bendpoints get removed\n    if (offset < 0 && oldBendpointIndex !== 0 && oldBendpointIndex < oldWaypoints.length - 1) {\n      relativeFootPosition = relativePositionMidWaypoint(oldWaypoints, oldBendpointIndex);\n    }\n  }\n\n  var newFoot = {\n    x: (newLabelLine[1].x - newLabelLine[0].x) * relativeFootPosition + newLabelLine[0].x,\n    y: (newLabelLine[1].y - newLabelLine[0].y) * relativeFootPosition + newLabelLine[0].y\n  };\n\n  // the rotated vector to label\n  var newLabelVector = rotateVector({\n    x: labelPosition.x - oldFoot.x,\n    y: labelPosition.y - oldFoot.y\n  }, angleDelta);\n\n  // the new relative position\n  x = newFoot.x + newLabelVector.x - labelPosition.x;\n  y = newFoot.y + newLabelVector.y - labelPosition.y;\n\n  return roundPoint({\n    x: x,\n    y: y\n  });\n}\n\n\n// HELPERS //////////////////////\n\nfunction relativePositionMidWaypoint(waypoints, idx) {\n\n  var distanceSegment1 = getDistancePointPoint(waypoints[idx-1], waypoints[idx]),\n      distanceSegment2 = getDistancePointPoint(waypoints[idx], waypoints[idx+1]);\n\n  var relativePosition = distanceSegment1 / (distanceSegment1 + distanceSegment2);\n\n  return relativePosition;\n}\n\nfunction getLabelMid(label) {\n  return {\n    x: label.x + label.width / 2,\n    y: label.y + label.height / 2\n  };\n}\n\nfunction getAngleDelta(l1, l2) {\n  var a1 = getAngle(l1),\n      a2 = getAngle(l2);\n  return a2 - a1;\n}\n\nfunction getLine(waypoints, idx) {\n  return [ waypoints[idx], waypoints[idx+1] ];\n}\n\nfunction getRelativeFootPosition(line, foot) {\n\n  var length = getDistancePointPoint(line[0], line[1]),\n      lengthToFoot = getDistancePointPoint(line[0], foot);\n\n  return length === 0 ? 0 : lengthToFoot / length;\n}\n","import {\n  asTRBL,\n  getOrientation,\n  roundPoint\n} from '../layout/LayoutUtil';\n\nimport {\n  center,\n  delta\n} from './PositionUtil';\n\n\n/**\n * Calculates the absolute point relative to the new element's position\n *\n * @param {point} point [absolute]\n * @param {bounds} oldBounds\n * @param {bounds} newBounds\n *\n * @return {point} point [absolute]\n */\nexport function getNewAttachPoint(point, oldBounds, newBounds) {\n  var oldCenter = center(oldBounds),\n      newCenter = center(newBounds),\n      oldDelta = delta(point, oldCenter);\n\n  var newDelta = {\n    x: oldDelta.x * (newBounds.width / oldBounds.width),\n    y: oldDelta.y * (newBounds.height / oldBounds.height)\n  };\n\n  return roundPoint({\n    x: newCenter.x + newDelta.x,\n    y: newCenter.y + newDelta.y\n  });\n}\n\n\n/**\n * Calculates the shape's delta relative to a new position\n * of a certain element's bounds\n *\n * @param {djs.model.Shape} point [absolute]\n * @param {bounds} oldBounds\n * @param {bounds} newBounds\n *\n * @return {delta} delta\n */\nexport function getNewAttachShapeDelta(shape, oldBounds, newBounds) {\n  var shapeCenter = center(shape),\n      oldCenter = center(oldBounds),\n      newCenter = center(newBounds),\n      shapeDelta = delta(shape, shapeCenter),\n      oldCenterDelta = delta(shapeCenter, oldCenter),\n      stickyPositionDelta = getStickyPositionDelta(shapeCenter, oldBounds, newBounds);\n\n  if (stickyPositionDelta) {\n    return stickyPositionDelta;\n  }\n\n  var newCenterDelta = {\n    x: oldCenterDelta.x * (newBounds.width / oldBounds.width),\n    y: oldCenterDelta.y * (newBounds.height / oldBounds.height)\n  };\n\n  var newShapeCenter = {\n    x: newCenter.x + newCenterDelta.x,\n    y: newCenter.y + newCenterDelta.y\n  };\n\n  return roundPoint({\n    x: newShapeCenter.x + shapeDelta.x - shape.x,\n    y: newShapeCenter.y + shapeDelta.y - shape.y\n  });\n}\n\nfunction getStickyPositionDelta(oldShapeCenter, oldBounds, newBounds) {\n  var oldTRBL = asTRBL(oldBounds),\n      newTRBL = asTRBL(newBounds);\n\n  if (isMoved(oldTRBL, newTRBL)) {\n    return null;\n  }\n\n  var oldOrientation = getOrientation(oldBounds, oldShapeCenter),\n      stickyPositionDelta,\n      newShapeCenter,\n      newOrientation;\n\n  if (oldOrientation === 'top') {\n    stickyPositionDelta = {\n      x: 0,\n      y: newTRBL.bottom - oldTRBL.bottom\n    };\n  } else if (oldOrientation === 'bottom') {\n    stickyPositionDelta = {\n      x: 0,\n      y: newTRBL.top - oldTRBL.top\n    };\n  } else if (oldOrientation === 'right') {\n    stickyPositionDelta = {\n      x: newTRBL.left - oldTRBL.left,\n      y: 0\n    };\n  } else if (oldOrientation === 'left') {\n    stickyPositionDelta = {\n      x: newTRBL.right - oldTRBL.right,\n      y: 0\n    };\n  } else {\n\n    // fallback to proportional movement for corner-placed attachments\n    return null;\n  }\n\n  newShapeCenter = {\n    x: oldShapeCenter.x + stickyPositionDelta.x,\n    y: oldShapeCenter.y + stickyPositionDelta.y\n  };\n\n  newOrientation = getOrientation(newBounds, newShapeCenter);\n\n  if (newOrientation !== oldOrientation) {\n\n    // fallback to proportional movement if orientation would otherwise change\n    return null;\n  }\n\n  return stickyPositionDelta;\n}\n\nfunction isMoved(oldTRBL, newTRBL) {\n  return isHorizontallyMoved(oldTRBL, newTRBL) || isVerticallyMoved(oldTRBL, newTRBL);\n}\n\nfunction isHorizontallyMoved(oldTRBL, newTRBL) {\n  return oldTRBL.right !== newTRBL.right && oldTRBL.left !== newTRBL.left;\n}\n\nfunction isVerticallyMoved(oldTRBL, newTRBL) {\n  return oldTRBL.top !== newTRBL.top && oldTRBL.bottom !== newTRBL.bottom;\n}\n","import {\n  assign\n} from 'min-dash';\n\nimport inherits from 'inherits';\n\nimport {\n  is,\n  getBusinessObject\n} from '../../../util/ModelUtil';\n\nimport {\n  isLabelExternal,\n  getExternalLabelMid,\n  hasExternalLabel,\n  isLabel\n} from '../../../util/LabelUtil';\n\nimport {\n  getLabel\n} from '../../label-editing/LabelUtil';\n\nimport {\n  getLabelAdjustment\n} from './util/LabelLayoutUtil';\n\nimport CommandInterceptor from 'diagram-js/lib/command/CommandInterceptor';\n\nimport {\n  getNewAttachPoint\n} from 'diagram-js/lib/util/AttachUtil';\n\nimport {\n  getMid,\n  roundPoint\n} from 'diagram-js/lib/layout/LayoutUtil';\n\nimport {\n  delta\n} from 'diagram-js/lib/util/PositionUtil';\n\nimport {\n  sortBy\n} from 'min-dash';\n\nimport {\n  getDistancePointLine,\n  perpendicularFoot\n} from './util/GeometricUtil';\n\nvar DEFAULT_LABEL_DIMENSIONS = {\n  width: 90,\n  height: 20\n};\n\nvar NAME_PROPERTY = 'name';\n\n/**\n * A component that makes sure that external labels are added\n * together with respective elements and properly updated (DI wise)\n * during move.\n *\n * @param {EventBus} eventBus\n * @param {Modeling} modeling\n * @param {PostitFactory} postitFactory\n * @param {TextRenderer} textRenderer\n */\nexport default function LabelBehavior(\n    eventBus, modeling, postitFactory,\n    textRenderer) {\n\n  CommandInterceptor.call(this, eventBus);\n\n  // update label if name property was updated\n  this.postExecute('element.updateProperties', function(e) {\n    var context = e.context,\n        element = context.element,\n        properties = context.properties;\n\n    if (NAME_PROPERTY in properties) {\n      modeling.updateLabel(element, properties[NAME_PROPERTY]);\n    }\n  });\n\n  // create label shape after shape/connection was created\n  this.postExecute([ 'shape.create', 'connection.create' ], function(e) {\n    var context = e.context,\n        hints = context.hints || {};\n\n    if (hints.createElementsBehavior === false) {\n      return;\n    }\n\n    var element = context.shape || context.connection,\n        businessObject = element.businessObject;\n\n    if (isLabel(element) || !isLabelExternal(element)) {\n      return;\n    }\n\n    // only create label if attribute available\n    if (!getLabel(element)) {\n      return;\n    }\n\n    var labelCenter = getExternalLabelMid(element);\n\n    // we don't care about x and y\n    var labelDimensions = textRenderer.getExternalLabelBounds(\n      DEFAULT_LABEL_DIMENSIONS,\n      getLabel(element)\n    );\n\n    modeling.createLabel(element, labelCenter, {\n      id: businessObject.id + '_label',\n      businessObject: businessObject,\n      width: labelDimensions.width,\n      height: labelDimensions.height\n    });\n  });\n\n  // update label after label shape was deleted\n  this.postExecute('shape.delete', function(event) {\n    var context = event.context,\n        labelTarget = context.labelTarget,\n        hints = context.hints || {};\n\n    // check if label\n    if (labelTarget && hints.unsetLabel !== false) {\n      modeling.updateLabel(labelTarget, null, null, { removeShape: false });\n    }\n  });\n\n  // update di information on label creation\n  this.postExecute([ 'label.create' ], function(event) {\n\n    var context = event.context,\n        element = context.shape,\n        businessObject,\n        di;\n\n    // we want to trigger on real labels only\n    if (!element.labelTarget) {\n      return;\n    }\n\n    // we want to trigger on board elements only\n    if (!is(element.labelTarget || element, 'postit:BoardElement')) {\n      return;\n    }\n\n    businessObject = element.businessObject,\n    di = businessObject.di;\n\n\n    if (!di.label) {\n      di.label = postitFactory.create('postitDi:PostitLabel', {\n        bounds: postitFactory.create('dc:Bounds')\n      });\n    }\n\n    assign(di.label.bounds, {\n      x: element.x,\n      y: element.y,\n      width: element.width,\n      height: element.height\n    });\n  });\n\n  function getVisibleLabelAdjustment(event) {\n\n    var context = event.context,\n        connection = context.connection,\n        label = connection.label,\n        hints = assign({}, context.hints),\n        newWaypoints = context.newWaypoints || connection.waypoints,\n        oldWaypoints = context.oldWaypoints;\n\n\n    if (typeof hints.startChanged === 'undefined') {\n      hints.startChanged = !!hints.connectionStart;\n    }\n\n    if (typeof hints.endChanged === 'undefined') {\n      hints.endChanged = !!hints.connectionEnd;\n    }\n\n    return getLabelAdjustment(label, newWaypoints, oldWaypoints, hints);\n  }\n\n  this.postExecute([\n    'connection.layout',\n    'connection.updateWaypoints'\n  ], function(event) {\n    var context = event.context,\n        hints = context.hints || {};\n\n    if (hints.labelBehavior === false) {\n      return;\n    }\n\n    var connection = context.connection,\n        label = connection.label,\n        labelAdjustment;\n\n    // handle missing label as well as the case\n    // that the label parent does not exist (yet),\n    // because it is being pasted / created via multi element create\n    //\n    // Cf. https://github.com/bpmn-io/bpmn-js/pull/1227\n    if (!label || !label.parent) {\n      return;\n    }\n\n    labelAdjustment = getVisibleLabelAdjustment(event);\n\n    modeling.moveShape(label, labelAdjustment);\n  });\n\n\n  // keep label position on shape replace\n  this.postExecute([ 'shape.replace' ], function(event) {\n    var context = event.context,\n        newShape = context.newShape,\n        oldShape = context.oldShape;\n\n    var businessObject = getBusinessObject(newShape);\n\n    if (businessObject\n      && isLabelExternal(businessObject)\n      && oldShape.label\n      && newShape.label) {\n      newShape.label.x = oldShape.label.x;\n      newShape.label.y = oldShape.label.y;\n    }\n  });\n\n\n  // move external label after resizing\n  this.postExecute('shape.resize', function(event) {\n\n    var context = event.context,\n        shape = context.shape,\n        newBounds = context.newBounds,\n        oldBounds = context.oldBounds;\n\n    if (hasExternalLabel(shape)) {\n\n      var label = shape.label,\n          labelMid = getMid(label),\n          edges = asEdges(oldBounds);\n\n      // get nearest border point to label as reference point\n      var referencePoint = getReferencePoint(labelMid, edges);\n\n      var delta = getReferencePointDelta(referencePoint, oldBounds, newBounds);\n\n      modeling.moveShape(label, delta);\n\n    }\n\n  });\n\n}\n\ninherits(LabelBehavior, CommandInterceptor);\n\nLabelBehavior.$inject = [\n  'eventBus',\n  'modeling',\n  'postitFactory',\n  'textRenderer'\n];\n\n// helpers //////////////////////\n\n/**\n * Calculates a reference point delta relative to a new position\n * of a certain element's bounds\n *\n * @param {Point} point\n * @param {Bounds} oldBounds\n * @param {Bounds} newBounds\n *\n * @return {Delta} delta\n */\nexport function getReferencePointDelta(referencePoint, oldBounds, newBounds) {\n\n  var newReferencePoint = getNewAttachPoint(referencePoint, oldBounds, newBounds);\n\n  return roundPoint(delta(newReferencePoint, referencePoint));\n}\n\n/**\n * Generates the nearest point (reference point) for a given point\n * onto given set of lines\n *\n * @param {Array<Point, Point>} lines\n * @param {Point} point\n *\n * @param {Point}\n */\nexport function getReferencePoint(point, lines) {\n\n  if (!lines.length) {\n    return;\n  }\n\n  var nearestLine = getNearestLine(point, lines);\n\n  return perpendicularFoot(point, nearestLine);\n}\n\n/**\n * Convert the given bounds to a lines array containing all edges\n *\n * @param {Bounds|Point} bounds\n *\n * @return Array<Point>\n */\nexport function asEdges(bounds) {\n  return [\n    [ // top\n      {\n        x: bounds.x,\n        y: bounds.y\n      },\n      {\n        x: bounds.x + (bounds.width || 0),\n        y: bounds.y\n      }\n    ],\n    [ // right\n      {\n        x: bounds.x + (bounds.width || 0),\n        y: bounds.y\n      },\n      {\n        x: bounds.x + (bounds.width || 0),\n        y: bounds.y + (bounds.height || 0)\n      }\n    ],\n    [ // bottom\n      {\n        x: bounds.x,\n        y: bounds.y + (bounds.height || 0)\n      },\n      {\n        x: bounds.x + (bounds.width || 0),\n        y: bounds.y + (bounds.height || 0)\n      }\n    ],\n    [ // left\n      {\n        x: bounds.x,\n        y: bounds.y\n      },\n      {\n        x: bounds.x,\n        y: bounds.y + (bounds.height || 0)\n      }\n    ]\n  ];\n}\n\n/**\n * Returns the nearest line for a given point by distance\n * @param {Point} point\n * @param Array<Point> lines\n *\n * @return Array<Point>\n */\nfunction getNearestLine(point, lines) {\n\n  var distances = lines.map(function(l) {\n    return {\n      line: l,\n      distance: getDistancePointLine(point, l)\n    };\n  });\n\n  var sorted = sortBy(distances, 'distance');\n\n  return sorted[0].line;\n}\n","import inherits from 'inherits';\n\nimport { forEach } from 'min-dash';\n\nimport CommandInterceptor from 'diagram-js/lib/command/CommandInterceptor';\n\n\n/**\n * postit-specific replace behavior.\n */\nexport default function ReplaceElementBehaviour(\n    postitReplace,\n    postitRules,\n    elementRegistry,\n    injector,\n    modeling,\n    selection\n) {\n  injector.invoke(CommandInterceptor, this);\n\n  this._postitReplace = postitReplace;\n  this._elementRegistry = elementRegistry;\n  this._selection = selection;\n\n  // replace elements on move\n  this.postExecuted([ 'elements.move' ], 500, function(event) {\n    var context = event.context,\n        target = context.newParent,\n        newHost = context.newHost,\n        elements = [];\n\n    forEach(context.closure.topLevel, function(topLevelElements) {\n      elements = elements.concat(topLevelElements);\n    });\n\n    // set target to host if attaching\n    if (elements.length === 1 && newHost) {\n      target = newHost;\n    }\n\n    var canReplace = postitRules.canReplace(elements, target);\n\n    if (canReplace) {\n      this.replaceElements(elements, canReplace.replacements, newHost);\n    }\n  }, this);\n\n  // update attachments on host replace\n  this.postExecute([ 'shape.replace' ], 1500, function(e) {\n    var context = e.context,\n        oldShape = context.oldShape,\n        newShape = context.newShape,\n        attachers = oldShape.attachers,\n        canReplace;\n\n    if (attachers && attachers.length) {\n      canReplace = postitRules.canReplace(attachers, newShape);\n\n      this.replaceElements(attachers, canReplace.replacements);\n    }\n\n  }, this);\n\n  // keep ID on shape replace\n  this.postExecuted([ 'shape.replace' ], 1500, function(e) {\n    var context = e.context,\n        oldShape = context.oldShape,\n        newShape = context.newShape;\n\n    modeling.unclaimId(oldShape.businessObject.id, oldShape.businessObject);\n    modeling.updateProperties(newShape, { id: oldShape.id });\n  });\n}\n\ninherits(ReplaceElementBehaviour, CommandInterceptor);\n\nReplaceElementBehaviour.prototype.replaceElements = function(elements, newElements) {\n  var elementRegistry = this._elementRegistry,\n      postitReplace = this._postitReplace,\n      selection = this._selection;\n\n  forEach(newElements, function(replacement) {\n    var newElement = {\n      type: replacement.newElementType\n    };\n\n    var oldElement = elementRegistry.get(replacement.oldElementId);\n\n    var idx = elements.indexOf(oldElement);\n\n    elements[idx] = postitReplace.replaceElement(oldElement, newElement, { select: false });\n  });\n\n  if (newElements) {\n    selection.select(elements);\n  }\n};\n\nReplaceElementBehaviour.$inject = [\n  'postitReplace',\n  'postitRules',\n  'elementRegistry',\n  'injector',\n  'modeling',\n  'selection'\n];\n","import inherits from 'inherits';\n\nimport CommandInterceptor from 'diagram-js/lib/command/CommandInterceptor';\n\nimport { isLabel } from '../../../util/LabelUtil';\n\n\n/**\n * Unclaims model IDs on element deletion.\n *\n * @param {Canvas} canvas\n * @param {Injector} injector\n * @param {Moddle} moddle\n * @param {Modeling} modeling\n */\nexport default function UnclaimIdBehavior(canvas, injector, moddle, modeling) {\n  injector.invoke(CommandInterceptor, this);\n\n  this.preExecute('shape.delete', function(event) {\n    var context = event.context,\n        shape = context.shape,\n        shapeBo = shape.businessObject;\n\n    if (isLabel(shape)) {\n      return;\n    }\n\n    modeling.unclaimId(shapeBo.id, shapeBo);\n  });\n\n  this.preExecute('canvas.updateRoot', function() {\n    var rootElement = canvas.getRootElement(),\n        rootElementBo = rootElement.businessObject;\n\n    moddle.ids.unclaim(rootElementBo.id);\n  });\n}\n\ninherits(UnclaimIdBehavior, CommandInterceptor);\n\nUnclaimIdBehavior.$inject = [ 'canvas', 'injector', 'moddle', 'modeling' ];","import inherits from 'inherits';\n\nimport {\n  assign\n} from 'min-dash';\n\nimport {\n  getBusinessObject,\n  is\n} from '../../../util/ModelUtil';\n\nimport CommandInterceptor from 'diagram-js/lib/command/CommandInterceptor';\n\n\nexport default function CreateBoardElementBehavior(eventBus) {\n\n  CommandInterceptor.call(this, eventBus);\n\n  // ensure properties were set in business object\n\n  this.execute('shape.create', function(context) {\n\n    var shape = context.context.shape;\n\n    if (is(shape, 'postit:Postit')) {\n      const businessObject = getBusinessObject(shape);\n      !businessObject.color && assign(businessObject, { color: shape.color });\n    }\n\n    if (is(shape, 'postit:Image')) {\n      const businessObject = getBusinessObject(shape);\n      !businessObject.source && assign(businessObject, { source: shape.source });\n    }\n  });\n}\n\ninherits(CreateBoardElementBehavior, CommandInterceptor);\n\nCreateBoardElementBehavior.$inject = [\n  'eventBus'\n];","import inherits from 'inherits';\n\nimport {\n  is,\n  getBusinessObject\n} from '../../../util/ModelUtil';\n\nimport CommandInterceptor from 'diagram-js/lib/command/CommandInterceptor';\n\n\nexport default function EmptyTextBoxBehavior(eventBus, modeling, directEditing) {\n\n  CommandInterceptor.call(this, eventBus);\n\n  // delete text box if it has no text\n  this.postExecute('element.updateLabel', function(context) {\n\n    var element = context.element,\n        newLabel = context.newLabel;\n\n    if (is(element, 'postit:TextBox') && isEmpty(newLabel)) {\n      modeling.removeElements([ element ]);\n    }\n  }, true);\n\n  eventBus.on('directEditing.cancel', 1001, function(event) {\n    var active = event.active,\n        element = active.element;\n\n    if (is(element, 'postit:TextBox') && isEmpty(getBusinessObject(element).name)) {\n      directEditing._active = false;\n      modeling.removeElements([ element ]);\n    }\n  });\n}\n\ninherits(EmptyTextBoxBehavior, CommandInterceptor);\n\nEmptyTextBoxBehavior.$inject = [\n  'eventBus',\n  'modeling',\n  'directEditing'\n];\n\n\n// helpers //////////\n\nfunction isEmpty(label) {\n  return !label || label === '';\n}","import AdaptiveLabelPositioningBehavior from './AdaptiveLabelPositioningBehavior';\nimport AppendBehavior from './AppendBehavior';\nimport FixHoverBehavior from './FixHoverBehavior';\nimport ImportDockingFix from './ImportDockingFix';\nimport LabelBehavior from './LabelBehavior';\nimport ReplaceElementBehaviour from './ReplaceElementBehaviour';\nimport UnclaimIdBehavior from './UnclaimIdBehavior';\nimport CreateBoardElementBehavior from './CreateBoardElementBehavior';\nimport EmptyTextBoxBehavior from './EmptyTextBoxBehavior';\n\nexport default {\n  __init__: [\n    'adaptiveLabelPositioningBehavior',\n    'appendBehavior',\n    'fixHoverBehavior',\n    'importDockingFix',\n    'labelBehavior',\n    'replaceElementBehaviour',\n    'unclaimIdBehavior',\n    'createBoardElementBehavior',\n    'emptyTextBoxBehavior'\n  ],\n  adaptiveLabelPositioningBehavior: [ 'type', AdaptiveLabelPositioningBehavior ],\n  appendBehavior: [ 'type', AppendBehavior ],\n  fixHoverBehavior: [ 'type', FixHoverBehavior ],\n  importDockingFix: [ 'type', ImportDockingFix ],\n  labelBehavior: [ 'type', LabelBehavior ],\n  replaceElementBehaviour: [ 'type', ReplaceElementBehaviour ],\n  unclaimIdBehavior: [ 'type', UnclaimIdBehavior ],\n  createBoardElementBehavior: [ 'type', CreateBoardElementBehavior ],\n  emptyTextBoxBehavior: [ 'type', EmptyTextBoxBehavior ]\n};\n","import inherits from 'inherits';\n\nimport CommandInterceptor from '../../command/CommandInterceptor';\n\n/**\n * A basic provider that may be extended to implement modeling rules.\n *\n * Extensions should implement the init method to actually add their custom\n * modeling checks. Checks may be added via the #addRule(action, fn) method.\n *\n * @param {EventBus} eventBus\n */\nexport default function RuleProvider(eventBus) {\n  CommandInterceptor.call(this, eventBus);\n\n  this.init();\n}\n\nRuleProvider.$inject = [ 'eventBus' ];\n\ninherits(RuleProvider, CommandInterceptor);\n\n\n/**\n * Adds a modeling rule for the given action, implemented through\n * a callback function.\n *\n * The function will receive the modeling specific action context\n * to perform its check. It must return `false` to disallow the\n * action from happening or `true` to allow the action.\n *\n * A rule provider may pass over the evaluation to lower priority\n * rules by returning return nothing (or <code>undefined</code>).\n *\n * @example\n *\n * ResizableRules.prototype.init = function() {\n *\n *   \\/**\n *    * Return `true`, `false` or nothing to denote\n *    * _allowed_, _not allowed_ and _continue evaluating_.\n *    *\\/\n *   this.addRule('shape.resize', function(context) {\n *\n *     var shape = context.shape;\n *\n *     if (!context.newBounds) {\n *       // check general resizability\n *       if (!shape.resizable) {\n *         return false;\n *       }\n *\n *       // not returning anything (read: undefined)\n *       // will continue the evaluation of other rules\n *       // (with lower priority)\n *       return;\n *     } else {\n *       // element must have minimum size of 10*10 points\n *       return context.newBounds.width > 10 && context.newBounds.height > 10;\n *     }\n *   });\n * };\n *\n * @param {string|Array<string>} actions the identifier for the modeling action to check\n * @param {number} [priority] the priority at which this rule is being applied\n * @param {Function} fn the callback function that performs the actual check\n */\nRuleProvider.prototype.addRule = function(actions, priority, fn) {\n\n  var self = this;\n\n  if (typeof actions === 'string') {\n    actions = [ actions ];\n  }\n\n  actions.forEach(function(action) {\n\n    self.canExecute(action, priority, function(context, action, event) {\n      return fn(context);\n    }, true);\n  });\n};\n\n/**\n * Implement this method to add new rules during provider initialization.\n */\nRuleProvider.prototype.init = function() {};","import {\n  every\n} from 'min-dash';\n\nimport inherits from 'inherits';\n\nimport {\n  is\n} from '../../util/ModelUtil';\n\nimport {\n  isLabel\n} from '../../util/LabelUtil';\n\nimport RuleProvider from 'diagram-js/lib/features/rules/RuleProvider';\nimport { isAny } from '../modeling/util/ModelingUtil';\n\n\n/**\n * Postit specific modeling rule\n */\nexport default function PostitRules(eventBus) {\n  RuleProvider.call(this, eventBus);\n}\n\ninherits(PostitRules, RuleProvider);\n\nPostitRules.$inject = [ 'eventBus' ];\n\nPostitRules.prototype.init = function() {\n\n  this.addRule('shape.resize', function(context) {\n\n    var shape = context.shape,\n        newBounds = context.newBounds;\n\n    return canResize(shape, newBounds);\n  });\n\n  this.addRule('elements.create', function(context) {\n    var elements = context.elements,\n        position = context.position,\n        target = context.target;\n\n    return every(elements, function(element) {\n      if (element.host) {\n        return canAttach(element, element.host, null, position);\n      }\n\n      return canCreate(element, target, null, position);\n    });\n  });\n\n  this.addRule('elements.move', function(context) {\n\n    var target = context.target,\n        shapes = context.shapes,\n        position = context.position;\n\n    return canAttach(shapes, target, null, position) ||\n           canMove(shapes, target, position);\n  });\n\n  this.addRule('shape.create', function(context) {\n    return canCreate(\n      context.shape,\n      context.target,\n      context.source,\n      context.position\n    );\n  });\n\n  this.addRule('shape.attach', function(context) {\n\n    return canAttach(\n      context.shape,\n      context.target,\n      null,\n      context.position\n    );\n  });\n\n  this.addRule('element.copy', function(context) {\n    var element = context.element,\n        elements = context.elements;\n\n    return canCopy(elements, element);\n  });\n};\n\nPostitRules.prototype.canMove = canMove;\n\nPostitRules.prototype.canAttach = canAttach;\n\nPostitRules.prototype.canDrop = canDrop;\n\nPostitRules.prototype.canCreate = canCreate;\n\nPostitRules.prototype.canReplace = canReplace;\n\nPostitRules.prototype.canResize = canResize;\n\nPostitRules.prototype.canCopy = canCopy;\n\n/**\n * Utility functions for rule checking\n */\n\nfunction isSame(a, b) {\n  return a === b;\n}\n\nfunction getParents(element) {\n\n  var parents = [];\n\n  while (element) {\n    element = element.parent;\n\n    if (element) {\n      parents.push(element);\n    }\n  }\n\n  return parents;\n}\n\nfunction isParent(possibleParent, element) {\n  var allParents = getParents(element);\n  return allParents.indexOf(possibleParent) !== -1;\n}\n\nfunction isGroup(element) {\n  return is(element, 'postit:Group') && !element.labelTarget;\n}\n\n/**\n * Can an element be dropped into the target element\n *\n * @return {Boolean}\n */\nfunction canDrop(element, target) {\n\n  // can move labels\n  if (isLabel(element) || isGroup(element)) {\n    return true;\n  }\n\n  // drop board elements onto boards\n  if (is(element, 'postit:BoardElement') && is(target, 'postit:PostitBoard')) {\n    return true;\n  }\n\n  return false;\n}\n\nfunction canReplace(elements, target) {\n\n  if (!target) {\n    return false;\n  }\n\n  return true;\n}\n\n\nfunction canAttach(elements, target) {\n\n  if (!Array.isArray(elements)) {\n    elements = [ elements ];\n  }\n\n  // only (re-)attach one element at a time\n  if (elements.length !== 1) {\n    return false;\n  }\n\n  var element = elements[0];\n\n  // do not attach labels\n  if (isLabel(element)) {\n    return false;\n  }\n\n  if (is(target, 'postit:BoardElement')) {\n    return false;\n  }\n\n  return 'attach';\n}\n\n\nfunction canMove(elements, target) {\n\n  // allow default move check to start move operation\n  if (!target) {\n    return true;\n  }\n\n  return elements.every(function(element) {\n    return canDrop(element, target);\n  });\n}\n\nfunction canCreate(shape, target, source, position) {\n\n  if (!target) {\n    return false;\n  }\n\n  if (isLabel(shape) || isGroup(shape)) {\n    return true;\n  }\n\n  if (isSame(source, target)) {\n    return false;\n  }\n\n  // ensure we do not drop the element\n  // into source\n  if (source && isParent(source, target)) {\n    return false;\n  }\n\n  return canDrop(shape, target, position);\n}\n\nfunction canResize(shape, newBounds) {\n\n  if (isAny(shape, [ 'postit:Postit', 'postit:TextBox' ])) {\n    return !newBounds || (newBounds.width >= 50 && newBounds.height >= 50);\n  }\n\n  if (is(shape, 'postit:Group')) {\n    return true;\n  }\n\n  if (is(shape, 'postit:Image')) {\n    return true;\n  }\n\n  return false;\n}\n\nfunction canCopy(elements, element) {\n  return true;\n}\n","import RulesModule from 'diagram-js/lib/features/rules';\n\nimport PostitRules from './PostitRules';\n\nexport default {\n  __depends__: [\n    RulesModule\n  ],\n  __init__: [ 'postitRules' ],\n  postitRules: [ 'type', PostitRules ]\n};\n","import { getDi } from '../../draw/PostitRendererUtil';\nimport { getBusinessObject } from '../../util/ModelUtil';\n\nimport {\n  filter,\n  map\n} from 'min-dash';\n\nimport { selfAndAllChildren } from 'diagram-js/lib/util/Elements';\n\n\nvar HIGH_PRIORITY = 2000;\n\nexport default function PostitDiOrdering(eventBus, canvas) {\n\n  eventBus.on('saveXML.start', HIGH_PRIORITY, orderDi);\n\n  function orderDi() {\n    var root = canvas.getRootElement(),\n        rootDi = getBusinessObject(root).di,\n        elements,\n        diElements;\n\n    elements = selfAndAllChildren([ root ], false);\n\n    // only postitDi:Shape can be direct children of postitDi:Plane\n    elements = filter(elements, function(element) {\n      return element !== root && !element.labelTarget;\n    });\n\n    diElements = map(elements, getDi);\n\n    rootDi.set('planeElement', diElements);\n  }\n}\n\nPostitDiOrdering.$inject = [ 'eventBus', 'canvas' ];\n","import PostitDiOrdering from './PostitDiOrdering';\n\nexport default {\n  __init__: [\n    'postitDiOrdering'\n  ],\n  postitDiOrdering: [ 'type', PostitDiOrdering ]\n};","import inherits from 'inherits';\n\nimport CommandInterceptor from '../../command/CommandInterceptor';\n\n\n/**\n * An abstract provider that allows modelers to implement a custom\n * ordering of diagram elements on the canvas.\n *\n * It makes sure that the order is always preserved during element\n * creation and move operations.\n *\n * In order to use this behavior, inherit from it and override\n * the method {@link OrderingProvider#getOrdering}.\n *\n * @example\n *\n * ```javascript\n * function CustomOrderingProvider(eventBus) {\n *   OrderingProvider.call(this, eventBus);\n *\n *   this.getOrdering = function(element, newParent) {\n *     // always insert elements at the front\n *     // when moving\n *     return {\n *       index: 0,\n *       parent: newParent\n *     };\n *   };\n * }\n * ```\n *\n * @param {EventBus} eventBus\n */\nexport default function OrderingProvider(eventBus) {\n\n  CommandInterceptor.call(this, eventBus);\n\n\n  var self = this;\n\n  this.preExecute([ 'shape.create', 'connection.create' ], function(event) {\n\n    var context = event.context,\n        element = context.shape || context.connection,\n        parent = context.parent;\n\n    var ordering = self.getOrdering(element, parent);\n\n    if (ordering) {\n\n      if (ordering.parent !== undefined) {\n        context.parent = ordering.parent;\n      }\n\n      context.parentIndex = ordering.index;\n    }\n  });\n\n  this.preExecute([ 'shape.move', 'connection.move' ], function(event) {\n\n    var context = event.context,\n        element = context.shape || context.connection,\n        parent = context.newParent || element.parent;\n\n    var ordering = self.getOrdering(element, parent);\n\n    if (ordering) {\n\n      if (ordering.parent !== undefined) {\n        context.newParent = ordering.parent;\n      }\n\n      context.newParentIndex = ordering.index;\n    }\n  });\n}\n\n/**\n * Return a custom ordering of the element, both in terms\n * of parent element and index in the new parent.\n *\n * Implementors of this method must return an object with\n * `parent` _and_ `index` in it.\n *\n * @param {djs.model.Base} element\n * @param {djs.model.Shape} newParent\n *\n * @return {Object} ordering descriptor\n */\nOrderingProvider.prototype.getOrdering = function(element, newParent) {\n  return null;\n};\n\ninherits(OrderingProvider, CommandInterceptor);","import inherits from 'inherits';\n\nimport OrderingProvider from 'diagram-js/lib/features/ordering/OrderingProvider';\n\nimport {\n  isAny\n} from '../modeling/util/ModelingUtil';\n\nimport {\n  findIndex,\n  find\n} from 'min-dash';\n\n\n/**\n * a simple ordering provider that makes sure:\n *\n * (0) labels and groups are rendered always on top\n * (1) elements are ordered by a {level} property\n */\nexport default function PostitOrderingProvider(eventBus, canvas, translate) {\n\n  OrderingProvider.call(this, eventBus);\n\n  var orders = [\n    { type: 'postit:BoardElement', order: { level: 5 } }\n  ];\n\n  function computeOrder(element) {\n    if (element.labelTarget) {\n      return { level: 10 };\n    }\n\n    var entry = find(orders, function(o) {\n      return isAny(element, [ o.type ]);\n    });\n\n    return entry && entry.order || { level: 1 };\n  }\n\n  function getOrder(element) {\n\n    var order = element.order;\n\n    if (!order) {\n      element.order = order = computeOrder(element);\n    }\n\n    return order;\n  }\n\n  function findActualParent(element, newParent, containers) {\n\n    var actualParent = newParent;\n\n    while (actualParent) {\n\n      if (isAny(actualParent, containers)) {\n        break;\n      }\n\n      actualParent = actualParent.parent;\n    }\n\n    if (!actualParent) {\n      throw new Error(translate('no parent for {element} in {parent}', {\n        element: element.id,\n        parent: newParent.id\n      }));\n    }\n\n    return actualParent;\n  }\n\n  this.getOrdering = function(element, newParent) {\n\n    // render labels always on top\n    if (element.labelTarget) {\n      return {\n        parent: canvas.getRootElement(),\n        index: -1\n      };\n    }\n\n    var elementOrder = getOrder(element);\n\n\n    if (elementOrder.containers) {\n      newParent = findActualParent(element, newParent, elementOrder.containers);\n    }\n\n\n    var currentIndex = newParent.children.indexOf(element);\n\n    var insertIndex = findIndex(newParent.children, function(child) {\n\n      // do not compare with labels, they are created\n      // in the wrong order (right after elements) during import and\n      // mess up the positioning.\n      if (!element.labelTarget && child.labelTarget) {\n        return false;\n      }\n\n      return elementOrder.level < getOrder(child).level;\n    });\n\n\n    // if the element is already in the child list at\n    // a smaller index, we need to adjust the insert index.\n    // this takes into account that the element is being removed\n    // before being re-inserted\n    if (insertIndex !== -1) {\n      if (currentIndex !== -1 && currentIndex < insertIndex) {\n        insertIndex -= 1;\n      }\n    }\n\n    return {\n      index: insertIndex,\n      parent: newParent\n    };\n  };\n}\n\nPostitOrderingProvider.$inject = [ 'eventBus', 'canvas', 'translate' ];\n\ninherits(PostitOrderingProvider, OrderingProvider);","import translate from 'diagram-js/lib/i18n/translate';\n\nimport PostitOrderingProvider from './PostitOrderingProvider';\n\nexport default {\n  __depends__: [\n    translate\n  ],\n  __init__: [ 'postitOrderingProvider' ],\n  postitOrderingProvider: [ 'type', PostitOrderingProvider ]\n};","import {\n  uniqueBy,\n  isArray\n} from 'min-dash';\n\n\n/**\n * A service that offers un- and redoable execution of commands.\n *\n * The command stack is responsible for executing modeling actions\n * in a un- and redoable manner. To do this it delegates the actual\n * command execution to {@link CommandHandler}s.\n *\n * Command handlers provide {@link CommandHandler#execute(ctx)} and\n * {@link CommandHandler#revert(ctx)} methods to un- and redo a command\n * identified by a command context.\n *\n *\n * ## Life-Cycle events\n *\n * In the process the command stack fires a number of life-cycle events\n * that other components to participate in the command execution.\n *\n *    * preExecute\n *    * preExecuted\n *    * execute\n *    * executed\n *    * postExecute\n *    * postExecuted\n *    * revert\n *    * reverted\n *\n * A special event is used for validating, whether a command can be\n * performed prior to its execution.\n *\n *    * canExecute\n *\n * Each of the events is fired as `commandStack.{eventName}` and\n * `commandStack.{commandName}.{eventName}`, respectively. This gives\n * components fine grained control on where to hook into.\n *\n * The event object fired transports `command`, the name of the\n * command and `context`, the command context.\n *\n *\n * ## Creating Command Handlers\n *\n * Command handlers should provide the {@link CommandHandler#execute(ctx)}\n * and {@link CommandHandler#revert(ctx)} methods to implement\n * redoing and undoing of a command.\n *\n * A command handler _must_ ensure undo is performed properly in order\n * not to break the undo chain. It must also return the shapes that\n * got changed during the `execute` and `revert` operations.\n *\n * Command handlers may execute other modeling operations (and thus\n * commands) in their `preExecute` and `postExecute` phases. The command\n * stack will properly group all commands together into a logical unit\n * that may be re- and undone atomically.\n *\n * Command handlers must not execute other commands from within their\n * core implementation (`execute`, `revert`).\n *\n *\n * ## Change Tracking\n *\n * During the execution of the CommandStack it will keep track of all\n * elements that have been touched during the command's execution.\n *\n * At the end of the CommandStack execution it will notify interested\n * components via an 'elements.changed' event with all the dirty\n * elements.\n *\n * The event can be picked up by components that are interested in the fact\n * that elements have been changed. One use case for this is updating\n * their graphical representation after moving / resizing or deletion.\n *\n * @see CommandHandler\n *\n * @param {EventBus} eventBus\n * @param {Injector} injector\n */\nexport default function CommandStack(eventBus, injector) {\n\n  /**\n   * A map of all registered command handlers.\n   *\n   * @type {Object}\n   */\n  this._handlerMap = {};\n\n  /**\n   * A stack containing all re/undoable actions on the diagram\n   *\n   * @type {Array<Object>}\n   */\n  this._stack = [];\n\n  /**\n   * The current index on the stack\n   *\n   * @type {number}\n   */\n  this._stackIdx = -1;\n\n  /**\n   * Current active commandStack execution\n   *\n   * @type {Object}\n   * @property {Object[]} actions\n   * @property {Object[]} dirty\n   * @property { 'undo' | 'redo' | 'clear' | 'execute' | null } trigger the cause of the current excecution\n   */\n  this._currentExecution = {\n    actions: [],\n    dirty: [],\n    trigger: null\n  };\n\n\n  this._injector = injector;\n  this._eventBus = eventBus;\n\n  this._uid = 1;\n\n  eventBus.on([\n    'diagram.destroy',\n    'diagram.clear'\n  ], function() {\n    this.clear(false);\n  }, this);\n}\n\nCommandStack.$inject = [ 'eventBus', 'injector' ];\n\n\n/**\n * Execute a command\n *\n * @param {string} command the command to execute\n * @param {Object} context the environment to execute the command in\n */\nCommandStack.prototype.execute = function(command, context) {\n  if (!command) {\n    throw new Error('command required');\n  }\n\n  this._currentExecution.trigger = 'execute';\n\n  var action = { command: command, context: context };\n\n  this._pushAction(action);\n  this._internalExecute(action);\n  this._popAction(action);\n};\n\n\n/**\n * Ask whether a given command can be executed.\n *\n * Implementors may hook into the mechanism on two ways:\n *\n *   * in event listeners:\n *\n *     Users may prevent the execution via an event listener.\n *     It must prevent the default action for `commandStack.(<command>.)canExecute` events.\n *\n *   * in command handlers:\n *\n *     If the method {@link CommandHandler#canExecute} is implemented in a handler\n *     it will be called to figure out whether the execution is allowed.\n *\n * @param  {string} command the command to execute\n * @param  {Object} context the environment to execute the command in\n *\n * @return {boolean} true if the command can be executed\n */\nCommandStack.prototype.canExecute = function(command, context) {\n\n  var action = { command: command, context: context };\n\n  var handler = this._getHandler(command);\n\n  var result = this._fire(command, 'canExecute', action);\n\n  // handler#canExecute will only be called if no listener\n  // decided on a result already\n  if (result === undefined) {\n    if (!handler) {\n      return false;\n    }\n\n    if (handler.canExecute) {\n      result = handler.canExecute(context);\n    }\n  }\n\n  return result;\n};\n\n\n/**\n * Clear the command stack, erasing all undo / redo history\n */\nCommandStack.prototype.clear = function(emit) {\n  this._stack.length = 0;\n  this._stackIdx = -1;\n\n  if (emit !== false) {\n    this._fire('changed', { trigger: 'clear' });\n  }\n};\n\n\n/**\n * Undo last command(s)\n */\nCommandStack.prototype.undo = function() {\n  var action = this._getUndoAction(),\n      next;\n\n  if (action) {\n    this._currentExecution.trigger = 'undo';\n\n    this._pushAction(action);\n\n    while (action) {\n      this._internalUndo(action);\n      next = this._getUndoAction();\n\n      if (!next || next.id !== action.id) {\n        break;\n      }\n\n      action = next;\n    }\n\n    this._popAction();\n  }\n};\n\n\n/**\n * Redo last command(s)\n */\nCommandStack.prototype.redo = function() {\n  var action = this._getRedoAction(),\n      next;\n\n  if (action) {\n    this._currentExecution.trigger = 'redo';\n\n    this._pushAction(action);\n\n    while (action) {\n      this._internalExecute(action, true);\n      next = this._getRedoAction();\n\n      if (!next || next.id !== action.id) {\n        break;\n      }\n\n      action = next;\n    }\n\n    this._popAction();\n  }\n};\n\n\n/**\n * Register a handler instance with the command stack\n *\n * @param {string} command\n * @param {CommandHandler} handler\n */\nCommandStack.prototype.register = function(command, handler) {\n  this._setHandler(command, handler);\n};\n\n\n/**\n * Register a handler type with the command stack\n * by instantiating it and injecting its dependencies.\n *\n * @param {string} command\n * @param {Function} a constructor for a {@link CommandHandler}\n */\nCommandStack.prototype.registerHandler = function(command, handlerCls) {\n\n  if (!command || !handlerCls) {\n    throw new Error('command and handlerCls must be defined');\n  }\n\n  var handler = this._injector.instantiate(handlerCls);\n  this.register(command, handler);\n};\n\nCommandStack.prototype.canUndo = function() {\n  return !!this._getUndoAction();\n};\n\nCommandStack.prototype.canRedo = function() {\n  return !!this._getRedoAction();\n};\n\n// stack access  //////////////////////\n\nCommandStack.prototype._getRedoAction = function() {\n  return this._stack[this._stackIdx + 1];\n};\n\n\nCommandStack.prototype._getUndoAction = function() {\n  return this._stack[this._stackIdx];\n};\n\n\n// internal functionality //////////////////////\n\nCommandStack.prototype._internalUndo = function(action) {\n  var self = this;\n\n  var command = action.command,\n      context = action.context;\n\n  var handler = this._getHandler(command);\n\n  // guard against illegal nested command stack invocations\n  this._atomicDo(function() {\n    self._fire(command, 'revert', action);\n\n    if (handler.revert) {\n      self._markDirty(handler.revert(context));\n    }\n\n    self._revertedAction(action);\n\n    self._fire(command, 'reverted', action);\n  });\n};\n\n\nCommandStack.prototype._fire = function(command, qualifier, event) {\n  if (arguments.length < 3) {\n    event = qualifier;\n    qualifier = null;\n  }\n\n  var names = qualifier ? [ command + '.' + qualifier, qualifier ] : [ command ],\n      i, name, result;\n\n  event = this._eventBus.createEvent(event);\n\n  for (i = 0; (name = names[i]); i++) {\n    result = this._eventBus.fire('commandStack.' + name, event);\n\n    if (event.cancelBubble) {\n      break;\n    }\n  }\n\n  return result;\n};\n\nCommandStack.prototype._createId = function() {\n  return this._uid++;\n};\n\nCommandStack.prototype._atomicDo = function(fn) {\n\n  var execution = this._currentExecution;\n\n  execution.atomic = true;\n\n  try {\n    fn();\n  } finally {\n    execution.atomic = false;\n  }\n};\n\nCommandStack.prototype._internalExecute = function(action, redo) {\n  var self = this;\n\n  var command = action.command,\n      context = action.context;\n\n  var handler = this._getHandler(command);\n\n  if (!handler) {\n    throw new Error('no command handler registered for <' + command + '>');\n  }\n\n  this._pushAction(action);\n\n  if (!redo) {\n    this._fire(command, 'preExecute', action);\n\n    if (handler.preExecute) {\n      handler.preExecute(context);\n    }\n\n    this._fire(command, 'preExecuted', action);\n  }\n\n  // guard against illegal nested command stack invocations\n  this._atomicDo(function() {\n\n    self._fire(command, 'execute', action);\n\n    if (handler.execute) {\n\n      // actual execute + mark return results as dirty\n      self._markDirty(handler.execute(context));\n    }\n\n    // log to stack\n    self._executedAction(action, redo);\n\n    self._fire(command, 'executed', action);\n  });\n\n  if (!redo) {\n    this._fire(command, 'postExecute', action);\n\n    if (handler.postExecute) {\n      handler.postExecute(context);\n    }\n\n    this._fire(command, 'postExecuted', action);\n  }\n\n  this._popAction(action);\n};\n\n\nCommandStack.prototype._pushAction = function(action) {\n\n  var execution = this._currentExecution,\n      actions = execution.actions;\n\n  var baseAction = actions[0];\n\n  if (execution.atomic) {\n    throw new Error('illegal invocation in <execute> or <revert> phase (action: ' + action.command + ')');\n  }\n\n  if (!action.id) {\n    action.id = (baseAction && baseAction.id) || this._createId();\n  }\n\n  actions.push(action);\n};\n\n\nCommandStack.prototype._popAction = function() {\n  var execution = this._currentExecution,\n      trigger = execution.trigger,\n      actions = execution.actions,\n      dirty = execution.dirty;\n\n  actions.pop();\n\n  if (!actions.length) {\n    this._eventBus.fire('elements.changed', { elements: uniqueBy('id', dirty.reverse()) });\n\n    dirty.length = 0;\n\n    this._fire('changed', { trigger: trigger });\n\n    execution.trigger = null;\n  }\n};\n\n\nCommandStack.prototype._markDirty = function(elements) {\n  var execution = this._currentExecution;\n\n  if (!elements) {\n    return;\n  }\n\n  elements = isArray(elements) ? elements : [ elements ];\n\n  execution.dirty = execution.dirty.concat(elements);\n};\n\n\nCommandStack.prototype._executedAction = function(action, redo) {\n  var stackIdx = ++this._stackIdx;\n\n  if (!redo) {\n    this._stack.splice(stackIdx, this._stack.length, action);\n  }\n};\n\n\nCommandStack.prototype._revertedAction = function(action) {\n  this._stackIdx--;\n};\n\n\nCommandStack.prototype._getHandler = function(command) {\n  return this._handlerMap[command];\n};\n\nCommandStack.prototype._setHandler = function(command, handler) {\n  if (!command || !handler) {\n    throw new Error('command and handler required');\n  }\n\n  if (this._handlerMap[command]) {\n    throw new Error('overriding handler for command <' + command + '>');\n  }\n\n  this._handlerMap[command] = handler;\n};\n","import CommandStack from './CommandStack';\n\nexport default {\n  commandStack: [ 'type', CommandStack ]\n};\n","import {\n  isString,\n  assign,\n  forEach\n} from 'min-dash';\n\nimport {\n  domify,\n  attr as domAttr,\n  classes as domClasses,\n  remove as domRemove,\n  delegate as domDelegate\n} from 'min-dom';\n\nimport Ids from '../../util/IdGenerator';\n\n// document wide unique tooltip ids\nvar ids = new Ids('tt');\n\n\nfunction createRoot(parentNode) {\n  var root = domify(\n    '<div class=\"djs-tooltip-container\" style=\"position: absolute; width: 0; height: 0;\" />'\n  );\n\n  parentNode.insertBefore(root, parentNode.firstChild);\n\n  return root;\n}\n\n\nfunction setPosition(el, x, y) {\n  assign(el.style, { left: x + 'px', top: y + 'px' });\n}\n\nfunction setVisible(el, visible) {\n  el.style.display = visible === false ? 'none' : '';\n}\n\n\nvar tooltipClass = 'djs-tooltip',\n    tooltipSelector = '.' + tooltipClass;\n\n/**\n * A service that allows users to render tool tips on the diagram.\n *\n * The tooltip service will take care of updating the tooltip positioning\n * during navigation + zooming.\n *\n * @example\n *\n * ```javascript\n *\n * // add a pink badge on the top left of the shape\n * tooltips.add({\n *   position: {\n *     x: 50,\n *     y: 100\n *   },\n *   html: '<div style=\"width: 10px; background: fuchsia; color: white;\">0</div>'\n * });\n *\n * // or with optional life span\n * tooltips.add({\n *   position: {\n *     top: -5,\n *     left: -5\n *   },\n *   html: '<div style=\"width: 10px; background: fuchsia; color: white;\">0</div>',\n *   ttl: 2000\n * });\n *\n * // remove a tool tip\n * var id = tooltips.add(...);\n * tooltips.remove(id);\n * ```\n *\n * @param {EventBus} eventBus\n * @param {Canvas} canvas\n */\nexport default function Tooltips(eventBus, canvas) {\n\n  this._eventBus = eventBus;\n  this._canvas = canvas;\n\n  this._ids = ids;\n\n  this._tooltipDefaults = {\n    show: {\n      minZoom: 0.7,\n      maxZoom: 5.0\n    }\n  };\n\n  /**\n   * Mapping tooltipId -> tooltip\n   */\n  this._tooltips = {};\n\n  // root html element for all tooltips\n  this._tooltipRoot = createRoot(canvas.getContainer());\n\n\n  var self = this;\n\n  domDelegate.bind(this._tooltipRoot, tooltipSelector, 'mousedown', function(event) {\n    event.stopPropagation();\n  });\n\n  domDelegate.bind(this._tooltipRoot, tooltipSelector, 'mouseover', function(event) {\n    self.trigger('mouseover', event);\n  });\n\n  domDelegate.bind(this._tooltipRoot, tooltipSelector, 'mouseout', function(event) {\n    self.trigger('mouseout', event);\n  });\n\n  this._init();\n}\n\n\nTooltips.$inject = [ 'eventBus', 'canvas' ];\n\n\n/**\n * Adds a HTML tooltip to the diagram\n *\n * @param {Object}               tooltip   the tooltip configuration\n *\n * @param {string|DOMElement}    tooltip.html                 html element to use as an tooltip\n * @param {Object}               [tooltip.show]               show configuration\n * @param {number}               [tooltip.show.minZoom]       minimal zoom level to show the tooltip\n * @param {number}               [tooltip.show.maxZoom]       maximum zoom level to show the tooltip\n * @param {Object}               tooltip.position             where to attach the tooltip\n * @param {number}               [tooltip.position.left]      relative to element bbox left attachment\n * @param {number}               [tooltip.position.top]       relative to element bbox top attachment\n * @param {number}               [tooltip.position.bottom]    relative to element bbox bottom attachment\n * @param {number}               [tooltip.position.right]     relative to element bbox right attachment\n * @param {number}               [tooltip.timeout=-1]\n *\n * @return {string}              id that may be used to reference the tooltip for update or removal\n */\nTooltips.prototype.add = function(tooltip) {\n\n  if (!tooltip.position) {\n    throw new Error('must specifiy tooltip position');\n  }\n\n  if (!tooltip.html) {\n    throw new Error('must specifiy tooltip html');\n  }\n\n  var id = this._ids.next();\n\n  tooltip = assign({}, this._tooltipDefaults, tooltip, {\n    id: id\n  });\n\n  this._addTooltip(tooltip);\n\n  if (tooltip.timeout) {\n    this.setTimeout(tooltip);\n  }\n\n  return id;\n};\n\nTooltips.prototype.trigger = function(action, event) {\n\n  var node = event.delegateTarget || event.target;\n\n  var tooltip = this.get(domAttr(node, 'data-tooltip-id'));\n\n  if (!tooltip) {\n    return;\n  }\n\n  if (action === 'mouseover' && tooltip.timeout) {\n    this.clearTimeout(tooltip);\n  }\n\n  if (action === 'mouseout' && tooltip.timeout) {\n\n    // cut timeout after mouse out\n    tooltip.timeout = 1000;\n\n    this.setTimeout(tooltip);\n  }\n};\n\n/**\n * Get a tooltip with the given id\n *\n * @param {string} id\n */\nTooltips.prototype.get = function(id) {\n\n  if (typeof id !== 'string') {\n    id = id.id;\n  }\n\n  return this._tooltips[id];\n};\n\nTooltips.prototype.clearTimeout = function(tooltip) {\n\n  tooltip = this.get(tooltip);\n\n  if (!tooltip) {\n    return;\n  }\n\n  var removeTimer = tooltip.removeTimer;\n\n  if (removeTimer) {\n    clearTimeout(removeTimer);\n    tooltip.removeTimer = null;\n  }\n};\n\nTooltips.prototype.setTimeout = function(tooltip) {\n\n  tooltip = this.get(tooltip);\n\n  if (!tooltip) {\n    return;\n  }\n\n  this.clearTimeout(tooltip);\n\n  var self = this;\n\n  tooltip.removeTimer = setTimeout(function() {\n    self.remove(tooltip);\n  }, tooltip.timeout);\n};\n\n/**\n * Remove an tooltip with the given id\n *\n * @param {string} id\n */\nTooltips.prototype.remove = function(id) {\n\n  var tooltip = this.get(id);\n\n  if (tooltip) {\n    domRemove(tooltip.html);\n    domRemove(tooltip.htmlContainer);\n\n    delete tooltip.htmlContainer;\n\n    delete this._tooltips[tooltip.id];\n  }\n};\n\n\nTooltips.prototype.show = function() {\n  setVisible(this._tooltipRoot);\n};\n\n\nTooltips.prototype.hide = function() {\n  setVisible(this._tooltipRoot, false);\n};\n\n\nTooltips.prototype._updateRoot = function(viewbox) {\n  var a = viewbox.scale || 1;\n  var d = viewbox.scale || 1;\n\n  var matrix = 'matrix(' + a + ',0,0,' + d + ',' + (-1 * viewbox.x * a) + ',' + (-1 * viewbox.y * d) + ')';\n\n  this._tooltipRoot.style.transform = matrix;\n  this._tooltipRoot.style['-ms-transform'] = matrix;\n};\n\n\nTooltips.prototype._addTooltip = function(tooltip) {\n\n  var id = tooltip.id,\n      html = tooltip.html,\n      htmlContainer,\n      tooltipRoot = this._tooltipRoot;\n\n  // unwrap jquery (for those who need it)\n  if (html.get && html.constructor.prototype.jquery) {\n    html = html.get(0);\n  }\n\n  // create proper html elements from\n  // tooltip HTML strings\n  if (isString(html)) {\n    html = domify(html);\n  }\n\n  htmlContainer = domify('<div data-tooltip-id=\"' + id + '\" class=\"' + tooltipClass + '\" style=\"position: absolute\">');\n\n  htmlContainer.appendChild(html);\n\n  if (tooltip.type) {\n    domClasses(htmlContainer).add('djs-tooltip-' + tooltip.type);\n  }\n\n  if (tooltip.className) {\n    domClasses(htmlContainer).add(tooltip.className);\n  }\n\n  tooltip.htmlContainer = htmlContainer;\n\n  tooltipRoot.appendChild(htmlContainer);\n\n  this._tooltips[id] = tooltip;\n\n  this._updateTooltip(tooltip);\n};\n\n\nTooltips.prototype._updateTooltip = function(tooltip) {\n\n  var position = tooltip.position,\n      htmlContainer = tooltip.htmlContainer;\n\n  // update overlay html based on tooltip x, y\n\n  setPosition(htmlContainer, position.x, position.y);\n};\n\n\nTooltips.prototype._updateTooltipVisibilty = function(viewbox) {\n\n  forEach(this._tooltips, function(tooltip) {\n    var show = tooltip.show,\n        htmlContainer = tooltip.htmlContainer,\n        visible = true;\n\n    if (show) {\n      if (show.minZoom > viewbox.scale ||\n          show.maxZoom < viewbox.scale) {\n        visible = false;\n      }\n\n      setVisible(htmlContainer, visible);\n    }\n  });\n};\n\nTooltips.prototype._init = function() {\n\n  var self = this;\n\n  // scroll/zoom integration\n\n  function updateViewbox(viewbox) {\n    self._updateRoot(viewbox);\n    self._updateTooltipVisibilty(viewbox);\n\n    self.show();\n  }\n\n  this._eventBus.on('canvas.viewbox.changing', function(event) {\n    self.hide();\n  });\n\n  this._eventBus.on('canvas.viewbox.changed', function(event) {\n    updateViewbox(event.viewbox);\n  });\n};\n","import Tooltips from './Tooltips';\n\nexport default {\n  __init__: [ 'tooltips' ],\n  tooltips: [ 'type', Tooltips ]\n};","/**\n * Remove from the beginning of a collection until it is empty.\n *\n * This is a null-safe operation that ensures elements\n * are being removed from the given collection until the\n * collection is empty.\n *\n * The implementation deals with the fact that a remove operation\n * may touch, i.e. remove multiple elements in the collection\n * at a time.\n *\n * @param {Array<Object>} [collection]\n * @param {Function} removeFn\n *\n * @return {Array<Object>} the cleared collection\n */\nexport function saveClear(collection, removeFn) {\n\n  if (typeof removeFn !== 'function') {\n    throw new Error('removeFn iterator must be a function');\n  }\n\n  if (!collection) {\n    return;\n  }\n\n  var e;\n\n  while ((e = collection[0])) {\n    removeFn(e);\n  }\n\n  return collection;\n}\n","import {\n  forEach,\n  filter\n} from 'min-dash';\n\nimport inherits from 'inherits';\n\nvar LOW_PRIORITY = 250,\n    HIGH_PRIORITY = 1400;\n\nimport {\n  add as collectionAdd,\n  indexOf as collectionIdx\n} from '../../util/Collections';\n\nimport { saveClear } from '../../util/Removal';\n\nimport CommandInterceptor from '../../command/CommandInterceptor';\n\n\n/**\n * A handler that makes sure labels are properly moved with\n * their label targets.\n *\n * @param {didi.Injector} injector\n * @param {EventBus} eventBus\n * @param {Modeling} modeling\n */\nexport default function LabelSupport(injector, eventBus, modeling) {\n\n  CommandInterceptor.call(this, eventBus);\n\n  var movePreview = injector.get('movePreview', false);\n\n  // remove labels from the collection that are being\n  // moved with other elements anyway\n  eventBus.on('shape.move.start', HIGH_PRIORITY, function(e) {\n\n    var context = e.context,\n        shapes = context.shapes,\n        validatedShapes = context.validatedShapes;\n\n    context.shapes = removeLabels(shapes);\n    context.validatedShapes = removeLabels(validatedShapes);\n  });\n\n  // add labels to visual's group\n  movePreview && eventBus.on('shape.move.start', LOW_PRIORITY, function(e) {\n\n    var context = e.context,\n        shapes = context.shapes;\n\n    var labels = [];\n\n    forEach(shapes, function(element) {\n\n      forEach(element.labels, function(label) {\n\n        if (!label.hidden && context.shapes.indexOf(label) === -1) {\n          labels.push(label);\n        }\n\n        if (element.labelTarget) {\n          labels.push(element);\n        }\n      });\n    });\n\n    forEach(labels, function(label) {\n      movePreview.makeDraggable(context, label, true);\n    });\n\n  });\n\n  // add all labels to move closure\n  this.preExecuted('elements.move', HIGH_PRIORITY, function(e) {\n    var context = e.context,\n        closure = context.closure,\n        enclosedElements = closure.enclosedElements;\n\n    var enclosedLabels = [];\n\n    // find labels that are not part of\n    // move closure yet and add them\n    forEach(enclosedElements, function(element) {\n      forEach(element.labels, function(label) {\n\n        if (!enclosedElements[label.id]) {\n          enclosedLabels.push(label);\n        }\n      });\n    });\n\n    closure.addAll(enclosedLabels);\n  });\n\n\n  this.preExecute([\n    'connection.delete',\n    'shape.delete'\n  ], function(e) {\n\n    var context = e.context,\n        element = context.connection || context.shape;\n\n    saveClear(element.labels, function(label) {\n      modeling.removeShape(label, { nested: true });\n    });\n  });\n\n\n  this.execute('shape.delete', function(e) {\n\n    var context = e.context,\n        shape = context.shape,\n        labelTarget = shape.labelTarget;\n\n    // unset labelTarget\n    if (labelTarget) {\n      context.labelTargetIndex = collectionIdx(labelTarget.labels, shape);\n      context.labelTarget = labelTarget;\n\n      shape.labelTarget = null;\n    }\n  });\n\n  this.revert('shape.delete', function(e) {\n\n    var context = e.context,\n        shape = context.shape,\n        labelTarget = context.labelTarget,\n        labelTargetIndex = context.labelTargetIndex;\n\n    // restore labelTarget\n    if (labelTarget) {\n      collectionAdd(labelTarget.labels, shape, labelTargetIndex);\n\n      shape.labelTarget = labelTarget;\n    }\n  });\n\n}\n\ninherits(LabelSupport, CommandInterceptor);\n\nLabelSupport.$inject = [\n  'injector',\n  'eventBus',\n  'modeling'\n];\n\n\n/**\n * Return a filtered list of elements that do not\n * contain attached elements with hosts being part\n * of the selection.\n *\n * @param  {Array<djs.model.Base>} elements\n *\n * @return {Array<djs.model.Base>} filtered\n */\nfunction removeLabels(elements) {\n\n  return filter(elements, function(element) {\n\n    // filter out labels that are move together\n    // with their label targets\n    return elements.indexOf(element.labelTarget) === -1;\n  });\n}\n","import LabelSupport from './LabelSupport';\n\nexport default {\n  __init__: [ 'labelSupport'],\n  labelSupport: [ 'type', LabelSupport ]\n};\n","import {\n  flatten,\n  filter,\n  forEach,\n  groupBy,\n  map,\n  unionBy\n} from 'min-dash';\n\nimport { saveClear } from '../../util/Removal';\n\nimport { getNewAttachShapeDelta } from '../../util/AttachUtil';\n\nimport inherits from 'inherits';\n\nimport CommandInterceptor from '../../command/CommandInterceptor';\n\nvar LOW_PRIORITY = 251,\n    HIGH_PRIORITY = 1401;\n\nvar MARKER_ATTACH = 'attach-ok';\n\n\n/**\n * Adds the notion of attached elements to the modeler.\n *\n * Optionally depends on `diagram-js/lib/features/move` to render\n * the attached elements during move preview.\n *\n * Optionally depends on `diagram-js/lib/features/label-support`\n * to render attached labels during move preview.\n *\n * @param {didi.Injector} injector\n * @param {EventBus} eventBus\n * @param {Canvas} canvas\n * @param {Rules} rules\n * @param {Modeling} modeling\n */\nexport default function AttachSupport(injector, eventBus, canvas, rules, modeling) {\n\n  CommandInterceptor.call(this, eventBus);\n\n  var movePreview = injector.get('movePreview', false);\n\n\n  // remove all the attached elements from the shapes to be validated\n  // add all the attached shapes to the overall list of moved shapes\n  eventBus.on('shape.move.start', HIGH_PRIORITY, function(e) {\n\n    var context = e.context,\n        shapes = context.shapes,\n        validatedShapes = context.validatedShapes;\n\n    context.shapes = addAttached(shapes);\n\n    context.validatedShapes = removeAttached(validatedShapes);\n  });\n\n  // add attachers to the visual's group\n  movePreview && eventBus.on('shape.move.start', LOW_PRIORITY, function(e) {\n\n    var context = e.context,\n        shapes = context.shapes,\n        attachers = getAttachers(shapes);\n\n    forEach(attachers, function(attacher) {\n      movePreview.makeDraggable(context, attacher, true);\n\n      forEach(attacher.labels, function(label) {\n        movePreview.makeDraggable(context, label, true);\n      });\n    });\n  });\n\n  // add attach-ok marker to current host\n  movePreview && eventBus.on('shape.move.start', function(event) {\n    var context = event.context,\n        shapes = context.shapes;\n\n    if (shapes.length !== 1) {\n      return;\n    }\n\n    var shape = shapes[0];\n\n    var host = shape.host;\n\n    if (host) {\n      canvas.addMarker(host, MARKER_ATTACH);\n\n      eventBus.once([\n        'shape.move.out',\n        'shape.move.cleanup'\n      ], function() {\n        canvas.removeMarker(host, MARKER_ATTACH);\n      });\n    }\n  });\n\n  // add all attachers to move closure\n  this.preExecuted('elements.move', HIGH_PRIORITY, function(e) {\n    var context = e.context,\n        closure = context.closure,\n        shapes = context.shapes,\n        attachers = getAttachers(shapes);\n\n    forEach(attachers, function(attacher) {\n      closure.add(attacher, closure.topLevel[attacher.host.id]);\n    });\n  });\n\n  // perform the attaching after shapes are done moving\n  this.postExecuted('elements.move', function(e) {\n\n    var context = e.context,\n        shapes = context.shapes,\n        newHost = context.newHost,\n        attachers;\n\n    // only single elements can be attached\n    // multiply elements can be detached\n    if (newHost && shapes.length !== 1) {\n      return;\n    }\n\n    if (newHost) {\n      attachers = shapes;\n    } else {\n\n      // find attachers moved without host\n      attachers = filter(shapes, function(shape) {\n        var host = shape.host;\n\n        return isAttacher(shape) && !includes(shapes, host);\n      });\n    }\n\n    forEach(attachers, function(attacher) {\n      modeling.updateAttachment(attacher, newHost);\n    });\n  });\n\n  // ensure invalid attachment connections are removed\n  this.postExecuted('elements.move', function(e) {\n\n    var shapes = e.context.shapes;\n\n    forEach(shapes, function(shape) {\n\n      forEach(shape.attachers, function(attacher) {\n\n        // remove invalid outgoing connections\n        forEach(attacher.outgoing.slice(), function(connection) {\n          var allowed = rules.allowed('connection.reconnect', {\n            connection: connection,\n            source: connection.source,\n            target: connection.target\n          });\n\n          if (!allowed) {\n            modeling.removeConnection(connection);\n          }\n        });\n\n        // remove invalid incoming connections\n        forEach(attacher.incoming.slice(), function(connection) {\n          var allowed = rules.allowed('connection.reconnect', {\n            connection: connection,\n            source: connection.source,\n            target: connection.target\n          });\n\n          if (!allowed) {\n            modeling.removeConnection(connection);\n          }\n        });\n      });\n    });\n  });\n\n  this.postExecute('shape.create', function(e) {\n    var context = e.context,\n        shape = context.shape,\n        host = context.host;\n\n    if (host) {\n      modeling.updateAttachment(shape, host);\n    }\n  });\n\n  // update attachments if the host is replaced\n  this.postExecute('shape.replace', function(e) {\n\n    var context = e.context,\n        oldShape = context.oldShape,\n        newShape = context.newShape;\n\n    // move the attachers to the new host\n    saveClear(oldShape.attachers, function(attacher) {\n      var allowed = rules.allowed('elements.move', {\n        target: newShape,\n        shapes: [attacher]\n      });\n\n      if (allowed === 'attach') {\n        modeling.updateAttachment(attacher, newShape);\n      } else {\n        modeling.removeShape(attacher);\n      }\n    });\n\n    // move attachers if new host has different size\n    if (newShape.attachers.length) {\n\n      forEach(newShape.attachers, function(attacher) {\n        var delta = getNewAttachShapeDelta(attacher, oldShape, newShape);\n        modeling.moveShape(attacher, delta, attacher.parent);\n      });\n    }\n\n  });\n\n  // move shape on host resize\n  this.postExecute('shape.resize', function(event) {\n    var context = event.context,\n        shape = context.shape,\n        oldBounds = context.oldBounds,\n        newBounds = context.newBounds,\n        attachers = shape.attachers,\n        hints = context.hints || {};\n\n    if (hints.attachSupport === false) {\n      return;\n    }\n\n    forEach(attachers, function(attacher) {\n      var delta = getNewAttachShapeDelta(attacher, oldBounds, newBounds);\n\n      modeling.moveShape(attacher, delta, attacher.parent);\n\n      forEach(attacher.labels, function(label) {\n        modeling.moveShape(label, delta, label.parent);\n      });\n    });\n  });\n\n  // remove attachments\n  this.preExecute('shape.delete', function(event) {\n\n    var shape = event.context.shape;\n\n    saveClear(shape.attachers, function(attacher) {\n      modeling.removeShape(attacher);\n    });\n\n    if (shape.host) {\n      modeling.updateAttachment(shape, null);\n    }\n  });\n}\n\ninherits(AttachSupport, CommandInterceptor);\n\nAttachSupport.$inject = [\n  'injector',\n  'eventBus',\n  'canvas',\n  'rules',\n  'modeling'\n];\n\n\n/**\n * Return attachers of the given shapes\n *\n * @param {Array<djs.model.Base>} shapes\n * @return {Array<djs.model.Base>}\n */\nfunction getAttachers(shapes) {\n  return flatten(map(shapes, function(s) {\n    return s.attachers || [];\n  }));\n}\n\n/**\n * Return a combined list of elements and\n * attachers.\n *\n * @param {Array<djs.model.Base>} elements\n * @return {Array<djs.model.Base>} filtered\n */\nfunction addAttached(elements) {\n  var attachers = getAttachers(elements);\n\n  return unionBy('id', elements, attachers);\n}\n\n/**\n * Return a filtered list of elements that do not\n * contain attached elements with hosts being part\n * of the selection.\n *\n * @param  {Array<djs.model.Base>} elements\n *\n * @return {Array<djs.model.Base>} filtered\n */\nfunction removeAttached(elements) {\n\n  var ids = groupBy(elements, 'id');\n\n  return filter(elements, function(element) {\n    while (element) {\n\n      // host in selection\n      if (element.host && ids[element.host.id]) {\n        return false;\n      }\n\n      element = element.parent;\n    }\n\n    return true;\n  });\n}\n\nfunction isAttacher(shape) {\n  return !!shape.host;\n}\n\nfunction includes(array, item) {\n  return array.indexOf(item) !== -1;\n}","import RulesModule from '../rules';\n\nimport AttachSupport from './AttachSupport';\n\nexport default {\n  __depends__: [\n    RulesModule\n  ],\n  __init__: [ 'attachSupport' ],\n  attachSupport: [ 'type', AttachSupport ]\n};\n","import {\n  forEach\n} from 'min-dash';\n\nimport {\n  closest as domClosest\n} from 'min-dom';\n\nvar LOW_PRIORITY = 250;\n\n/**\n * The tool manager acts as middle-man between the available tool's and the Palette,\n * it takes care of making sure that the correct active state is set.\n *\n * @param  {Object}    eventBus\n * @param  {Object}    dragging\n */\nexport default function ToolManager(eventBus, dragging) {\n  this._eventBus = eventBus;\n  this._dragging = dragging;\n\n  this._tools = [];\n  this._active = null;\n}\n\nToolManager.$inject = [ 'eventBus', 'dragging' ];\n\nToolManager.prototype.registerTool = function(name, events) {\n  var tools = this._tools;\n\n  if (!events) {\n    throw new Error('A tool has to be registered with it\\'s \"events\"');\n  }\n\n  tools.push(name);\n\n  this.bindEvents(name, events);\n};\n\nToolManager.prototype.isActive = function(tool) {\n  return tool && this._active === tool;\n};\n\nToolManager.prototype.length = function(tool) {\n  return this._tools.length;\n};\n\nToolManager.prototype.setActive = function(tool) {\n  var eventBus = this._eventBus;\n\n  if (this._active !== tool) {\n    this._active = tool;\n\n    eventBus.fire('tool-manager.update', { tool: tool });\n  }\n};\n\nToolManager.prototype.bindEvents = function(name, events) {\n  var eventBus = this._eventBus,\n      dragging = this._dragging;\n\n  var eventsToRegister = [];\n\n  eventBus.on(events.tool + '.init', function(event) {\n    var context = event.context;\n\n    // Active tools that want to reactivate themselves must do this explicitly\n    if (!context.reactivate && this.isActive(name)) {\n      this.setActive(null);\n\n      dragging.cancel();\n      return;\n    }\n\n    this.setActive(name);\n\n  }, this);\n\n  // Todo[ricardo]: add test cases\n  forEach(events, function(event) {\n    eventsToRegister.push(event + '.ended');\n    eventsToRegister.push(event + '.canceled');\n  });\n\n  eventBus.on(eventsToRegister, LOW_PRIORITY, function(event) {\n\n    // We defer the de-activation of the tool to the .activate phase,\n    // so we're able to check if we want to toggle off the current\n    // active tool or switch to a new one\n    if (!this._active) {\n      return;\n    }\n\n    if (isPaletteClick(event)) {\n      return;\n    }\n\n    this.setActive(null);\n  }, this);\n\n};\n\n\n// helpers ///////////////\n\n/**\n * Check if a given event is a palette click event.\n *\n * @param {EventBus.Event} event\n *\n * @return {boolean}\n */\nfunction isPaletteClick(event) {\n  var target = event.originalEvent && event.originalEvent.target;\n\n  return target && domClosest(target, '.group[data-group=\"tools\"]');\n}","import DraggingModule from '../dragging';\n\nimport ToolManager from './ToolManager';\n\nexport default {\n  __depends__: [\n    DraggingModule\n  ],\n  __init__: [ 'toolManager' ],\n  toolManager: [ 'type', ToolManager ]\n};\n","import { forEach } from 'min-dash';\n\n/**\n * Return direction given axis and delta.\n *\n * @param {string} axis\n * @param {number} delta\n *\n * @return {string}\n */\nexport function getDirection(axis, delta) {\n\n  if (axis === 'x') {\n    if (delta > 0) {\n      return 'e';\n    }\n\n    if (delta < 0) {\n      return 'w';\n    }\n  }\n\n  if (axis === 'y') {\n    if (delta > 0) {\n      return 's';\n    }\n\n    if (delta < 0) {\n      return 'n';\n    }\n  }\n\n  return null;\n}\n\n/**\n * Returns connections whose waypoints are to be updated. Waypoints are to be updated if start\n * or end is to be moved or resized.\n *\n * @param {Array<djs.model.Shape} movingShapes\n * @param {Array<djs.model.Shape} resizingShapes\n *\n * @returns {Array<djs.model.Connection>}\n */\nexport function getWaypointsUpdatingConnections(movingShapes, resizingShapes) {\n  var waypointsUpdatingConnections = [];\n\n  forEach(movingShapes.concat(resizingShapes), function(shape) {\n    var incoming = shape.incoming,\n        outgoing = shape.outgoing;\n\n    forEach(incoming.concat(outgoing), function(connection) {\n      var source = connection.source,\n          target = connection.target;\n\n      if (includes(movingShapes, source) ||\n        includes(movingShapes, target) ||\n        includes(resizingShapes, source) ||\n        includes(resizingShapes, target)) {\n\n        if (!includes(waypointsUpdatingConnections, connection)) {\n          waypointsUpdatingConnections.push(connection);\n        }\n      }\n    });\n  });\n\n  return waypointsUpdatingConnections;\n}\n\nfunction includes(array, item) {\n  return array.indexOf(item) !== -1;\n}\n\n/**\n * Resize bounds.\n *\n * @param {Object} bounds\n * @param {number} bounds.x\n * @param {number} bounds.y\n * @param {number} bounds.width\n * @param {number} bounds.height\n * @param {string} direction\n * @param {Object} delta\n * @param {number} delta.x\n * @param {number} delta.y\n *\n * @return {Object}\n */\nexport function resizeBounds(bounds, direction, delta) {\n  var x = bounds.x,\n      y = bounds.y,\n      width = bounds.width,\n      height = bounds.height,\n      dx = delta.x,\n      dy = delta.y;\n\n  switch (direction) {\n  case 'n':\n    return {\n      x: x,\n      y: y + dy,\n      width: width,\n      height: height - dy\n    };\n  case 's':\n    return {\n      x: x,\n      y: y,\n      width: width,\n      height: height + dy\n    };\n  case 'w':\n    return {\n      x: x + dx,\n      y: y,\n      width: width - dx,\n      height: height\n    };\n  case 'e':\n    return {\n      x: x,\n      y: y,\n      width: width + dx,\n      height: height\n    };\n  default:\n    throw new Error('unknown direction: ' + direction);\n  }\n}","import {\n  assign,\n  filter,\n  forEach,\n  isNumber\n} from 'min-dash';\n\nimport { asTRBL } from '../../layout/LayoutUtil';\n\nimport { getBBox } from '../../util/Elements';\n\nimport { getDirection } from './SpaceUtil';\n\nimport { hasPrimaryModifier } from '../../util/Mouse';\n\nimport { set as setCursor } from '../../util/Cursor';\n\nimport { selfAndAllChildren } from '../../util/Elements';\n\nvar abs = Math.abs,\n    round = Math.round;\n\nvar AXIS_TO_DIMENSION = {\n  x: 'width',\n  y: 'height'\n};\n\nvar CURSOR_CROSSHAIR = 'crosshair';\n\nvar DIRECTION_TO_TRBL = {\n  n: 'top',\n  w: 'left',\n  s: 'bottom',\n  e: 'right'\n};\n\nvar HIGH_PRIORITY = 1500;\n\nvar DIRECTION_TO_OPPOSITE = {\n  n: 's',\n  w: 'e',\n  s: 'n',\n  e: 'w'\n};\n\nvar PADDING = 20;\n\n\n/**\n * Add or remove space by moving and resizing elements.\n *\n * @param {Canvas} canvas\n * @param {Dragging} dragging\n * @param {EventBus} eventBus\n * @param {Modeling} modeling\n * @param {Rules} rules\n * @param {ToolManager} toolManager\n * @param {Mouse} mouse\n */\nexport default function SpaceTool(\n    canvas, dragging, eventBus,\n    modeling, rules, toolManager,\n    mouse) {\n\n  this._canvas = canvas;\n  this._dragging = dragging;\n  this._eventBus = eventBus;\n  this._modeling = modeling;\n  this._rules = rules;\n  this._toolManager = toolManager;\n  this._mouse = mouse;\n\n  var self = this;\n\n  toolManager.registerTool('space', {\n    tool: 'spaceTool.selection',\n    dragging: 'spaceTool'\n  });\n\n  eventBus.on('spaceTool.selection.end', function(event) {\n    eventBus.once('spaceTool.selection.ended', function() {\n      self.activateMakeSpace(event.originalEvent);\n    });\n  });\n\n  eventBus.on('spaceTool.move', HIGH_PRIORITY , function(event) {\n    var context = event.context,\n        initialized = context.initialized;\n\n    if (!initialized) {\n      initialized = context.initialized = self.init(event, context);\n    }\n\n    if (initialized) {\n      ensureConstraints(event);\n    }\n  });\n\n  eventBus.on('spaceTool.end', function(event) {\n    var context = event.context,\n        axis = context.axis,\n        direction = context.direction,\n        movingShapes = context.movingShapes,\n        resizingShapes = context.resizingShapes,\n        start = context.start;\n\n    if (!context.initialized) {\n      return;\n    }\n\n    ensureConstraints(event);\n\n    var delta = {\n      x: 0,\n      y: 0\n    };\n\n    delta[ axis ] = round(event[ 'd' + axis ]);\n\n    self.makeSpace(movingShapes, resizingShapes, delta, direction, start);\n\n    eventBus.once('spaceTool.ended', function(event) {\n\n      // activate space tool selection after make space\n      self.activateSelection(event.originalEvent, true, true);\n    });\n  });\n}\n\nSpaceTool.$inject = [\n  'canvas',\n  'dragging',\n  'eventBus',\n  'modeling',\n  'rules',\n  'toolManager',\n  'mouse'\n];\n\n/**\n * Activate space tool selection.\n *\n * @param {Object} event\n * @param {boolean} autoActivate\n */\nSpaceTool.prototype.activateSelection = function(event, autoActivate, reactivate) {\n  this._dragging.init(event, 'spaceTool.selection', {\n    autoActivate: autoActivate,\n    cursor: CURSOR_CROSSHAIR,\n    data: {\n      context: {\n        reactivate: reactivate\n      }\n    },\n    trapClick: false\n  });\n};\n\n/**\n * Activate space tool make space.\n *\n * @param  {MouseEvent} event\n */\nSpaceTool.prototype.activateMakeSpace = function(event) {\n  this._dragging.init(event, 'spaceTool', {\n    autoActivate: true,\n    cursor: CURSOR_CROSSHAIR,\n    data: {\n      context: {}\n    }\n  });\n};\n\n/**\n * Make space.\n *\n * @param  {Array<djs.model.Shape>} movingShapes\n * @param  {Array<djs.model.Shape>} resizingShapes\n * @param  {Object} delta\n * @param  {number} delta.x\n * @param  {number} delta.y\n * @param  {string} direction\n * @param  {number} start\n */\nSpaceTool.prototype.makeSpace = function(movingShapes, resizingShapes, delta, direction, start) {\n  return this._modeling.createSpace(movingShapes, resizingShapes, delta, direction, start);\n};\n\n/**\n * Initialize make space and return true if that was successful.\n *\n * @param {Object} event\n * @param {Object} context\n *\n * @return {boolean}\n */\nSpaceTool.prototype.init = function(event, context) {\n  var axis = abs(event.dx) > abs(event.dy) ? 'x' : 'y',\n      delta = event[ 'd' + axis ],\n      start = event[ axis ] - delta;\n\n  if (abs(delta) < 5) {\n    return false;\n  }\n\n  // invert delta to remove space when moving left\n  if (delta < 0) {\n    delta *= -1;\n  }\n\n  // invert delta to add/remove space when removing/adding space if modifier key is pressed\n  if (hasPrimaryModifier(event)) {\n    delta *= -1;\n  }\n\n  var direction = getDirection(axis, delta);\n\n  var root = this._canvas.getRootElement();\n\n  var children = selfAndAllChildren(root, true);\n\n  var elements = this.calculateAdjustments(children, axis, delta, start);\n\n  var minDimensions = this._eventBus.fire('spaceTool.getMinDimensions', {\n    axis: axis,\n    direction: direction,\n    shapes: elements.resizingShapes,\n    start: start\n  });\n\n  var spaceToolConstraints = getSpaceToolConstraints(elements, axis, direction, start, minDimensions);\n\n  assign(\n    context,\n    elements,\n    {\n      axis: axis,\n      direction: direction,\n      spaceToolConstraints: spaceToolConstraints,\n      start: start\n    }\n  );\n\n  setCursor('resize-' + (axis === 'x' ? 'ew' : 'ns'));\n\n  return true;\n};\n\n/**\n * Get elements to be moved and resized.\n *\n * @param  {Array<djs.model.Shape>} elements\n * @param  {string} axis\n * @param  {number} delta\n * @param  {number} start\n *\n * @return {Object}\n */\nSpaceTool.prototype.calculateAdjustments = function(elements, axis, delta, start) {\n  var rules = this._rules;\n\n  var movingShapes = [],\n      resizingShapes = [];\n\n  forEach(elements, function(element) {\n    if (!element.parent || isConnection(element)) {\n      return;\n    }\n\n    var shapeStart = element[ axis ],\n        shapeEnd = shapeStart + element[ AXIS_TO_DIMENSION[ axis ] ];\n\n    // shape to be moved\n    if ((delta > 0 && shapeStart > start) || (delta < 0 && shapeEnd < start)) {\n      return movingShapes.push(element);\n    }\n\n    // shape to be resized\n    if (shapeStart < start &&\n      shapeEnd > start &&\n      rules.allowed('shape.resize', { shape: element })\n    ) {\n\n      return resizingShapes.push(element);\n    }\n  });\n\n  return {\n    movingShapes: movingShapes,\n    resizingShapes: resizingShapes\n  };\n};\n\nSpaceTool.prototype.toggle = function() {\n\n  if (this.isActive()) {\n    return this._dragging.cancel();\n  }\n\n  var mouseEvent = this._mouse.getLastMoveEvent();\n\n  this.activateSelection(mouseEvent, !!mouseEvent);\n};\n\nSpaceTool.prototype.isActive = function() {\n  var context = this._dragging.context();\n\n  return context && /^spaceTool/.test(context.prefix);\n};\n\n// helpers //////////\n\nfunction addPadding(trbl) {\n  return {\n    top: trbl.top - PADDING,\n    right: trbl.right + PADDING,\n    bottom: trbl.bottom + PADDING,\n    left: trbl.left - PADDING\n  };\n}\n\nfunction ensureConstraints(event) {\n  var context = event.context,\n      spaceToolConstraints = context.spaceToolConstraints;\n\n  if (!spaceToolConstraints) {\n    return;\n  }\n\n  var x, y;\n\n  if (isNumber(spaceToolConstraints.left)) {\n    x = Math.max(event.x, spaceToolConstraints.left);\n\n    event.dx = event.dx + x - event.x;\n    event.x = x;\n  }\n\n  if (isNumber(spaceToolConstraints.right)) {\n    x = Math.min(event.x, spaceToolConstraints.right);\n\n    event.dx = event.dx + x - event.x;\n    event.x = x;\n  }\n\n  if (isNumber(spaceToolConstraints.top)) {\n    y = Math.max(event.y, spaceToolConstraints.top);\n\n    event.dy = event.dy + y - event.y;\n    event.y = y;\n  }\n\n  if (isNumber(spaceToolConstraints.bottom)) {\n    y = Math.min(event.y, spaceToolConstraints.bottom);\n\n    event.dy = event.dy + y - event.y;\n    event.y = y;\n  }\n}\n\nfunction getSpaceToolConstraints(elements, axis, direction, start, minDimensions) {\n  var movingShapes = elements.movingShapes,\n      resizingShapes = elements.resizingShapes;\n\n  if (!resizingShapes.length) {\n    return;\n  }\n\n  var spaceToolConstraints = {},\n      min,\n      max;\n\n  forEach(resizingShapes, function(resizingShape) {\n    var resizingShapeBBox = asTRBL(resizingShape);\n\n    // find children that are not moving or resizing\n    var nonMovingResizingChildren = filter(resizingShape.children, function(child) {\n      return !isConnection(child) &&\n        !isLabel(child) &&\n        !includes(movingShapes, child) &&\n        !includes(resizingShapes, child);\n    });\n\n    // find children that are moving\n    var movingChildren = filter(resizingShape.children, function(child) {\n      return !isConnection(child) && !isLabel(child) && includes(movingShapes, child);\n    });\n\n    var minOrMax,\n        nonMovingResizingChildrenBBox,\n        movingChildrenBBox;\n\n    if (nonMovingResizingChildren.length) {\n      nonMovingResizingChildrenBBox = addPadding(asTRBL(getBBox(nonMovingResizingChildren)));\n\n      minOrMax = start -\n        resizingShapeBBox[ DIRECTION_TO_TRBL[ direction ] ] +\n        nonMovingResizingChildrenBBox[ DIRECTION_TO_TRBL[ direction ] ];\n\n      if (direction === 'n') {\n        spaceToolConstraints.bottom = max = isNumber(max) ? Math.min(max, minOrMax) : minOrMax;\n      } else if (direction === 'w') {\n        spaceToolConstraints.right = max = isNumber(max) ? Math.min(max, minOrMax) : minOrMax;\n      } else if (direction === 's') {\n        spaceToolConstraints.top = min = isNumber(min) ? Math.max(min, minOrMax) : minOrMax;\n      } else if (direction === 'e') {\n        spaceToolConstraints.left = min = isNumber(min) ? Math.max(min, minOrMax) : minOrMax;\n      }\n    }\n\n    if (movingChildren.length) {\n      movingChildrenBBox = addPadding(asTRBL(getBBox(movingChildren)));\n\n      minOrMax = start -\n        movingChildrenBBox[ DIRECTION_TO_TRBL[ DIRECTION_TO_OPPOSITE[ direction ] ] ] +\n        resizingShapeBBox[ DIRECTION_TO_TRBL[ DIRECTION_TO_OPPOSITE[ direction ] ] ];\n\n      if (direction === 'n') {\n        spaceToolConstraints.bottom = max = isNumber(max) ? Math.min(max, minOrMax) : minOrMax;\n      } else if (direction === 'w') {\n        spaceToolConstraints.right = max = isNumber(max) ? Math.min(max, minOrMax) : minOrMax;\n      } else if (direction === 's') {\n        spaceToolConstraints.top = min = isNumber(min) ? Math.max(min, minOrMax) : minOrMax;\n      } else if (direction === 'e') {\n        spaceToolConstraints.left = min = isNumber(min) ? Math.max(min, minOrMax) : minOrMax;\n      }\n    }\n\n    var resizingShapeMinDimensions = minDimensions && minDimensions[ resizingShape.id ];\n\n    if (resizingShapeMinDimensions) {\n      if (direction === 'n') {\n        minOrMax = start +\n          resizingShape[ AXIS_TO_DIMENSION [ axis ] ] -\n          resizingShapeMinDimensions[ AXIS_TO_DIMENSION[ axis ] ];\n\n        spaceToolConstraints.bottom = max = isNumber(max) ? Math.min(max, minOrMax) : minOrMax;\n      } else if (direction === 'w') {\n        minOrMax = start +\n          resizingShape[ AXIS_TO_DIMENSION [ axis ] ] -\n          resizingShapeMinDimensions[ AXIS_TO_DIMENSION[ axis ] ];\n\n        spaceToolConstraints.right = max = isNumber(max) ? Math.min(max, minOrMax) : minOrMax;\n      } else if (direction === 's') {\n        minOrMax = start -\n          resizingShape[ AXIS_TO_DIMENSION [ axis ] ] +\n          resizingShapeMinDimensions[ AXIS_TO_DIMENSION[ axis ] ];\n\n        spaceToolConstraints.top = min = isNumber(min) ? Math.max(min, minOrMax) : minOrMax;\n      } else if (direction === 'e') {\n        minOrMax = start -\n          resizingShape[ AXIS_TO_DIMENSION [ axis ] ] +\n          resizingShapeMinDimensions[ AXIS_TO_DIMENSION[ axis ] ];\n\n        spaceToolConstraints.left = min = isNumber(min) ? Math.max(min, minOrMax) : minOrMax;\n      }\n    }\n  });\n\n  return spaceToolConstraints;\n}\n\nfunction includes(array, item) {\n  return array.indexOf(item) !== -1;\n}\n\nfunction isConnection(element) {\n  return !!element.waypoints;\n}\n\nfunction isLabel(element) {\n  return !!element.labelTarget;\n}","import {\n  forEach\n} from 'min-dash';\n\nvar MARKER_DRAGGING = 'djs-dragging',\n    MARKER_RESIZING = 'djs-resizing';\n\nvar LOW_PRIORITY = 250;\n\nimport {\n  append as svgAppend,\n  attr as svgAttr,\n  classes as svgClasses,\n  create as svgCreate,\n  remove as svgRemove\n} from 'tiny-svg';\n\nimport {\n  translate\n} from '../../util/SvgTransformUtil';\n\nvar max = Math.max;\n\n\n/**\n * Provides previews for selecting/moving/resizing shapes when creating/removing space.\n *\n * @param {EventBus} eventBus\n * @param {ElementRegistry} elementRegistry\n * @param {Canvas} canvas\n * @param {Styles} styles\n */\nexport default function SpaceToolPreview(\n    eventBus, elementRegistry, canvas,\n    styles, previewSupport) {\n\n  function addPreviewGfx(collection, dragGroup) {\n    forEach(collection, function(element) {\n      previewSupport.addDragger(element, dragGroup);\n\n      canvas.addMarker(element, MARKER_DRAGGING);\n    });\n  }\n\n  // add crosshair\n  eventBus.on('spaceTool.selection.start', function(event) {\n    var space = canvas.getLayer('space'),\n        context = event.context;\n\n    var orientation = {\n      x: 'M 0,-10000 L 0,10000',\n      y: 'M -10000,0 L 10000,0'\n    };\n\n    var crosshairGroup = svgCreate('g');\n    svgAttr(crosshairGroup, styles.cls('djs-crosshair-group', [ 'no-events' ]));\n\n    svgAppend(space, crosshairGroup);\n\n    // horizontal path\n    var pathX = svgCreate('path');\n    svgAttr(pathX, 'd', orientation.x);\n    svgClasses(pathX).add('djs-crosshair');\n\n    svgAppend(crosshairGroup, pathX);\n\n    // vertical path\n    var pathY = svgCreate('path');\n    svgAttr(pathY, 'd', orientation.y);\n    svgClasses(pathY).add('djs-crosshair');\n\n    svgAppend(crosshairGroup, pathY);\n\n    context.crosshairGroup = crosshairGroup;\n  });\n\n  // update crosshair\n  eventBus.on('spaceTool.selection.move', function(event) {\n    var crosshairGroup = event.context.crosshairGroup;\n\n    translate(crosshairGroup, event.x, event.y);\n  });\n\n  // remove crosshair\n  eventBus.on('spaceTool.selection.cleanup', function(event) {\n    var context = event.context,\n        crosshairGroup = context.crosshairGroup;\n\n    if (crosshairGroup) {\n      svgRemove(crosshairGroup);\n    }\n  });\n\n  // add and update move/resize previews\n  eventBus.on('spaceTool.move', LOW_PRIORITY, function(event) {\n\n    var context = event.context,\n        line = context.line,\n        axis = context.axis,\n        movingShapes = context.movingShapes,\n        resizingShapes = context.resizingShapes;\n\n    if (!context.initialized) {\n      return;\n    }\n\n    if (!context.dragGroup) {\n      var spaceLayer = canvas.getLayer('space');\n\n      line = svgCreate('path');\n      svgAttr(line, 'd', 'M0,0 L0,0');\n      svgClasses(line).add('djs-crosshair');\n\n      svgAppend(spaceLayer, line);\n\n      context.line = line;\n\n      var dragGroup = svgCreate('g');\n      svgAttr(dragGroup, styles.cls('djs-drag-group', [ 'no-events' ]));\n\n      svgAppend(canvas.getDefaultLayer(), dragGroup);\n\n      // shapes\n      addPreviewGfx(movingShapes, dragGroup);\n\n      // connections\n      var movingConnections = context.movingConnections = elementRegistry.filter(function(element) {\n        var sourceIsMoving = false;\n\n        forEach(movingShapes, function(shape) {\n          forEach(shape.outgoing, function(connection) {\n            if (element === connection) {\n              sourceIsMoving = true;\n            }\n          });\n        });\n\n        var targetIsMoving = false;\n\n        forEach(movingShapes, function(shape) {\n          forEach(shape.incoming, function(connection) {\n            if (element === connection) {\n              targetIsMoving = true;\n            }\n          });\n        });\n\n        var sourceIsResizing = false;\n\n        forEach(resizingShapes, function(shape) {\n          forEach(shape.outgoing, function(connection) {\n            if (element === connection) {\n              sourceIsResizing = true;\n            }\n          });\n        });\n\n        var targetIsResizing = false;\n\n        forEach(resizingShapes, function(shape) {\n          forEach(shape.incoming, function(connection) {\n            if (element === connection) {\n              targetIsResizing = true;\n            }\n          });\n        });\n\n        return isConnection(element)\n          && (sourceIsMoving || sourceIsResizing)\n          && (targetIsMoving || targetIsResizing);\n      });\n\n\n      addPreviewGfx(movingConnections, dragGroup);\n\n      context.dragGroup = dragGroup;\n    }\n\n    if (!context.frameGroup) {\n      var frameGroup = svgCreate('g');\n      svgAttr(frameGroup, styles.cls('djs-frame-group', [ 'no-events' ]));\n\n      svgAppend(canvas.getDefaultLayer(), frameGroup);\n\n      var frames = [];\n\n      forEach(resizingShapes, function(shape) {\n        var frame = previewSupport.addFrame(shape, frameGroup);\n\n        var initialBounds = frame.getBBox();\n\n        frames.push({\n          element: frame,\n          initialBounds: initialBounds\n        });\n\n        canvas.addMarker(shape, MARKER_RESIZING);\n      });\n\n      context.frameGroup = frameGroup;\n      context.frames = frames;\n    }\n\n    var orientation = {\n      x: 'M' + event.x + ', -10000 L' + event.x + ', 10000',\n      y: 'M -10000, ' + event.y + ' L 10000, ' + event.y\n    };\n\n    svgAttr(line, { d: orientation[ axis ] });\n\n    var opposite = { x: 'y', y: 'x' };\n    var delta = { x: event.dx, y: event.dy };\n    delta[ opposite[ context.axis ] ] = 0;\n\n    // update move previews\n    translate(context.dragGroup, delta.x, delta.y);\n\n    // update resize previews\n    forEach(context.frames, function(frame) {\n      var element = frame.element,\n          initialBounds = frame.initialBounds,\n          width,\n          height;\n\n      if (context.direction === 'e') {\n        svgAttr(element, {\n          width: max(initialBounds.width + delta.x, 5)\n        });\n      } else {\n        width = max(initialBounds.width - delta.x, 5);\n\n        svgAttr(element, {\n          width: width,\n          x: initialBounds.x + initialBounds.width - width\n        });\n      }\n\n      if (context.direction === 's') {\n        svgAttr(element, {\n          height: max(initialBounds.height + delta.y, 5)\n        });\n      } else {\n        height = max(initialBounds.height - delta.y, 5);\n\n        svgAttr(element, {\n          height: height,\n          y: initialBounds.y + initialBounds.height - height\n        });\n      }\n    });\n\n  });\n\n  // remove move/resize previews\n  eventBus.on('spaceTool.cleanup', function(event) {\n\n    var context = event.context,\n        movingShapes = context.movingShapes,\n        movingConnections = context.movingConnections,\n        resizingShapes = context.resizingShapes,\n        line = context.line,\n        dragGroup = context.dragGroup,\n        frameGroup = context.frameGroup;\n\n    // moving shapes\n    forEach(movingShapes, function(shape) {\n      canvas.removeMarker(shape, MARKER_DRAGGING);\n    });\n\n    // moving connections\n    forEach(movingConnections, function(connection) {\n      canvas.removeMarker(connection, MARKER_DRAGGING);\n    });\n\n    if (dragGroup) {\n      svgRemove(line);\n      svgRemove(dragGroup);\n    }\n\n    forEach(resizingShapes, function(shape) {\n      canvas.removeMarker(shape, MARKER_RESIZING);\n    });\n\n    if (frameGroup) {\n      svgRemove(frameGroup);\n    }\n  });\n}\n\nSpaceToolPreview.$inject = [\n  'eventBus',\n  'elementRegistry',\n  'canvas',\n  'styles',\n  'previewSupport'\n];\n\n\n// helpers //////////////////////\n\n/**\n * Checks if an element is a connection.\n */\nfunction isConnection(element) {\n  return element.waypoints;\n}\n","import DraggingModule from '../dragging';\nimport RulesModule from '../rules';\nimport ToolManagerModule from '../tool-manager';\nimport PreviewSupportModule from '../preview-support';\nimport MouseModule from '../mouse';\n\nimport SpaceTool from './SpaceTool';\nimport SpaceToolPreview from './SpaceToolPreview';\n\nexport default {\n  __init__: ['spaceToolPreview'],\n  __depends__: [\n    DraggingModule,\n    RulesModule,\n    ToolManagerModule,\n    PreviewSupportModule,\n    MouseModule\n  ],\n  spaceTool: ['type', SpaceTool ],\n  spaceToolPreview: ['type', SpaceToolPreview ]\n};\n","import {\n  assign,\n} from 'min-dash';\n\nimport {\n  isAny\n} from './util/ModelingUtil';\n\nimport {\n  is\n} from '../../util/ModelUtil';\n\n\nexport default function PositFactory(moddle) {\n  this._model = moddle;\n}\n\nPositFactory.$inject = [ 'moddle' ];\n\n\nPositFactory.prototype._needsId = function(element) {\n  return isAny(element, [\n    'postit:BoardElement'\n  ]);\n};\n\nPositFactory.prototype._ensureId = function(element) {\n\n  // generate semantic ids for elements\n  // postit:Postit -> Positit_ID\n  var prefix;\n\n  if (is(element, 'postit:Postit')) {\n    prefix = 'Postit';\n  } else {\n    prefix = (element.$type || '').replace(/^[^:]*:/g, '');\n  }\n\n  prefix += '_';\n\n  if (!element.id && this._needsId(element)) {\n    element.id = this._model.ids.nextPrefixed(prefix, element);\n  }\n};\n\n\nPositFactory.prototype.create = function(type, attrs) {\n  var element = this._model.create(type, attrs || {});\n\n  this._ensureId(element);\n\n  return element;\n};\n\n\nPositFactory.prototype.createDiLabel = function() {\n  return this.create('postitDi:PostitLabel', {\n    bounds: this.createDiBounds()\n  });\n};\n\n\nPositFactory.prototype.createDiShape = function(semantic, bounds, attrs) {\n\n  return this.create('postitDi:PostitShape', assign({\n    boardElement: semantic,\n    bounds: this.createDiBounds(bounds)\n  }, attrs));\n};\n\n\nPositFactory.prototype.createDiBounds = function(bounds) {\n  return this.create('dc:Bounds', bounds);\n};\n\n\nPositFactory.prototype.createDiPlane = function(semantic) {\n  return this.create('postitDi:PostitPlane', {\n    boardElement: semantic\n  });\n};","import {\n  assign,\n  forEach\n} from 'min-dash';\n\nimport inherits from 'inherits';\n\nimport {\n  remove as collectionRemove\n} from 'diagram-js/lib/util/Collections';\n\nimport {\n  Label\n} from 'diagram-js/lib/model';\n\nimport {\n  is\n} from '../../util/ModelUtil';\n\nimport CommandInterceptor from 'diagram-js/lib/command/CommandInterceptor';\n\n/**\n * A handler responsible for updating the underlying Postit XML + DI\n * once changes on the diagram happen\n */\nexport default function PostitUpdater(\n    eventBus, postitFactory, connectionDocking,\n    translate) {\n\n  CommandInterceptor.call(this, eventBus);\n\n  this._postitFactory = postitFactory;\n  this._translate = translate;\n\n  var self = this;\n\n\n  // Postit + DI update //////////////////////\n\n\n  // update parent\n  function updateParent(e) {\n    var context = e.context;\n\n    self.updateParent(context.shape || context.connection, context.oldParent);\n  }\n\n  function reverseUpdateParent(e) {\n    var context = e.context;\n\n    var element = context.shape || context.connection,\n\n        // oldParent is the (old) new parent, because we are undoing\n        oldParent = context.parent || context.newParent;\n\n    self.updateParent(element, oldParent);\n  }\n\n  this.executed([\n    'shape.move',\n    'shape.create',\n    'shape.delete'\n  ], ifPostit(updateParent));\n\n  this.reverted([\n    'shape.move',\n    'shape.create',\n    'shape.delete'\n  ], ifPostit(reverseUpdateParent));\n\n  /*\n   * ## Updating Parent\n   *\n   * When morphing a root element\n   * make sure that both the *semantic* and *di* parent of each element\n   * is updated.\n   *\n   */\n  function updateRoot(event) {\n    var context = event.context,\n        oldRoot = context.oldRoot,\n        children = oldRoot.children;\n\n    forEach(children, function(child) {\n      if (is(child, 'postit:BoardElement')) {\n        self.updateParent(child);\n      }\n    });\n  }\n\n  this.executed([ 'canvas.updateRoot' ], updateRoot);\n  this.reverted([ 'canvas.updateRoot' ], updateRoot);\n\n\n  // update bounds\n  function updateBounds(e) {\n    var shape = e.context.shape;\n\n    if (!is(shape, 'postit:BoardElement')) {\n      return;\n    }\n\n    self.updateBounds(shape);\n  }\n\n  this.executed([ 'shape.move', 'shape.create', 'shape.resize' ], ifPostit(function(event) {\n\n    // exclude labels because they're handled separately during shape.changed\n    if (event.context.shape.type === 'label') {\n      return;\n    }\n\n    updateBounds(event);\n  }));\n\n  this.reverted([ 'shape.move', 'shape.create', 'shape.resize' ], ifPostit(function(event) {\n\n    // exclude labels because they're handled separately during shape.changed\n    if (event.context.shape.type === 'label') {\n      return;\n    }\n\n    updateBounds(event);\n  }));\n\n  // Handle labels separately. This is necessary, because the label bounds have to be updated\n  // every time its shape changes, not only on move, create and resize.\n  eventBus.on('shape.changed', function(event) {\n    if (event.element.type === 'label') {\n      updateBounds({ context: { shape: event.element } });\n    }\n  });\n\n}\n\ninherits(PostitUpdater, CommandInterceptor);\n\nPostitUpdater.$inject = [\n  'eventBus',\n  'postitFactory',\n  'connectionDocking',\n  'translate'\n];\n\n\n// implementation //////////////////////\n\nPostitUpdater.prototype.updateAttachment = function(context) {\n\n  var shape = context.shape,\n      businessObject = shape.businessObject,\n      host = shape.host;\n\n  businessObject.attachedToRef = host && host.businessObject;\n};\n\nPostitUpdater.prototype.updateParent = function(element, oldParent) {\n\n  // do not update label parent\n  if (element instanceof Label) {\n    return;\n  }\n\n  var parentShape = element.parent;\n\n  var businessObject = element.businessObject,\n      parentBusinessObject = parentShape && parentShape.businessObject,\n      parentDi = parentBusinessObject && parentBusinessObject.di;\n\n  this.updateSemanticParent(businessObject, parentBusinessObject);\n\n  this.updateDiParent(businessObject.di, parentDi);\n};\n\n\nPostitUpdater.prototype.updateBounds = function(shape) {\n\n  var di = shape.businessObject.di;\n\n  var target = (shape instanceof Label) ? this._getLabel(di) : di;\n\n  var bounds = target.bounds;\n\n  if (!bounds) {\n    bounds = this._postitFactory.createDiBounds();\n    target.set('bounds', bounds);\n  }\n\n  assign(bounds, {\n    x: shape.x,\n    y: shape.y,\n    width: shape.width,\n    height: shape.height\n  });\n};\n\n\nPostitUpdater.prototype.updateDiParent = function(di, parentDi) {\n\n  if (parentDi && !is(parentDi, 'postitDi:PostitPlane')) {\n    parentDi = parentDi.$parent;\n  }\n\n  if (di.$parent === parentDi) {\n    return;\n  }\n\n  var planeElements = (parentDi || di.$parent).get('planeElement');\n\n  if (parentDi) {\n    planeElements.push(di);\n    di.$parent = parentDi;\n  } else {\n    collectionRemove(planeElements, di);\n    di.$parent = null;\n  }\n};\n\n\nPostitUpdater.prototype.updateSemanticParent = function(businessObject, newParent, visualParent) {\n\n  var containment,\n      translate = this._translate;\n\n  if (businessObject.$parent === newParent) {\n    return;\n  }\n\n\n  if (is(businessObject, 'postit:BoardElement')) {\n    containment = 'boardElements';\n  }\n\n  if (!containment) {\n    throw new Error(translate(\n      'no parent for {element} in {parent}',\n      {\n        element: businessObject.id,\n        parent: newParent.id\n      }\n    ));\n  }\n\n  var children;\n\n  if (businessObject.$parent) {\n\n    // remove from old parent\n    children = businessObject.$parent.get(containment);\n    collectionRemove(children, businessObject);\n  }\n\n  if (!newParent) {\n    businessObject.$parent = null;\n  } else {\n\n    // add to new parent\n    children = newParent.get(containment);\n    children.push(businessObject);\n    businessObject.$parent = newParent;\n  }\n\n  if (visualParent) {\n    var diChildren = visualParent.get(containment);\n\n    collectionRemove(children, businessObject);\n\n    if (newParent) {\n\n      if (!diChildren) {\n        diChildren = [];\n        newParent.set(containment, diChildren);\n      }\n\n      diChildren.push(businessObject);\n    }\n  }\n};\n\n\n// helpers //////////////////////\n\nPostitUpdater.prototype._getLabel = function(di) {\n  if (!di.label) {\n    di.label = this._postitFactory.createDiLabel();\n  }\n\n  return di.label;\n};\n\n\n/**\n * Make sure the event listener is only called\n * if the touched element is a postit element.\n *\n * @param  {Function} fn\n * @return {Function} guarded function\n */\nfunction ifPostit(fn) {\n\n  return function(event) {\n\n    var context = event.context,\n        element = context.shape || context.connection;\n\n    if (is(element, 'postit:BoardElement')) {\n      fn(event);\n    }\n  };\n}\n","import {\n  assign,\n  forEach\n} from 'min-dash';\n\nimport inherits from 'inherits';\n\nimport { is } from '../../util/ModelUtil';\n\nimport BaseElementFactory from 'diagram-js/lib/core/ElementFactory';\n\nimport {\n  DEFAULT_LABEL_SIZE\n} from '../../util/LabelUtil';\n\n\n/**\n * A postit-aware factory for diagram-js shapes\n */\nexport default function ElementFactory(postitFactory, moddle, translate) {\n  BaseElementFactory.call(this);\n\n  this._postitFactory = postitFactory;\n  this._moddle = moddle;\n  this._translate = translate;\n}\n\ninherits(ElementFactory, BaseElementFactory);\n\nElementFactory.$inject = [\n  'postitFactory',\n  'moddle',\n  'translate'\n];\n\nElementFactory.prototype.baseCreate = BaseElementFactory.prototype.create;\n\nElementFactory.prototype.create = function(elementType, attrs) {\n\n  // no special magic for labels,\n  // we assume their businessObjects have already been created\n  // and wired via attrs\n  if (elementType === 'label') {\n    return this.baseCreate(elementType, assign({ type: 'label' }, DEFAULT_LABEL_SIZE, attrs));\n  }\n\n  return this.createPostitElement(elementType, attrs);\n};\n\nElementFactory.prototype.createPostitElement = function(elementType, attrs) {\n  var size,\n      translate = this._translate;\n\n  attrs = attrs || {};\n\n  var businessObject = attrs.businessObject;\n\n  if (!businessObject) {\n    if (!attrs.type) {\n      throw new Error(translate('no shape type specified'));\n    }\n\n    businessObject = this._postitFactory.create(attrs.type);\n  }\n\n  if (!businessObject.di) {\n    if (elementType === 'root') {\n      businessObject.di = this._postitFactory.createDiPlane(businessObject, [], {\n        id: businessObject.id + '_di'\n      });\n    } else {\n      businessObject.di = this._postitFactory.createDiShape(businessObject, {}, {\n        id: businessObject.id + '_di'\n      });\n    }\n  }\n\n  if (is(businessObject, 'postit:Group')) {\n    attrs = assign({\n      isFrame: true\n    }, attrs);\n  }\n\n  if (attrs.di) {\n    assign(businessObject.di, attrs.di);\n\n    delete attrs.di;\n  }\n\n  applyAttributes(businessObject, attrs, [\n    'processRef',\n    'isInterrupting',\n    'associationDirection',\n    'isForCompensation'\n  ]);\n\n  size = this._getDefaultSize(businessObject);\n\n  attrs = assign({\n    businessObject: businessObject,\n    id: businessObject.id\n  }, size, attrs);\n\n  return this.baseCreate(elementType, attrs);\n};\n\n\nElementFactory.prototype._getDefaultSize = function(semantic) {\n  if (is(semantic, 'postit:Postit')) {\n    return { width: 150, height: 150 };\n  }\n\n  if (is(semantic, 'postit:Group')) {\n    return { width: 300, height: 300 };\n  }\n\n  if (is(semantic, 'postit:Image')) {\n    return { width: 300, height: 300 };\n  }\n\n  return { width: 100, height: 80 };\n};\n\n\n\n// helpers //////////////////////\n\n/**\n * Apply attributes from a map to the given element,\n * remove attribute from the map on application.\n *\n * @param {Base} element\n * @param {Object} attrs (in/out map of attributes)\n * @param {Array<String>} attributeNames name of attributes to apply\n */\nfunction applyAttributes(element, attrs, attributeNames) {\n\n  forEach(attributeNames, function(property) {\n    if (attrs[property] !== undefined) {\n      applyAttribute(element, attrs, property);\n    }\n  });\n}\n\n/**\n * Apply named property to element and drain it from the attrs\n * collection.\n *\n * @param {Base} element\n * @param {Object} attrs (in/out map of attributes)\n * @param {String} attributeName to apply\n */\nfunction applyAttribute(element, attrs, attributeName) {\n  element[attributeName] = attrs[attributeName];\n\n  delete attrs[attributeName];\n}","import { forEach } from 'min-dash';\n\n/**\n * A handler that align elements in a certain way.\n *\n */\nexport default function AlignElements(modeling, canvas) {\n  this._modeling = modeling;\n  this._canvas = canvas;\n}\n\nAlignElements.$inject = [ 'modeling', 'canvas' ];\n\n\nAlignElements.prototype.preExecute = function(context) {\n  var modeling = this._modeling;\n\n  var elements = context.elements,\n      alignment = context.alignment;\n\n\n  forEach(elements, function(element) {\n    var delta = {\n      x: 0,\n      y: 0\n    };\n\n    if (alignment.left) {\n      delta.x = alignment.left - element.x;\n\n    } else if (alignment.right) {\n      delta.x = (alignment.right - element.width) - element.x;\n\n    } else if (alignment.center) {\n      delta.x = (alignment.center - Math.round(element.width / 2)) - element.x;\n\n    } else if (alignment.top) {\n      delta.y = alignment.top - element.y;\n\n    } else if (alignment.bottom) {\n      delta.y = (alignment.bottom - element.height) - element.y;\n\n    } else if (alignment.middle) {\n      delta.y = (alignment.middle - Math.round(element.height / 2)) - element.y;\n    }\n\n    modeling.moveElements([ element ], delta, element.parent);\n  });\n};\n\nAlignElements.prototype.postExecute = function(context) {\n\n};\n","import { some } from 'min-dash';\n\n\n/**\n * A handler that implements reversible appending of shapes\n * to a source shape.\n *\n * @param {canvas} Canvas\n * @param {elementFactory} ElementFactory\n * @param {modeling} Modeling\n */\nexport default function AppendShapeHandler(modeling) {\n  this._modeling = modeling;\n}\n\nAppendShapeHandler.$inject = [ 'modeling' ];\n\n\n// api //////////////////////\n\n\n/**\n * Creates a new shape\n *\n * @param {Object} context\n * @param {ElementDescriptor} context.shape the new shape\n * @param {ElementDescriptor} context.source the source object\n * @param {ElementDescriptor} context.parent the parent object\n * @param {Point} context.position position of the new element\n */\nAppendShapeHandler.prototype.preExecute = function(context) {\n\n  var source = context.source;\n\n  if (!source) {\n    throw new Error('source required');\n  }\n\n  var target = context.target || source.parent,\n      shape = context.shape,\n      hints = context.hints || {};\n\n  shape = context.shape =\n    this._modeling.createShape(\n      shape,\n      context.position,\n      target, { attach: hints.attach });\n\n  context.shape = shape;\n};\n\nAppendShapeHandler.prototype.postExecute = function(context) {\n  var hints = context.hints || {};\n\n  if (!existsConnection(context.source, context.shape)) {\n\n    // create connection\n    if (hints.connectionTarget === context.source) {\n      this._modeling.connect(context.shape, context.source, context.connection);\n    } else {\n      this._modeling.connect(context.source, context.shape, context.connection);\n    }\n  }\n};\n\n\nfunction existsConnection(source, target) {\n  return some(source.outgoing, function(c) {\n    return c.target === target;\n  });\n}","export default function CreateConnectionHandler(canvas, layouter) {\n  this._canvas = canvas;\n  this._layouter = layouter;\n}\n\nCreateConnectionHandler.$inject = [ 'canvas', 'layouter' ];\n\n\n// api //////////////////////\n\n\n/**\n * Appends a shape to a target shape\n *\n * @param {Object} context\n * @param {djs.element.Base} context.source the source object\n * @param {djs.element.Base} context.target the parent object\n * @param {Point} context.position position of the new element\n */\nCreateConnectionHandler.prototype.execute = function(context) {\n\n  var connection = context.connection,\n      source = context.source,\n      target = context.target,\n      parent = context.parent,\n      parentIndex = context.parentIndex,\n      hints = context.hints;\n\n  if (!source || !target) {\n    throw new Error('source and target required');\n  }\n\n  if (!parent) {\n    throw new Error('parent required');\n  }\n\n  connection.source = source;\n  connection.target = target;\n\n  if (!connection.waypoints) {\n    connection.waypoints = this._layouter.layoutConnection(connection, hints);\n  }\n\n  // add connection\n  this._canvas.addConnection(connection, parent, parentIndex);\n\n  return connection;\n};\n\nCreateConnectionHandler.prototype.revert = function(context) {\n  var connection = context.connection;\n\n  this._canvas.removeConnection(connection);\n\n  connection.source = null;\n  connection.target = null;\n\n  return connection;\n};","import {\r\n  assign,\r\n  forEach,\r\n  isNumber,\r\n  map,\r\n  pick,\r\n  values\r\n} from 'min-dash';\r\n\r\nimport {\r\n  getBBox,\r\n  getParents\r\n} from '../../../util/Elements';\r\n\r\nvar round = Math.round;\r\n\r\nexport default function CreateElementsHandler(modeling) {\r\n  this._modeling = modeling;\r\n}\r\n\r\nCreateElementsHandler.$inject = [\r\n  'modeling'\r\n];\r\n\r\nCreateElementsHandler.prototype.preExecute = function(context) {\r\n  var elements = context.elements,\r\n      parent = context.parent,\r\n      parentIndex = context.parentIndex,\r\n      position = context.position,\r\n      hints = context.hints;\r\n\r\n  var modeling = this._modeling;\r\n\r\n  // make sure each element has x and y\r\n  forEach(elements, function(element) {\r\n    if (!isNumber(element.x)) {\r\n      element.x = 0;\r\n    }\r\n\r\n    if (!isNumber(element.y)) {\r\n      element.y = 0;\r\n    }\r\n  });\r\n\r\n  var bbox = getBBox(elements);\r\n\r\n  // center elements around position\r\n  forEach(elements, function(element) {\r\n    if (isConnection(element)) {\r\n      element.waypoints = map(element.waypoints, function(waypoint) {\r\n        return {\r\n          x: round(waypoint.x - bbox.x - bbox.width / 2 + position.x),\r\n          y: round(waypoint.y - bbox.y - bbox.height / 2 + position.y)\r\n        };\r\n      });\r\n    }\r\n\r\n    assign(element, {\r\n      x: round(element.x - bbox.x - bbox.width / 2 + position.x),\r\n      y: round(element.y - bbox.y - bbox.height / 2 + position.y)\r\n    });\r\n  });\r\n\r\n  var parents = getParents(elements);\r\n\r\n  var cache = {};\r\n\r\n  forEach(elements, function(element) {\r\n    if (isConnection(element)) {\r\n      cache[ element.id ] = isNumber(parentIndex) ?\r\n        modeling.createConnection(\r\n          cache[ element.source.id ],\r\n          cache[ element.target.id ],\r\n          parentIndex,\r\n          element,\r\n          element.parent || parent,\r\n          hints\r\n        ) :\r\n        modeling.createConnection(\r\n          cache[ element.source.id ],\r\n          cache[ element.target.id ],\r\n          element,\r\n          element.parent || parent,\r\n          hints\r\n        );\r\n\r\n      return;\r\n    }\r\n\r\n    var createShapeHints = assign({}, hints);\r\n\r\n    if (parents.indexOf(element) === -1) {\r\n      createShapeHints.autoResize = false;\r\n    }\r\n\r\n    cache[ element.id ] = isNumber(parentIndex) ?\r\n      modeling.createShape(\r\n        element,\r\n        pick(element, [ 'x', 'y', 'width', 'height' ]),\r\n        element.parent || parent,\r\n        parentIndex,\r\n        createShapeHints\r\n      ) :\r\n      modeling.createShape(\r\n        element,\r\n        pick(element, [ 'x', 'y', 'width', 'height' ]),\r\n        element.parent || parent,\r\n        createShapeHints\r\n      );\r\n  });\r\n\r\n  context.elements = values(cache);\r\n};\r\n\r\n// helpers //////////\r\n\r\nfunction isConnection(element) {\r\n  return !!element.waypoints;\r\n}","import { assign } from 'min-dash';\n\nvar round = Math.round;\n\n\n/**\n * A handler that implements reversible addition of shapes.\n *\n * @param {canvas} Canvas\n */\nexport default function CreateShapeHandler(canvas) {\n  this._canvas = canvas;\n}\n\nCreateShapeHandler.$inject = [ 'canvas' ];\n\n\n// api //////////////////////\n\n\n/**\n * Appends a shape to a target shape\n *\n * @param {Object} context\n * @param {djs.model.Base} context.parent the parent object\n * @param {Point} context.position position of the new element\n */\nCreateShapeHandler.prototype.execute = function(context) {\n\n  var shape = context.shape,\n      positionOrBounds = context.position,\n      parent = context.parent,\n      parentIndex = context.parentIndex;\n\n  if (!parent) {\n    throw new Error('parent required');\n  }\n\n  if (!positionOrBounds) {\n    throw new Error('position required');\n  }\n\n  // (1) add at event center position _or_ at given bounds\n  if (positionOrBounds.width !== undefined) {\n    assign(shape, positionOrBounds);\n  } else {\n    assign(shape, {\n      x: positionOrBounds.x - round(shape.width / 2),\n      y: positionOrBounds.y - round(shape.height / 2)\n    });\n  }\n\n  // (2) add to canvas\n  this._canvas.addShape(shape, parent, parentIndex);\n\n  return shape;\n};\n\n\n/**\n * Undo append by removing the shape\n */\nCreateShapeHandler.prototype.revert = function(context) {\n\n  var shape = context.shape;\n\n  // (3) remove form canvas\n  this._canvas.removeShape(shape);\n\n  return shape;\n};","import inherits from 'inherits';\n\nimport CreateShapeHandler from './CreateShapeHandler';\n\n\n/**\n * A handler that attaches a label to a given target shape.\n *\n * @param {Canvas} canvas\n */\nexport default function CreateLabelHandler(canvas) {\n  CreateShapeHandler.call(this, canvas);\n}\n\ninherits(CreateLabelHandler, CreateShapeHandler);\n\nCreateLabelHandler.$inject = [ 'canvas' ];\n\n\n// api //////////////////////\n\n\nvar originalExecute = CreateShapeHandler.prototype.execute;\n\n/**\n * Appends a label to a target shape.\n *\n * @method CreateLabelHandler#execute\n *\n * @param {Object} context\n * @param {ElementDescriptor} context.target the element the label is attached to\n * @param {ElementDescriptor} context.parent the parent object\n * @param {Point} context.position position of the new element\n */\nCreateLabelHandler.prototype.execute = function(context) {\n\n  var label = context.shape;\n\n  ensureValidDimensions(label);\n\n  label.labelTarget = context.labelTarget;\n\n  return originalExecute.call(this, context);\n};\n\nvar originalRevert = CreateShapeHandler.prototype.revert;\n\n/**\n * Undo append by removing the shape\n */\nCreateLabelHandler.prototype.revert = function(context) {\n  context.shape.labelTarget = null;\n\n  return originalRevert.call(this, context);\n};\n\n\n// helpers //////////////////////\n\nfunction ensureValidDimensions(label) {\n\n  // make sure a label has valid { width, height } dimensions\n  [ 'width', 'height' ].forEach(function(prop) {\n    if (typeof label[prop] === 'undefined') {\n      label[prop] = 0;\n    }\n  });\n}","import {\n  add as collectionAdd,\n  indexOf as collectionIdx\n} from '../../../util/Collections';\n\n\n/**\n * A handler that implements reversible deletion of Connections.\n */\nexport default function DeleteConnectionHandler(canvas, modeling) {\n  this._canvas = canvas;\n  this._modeling = modeling;\n}\n\nDeleteConnectionHandler.$inject = [\n  'canvas',\n  'modeling'\n];\n\n\nDeleteConnectionHandler.prototype.execute = function(context) {\n\n  var connection = context.connection,\n      parent = connection.parent;\n\n  context.parent = parent;\n\n  // remember containment\n  context.parentIndex = collectionIdx(parent.children, connection);\n\n  context.source = connection.source;\n  context.target = connection.target;\n\n  this._canvas.removeConnection(connection);\n\n  connection.source = null;\n  connection.target = null;\n\n  return connection;\n};\n\n/**\n * Command revert implementation.\n */\nDeleteConnectionHandler.prototype.revert = function(context) {\n\n  var connection = context.connection,\n      parent = context.parent,\n      parentIndex = context.parentIndex;\n\n  connection.source = context.source;\n  connection.target = context.target;\n\n  // restore containment\n  collectionAdd(parent.children, connection, parentIndex);\n\n  this._canvas.addConnection(connection, parent);\n\n  return connection;\n};\n","import { forEach } from 'min-dash';\n\n\nexport default function DeleteElementsHandler(modeling, elementRegistry) {\n  this._modeling = modeling;\n  this._elementRegistry = elementRegistry;\n}\n\nDeleteElementsHandler.$inject = [\n  'modeling',\n  'elementRegistry'\n];\n\n\nDeleteElementsHandler.prototype.postExecute = function(context) {\n\n  var modeling = this._modeling,\n      elementRegistry = this._elementRegistry,\n      elements = context.elements;\n\n  forEach(elements, function(element) {\n\n    // element may have been removed with previous\n    // remove operations already (e.g. in case of nesting)\n    if (!elementRegistry.get(element.id)) {\n      return;\n    }\n\n    if (element.waypoints) {\n      modeling.removeConnection(element);\n    } else {\n      modeling.removeShape(element);\n    }\n  });\n};","import {\n  add as collectionAdd,\n  indexOf as collectionIdx\n} from '../../../util/Collections';\n\nimport { saveClear } from '../../../util/Removal';\n\n\n/**\n * A handler that implements reversible deletion of shapes.\n *\n */\nexport default function DeleteShapeHandler(canvas, modeling) {\n  this._canvas = canvas;\n  this._modeling = modeling;\n}\n\nDeleteShapeHandler.$inject = [ 'canvas', 'modeling' ];\n\n\n/**\n * - Remove connections\n * - Remove all direct children\n */\nDeleteShapeHandler.prototype.preExecute = function(context) {\n\n  var modeling = this._modeling;\n\n  var shape = context.shape;\n\n  // remove connections\n  saveClear(shape.incoming, function(connection) {\n\n    // To make sure that the connection isn't removed twice\n    // For example if a container is removed\n    modeling.removeConnection(connection, { nested: true });\n  });\n\n  saveClear(shape.outgoing, function(connection) {\n    modeling.removeConnection(connection, { nested: true });\n  });\n\n  // remove child shapes and connections\n  saveClear(shape.children, function(child) {\n    if (isConnection(child)) {\n      modeling.removeConnection(child, { nested: true });\n    } else {\n      modeling.removeShape(child, { nested: true });\n    }\n  });\n};\n\n/**\n * Remove shape and remember the parent\n */\nDeleteShapeHandler.prototype.execute = function(context) {\n  var canvas = this._canvas;\n\n  var shape = context.shape,\n      oldParent = shape.parent;\n\n  context.oldParent = oldParent;\n\n  // remove containment\n  context.oldParentIndex = collectionIdx(oldParent.children, shape);\n\n  // remove shape\n  canvas.removeShape(shape);\n\n  return shape;\n};\n\n\n/**\n * Command revert implementation\n */\nDeleteShapeHandler.prototype.revert = function(context) {\n\n  var canvas = this._canvas;\n\n  var shape = context.shape,\n      oldParent = context.oldParent,\n      oldParentIndex = context.oldParentIndex;\n\n  // restore containment\n  collectionAdd(oldParent.children, shape, oldParentIndex);\n\n  canvas.addShape(shape, oldParent);\n\n  return shape;\n};\n\nfunction isConnection(element) {\n  return element.waypoints;\n}\n","import {\n  forEach,\n  sortBy\n} from 'min-dash';\n\n\n/**\n * A handler that distributes elements evenly.\n */\nexport default function DistributeElements(modeling) {\n  this._modeling = modeling;\n}\n\nDistributeElements.$inject = [ 'modeling' ];\n\nvar OFF_AXIS = {\n  x: 'y',\n  y: 'x'\n};\n\nDistributeElements.prototype.preExecute = function(context) {\n  var modeling = this._modeling;\n\n  var groups = context.groups,\n      axis = context.axis,\n      dimension = context.dimension;\n\n  function updateRange(group, element) {\n    group.range.min = Math.min(element[axis], group.range.min);\n    group.range.max = Math.max(element[axis] + element[dimension], group.range.max);\n  }\n\n  function center(element) {\n    return element[axis] + element[dimension] / 2;\n  }\n\n  function lastIdx(arr) {\n    return arr.length - 1;\n  }\n\n  function rangeDiff(range) {\n    return range.max - range.min;\n  }\n\n  function centerElement(refCenter, element) {\n    var delta = { y: 0 };\n\n    delta[axis] = refCenter - center(element);\n\n    if (delta[axis]) {\n\n      delta[OFF_AXIS[axis]] = 0;\n\n      modeling.moveElements([ element ], delta, element.parent);\n    }\n  }\n\n  var firstGroup = groups[0],\n      lastGroupIdx = lastIdx(groups),\n      lastGroup = groups[ lastGroupIdx ];\n\n  var margin,\n      spaceInBetween,\n      groupsSize = 0; // the size of each range\n\n  forEach(groups, function(group, idx) {\n    var sortedElements,\n        refElem,\n        refCenter;\n\n    if (group.elements.length < 2) {\n      if (idx && idx !== groups.length - 1) {\n        updateRange(group, group.elements[0]);\n\n        groupsSize += rangeDiff(group.range);\n      }\n      return;\n    }\n\n    sortedElements = sortBy(group.elements, axis);\n\n    refElem = sortedElements[0];\n\n    if (idx === lastGroupIdx) {\n      refElem = sortedElements[lastIdx(sortedElements)];\n    }\n\n    refCenter = center(refElem);\n\n    // wanna update the ranges after the shapes have been centered\n    group.range = null;\n\n    forEach(sortedElements, function(element) {\n\n      centerElement(refCenter, element);\n\n      if (group.range === null) {\n        group.range = {\n          min: element[axis],\n          max: element[axis] + element[dimension]\n        };\n\n        return;\n      }\n\n      // update group's range after centering the range elements\n      updateRange(group, element);\n    });\n\n    if (idx && idx !== groups.length - 1) {\n      groupsSize += rangeDiff(group.range);\n    }\n  });\n\n  spaceInBetween = Math.abs(lastGroup.range.min - firstGroup.range.max);\n\n  margin = Math.round((spaceInBetween - groupsSize) / (groups.length - 1));\n\n  if (margin < groups.length - 1) {\n    return;\n  }\n\n  forEach(groups, function(group, groupIdx) {\n    var delta = {},\n        prevGroup;\n\n    if (group === firstGroup || group === lastGroup) {\n      return;\n    }\n\n    prevGroup = groups[groupIdx - 1];\n\n    group.range.max = 0;\n\n    forEach(group.elements, function(element, idx) {\n      delta[OFF_AXIS[axis]] = 0;\n      delta[axis] = (prevGroup.range.max - element[axis]) + margin;\n\n      if (group.range.min !== element[axis]) {\n        delta[axis] += element[axis] - group.range.min;\n      }\n\n      if (delta[axis]) {\n        modeling.moveElements([ element ], delta, element.parent);\n      }\n\n      group.range.max = Math.max(element[axis] + element[dimension], idx ? group.range.max : 0);\n    });\n  });\n};\n\nDistributeElements.prototype.postExecute = function(context) {\n\n};\n","import { assign } from 'min-dash';\n\n\n/**\n * A handler that implements reversible moving of shapes.\n */\nexport default function LayoutConnectionHandler(layouter, canvas) {\n  this._layouter = layouter;\n  this._canvas = canvas;\n}\n\nLayoutConnectionHandler.$inject = [ 'layouter', 'canvas' ];\n\nLayoutConnectionHandler.prototype.execute = function(context) {\n\n  var connection = context.connection;\n\n  var oldWaypoints = connection.waypoints;\n\n  assign(context, {\n    oldWaypoints: oldWaypoints\n  });\n\n  connection.waypoints = this._layouter.layoutConnection(connection, context.hints);\n\n  return connection;\n};\n\nLayoutConnectionHandler.prototype.revert = function(context) {\n\n  var connection = context.connection;\n\n  connection.waypoints = context.oldWaypoints;\n\n  return connection;\n};\n","import { forEach } from 'min-dash';\n\n\nimport {\n  add as collectionAdd,\n  remove as collectionRemove\n} from '../../../util/Collections';\n\n\n/**\n * A handler that implements reversible moving of connections.\n *\n * The handler differs from the layout connection handler in a sense\n * that it preserves the connection layout.\n */\nexport default function MoveConnectionHandler() { }\n\n\nMoveConnectionHandler.prototype.execute = function(context) {\n\n  var connection = context.connection,\n      delta = context.delta;\n\n  var newParent = context.newParent || connection.parent,\n      newParentIndex = context.newParentIndex,\n      oldParent = connection.parent;\n\n  // save old parent in context\n  context.oldParent = oldParent;\n  context.oldParentIndex = collectionRemove(oldParent.children, connection);\n\n  // add to new parent at position\n  collectionAdd(newParent.children, connection, newParentIndex);\n\n  // update parent\n  connection.parent = newParent;\n\n  // update waypoint positions\n  forEach(connection.waypoints, function(p) {\n    p.x += delta.x;\n    p.y += delta.y;\n\n    if (p.original) {\n      p.original.x += delta.x;\n      p.original.y += delta.y;\n    }\n  });\n\n  return connection;\n};\n\nMoveConnectionHandler.prototype.revert = function(context) {\n\n  var connection = context.connection,\n      newParent = connection.parent,\n      oldParent = context.oldParent,\n      oldParentIndex = context.oldParentIndex,\n      delta = context.delta;\n\n  // remove from newParent\n  collectionRemove(newParent.children, connection);\n\n  // restore previous location in old parent\n  collectionAdd(oldParent.children, connection, oldParentIndex);\n\n  // restore parent\n  connection.parent = oldParent;\n\n  // revert to old waypoint positions\n  forEach(connection.waypoints, function(p) {\n    p.x -= delta.x;\n    p.y -= delta.y;\n\n    if (p.original) {\n      p.original.x -= delta.x;\n      p.original.y -= delta.y;\n    }\n  });\n\n  return connection;\n};","import {\n  getNewAttachPoint\n} from '../../../../util/AttachUtil';\n\nimport {\n  getOrientation\n} from '../../../../layout/LayoutUtil';\n\nimport {\n  filter,\n  map\n} from 'min-dash';\n\n\nexport function getResizedSourceAnchor(connection, shape, oldBounds) {\n\n  var waypoints = safeGetWaypoints(connection),\n      waypointsInsideNewBounds = getWaypointsInsideBounds(waypoints, shape),\n      oldAnchor = waypoints[0];\n\n  // new anchor is the last waypoint enclosed be resized source\n  if (waypointsInsideNewBounds.length) {\n    return waypointsInsideNewBounds[ waypointsInsideNewBounds.length - 1 ];\n  }\n\n  return getNewAttachPoint(oldAnchor.original || oldAnchor, oldBounds, shape);\n}\n\n\nexport function getResizedTargetAnchor(connection, shape, oldBounds) {\n\n  var waypoints = safeGetWaypoints(connection),\n      waypointsInsideNewBounds = getWaypointsInsideBounds(waypoints, shape),\n      oldAnchor = waypoints[waypoints.length - 1];\n\n  // new anchor is the first waypoint enclosed be resized target\n  if (waypointsInsideNewBounds.length) {\n    return waypointsInsideNewBounds[ 0 ];\n  }\n\n  return getNewAttachPoint(oldAnchor.original || oldAnchor, oldBounds, shape);\n}\n\n\nexport function getMovedSourceAnchor(connection, source, moveDelta) {\n\n  var waypoints = safeGetWaypoints(connection),\n      oldBounds = subtract(source, moveDelta),\n      oldAnchor = waypoints[ 0 ];\n\n  return getNewAttachPoint(oldAnchor.original || oldAnchor, oldBounds, source);\n}\n\n\nexport function getMovedTargetAnchor(connection, target, moveDelta) {\n\n  var waypoints = safeGetWaypoints(connection),\n      oldBounds = subtract(target, moveDelta),\n      oldAnchor = waypoints[ waypoints.length - 1 ];\n\n  return getNewAttachPoint(oldAnchor.original || oldAnchor, oldBounds, target);\n}\n\n\n// helpers //////////////////////\n\nfunction subtract(bounds, delta) {\n  return {\n    x: bounds.x - delta.x,\n    y: bounds.y - delta.y,\n    width: bounds.width,\n    height: bounds.height\n  };\n}\n\n\n/**\n * Return waypoints of given connection; throw if non exists (should not happen!!).\n *\n * @param {Connection} connection\n *\n * @return {Array<Point>}\n */\nfunction safeGetWaypoints(connection) {\n\n  var waypoints = connection.waypoints;\n\n  if (!waypoints.length) {\n    throw new Error('connection#' + connection.id + ': no waypoints');\n  }\n\n  return waypoints;\n}\n\nfunction getWaypointsInsideBounds(waypoints, bounds) {\n  var originalWaypoints = map(waypoints, getOriginal);\n\n  return filter(originalWaypoints, function(waypoint) {\n    return isInsideBounds(waypoint, bounds);\n  });\n}\n\n/**\n * Checks if point is inside bounds, incl. edges.\n *\n * @param {Point} point\n * @param {Bounds} bounds\n */\nfunction isInsideBounds(point, bounds) {\n  return getOrientation(bounds, point, 1) === 'intersect';\n}\n\nfunction getOriginal(point) {\n  return point.original || point;\n}\n","import {\n  assign\n} from 'min-dash';\n\nimport {\n  getClosure\n} from '../../../../util/Elements';\n\n\nexport default function MoveClosure() {\n\n  this.allShapes = {};\n  this.allConnections = {};\n\n  this.enclosedElements = {};\n  this.enclosedConnections = {};\n\n  this.topLevel = {};\n}\n\n\nMoveClosure.prototype.add = function(element, isTopLevel) {\n  return this.addAll([ element ], isTopLevel);\n};\n\n\nMoveClosure.prototype.addAll = function(elements, isTopLevel) {\n\n  var newClosure = getClosure(elements, !!isTopLevel, this);\n\n  assign(this, newClosure);\n\n  return this;\n};","import {\n  forEach\n} from 'min-dash';\n\nimport {\n  getMovedSourceAnchor,\n  getMovedTargetAnchor\n} from './AnchorsHelper';\n\nimport MoveClosure from './MoveClosure';\n\n\n/**\n * A helper that is able to carry out serialized move\n * operations on multiple elements.\n *\n * @param {Modeling} modeling\n */\nexport default function MoveHelper(modeling) {\n  this._modeling = modeling;\n}\n\n/**\n * Move the specified elements and all children by the given delta.\n *\n * This moves all enclosed connections, too and layouts all affected\n * external connections.\n *\n * @param  {Array<djs.model.Base>} elements\n * @param  {Point} delta\n * @param  {djs.model.Base} newParent applied to the first level of shapes\n *\n * @return {Array<djs.model.Base>} list of touched elements\n */\nMoveHelper.prototype.moveRecursive = function(elements, delta, newParent) {\n  if (!elements) {\n    return [];\n  } else {\n    return this.moveClosure(this.getClosure(elements), delta, newParent);\n  }\n};\n\n/**\n * Move the given closure of elmements.\n *\n * @param {Object} closure\n * @param {Point} delta\n * @param {djs.model.Base} [newParent]\n * @param {djs.model.Base} [newHost]\n */\nMoveHelper.prototype.moveClosure = function(closure, delta, newParent, newHost, primaryShape) {\n  var modeling = this._modeling;\n\n  var allShapes = closure.allShapes,\n      allConnections = closure.allConnections,\n      enclosedConnections = closure.enclosedConnections,\n      topLevel = closure.topLevel,\n      keepParent = false;\n\n  if (primaryShape && primaryShape.parent === newParent) {\n    keepParent = true;\n  }\n\n  // move all shapes\n  forEach(allShapes, function(shape) {\n\n    // move the element according to the given delta\n    modeling.moveShape(shape, delta, topLevel[shape.id] && !keepParent && newParent, {\n      recurse: false,\n      layout: false\n    });\n  });\n\n  // move all child connections / layout external connections\n  forEach(allConnections, function(c) {\n\n    var sourceMoved = !!allShapes[c.source.id],\n        targetMoved = !!allShapes[c.target.id];\n\n    if (enclosedConnections[c.id] && sourceMoved && targetMoved) {\n      modeling.moveConnection(c, delta, topLevel[c.id] && !keepParent && newParent);\n    } else {\n      modeling.layoutConnection(c, {\n        connectionStart: sourceMoved && getMovedSourceAnchor(c, c.source, delta),\n        connectionEnd: targetMoved && getMovedTargetAnchor(c, c.target, delta)\n      });\n    }\n  });\n};\n\n/**\n * Returns the closure for the selected elements\n *\n * @param  {Array<djs.model.Base>} elements\n * @return {MoveClosure} closure\n */\nMoveHelper.prototype.getClosure = function(elements) {\n  return new MoveClosure().addAll(elements, true);\n};","import MoveHelper from './helper/MoveHelper';\n\n\n/**\n * A handler that implements reversible moving of shapes.\n */\nexport default function MoveElementsHandler(modeling) {\n  this._helper = new MoveHelper(modeling);\n}\n\nMoveElementsHandler.$inject = [ 'modeling' ];\n\nMoveElementsHandler.prototype.preExecute = function(context) {\n  context.closure = this._helper.getClosure(context.shapes);\n};\n\nMoveElementsHandler.prototype.postExecute = function(context) {\n\n  var hints = context.hints,\n      primaryShape;\n\n  if (hints && hints.primaryShape) {\n    primaryShape = hints.primaryShape;\n    hints.oldParent = primaryShape.parent;\n  }\n\n  this._helper.moveClosure(\n    context.closure,\n    context.delta,\n    context.newParent,\n    context.newHost,\n    primaryShape\n  );\n};","import {\n  assign,\n  forEach,\n  pick\n} from 'min-dash';\n\nimport MoveHelper from './helper/MoveHelper';\n\nimport {\n  add as collectionAdd,\n  remove as collectionRemove\n} from '../../../util/Collections';\n\nimport {\n  getMovedSourceAnchor,\n  getMovedTargetAnchor\n} from './helper/AnchorsHelper';\n\n\n/**\n * A handler that implements reversible moving of shapes.\n */\nexport default function MoveShapeHandler(modeling) {\n  this._modeling = modeling;\n\n  this._helper = new MoveHelper(modeling);\n}\n\nMoveShapeHandler.$inject = [ 'modeling' ];\n\n\nMoveShapeHandler.prototype.execute = function(context) {\n\n  var shape = context.shape,\n      delta = context.delta,\n      newParent = context.newParent || shape.parent,\n      newParentIndex = context.newParentIndex,\n      oldParent = shape.parent;\n\n  context.oldBounds = pick(shape, [ 'x', 'y', 'width', 'height']);\n\n  // save old parent in context\n  context.oldParent = oldParent;\n  context.oldParentIndex = collectionRemove(oldParent.children, shape);\n\n  // add to new parent at position\n  collectionAdd(newParent.children, shape, newParentIndex);\n\n  // update shape parent + position\n  assign(shape, {\n    parent: newParent,\n    x: shape.x + delta.x,\n    y: shape.y + delta.y\n  });\n\n  return shape;\n};\n\nMoveShapeHandler.prototype.postExecute = function(context) {\n\n  var shape = context.shape,\n      delta = context.delta,\n      hints = context.hints;\n\n  var modeling = this._modeling;\n\n  if (hints.layout !== false) {\n\n    forEach(shape.incoming, function(c) {\n      modeling.layoutConnection(c, {\n        connectionEnd: getMovedTargetAnchor(c, shape, delta)\n      });\n    });\n\n    forEach(shape.outgoing, function(c) {\n      modeling.layoutConnection(c, {\n        connectionStart: getMovedSourceAnchor(c, shape, delta)\n      });\n    });\n  }\n\n  if (hints.recurse !== false) {\n    this.moveChildren(context);\n  }\n};\n\nMoveShapeHandler.prototype.revert = function(context) {\n\n  var shape = context.shape,\n      oldParent = context.oldParent,\n      oldParentIndex = context.oldParentIndex,\n      delta = context.delta;\n\n  // restore previous location in old parent\n  collectionAdd(oldParent.children, shape, oldParentIndex);\n\n  // revert to old position and parent\n  assign(shape, {\n    parent: oldParent,\n    x: shape.x - delta.x,\n    y: shape.y - delta.y\n  });\n\n  return shape;\n};\n\nMoveShapeHandler.prototype.moveChildren = function(context) {\n\n  var delta = context.delta,\n      shape = context.shape;\n\n  this._helper.moveRecursive(shape.children, delta, null);\n};\n\nMoveShapeHandler.prototype.getNewParent = function(context) {\n  return context.newParent || context.shape.parent;\n};\n","import { isArray } from 'min-dash';\n\n\n/**\n * Reconnect connection handler\n */\nexport default function ReconnectConnectionHandler(modeling) {\n  this._modeling = modeling;\n}\n\nReconnectConnectionHandler.$inject = [ 'modeling' ];\n\nReconnectConnectionHandler.prototype.execute = function(context) {\n  var newSource = context.newSource,\n      newTarget = context.newTarget,\n      connection = context.connection,\n      dockingOrPoints = context.dockingOrPoints;\n\n  if (!newSource && !newTarget) {\n    throw new Error('newSource or newTarget required');\n  }\n\n  if (isArray(dockingOrPoints)) {\n    context.oldWaypoints = connection.waypoints;\n    connection.waypoints = dockingOrPoints;\n  }\n\n  if (newSource) {\n    context.oldSource = connection.source;\n    connection.source = newSource;\n  }\n\n  if (newTarget) {\n    context.oldTarget = connection.target;\n    connection.target = newTarget;\n  }\n\n  return connection;\n};\n\nReconnectConnectionHandler.prototype.postExecute = function(context) {\n  var connection = context.connection,\n      newSource = context.newSource,\n      newTarget = context.newTarget,\n      dockingOrPoints = context.dockingOrPoints,\n      hints = context.hints || {};\n\n  var layoutConnectionHints = {};\n\n  if (hints.connectionStart) {\n    layoutConnectionHints.connectionStart = hints.connectionStart;\n  }\n\n  if (hints.connectionEnd) {\n    layoutConnectionHints.connectionEnd = hints.connectionEnd;\n  }\n\n  if (hints.layoutConnection === false) {\n    return;\n  }\n\n  if (newSource && (!newTarget || hints.docking === 'source')) {\n    layoutConnectionHints.connectionStart = layoutConnectionHints.connectionStart\n      || getDocking(isArray(dockingOrPoints) ? dockingOrPoints[ 0 ] : dockingOrPoints);\n  }\n\n  if (newTarget && (!newSource || hints.docking === 'target')) {\n    layoutConnectionHints.connectionEnd = layoutConnectionHints.connectionEnd\n      || getDocking(isArray(dockingOrPoints) ? dockingOrPoints[ dockingOrPoints.length - 1 ] : dockingOrPoints);\n  }\n\n  if (hints.newWaypoints) {\n    layoutConnectionHints.waypoints = hints.newWaypoints;\n  }\n\n  this._modeling.layoutConnection(connection, layoutConnectionHints);\n};\n\nReconnectConnectionHandler.prototype.revert = function(context) {\n  var oldSource = context.oldSource,\n      oldTarget = context.oldTarget,\n      oldWaypoints = context.oldWaypoints,\n      connection = context.connection;\n\n  if (oldSource) {\n    connection.source = oldSource;\n  }\n\n  if (oldTarget) {\n    connection.target = oldTarget;\n  }\n\n  if (oldWaypoints) {\n    connection.waypoints = oldWaypoints;\n  }\n\n  return connection;\n};\n\n\n\n// helpers //////////\n\nfunction getDocking(point) {\n  return point.original || point;\n}","import { forEach } from 'min-dash';\n\nimport {\n  getResizedSourceAnchor,\n  getResizedTargetAnchor\n} from './helper/AnchorsHelper';\n\n/**\n * Replace shape by adding new shape and removing old shape. Incoming and outgoing connections will\n * be kept if possible.\n *\n * @class\n * @constructor\n *\n * @param {Modeling} modeling\n * @param {Rules} rules\n */\nexport default function ReplaceShapeHandler(modeling, rules) {\n  this._modeling = modeling;\n  this._rules = rules;\n}\n\nReplaceShapeHandler.$inject = [ 'modeling', 'rules' ];\n\n\n/**\n * Add new shape.\n *\n * @param {Object} context\n * @param {djs.model.Shape} context.oldShape\n * @param {Object} context.newData\n * @param {string} context.newData.type\n * @param {number} context.newData.x\n * @param {number} context.newData.y\n * @param {Object} [hints]\n */\nReplaceShapeHandler.prototype.preExecute = function(context) {\n  var self = this,\n      modeling = this._modeling,\n      rules = this._rules;\n\n  var oldShape = context.oldShape,\n      newData = context.newData,\n      hints = context.hints || {},\n      newShape;\n\n  function canReconnect(source, target, connection) {\n    return rules.allowed('connection.reconnect', {\n      connection: connection,\n      source: source,\n      target: target\n    });\n  }\n\n  // (1) add new shape at given position\n  var position = {\n    x: newData.x,\n    y: newData.y\n  };\n\n  var oldBounds = {\n    x: oldShape.x,\n    y: oldShape.y,\n    width: oldShape.width,\n    height: oldShape.height\n  };\n\n  newShape = context.newShape =\n    context.newShape ||\n    self.createShape(newData, position, oldShape.parent, hints);\n\n  // (2) update host\n  if (oldShape.host) {\n    modeling.updateAttachment(newShape, oldShape.host);\n  }\n\n  // (3) adopt all children from old shape\n  var children;\n\n  if (hints.moveChildren !== false) {\n    children = oldShape.children.slice();\n\n    modeling.moveElements(children, { x: 0, y: 0 }, newShape, hints);\n  }\n\n  // (4) reconnect connections to new shape if possible\n  var incoming = oldShape.incoming.slice(),\n      outgoing = oldShape.outgoing.slice();\n\n  forEach(incoming, function(connection) {\n    var source = connection.source,\n        allowed = canReconnect(source, newShape, connection);\n\n    if (allowed) {\n      self.reconnectEnd(\n        connection, newShape,\n        getResizedTargetAnchor(connection, newShape, oldBounds),\n        hints\n      );\n    }\n  });\n\n  forEach(outgoing, function(connection) {\n    var target = connection.target,\n        allowed = canReconnect(newShape, target, connection);\n\n    if (allowed) {\n      self.reconnectStart(\n        connection, newShape,\n        getResizedSourceAnchor(connection, newShape, oldBounds),\n        hints\n      );\n    }\n  });\n};\n\n\n/**\n * Remove old shape.\n */\nReplaceShapeHandler.prototype.postExecute = function(context) {\n  var oldShape = context.oldShape;\n\n  this._modeling.removeShape(oldShape);\n};\n\n\nReplaceShapeHandler.prototype.execute = function(context) {};\n\n\nReplaceShapeHandler.prototype.revert = function(context) {};\n\n\nReplaceShapeHandler.prototype.createShape = function(shape, position, target, hints) {\n  return this._modeling.createShape(shape, position, target, hints);\n};\n\n\nReplaceShapeHandler.prototype.reconnectStart = function(connection, newSource, dockingPoint, hints) {\n  this._modeling.reconnectStart(connection, newSource, dockingPoint, hints);\n};\n\n\nReplaceShapeHandler.prototype.reconnectEnd = function(connection, newTarget, dockingPoint, hints) {\n  this._modeling.reconnectEnd(connection, newTarget, dockingPoint, hints);\n};\n","import {\n  assign,\n  forEach\n} from 'min-dash';\n\nimport {\n  getResizedSourceAnchor,\n  getResizedTargetAnchor\n} from './helper/AnchorsHelper';\n\n\n/**\n * A handler that implements reversible resizing of shapes.\n *\n * @param {Modeling} modeling\n */\nexport default function ResizeShapeHandler(modeling) {\n  this._modeling = modeling;\n}\n\nResizeShapeHandler.$inject = [ 'modeling' ];\n\n/**\n * {\n *   shape: {....}\n *   newBounds: {\n *     width:  20,\n *     height: 40,\n *     x:       5,\n *     y:      10\n *   }\n *\n * }\n */\nResizeShapeHandler.prototype.execute = function(context) {\n  var shape = context.shape,\n      newBounds = context.newBounds,\n      minBounds = context.minBounds;\n\n  if (newBounds.x === undefined || newBounds.y === undefined ||\n      newBounds.width === undefined || newBounds.height === undefined) {\n    throw new Error('newBounds must have {x, y, width, height} properties');\n  }\n\n  if (minBounds && (newBounds.width < minBounds.width\n    || newBounds.height < minBounds.height)) {\n    throw new Error('width and height cannot be less than minimum height and width');\n  } else if (!minBounds\n    && newBounds.width < 10 || newBounds.height < 10) {\n    throw new Error('width and height cannot be less than 10px');\n  }\n\n  // save old bbox in context\n  context.oldBounds = {\n    width:  shape.width,\n    height: shape.height,\n    x:      shape.x,\n    y:      shape.y\n  };\n\n  // update shape\n  assign(shape, {\n    width:  newBounds.width,\n    height: newBounds.height,\n    x:      newBounds.x,\n    y:      newBounds.y\n  });\n\n  return shape;\n};\n\nResizeShapeHandler.prototype.postExecute = function(context) {\n  var modeling = this._modeling;\n\n  var shape = context.shape,\n      oldBounds = context.oldBounds,\n      hints = context.hints || {};\n\n  if (hints.layout === false) {\n    return;\n  }\n\n  forEach(shape.incoming, function(c) {\n    modeling.layoutConnection(c, {\n      connectionEnd: getResizedTargetAnchor(c, shape, oldBounds)\n    });\n  });\n\n  forEach(shape.outgoing, function(c) {\n    modeling.layoutConnection(c, {\n      connectionStart: getResizedSourceAnchor(c, shape, oldBounds)\n    });\n  });\n\n};\n\nResizeShapeHandler.prototype.revert = function(context) {\n\n  var shape = context.shape,\n      oldBounds = context.oldBounds;\n\n  // restore previous bbox\n  assign(shape, {\n    width:  oldBounds.width,\n    height: oldBounds.height,\n    x:      oldBounds.x,\n    y:      oldBounds.y\n  });\n\n  return shape;\n};\n","import {\n  assign,\n  forEach,\n  map\n} from 'min-dash';\n\nimport {\n  getWaypointsUpdatingConnections,\n  resizeBounds\n} from '../../space-tool/SpaceUtil';\n\nimport {\n  getMovedSourceAnchor,\n  getMovedTargetAnchor,\n  getResizedSourceAnchor,\n  getResizedTargetAnchor\n} from './helper/AnchorsHelper';\n\n\n/**\n * Add or remove space by moving and resizing shapes and updating connection waypoints.\n */\nexport default function SpaceToolHandler(modeling) {\n  this._modeling = modeling;\n}\n\nSpaceToolHandler.$inject = [ 'modeling' ];\n\nSpaceToolHandler.prototype.preExecute = function(context) {\n  var delta = context.delta,\n      direction = context.direction,\n      movingShapes = context.movingShapes,\n      resizingShapes = context.resizingShapes,\n      start = context.start,\n      oldBounds = {};\n\n  // (1) move shapes\n  this.moveShapes(movingShapes, delta);\n\n  // (2a) save old bounds of resized shapes\n  forEach(resizingShapes, function(shape) {\n    oldBounds[shape.id] = getBounds(shape);\n  });\n\n  // (2b) resize shapes\n  this.resizeShapes(resizingShapes, delta, direction);\n\n  // (3) update connection waypoints\n  this.updateConnectionWaypoints(\n    getWaypointsUpdatingConnections(movingShapes, resizingShapes),\n    delta,\n    direction,\n    start,\n    movingShapes,\n    resizingShapes,\n    oldBounds\n  );\n};\n\nSpaceToolHandler.prototype.execute = function() {};\nSpaceToolHandler.prototype.revert = function() {};\n\nSpaceToolHandler.prototype.moveShapes = function(shapes, delta) {\n  var self = this;\n\n  forEach(shapes, function(element) {\n    self._modeling.moveShape(element, delta, null, {\n      autoResize: false,\n      layout: false,\n      recurse: false\n    });\n  });\n};\n\nSpaceToolHandler.prototype.resizeShapes = function(shapes, delta, direction) {\n  var self = this;\n\n  forEach(shapes, function(shape) {\n    var newBounds = resizeBounds(shape, direction, delta);\n\n    self._modeling.resizeShape(shape, newBounds, null, {\n      attachSupport: false,\n      autoResize: false,\n      layout: false\n    });\n  });\n};\n\n/**\n * Update connections waypoints according to the rules:\n *   1. Both source and target are moved/resized => move waypoints by the delta\n *   2. Only one of source and target is moved/resized => re-layout connection with moved start/end\n */\nSpaceToolHandler.prototype.updateConnectionWaypoints = function(\n    connections,\n    delta,\n    direction,\n    start,\n    movingShapes,\n    resizingShapes,\n    oldBounds\n) {\n  var self = this,\n      affectedShapes = movingShapes.concat(resizingShapes);\n\n  forEach(connections, function(connection) {\n    var source = connection.source,\n        target = connection.target,\n        waypoints = copyWaypoints(connection),\n        axis = getAxisFromDirection(direction),\n        layoutHints = {\n          labelBehavior: false\n        };\n\n    if (includes(affectedShapes, source) && includes(affectedShapes, target)) {\n\n      // move waypoints\n      waypoints = map(waypoints, function(waypoint) {\n        if (shouldMoveWaypoint(waypoint, start, direction)) {\n\n          // move waypoint\n          waypoint[ axis ] = waypoint[ axis ] + delta[ axis ];\n        }\n\n        if (waypoint.original && shouldMoveWaypoint(waypoint.original, start, direction)) {\n\n          // move waypoint original\n          waypoint.original[ axis ] = waypoint.original[ axis ] + delta[ axis ];\n        }\n\n        return waypoint;\n      });\n\n      self._modeling.updateWaypoints(connection, waypoints, {\n        labelBehavior: false\n      });\n    } else if (includes(affectedShapes, source) || includes(affectedShapes, target)) {\n\n      // re-layout connection with moved start/end\n      if (includes(movingShapes, source)) {\n        layoutHints.connectionStart = getMovedSourceAnchor(connection, source, delta);\n      } else if (includes(movingShapes, target)) {\n        layoutHints.connectionEnd = getMovedTargetAnchor(connection, target, delta);\n      } else if (includes(resizingShapes, source)) {\n        layoutHints.connectionStart = getResizedSourceAnchor(\n          connection, source, oldBounds[source.id]\n        );\n      } else if (includes(resizingShapes, target)) {\n        layoutHints.connectionEnd = getResizedTargetAnchor(\n          connection, target, oldBounds[target.id]\n        );\n      }\n\n      self._modeling.layoutConnection(connection, layoutHints);\n    }\n  });\n};\n\n\n// helpers //////////\n\nfunction copyWaypoint(waypoint) {\n  return assign({}, waypoint);\n}\n\nfunction copyWaypoints(connection) {\n  return map(connection.waypoints, function(waypoint) {\n\n    waypoint = copyWaypoint(waypoint);\n\n    if (waypoint.original) {\n      waypoint.original = copyWaypoint(waypoint.original);\n    }\n\n    return waypoint;\n  });\n}\n\nfunction getAxisFromDirection(direction) {\n  switch (direction) {\n  case 'n':\n    return 'y';\n  case 'w':\n    return 'x';\n  case 's':\n    return 'y';\n  case 'e':\n    return 'x';\n  }\n}\n\nfunction shouldMoveWaypoint(waypoint, start, direction) {\n  var relevantAxis = getAxisFromDirection(direction);\n\n  if (/e|s/.test(direction)) {\n    return waypoint[ relevantAxis ] > start;\n  } else if (/n|w/.test(direction)) {\n    return waypoint[ relevantAxis ] < start;\n  }\n}\n\nfunction includes(array, item) {\n  return array.indexOf(item) !== -1;\n}\n\nfunction getBounds(shape) {\n  return {\n    x: shape.x,\n    y: shape.y,\n    height: shape.height,\n    width: shape.width\n  };\n}\n","import {\n  assign,\n  forEach\n} from 'min-dash';\n\n/**\n * A handler that toggles the collapsed state of an element\n * and the visibility of all its children.\n *\n * @param {Modeling} modeling\n */\nexport default function ToggleShapeCollapseHandler(modeling) {\n  this._modeling = modeling;\n}\n\nToggleShapeCollapseHandler.$inject = [ 'modeling' ];\n\n\nToggleShapeCollapseHandler.prototype.execute = function(context) {\n\n  var shape = context.shape,\n      children = shape.children;\n\n  // recursively remember previous visibility of children\n  context.oldChildrenVisibility = getElementsVisibilityRecursive(children);\n\n  // toggle state\n  shape.collapsed = !shape.collapsed;\n\n  // recursively hide/show children\n  var result = setHiddenRecursive(children, shape.collapsed);\n\n  return [shape].concat(result);\n};\n\n\nToggleShapeCollapseHandler.prototype.revert = function(context) {\n\n  var shape = context.shape,\n      oldChildrenVisibility = context.oldChildrenVisibility;\n\n  var children = shape.children;\n\n  // recursively set old visability of children\n  var result = restoreVisibilityRecursive(children, oldChildrenVisibility);\n\n  // retoggle state\n  shape.collapsed = !shape.collapsed;\n\n  return [shape].concat(result);\n};\n\n\n// helpers //////////////////////\n\n/**\n * Return a map { elementId -> hiddenState}.\n *\n * @param {Array<djs.model.Shape>} elements\n *\n * @return {Object}\n */\nfunction getElementsVisibilityRecursive(elements) {\n\n  var result = {};\n\n  forEach(elements, function(element) {\n    result[element.id] = element.hidden;\n\n    if (element.children) {\n      result = assign({}, result, getElementsVisibilityRecursive(element.children));\n    }\n  });\n\n  return result;\n}\n\n\nfunction setHiddenRecursive(elements, newHidden) {\n  var result = [];\n  forEach(elements, function(element) {\n    element.hidden = newHidden;\n\n    result = result.concat(element);\n\n    if (element.children) {\n      result = result.concat(setHiddenRecursive(element.children, element.collapsed || newHidden));\n    }\n  });\n\n  return result;\n}\n\nfunction restoreVisibilityRecursive(elements, lastState) {\n  var result = [];\n  forEach(elements, function(element) {\n    element.hidden = lastState[element.id];\n\n    result = result.concat(element);\n\n    if (element.children) {\n      result = result.concat(restoreVisibilityRecursive(element.children, lastState));\n    }\n  });\n\n  return result;\n}\n","import {\n  add as collectionAdd,\n  remove as collectionRemove\n} from '../../../util/Collections';\n\n/**\n * A handler that implements reversible attaching/detaching of shapes.\n */\nexport default function UpdateAttachmentHandler(modeling) {\n  this._modeling = modeling;\n}\n\nUpdateAttachmentHandler.$inject = [ 'modeling' ];\n\n\nUpdateAttachmentHandler.prototype.execute = function(context) {\n  var shape = context.shape,\n      newHost = context.newHost,\n      oldHost = shape.host;\n\n  // (0) detach from old host\n  context.oldHost = oldHost;\n  context.attacherIdx = removeAttacher(oldHost, shape);\n\n  // (1) attach to new host\n  addAttacher(newHost, shape);\n\n  // (2) update host\n  shape.host = newHost;\n\n  return shape;\n};\n\nUpdateAttachmentHandler.prototype.revert = function(context) {\n  var shape = context.shape,\n      newHost = context.newHost,\n      oldHost = context.oldHost,\n      attacherIdx = context.attacherIdx;\n\n  // (2) update host\n  shape.host = oldHost;\n\n  // (1) attach to new host\n  removeAttacher(newHost, shape);\n\n  // (0) detach from old host\n  addAttacher(oldHost, shape, attacherIdx);\n\n  return shape;\n};\n\n\nfunction removeAttacher(host, attacher) {\n\n  // remove attacher from host\n  return collectionRemove(host && host.attachers, attacher);\n}\n\nfunction addAttacher(host, attacher, idx) {\n\n  if (!host) {\n    return;\n  }\n\n  var attachers = host.attachers;\n\n  if (!attachers) {\n    host.attachers = attachers = [];\n  }\n\n  collectionAdd(attachers, attacher, idx);\n}\n","export default function UpdateWaypointsHandler() { }\n\nUpdateWaypointsHandler.prototype.execute = function(context) {\n\n  var connection = context.connection,\n      newWaypoints = context.newWaypoints;\n\n  context.oldWaypoints = connection.waypoints;\n\n  connection.waypoints = newWaypoints;\n\n  return connection;\n};\n\nUpdateWaypointsHandler.prototype.revert = function(context) {\n\n  var connection = context.connection,\n      oldWaypoints = context.oldWaypoints;\n\n  connection.waypoints = oldWaypoints;\n\n  return connection;\n};","import {\n  assign,\n  forEach,\n  isArray\n} from 'min-dash';\n\nimport {\n  Base\n} from '../../model';\n\nimport AlignElementsHandler from './cmd/AlignElementsHandler';\nimport AppendShapeHandler from './cmd/AppendShapeHandler';\nimport CreateConnectionHandler from './cmd/CreateConnectionHandler';\nimport CreateElementsHandler from './cmd/CreateElementsHandler';\nimport CreateLabelHandler from './cmd/CreateLabelHandler';\nimport CreateShapeHandler from './cmd/CreateShapeHandler';\nimport DeleteConnectionHandler from './cmd/DeleteConnectionHandler';\nimport DeleteElementsHandler from './cmd/DeleteElementsHandler';\nimport DeleteShapeHandler from './cmd/DeleteShapeHandler';\nimport DistributeElementsHandler from './cmd/DistributeElementsHandler';\nimport LayoutConnectionHandler from './cmd/LayoutConnectionHandler';\nimport MoveConnectionHandler from './cmd/MoveConnectionHandler';\nimport MoveElementsHandler from './cmd/MoveElementsHandler';\nimport MoveShapeHandler from './cmd/MoveShapeHandler';\nimport ReconnectConnectionHandler from './cmd/ReconnectConnectionHandler';\nimport ReplaceShapeHandler from './cmd/ReplaceShapeHandler';\nimport ResizeShapeHandler from './cmd/ResizeShapeHandler';\nimport SpaceToolHandler from './cmd/SpaceToolHandler';\nimport ToggleShapeCollapseHandler from './cmd/ToggleShapeCollapseHandler';\nimport UpdateAttachmentHandler from './cmd/UpdateAttachmentHandler';\nimport UpdateWaypointsHandler from './cmd/UpdateWaypointsHandler';\n\n\n/**\n * The basic modeling entry point.\n *\n * @param {EventBus} eventBus\n * @param {ElementFactory} elementFactory\n * @param {CommandStack} commandStack\n */\nexport default function Modeling(eventBus, elementFactory, commandStack) {\n  this._eventBus = eventBus;\n  this._elementFactory = elementFactory;\n  this._commandStack = commandStack;\n\n  var self = this;\n\n  eventBus.on('diagram.init', function() {\n\n    // register modeling handlers\n    self.registerHandlers(commandStack);\n  });\n}\n\nModeling.$inject = [ 'eventBus', 'elementFactory', 'commandStack' ];\n\n\nModeling.prototype.getHandlers = function() {\n  return {\n    'shape.append': AppendShapeHandler,\n    'shape.create': CreateShapeHandler,\n    'shape.delete': DeleteShapeHandler,\n    'shape.move': MoveShapeHandler,\n    'shape.resize': ResizeShapeHandler,\n    'shape.replace': ReplaceShapeHandler,\n    'shape.toggleCollapse': ToggleShapeCollapseHandler,\n\n    'spaceTool': SpaceToolHandler,\n\n    'label.create': CreateLabelHandler,\n\n    'connection.create': CreateConnectionHandler,\n    'connection.delete': DeleteConnectionHandler,\n    'connection.move': MoveConnectionHandler,\n    'connection.layout': LayoutConnectionHandler,\n\n    'connection.updateWaypoints': UpdateWaypointsHandler,\n\n    'connection.reconnect': ReconnectConnectionHandler,\n\n    'elements.create': CreateElementsHandler,\n    'elements.move': MoveElementsHandler,\n    'elements.delete': DeleteElementsHandler,\n\n    'elements.distribute': DistributeElementsHandler,\n    'elements.align': AlignElementsHandler,\n\n    'element.updateAttachment': UpdateAttachmentHandler\n  };\n};\n\n/**\n * Register handlers with the command stack\n *\n * @param {CommandStack} commandStack\n */\nModeling.prototype.registerHandlers = function(commandStack) {\n  forEach(this.getHandlers(), function(handler, id) {\n    commandStack.registerHandler(id, handler);\n  });\n};\n\n\n// modeling helpers //////////////////////\n\nModeling.prototype.moveShape = function(shape, delta, newParent, newParentIndex, hints) {\n\n  if (typeof newParentIndex === 'object') {\n    hints = newParentIndex;\n    newParentIndex = null;\n  }\n\n  var context = {\n    shape: shape,\n    delta:  delta,\n    newParent: newParent,\n    newParentIndex: newParentIndex,\n    hints: hints || {}\n  };\n\n  this._commandStack.execute('shape.move', context);\n};\n\n\n/**\n * Update the attachment of the given shape.\n *\n * @param {djs.mode.Base} shape\n * @param {djs.model.Base} [newHost]\n */\nModeling.prototype.updateAttachment = function(shape, newHost) {\n  var context = {\n    shape: shape,\n    newHost: newHost\n  };\n\n  this._commandStack.execute('element.updateAttachment', context);\n};\n\n\n/**\n * Move a number of shapes to a new target, either setting it as\n * the new parent or attaching it.\n *\n * @param {Array<djs.mode.Base>} shapes\n * @param {Point} delta\n * @param {djs.model.Base} [target]\n * @param {Object} [hints]\n * @param {boolean} [hints.attach=false]\n */\nModeling.prototype.moveElements = function(shapes, delta, target, hints) {\n\n  hints = hints || {};\n\n  var attach = hints.attach;\n\n  var newParent = target,\n      newHost;\n\n  if (attach === true) {\n    newHost = target;\n    newParent = target.parent;\n  } else\n\n  if (attach === false) {\n    newHost = null;\n  }\n\n  var context = {\n    shapes: shapes,\n    delta: delta,\n    newParent: newParent,\n    newHost: newHost,\n    hints: hints\n  };\n\n  this._commandStack.execute('elements.move', context);\n};\n\n\nModeling.prototype.moveConnection = function(connection, delta, newParent, newParentIndex, hints) {\n\n  if (typeof newParentIndex === 'object') {\n    hints = newParentIndex;\n    newParentIndex = undefined;\n  }\n\n  var context = {\n    connection: connection,\n    delta: delta,\n    newParent: newParent,\n    newParentIndex: newParentIndex,\n    hints: hints || {}\n  };\n\n  this._commandStack.execute('connection.move', context);\n};\n\n\nModeling.prototype.layoutConnection = function(connection, hints) {\n  var context = {\n    connection: connection,\n    hints: hints || {}\n  };\n\n  this._commandStack.execute('connection.layout', context);\n};\n\n\n/**\n * Create connection.\n *\n * @param {djs.model.Base} source\n * @param {djs.model.Base} target\n * @param {number} [parentIndex]\n * @param {Object|djs.model.Connection} connection\n * @param {djs.model.Base} parent\n * @param {Object} hints\n *\n * @return {djs.model.Connection} the created connection.\n */\nModeling.prototype.createConnection = function(source, target, parentIndex, connection, parent, hints) {\n\n  if (typeof parentIndex === 'object') {\n    hints = parent;\n    parent = connection;\n    connection = parentIndex;\n    parentIndex = undefined;\n  }\n\n  connection = this._create('connection', connection);\n\n  var context = {\n    source: source,\n    target: target,\n    parent: parent,\n    parentIndex: parentIndex,\n    connection: connection,\n    hints: hints\n  };\n\n  this._commandStack.execute('connection.create', context);\n\n  return context.connection;\n};\n\n\n/**\n * Create a shape at the specified position.\n *\n * @param {djs.model.Shape|Object} shape\n * @param {Point} position\n * @param {djs.model.Shape|djs.model.Root} target\n * @param {number} [parentIndex] position in parents children list\n * @param {Object} [hints]\n * @param {boolean} [hints.attach] whether to attach to target or become a child\n *\n * @return {djs.model.Shape} the created shape\n */\nModeling.prototype.createShape = function(shape, position, target, parentIndex, hints) {\n\n  if (typeof parentIndex !== 'number') {\n    hints = parentIndex;\n    parentIndex = undefined;\n  }\n\n  hints = hints || {};\n\n  var attach = hints.attach,\n      parent,\n      host;\n\n  shape = this._create('shape', shape);\n\n  if (attach) {\n    parent = target.parent;\n    host = target;\n  } else {\n    parent = target;\n  }\n\n  var context = {\n    position: position,\n    shape: shape,\n    parent: parent,\n    parentIndex: parentIndex,\n    host: host,\n    hints: hints\n  };\n\n  this._commandStack.execute('shape.create', context);\n\n  return context.shape;\n};\n\n\nModeling.prototype.createElements = function(elements, position, parent, parentIndex, hints) {\n  if (!isArray(elements)) {\n    elements = [ elements ];\n  }\n\n  if (typeof parentIndex !== 'number') {\n    hints = parentIndex;\n    parentIndex = undefined;\n  }\n\n  hints = hints || {};\n\n  var context = {\n    position: position,\n    elements: elements,\n    parent: parent,\n    parentIndex: parentIndex,\n    hints: hints\n  };\n\n  this._commandStack.execute('elements.create', context);\n\n  return context.elements;\n};\n\n\nModeling.prototype.createLabel = function(labelTarget, position, label, parent) {\n\n  label = this._create('label', label);\n\n  var context = {\n    labelTarget: labelTarget,\n    position: position,\n    parent: parent || labelTarget.parent,\n    shape: label\n  };\n\n  this._commandStack.execute('label.create', context);\n\n  return context.shape;\n};\n\n\n/**\n * Append shape to given source, drawing a connection\n * between source and the newly created shape.\n *\n * @param {djs.model.Shape} source\n * @param {djs.model.Shape|Object} shape\n * @param {Point} position\n * @param {djs.model.Shape} target\n * @param {Object} [hints]\n * @param {boolean} [hints.attach]\n * @param {djs.model.Connection|Object} [hints.connection]\n * @param {djs.model.Base} [hints.connectionParent]\n *\n * @return {djs.model.Shape} the newly created shape\n */\nModeling.prototype.appendShape = function(source, shape, position, target, hints) {\n\n  hints = hints || {};\n\n  shape = this._create('shape', shape);\n\n  var context = {\n    source: source,\n    position: position,\n    target: target,\n    shape: shape,\n    connection: hints.connection,\n    connectionParent: hints.connectionParent,\n    hints: hints\n  };\n\n  this._commandStack.execute('shape.append', context);\n\n  return context.shape;\n};\n\n\nModeling.prototype.removeElements = function(elements) {\n  var context = {\n    elements: elements\n  };\n\n  this._commandStack.execute('elements.delete', context);\n};\n\n\nModeling.prototype.distributeElements = function(groups, axis, dimension) {\n  var context = {\n    groups: groups,\n    axis: axis,\n    dimension: dimension\n  };\n\n  this._commandStack.execute('elements.distribute', context);\n};\n\n\nModeling.prototype.removeShape = function(shape, hints) {\n  var context = {\n    shape: shape,\n    hints: hints || {}\n  };\n\n  this._commandStack.execute('shape.delete', context);\n};\n\n\nModeling.prototype.removeConnection = function(connection, hints) {\n  var context = {\n    connection: connection,\n    hints: hints || {}\n  };\n\n  this._commandStack.execute('connection.delete', context);\n};\n\nModeling.prototype.replaceShape = function(oldShape, newShape, hints) {\n  var context = {\n    oldShape: oldShape,\n    newData: newShape,\n    hints: hints || {}\n  };\n\n  this._commandStack.execute('shape.replace', context);\n\n  return context.newShape;\n};\n\nModeling.prototype.alignElements = function(elements, alignment) {\n  var context = {\n    elements: elements,\n    alignment: alignment\n  };\n\n  this._commandStack.execute('elements.align', context);\n};\n\nModeling.prototype.resizeShape = function(shape, newBounds, minBounds, hints) {\n  var context = {\n    shape: shape,\n    newBounds: newBounds,\n    minBounds: minBounds,\n    hints: hints\n  };\n\n  this._commandStack.execute('shape.resize', context);\n};\n\nModeling.prototype.createSpace = function(movingShapes, resizingShapes, delta, direction, start) {\n  var context = {\n    delta: delta,\n    direction: direction,\n    movingShapes: movingShapes,\n    resizingShapes: resizingShapes,\n    start: start\n  };\n\n  this._commandStack.execute('spaceTool', context);\n};\n\nModeling.prototype.updateWaypoints = function(connection, newWaypoints, hints) {\n  var context = {\n    connection: connection,\n    newWaypoints: newWaypoints,\n    hints: hints || {}\n  };\n\n  this._commandStack.execute('connection.updateWaypoints', context);\n};\n\nModeling.prototype.reconnect = function(connection, source, target, dockingOrPoints, hints) {\n  var context = {\n    connection: connection,\n    newSource: source,\n    newTarget: target,\n    dockingOrPoints: dockingOrPoints,\n    hints: hints || {}\n  };\n\n  this._commandStack.execute('connection.reconnect', context);\n};\n\nModeling.prototype.reconnectStart = function(connection, newSource, dockingOrPoints, hints) {\n  if (!hints) {\n    hints = {};\n  }\n\n  this.reconnect(connection, newSource, connection.target, dockingOrPoints, assign(hints, {\n    docking: 'source'\n  }));\n};\n\nModeling.prototype.reconnectEnd = function(connection, newTarget, dockingOrPoints, hints) {\n  if (!hints) {\n    hints = {};\n  }\n\n  this.reconnect(connection, connection.source, newTarget, dockingOrPoints, assign(hints, {\n    docking: 'target'\n  }));\n};\n\nModeling.prototype.connect = function(source, target, attrs, hints) {\n  return this.createConnection(source, target, attrs || {}, source.parent, hints);\n};\n\nModeling.prototype._create = function(type, attrs) {\n  if (attrs instanceof Base) {\n    return attrs;\n  } else {\n    return this._elementFactory.create(type, attrs);\n  }\n};\n\nModeling.prototype.toggleCollapse = function(shape, hints) {\n  var context = {\n    shape: shape,\n    hints: hints || {}\n  };\n\n  this._commandStack.execute('shape.toggleCollapse', context);\n};\n","import {\n  reduce,\n  keys,\n  forEach,\n  assign\n} from 'min-dash';\n\nimport {\n  getBusinessObject\n} from '../../../util/ModelUtil';\n\nvar ID = 'id',\n    DI = 'di';\n\nvar NULL_DIMENSIONS = {\n  width: 0,\n  height: 0\n};\n\n/**\n * A handler that implements a postit elements property update.\n *\n * This should be used to set simple properties on elements with\n * an underlying XML business object.\n *\n * Use respective diagram-js provided handlers if you would\n * like to perform automated modeling.\n */\nexport default function UpdatePropertiesHandler(\n    elementRegistry, moddle, translate,\n    modeling, textRenderer) {\n\n  this._elementRegistry = elementRegistry;\n  this._moddle = moddle;\n  this._translate = translate;\n  this._modeling = modeling;\n  this._textRenderer = textRenderer;\n}\n\nUpdatePropertiesHandler.$inject = [\n  'elementRegistry',\n  'moddle',\n  'translate',\n  'modeling',\n  'textRenderer'\n];\n\n\n// api //////////////////////\n\n/**\n * Updates a board element with a list of new properties\n *\n * @param {Object} context\n * @param {djs.model.Base} context.element the element to update\n * @param {Object} context.properties a list of properties to set on the element's\n *                                    businessObject (the XML model element)\n *\n * @return {Array<djs.model.Base>} the updated element\n */\nUpdatePropertiesHandler.prototype.execute = function(context) {\n\n  var element = context.element,\n      changed = [ element ],\n      translate = this._translate;\n\n  if (!element) {\n    throw new Error(translate('element required'));\n  }\n\n  var elementRegistry = this._elementRegistry,\n      ids = this._moddle.ids;\n\n  var businessObject = element.businessObject,\n      properties = unwrapBusinessObjects(context.properties),\n      oldProperties = context.oldProperties || getProperties(businessObject, properties);\n\n  if (isIdChange(properties, businessObject)) {\n    ids.unclaim(businessObject[ID]);\n\n    elementRegistry.updateId(element, properties[ID]);\n\n    ids.claim(properties[ID], businessObject);\n  }\n\n  // update properties\n  setProperties(businessObject, properties);\n\n  // store old values\n  context.oldProperties = oldProperties;\n  context.changed = changed;\n\n  // indicate changed on objects affected by the update\n  return changed;\n};\n\n\nUpdatePropertiesHandler.prototype.postExecute = function(context) {\n  var element = context.element,\n      label = element.label;\n\n  var text = label && getBusinessObject(label).name;\n\n  if (!text) {\n    return;\n  }\n\n  // get layouted text bounds and resize external\n  // external label accordingly\n  var newLabelBounds = this._textRenderer.getExternalLabelBounds(label, text);\n\n  this._modeling.resizeShape(label, newLabelBounds, NULL_DIMENSIONS);\n};\n\n/**\n * Reverts the update on a board elements properties.\n *\n * @param  {Object} context\n *\n * @return {djs.model.Base} the updated element\n */\nUpdatePropertiesHandler.prototype.revert = function(context) {\n\n  var element = context.element,\n      properties = context.properties,\n      oldProperties = context.oldProperties,\n      businessObject = element.businessObject,\n      elementRegistry = this._elementRegistry,\n      ids = this._moddle.ids;\n\n  // update properties\n  setProperties(businessObject, oldProperties);\n\n  if (isIdChange(properties, businessObject)) {\n    ids.unclaim(properties[ID]);\n\n    elementRegistry.updateId(element, oldProperties[ID]);\n\n    ids.claim(oldProperties[ID], businessObject);\n  }\n\n  return context.changed;\n};\n\n\nfunction isIdChange(properties, businessObject) {\n  return ID in properties && properties[ID] !== businessObject[ID];\n}\n\n\nfunction getProperties(businessObject, properties) {\n  var propertyNames = keys(properties);\n\n  return reduce(propertyNames, function(result, key) {\n\n    // handle DI separately\n    if (key !== DI) {\n      result[key] = businessObject.get(key);\n    } else {\n      result[key] = getDiProperties(businessObject.di, keys(properties.di));\n    }\n\n    return result;\n  }, {});\n}\n\n\nfunction getDiProperties(di, propertyNames) {\n  return reduce(propertyNames, function(result, key) {\n    result[key] = di.get(key);\n\n    return result;\n  }, {});\n}\n\n\nfunction setProperties(businessObject, properties) {\n  forEach(properties, function(value, key) {\n\n    if (key !== DI) {\n      businessObject.set(key, value);\n    } else {\n\n      // only update, if businessObject.di exists\n      if (businessObject.di) {\n        setDiProperties(businessObject.di, value);\n      }\n    }\n  });\n}\n\n\nfunction setDiProperties(di, properties) {\n  forEach(properties, function(value, key) {\n    di.set(key, value);\n  });\n}\n\n\nvar referencePropertyNames = [ 'default' ];\n\n/**\n * Make sure we unwrap the actual business object\n * behind diagram element that may have been\n * passed as arguments.\n *\n * @param  {Object} properties\n *\n * @return {Object} unwrappedProps\n */\nfunction unwrapBusinessObjects(properties) {\n\n  var unwrappedProps = assign({}, properties);\n\n  referencePropertyNames.forEach(function(name) {\n    if (name in properties) {\n      unwrappedProps[name] = getBusinessObject(unwrappedProps[name]);\n    }\n  });\n\n  return unwrappedProps;\n}","import {\n  add as collectionAdd,\n  remove as collectionRemove\n} from 'diagram-js/lib/util/Collections';\n\n\nexport default function UpdateCanvasRootHandler(canvas, modeling) {\n  this._canvas = canvas;\n  this._modeling = modeling;\n}\n\nUpdateCanvasRootHandler.$inject = [\n  'canvas',\n  'modeling'\n];\n\n\nUpdateCanvasRootHandler.prototype.execute = function(context) {\n\n  var canvas = this._canvas;\n\n  var newRoot = context.newRoot,\n      newRootBusinessObject = newRoot.businessObject,\n      oldRoot = canvas.getRootElement(),\n      oldRootBusinessObject = oldRoot.businessObject,\n      postitDefinitions = oldRootBusinessObject.$parent,\n      diPlane = oldRootBusinessObject.di;\n\n  // (1) replace process old <> new root\n  canvas.setRootElement(newRoot, true);\n\n  // (2) update root elements\n  collectionAdd(postitDefinitions.rootElements, newRootBusinessObject);\n  newRootBusinessObject.$parent = postitDefinitions;\n\n  collectionRemove(postitDefinitions.rootElements, oldRootBusinessObject);\n  oldRootBusinessObject.$parent = null;\n\n  // (3) wire di\n  oldRootBusinessObject.di = null;\n\n  diPlane.boardElement = newRootBusinessObject;\n  newRootBusinessObject.di = diPlane;\n\n  context.oldRoot = oldRoot;\n\n  // TODO(nikku): return changed elements?\n  // return [ newRoot, oldRoot ];\n};\n\n\nUpdateCanvasRootHandler.prototype.revert = function(context) {\n\n  var canvas = this._canvas;\n\n  var newRoot = context.newRoot,\n      newRootBusinessObject = newRoot.businessObject,\n      oldRoot = context.oldRoot,\n      oldRootBusinessObject = oldRoot.businessObject,\n      postitDefinitions = newRootBusinessObject.$parent,\n      diPlane = newRootBusinessObject.di;\n\n  // (1) replace process old <> new root\n  canvas.setRootElement(oldRoot, true);\n\n  // (2) update root elements\n  collectionRemove(postitDefinitions.rootElements, newRootBusinessObject);\n  newRootBusinessObject.$parent = null;\n\n  collectionAdd(postitDefinitions.rootElements, oldRootBusinessObject);\n  oldRootBusinessObject.$parent = postitDefinitions;\n\n  // (3) wire di\n  newRootBusinessObject.di = null;\n\n  diPlane.boardElement = oldRootBusinessObject;\n  oldRootBusinessObject.di = diPlane;\n\n  // TODO(nikku): return changed elements?\n  // return [ newRoot, oldRoot ];\n};","export default function IdClaimHandler(moddle) {\n  this._moddle = moddle;\n}\n\nIdClaimHandler.$inject = [ 'moddle' ];\n\n\nIdClaimHandler.prototype.execute = function(context) {\n  var ids = this._moddle.ids,\n      id = context.id,\n      element = context.element,\n      claiming = context.claiming;\n\n  if (claiming) {\n    ids.claim(id, element);\n  } else {\n    ids.unclaim(id);\n  }\n};\n\n/**\n * Command revert implementation.\n */\nIdClaimHandler.prototype.revert = function(context) {\n  var ids = this._moddle.ids,\n      id = context.id,\n      element = context.element,\n      claiming = context.claiming;\n\n  if (claiming) {\n    ids.unclaim(id);\n  } else {\n    ids.claim(id, element);\n  }\n};\n\n","import {\r\n  forEach\r\n} from 'min-dash';\r\n\r\nimport COLOR from '../../../util/ColorUtil';\r\n\r\n\r\nvar DEFAULT_COLOR = COLOR.GREEN;\r\n\r\n\r\nexport default function SetColorHandler(commandStack) {\r\n  this._commandStack = commandStack;\r\n}\r\n\r\nSetColorHandler.$inject = [\r\n  'commandStack'\r\n];\r\n\r\n\r\nSetColorHandler.prototype.postExecute = function(context) {\r\n  var elements = context.elements,\r\n      color = context.color || DEFAULT_COLOR;\r\n\r\n  var self = this;\r\n\r\n  forEach(elements, function(element) {\r\n\r\n    self._commandStack.execute('element.updateProperties', {\r\n      element: element,\r\n      properties: {\r\n        color: color\r\n      }\r\n    });\r\n  });\r\n\r\n};","import {\n  setLabel,\n  getLabel\n} from '../LabelUtil';\n\nimport {\n  getExternalLabelMid,\n  isLabelExternal,\n  hasExternalLabel,\n  isLabel\n} from '../../../util/LabelUtil';\n\nvar NULL_DIMENSIONS = {\n  width: 0,\n  height: 0\n};\n\n\n/**\n * A handler that updates the text of a postit element.\n */\nexport default function UpdateLabelHandler(modeling, textRenderer) {\n\n  /**\n   * Set the label and return the changed elements.\n   *\n   * Element parameter can be label itself or connection (i.e. sequence flow).\n   *\n   * @param {djs.model.Base} element\n   * @param {String} text\n   */\n  function setText(element, text) {\n\n    // external label if present\n    var label = element.label || element;\n\n    var labelTarget = element.labelTarget || element;\n\n    setLabel(label, text, labelTarget !== label);\n\n    return [ label, labelTarget ];\n  }\n\n  function preExecute(ctx) {\n    var element = ctx.element,\n        businessObject = element.businessObject,\n        newLabel = ctx.newLabel;\n\n    if (!isLabel(element)\n        && isLabelExternal(element)\n        && !hasExternalLabel(element)\n        && !isEmptyText(newLabel)) {\n\n      // create label\n      var paddingTop = 7;\n\n      var labelCenter = getExternalLabelMid(element);\n\n      labelCenter = {\n        x: labelCenter.x,\n        y: labelCenter.y + paddingTop\n      };\n\n      modeling.createLabel(element, labelCenter, {\n        id: businessObject.id + '_label',\n        businessObject: businessObject\n      });\n    }\n  }\n\n  function execute(ctx) {\n    ctx.oldLabel = getLabel(ctx.element);\n    return setText(ctx.element, ctx.newLabel);\n  }\n\n  function revert(ctx) {\n    return setText(ctx.element, ctx.oldLabel);\n  }\n\n  function postExecute(ctx) {\n    var element = ctx.element,\n        label = element.label || element,\n        newLabel = ctx.newLabel,\n        newBounds = ctx.newBounds,\n        hints = ctx.hints || {};\n\n    // ignore internal labels for elements\n    if (!isLabel(label)) {\n      return;\n    }\n\n    if (isLabel(label) && isEmptyText(newLabel)) {\n\n      if (hints.removeShape !== false) {\n        modeling.removeShape(label, { unsetLabel: false });\n      }\n\n      return;\n    }\n\n    var text = getLabel(label);\n\n    // resize element based on label _or_ pre-defined bounds\n    if (typeof newBounds === 'undefined') {\n      newBounds = textRenderer.getExternalLabelBounds(label, text);\n    }\n\n    // setting newBounds to false or _null_ will\n    // disable the postExecute resize operation\n    if (newBounds) {\n      modeling.resizeShape(label, newBounds, NULL_DIMENSIONS);\n    }\n  }\n\n  // API\n\n  this.preExecute = preExecute;\n  this.execute = execute;\n  this.revert = revert;\n  this.postExecute = postExecute;\n}\n\nUpdateLabelHandler.$inject = [\n  'modeling',\n  'textRenderer'\n];\n\n\n// helpers ///////////////////////\n\nfunction isEmptyText(label) {\n  return !label || !label.trim();\n}","import inherits from 'inherits';\n\nimport BaseModeling from 'diagram-js/lib/features/modeling/Modeling';\n\nimport UpdatePropertiesHandler from './cmd/UpdatePropertiesHandler';\nimport UpdateCanvasRootHandler from './cmd/UpdateCanvasRootHandler';\nimport IdClaimHandler from './cmd/IdClaimHandler';\nimport SetColorHandler from './cmd/SetColorHandler';\n\nimport UpdateLabelHandler from '../label-editing/cmd/UpdateLabelHandler';\n\n\n/**\n * Postit modeling features activator\n *\n * @param {EventBus} eventBus\n * @param {ElementFactory} elementFactory\n * @param {CommandStack} commandStack\n * @param {PostitRules} postitRules\n */\nexport default function Modeling(\n    eventBus, elementFactory, commandStack,\n    postitRules) {\n\n  BaseModeling.call(this, eventBus, elementFactory, commandStack);\n\n  this._postitRules = postitRules;\n}\n\ninherits(Modeling, BaseModeling);\n\nModeling.$inject = [\n  'eventBus',\n  'elementFactory',\n  'commandStack',\n  'postitRules'\n];\n\n\nModeling.prototype.getHandlers = function() {\n  var handlers = BaseModeling.prototype.getHandlers.call(this);\n\n  handlers['element.updateProperties'] = UpdatePropertiesHandler;\n  handlers['canvas.updateRoot'] = UpdateCanvasRootHandler;\n  handlers['id.updateClaim'] = IdClaimHandler;\n  handlers['element.setColor'] = SetColorHandler;\n  handlers['element.updateLabel'] = UpdateLabelHandler;\n\n  return handlers;\n};\n\n\nModeling.prototype.updateLabel = function(element, newLabel, newBounds, hints) {\n  this._commandStack.execute('element.updateLabel', {\n    element: element,\n    newLabel: newLabel,\n    newBounds: newBounds,\n    hints: hints || {}\n  });\n};\n\n\nModeling.prototype.updateProperties = function(element, properties) {\n  this._commandStack.execute('element.updateProperties', {\n    element: element,\n    properties: properties\n  });\n};\n\nModeling.prototype.claimId = function(id, moddleElement) {\n  this._commandStack.execute('id.updateClaim', {\n    id: id,\n    element: moddleElement,\n    claiming: true\n  });\n};\n\n\nModeling.prototype.unclaimId = function(id, moddleElement) {\n  this._commandStack.execute('id.updateClaim', {\n    id: id,\n    element: moddleElement\n  });\n};\n\nModeling.prototype.setColor = function(elements, color) {\n  if (!elements.length) {\n    elements = [ elements ];\n  }\n\n  this._commandStack.execute('element.setColor', {\n    elements: elements,\n    color: color\n  });\n};\n","import {\n  getMid\n} from './LayoutUtil';\n\n\n/**\n * A base connection layouter implementation\n * that layouts the connection by directly connecting\n * mid(source) + mid(target).\n */\nexport default function BaseLayouter() {}\n\n\n/**\n * Return the new layouted waypoints for the given connection.\n *\n * The connection passed is still unchanged; you may figure out about\n * the new connection start / end via the layout hints provided.\n *\n * @param {djs.model.Connection} connection\n * @param {Object} [hints]\n * @param {Point} [hints.connectionStart]\n * @param {Point} [hints.connectionEnd]\n * @param {Point} [hints.source]\n * @param {Point} [hints.target]\n *\n * @return {Array<Point>} the layouted connection waypoints\n */\nBaseLayouter.prototype.layoutConnection = function(connection, hints) {\n\n  hints = hints || {};\n\n  return [\n    hints.connectionStart || getMid(hints.source || connection.source),\n    hints.connectionEnd || getMid(hints.target || connection.target)\n  ];\n};\n","import {\n  assign\n} from 'min-dash';\n\nimport {\n  getElementLineIntersection\n} from './LayoutUtil';\n\n\nfunction dockingToPoint(docking) {\n\n  // use the dockings actual point and\n  // retain the original docking\n  return assign({ original: docking.point.original || docking.point }, docking.actual);\n}\n\n\n/**\n * A {@link ConnectionDocking} that crops connection waypoints based on\n * the path(s) of the connection source and target.\n *\n * @param {djs.core.ElementRegistry} elementRegistry\n */\nexport default function CroppingConnectionDocking(elementRegistry, graphicsFactory) {\n  this._elementRegistry = elementRegistry;\n  this._graphicsFactory = graphicsFactory;\n}\n\nCroppingConnectionDocking.$inject = [ 'elementRegistry', 'graphicsFactory' ];\n\n\n/**\n * @inheritDoc ConnectionDocking#getCroppedWaypoints\n */\nCroppingConnectionDocking.prototype.getCroppedWaypoints = function(connection, source, target) {\n\n  source = source || connection.source;\n  target = target || connection.target;\n\n  var sourceDocking = this.getDockingPoint(connection, source, true),\n      targetDocking = this.getDockingPoint(connection, target);\n\n  var croppedWaypoints = connection.waypoints.slice(sourceDocking.idx + 1, targetDocking.idx);\n\n  croppedWaypoints.unshift(dockingToPoint(sourceDocking));\n  croppedWaypoints.push(dockingToPoint(targetDocking));\n\n  return croppedWaypoints;\n};\n\n/**\n * Return the connection docking point on the specified shape\n *\n * @inheritDoc ConnectionDocking#getDockingPoint\n */\nCroppingConnectionDocking.prototype.getDockingPoint = function(connection, shape, dockStart) {\n\n  var waypoints = connection.waypoints,\n      dockingIdx,\n      dockingPoint,\n      croppedPoint;\n\n  dockingIdx = dockStart ? 0 : waypoints.length - 1;\n  dockingPoint = waypoints[dockingIdx];\n\n  croppedPoint = this._getIntersection(shape, connection, dockStart);\n\n  return {\n    point: dockingPoint,\n    actual: croppedPoint || dockingPoint,\n    idx: dockingIdx\n  };\n};\n\n\n// helpers //////////////////////\n\nCroppingConnectionDocking.prototype._getIntersection = function(shape, connection, takeFirst) {\n\n  var shapePath = this._getShapePath(shape),\n      connectionPath = this._getConnectionPath(connection);\n\n  return getElementLineIntersection(shapePath, connectionPath, takeFirst);\n};\n\nCroppingConnectionDocking.prototype._getConnectionPath = function(connection) {\n  return this._graphicsFactory.getConnectionPath(connection);\n};\n\nCroppingConnectionDocking.prototype._getShapePath = function(shape) {\n  return this._graphicsFactory.getShapePath(shape);\n};\n\nCroppingConnectionDocking.prototype._getGfx = function(element) {\n  return this._elementRegistry.getGraphics(element);\n};\n","import BehaviorModule from './behavior';\nimport RulesModule from '../rules';\nimport DiOrderingModule from '../di-ordering';\nimport OrderingModule from '../ordering';\nimport ReplaceModule from '../replace';\n\nimport CommandModule from 'diagram-js/lib/command';\nimport TooltipsModule from 'diagram-js/lib/features/tooltips';\nimport LabelSupportModule from 'diagram-js/lib/features/label-support';\nimport AttachSupportModule from 'diagram-js/lib/features/attach-support';\nimport SelectionModule from 'diagram-js/lib/features/selection';\nimport ChangeSupportModule from 'diagram-js/lib/features/change-support';\nimport SpaceToolModule from 'diagram-js/lib/features/space-tool';\n\nimport PositFactory from './PostitFactory';\nimport PostitUpdater from './PostitUpdater';\nimport ElementFactory from './ElementFactory';\nimport Modeling from './Modeling';\nimport Layouter from 'diagram-js/lib/layout/BaseLayouter';\nimport CroppingConnectionDocking from 'diagram-js/lib/layout/CroppingConnectionDocking';\n\n\nexport default {\n  __init__: [\n    'modeling',\n    'postitUpdater'\n  ],\n  __depends__: [\n    BehaviorModule,\n    RulesModule,\n    DiOrderingModule,\n    OrderingModule,\n    ReplaceModule,\n    CommandModule,\n    TooltipsModule,\n    LabelSupportModule,\n    AttachSupportModule,\n    SelectionModule,\n    ChangeSupportModule,\n    SpaceToolModule\n  ],\n  postitFactory: [ 'type', PositFactory ],\n  postitUpdater: [ 'type', PostitUpdater ],\n  elementFactory: [ 'type', ElementFactory ],\n  modeling: [ 'type', Modeling ],\n  layouter: [ 'type', Layouter ],\n  connectionDocking: [ 'type', CroppingConnectionDocking ]\n};","import {\n  assign,\n  filter,\n  groupBy,\n  isObject\n} from 'min-dash';\n\nvar LOW_PRIORITY = 500,\n    MEDIUM_PRIORITY = 1250,\n    HIGH_PRIORITY = 1500;\n\nimport { getOriginal as getOriginalEvent } from '../../util/Event';\n\nimport {\n  isPrimaryButton\n} from '../../util/Mouse';\n\nvar round = Math.round;\n\nfunction mid(element) {\n  return {\n    x: element.x + round(element.width / 2),\n    y: element.y + round(element.height / 2)\n  };\n}\n\n/**\n * A plugin that makes shapes draggable / droppable.\n *\n * @param {EventBus} eventBus\n * @param {Dragging} dragging\n * @param {Modeling} modeling\n * @param {Selection} selection\n * @param {Rules} rules\n */\nexport default function MoveEvents(\n    eventBus, dragging, modeling,\n    selection, rules) {\n\n  // rules\n\n  function canMove(shapes, delta, position, target) {\n\n    return rules.allowed('elements.move', {\n      shapes: shapes,\n      delta: delta,\n      position: position,\n      target: target\n    });\n  }\n\n\n  // move events\n\n  // assign a high priority to this handler to setup the environment\n  // others may hook up later, e.g. at default priority and modify\n  // the move environment.\n  //\n  // This sets up the context with\n  //\n  // * shape: the primary shape being moved\n  // * shapes: a list of shapes to be moved\n  // * validatedShapes: a list of shapes that are being checked\n  //                    against the rules before and during move\n  //\n  eventBus.on('shape.move.start', HIGH_PRIORITY, function(event) {\n\n    var context = event.context,\n        shape = event.shape,\n        shapes = selection.get().slice();\n\n    // move only single shape if the dragged element\n    // is not part of the current selection\n    if (shapes.indexOf(shape) === -1) {\n      shapes = [ shape ];\n    }\n\n    // ensure we remove nested elements in the collection\n    // and add attachers for a proper dragger\n    shapes = removeNested(shapes);\n\n    // attach shapes to drag context\n    assign(context, {\n      shapes: shapes,\n      validatedShapes: shapes,\n      shape: shape\n    });\n  });\n\n\n  // assign a high priority to this handler to setup the environment\n  // others may hook up later, e.g. at default priority and modify\n  // the move environment\n  //\n  eventBus.on('shape.move.start', MEDIUM_PRIORITY, function(event) {\n\n    var context = event.context,\n        validatedShapes = context.validatedShapes,\n        canExecute;\n\n    canExecute = context.canExecute = canMove(validatedShapes);\n\n    // check if we can move the elements\n    if (!canExecute) {\n      return false;\n    }\n  });\n\n  // assign a low priority to this handler\n  // to let others modify the move event before we update\n  // the context\n  //\n  eventBus.on('shape.move.move', LOW_PRIORITY, function(event) {\n\n    var context = event.context,\n        validatedShapes = context.validatedShapes,\n        hover = event.hover,\n        delta = { x: event.dx, y: event.dy },\n        position = { x: event.x, y: event.y },\n        canExecute;\n\n    // check if we can move the elements\n    canExecute = canMove(validatedShapes, delta, position, hover);\n\n    context.delta = delta;\n    context.canExecute = canExecute;\n\n    // simply ignore move over\n    if (canExecute === null) {\n      context.target = null;\n\n      return;\n    }\n\n    context.target = hover;\n  });\n\n  eventBus.on('shape.move.end', function(event) {\n\n    var context = event.context;\n\n    var delta = context.delta,\n        canExecute = context.canExecute,\n        isAttach = canExecute === 'attach',\n        shapes = context.shapes;\n\n    if (canExecute === false) {\n      return false;\n    }\n\n    // ensure we have actual pixel values deltas\n    // (important when zoom level was > 1 during move)\n    delta.x = round(delta.x);\n    delta.y = round(delta.y);\n\n    if (delta.x === 0 && delta.y === 0) {\n\n      // didn't move\n      return;\n    }\n\n    modeling.moveElements(shapes, delta, context.target, {\n      primaryShape: context.shape,\n      attach: isAttach\n    });\n  });\n\n\n  // move activation\n\n  eventBus.on('element.mousedown', function(event) {\n\n    if (!isPrimaryButton(event)) {\n      return;\n    }\n\n    var originalEvent = getOriginalEvent(event);\n\n    if (!originalEvent) {\n      throw new Error('must supply DOM mousedown event');\n    }\n\n    return start(originalEvent, event.element);\n  });\n\n  /**\n   * Start move.\n   *\n   * @param {MouseEvent} event\n   * @param {djs.model.Shape} shape\n   * @param {boolean} [activate]\n   * @param {Object} [context]\n   */\n  function start(event, element, activate, context) {\n    if (isObject(activate)) {\n      context = activate;\n      activate = false;\n    }\n\n    // do not move connections or the root element\n    if (element.waypoints || !element.parent) {\n      return;\n    }\n\n    var referencePoint = mid(element);\n\n    dragging.init(event, referencePoint, 'shape.move', {\n      cursor: 'grabbing',\n      autoActivate: activate,\n      data: {\n        shape: element,\n        context: context || {}\n      }\n    });\n\n    // we've handled the event\n    return true;\n  }\n\n  // API\n\n  this.start = start;\n}\n\nMoveEvents.$inject = [\n  'eventBus',\n  'dragging',\n  'modeling',\n  'selection',\n  'rules'\n];\n\n\n/**\n * Return a filtered list of elements that do not contain\n * those nested into others.\n *\n * @param  {Array<djs.model.Base>} elements\n *\n * @return {Array<djs.model.Base>} filtered\n */\nfunction removeNested(elements) {\n\n  var ids = groupBy(elements, 'id');\n\n  return filter(elements, function(element) {\n    while ((element = element.parent)) {\n\n      // parent in selection\n      if (ids[element.id]) {\n        return false;\n      }\n    }\n\n    return true;\n  });\n}\n","import {\n  flatten,\n  forEach,\n  filter,\n  find,\n  groupBy,\n  map,\n  matchPattern,\n  size\n} from 'min-dash';\n\nimport {\n  selfAndAllChildren\n} from '../../util/Elements';\n\nimport {\n  append as svgAppend,\n  attr as svgAttr,\n  create as svgCreate,\n  remove as svgRemove\n} from 'tiny-svg';\n\nimport { translate } from '../../util/SvgTransformUtil';\n\nvar LOW_PRIORITY = 499;\n\nvar MARKER_DRAGGING = 'djs-dragging',\n    MARKER_OK = 'drop-ok',\n    MARKER_NOT_OK = 'drop-not-ok',\n    MARKER_NEW_PARENT = 'new-parent',\n    MARKER_ATTACH = 'attach-ok';\n\n\n/**\n * Provides previews for moving shapes when moving.\n *\n * @param {EventBus} eventBus\n * @param {ElementRegistry} elementRegistry\n * @param {Canvas} canvas\n * @param {Styles} styles\n */\nexport default function MovePreview(\n    eventBus, canvas, styles, previewSupport) {\n\n  function getVisualDragShapes(shapes) {\n    var elements = getAllDraggedElements(shapes);\n\n    var filteredElements = removeEdges(elements);\n\n    return filteredElements;\n  }\n\n  function getAllDraggedElements(shapes) {\n    var allShapes = selfAndAllChildren(shapes, true);\n\n    var allConnections = map(allShapes, function(shape) {\n      return (shape.incoming || []).concat(shape.outgoing || []);\n    });\n\n    return flatten(allShapes.concat(allConnections));\n  }\n\n  /**\n   * Sets drop marker on an element.\n   */\n  function setMarker(element, marker) {\n\n    [ MARKER_ATTACH, MARKER_OK, MARKER_NOT_OK, MARKER_NEW_PARENT ].forEach(function(m) {\n\n      if (m === marker) {\n        canvas.addMarker(element, m);\n      } else {\n        canvas.removeMarker(element, m);\n      }\n    });\n  }\n\n  /**\n   * Make an element draggable.\n   *\n   * @param {Object} context\n   * @param {djs.model.Base} element\n   * @param {boolean} addMarker\n   */\n  function makeDraggable(context, element, addMarker) {\n\n    previewSupport.addDragger(element, context.dragGroup);\n\n    if (addMarker) {\n      canvas.addMarker(element, MARKER_DRAGGING);\n    }\n\n    if (context.allDraggedElements) {\n      context.allDraggedElements.push(element);\n    } else {\n      context.allDraggedElements = [ element ];\n    }\n  }\n\n  // assign a low priority to this handler\n  // to let others modify the move context before\n  // we draw things\n  eventBus.on('shape.move.start', LOW_PRIORITY, function(event) {\n    var context = event.context,\n        dragShapes = context.shapes,\n        allDraggedElements = context.allDraggedElements;\n\n    var visuallyDraggedShapes = getVisualDragShapes(dragShapes);\n\n    if (!context.dragGroup) {\n      var dragGroup = svgCreate('g');\n\n      svgAttr(dragGroup, styles.cls('djs-drag-group', [ 'no-events' ]));\n\n      var defaultLayer = canvas.getDefaultLayer();\n\n      svgAppend(defaultLayer, dragGroup);\n\n      context.dragGroup = dragGroup;\n    }\n\n    // add previews\n    visuallyDraggedShapes.forEach(function(shape) {\n      previewSupport.addDragger(shape, context.dragGroup);\n    });\n\n    // cache all dragged elements / gfx\n    // so that we can quickly undo their state changes later\n    if (!allDraggedElements) {\n      allDraggedElements = getAllDraggedElements(dragShapes);\n    } else {\n      allDraggedElements = flatten([\n        allDraggedElements,\n        getAllDraggedElements(dragShapes)\n      ]);\n    }\n\n    // add dragging marker\n    forEach(allDraggedElements, function(e) {\n      canvas.addMarker(e, MARKER_DRAGGING);\n    });\n\n    context.allDraggedElements = allDraggedElements;\n\n    // determine, if any of the dragged elements have different parents\n    context.differentParents = haveDifferentParents(dragShapes);\n  });\n\n  // update previews\n  eventBus.on('shape.move.move', LOW_PRIORITY, function(event) {\n\n    var context = event.context,\n        dragGroup = context.dragGroup,\n        target = context.target,\n        parent = context.shape.parent,\n        canExecute = context.canExecute;\n\n    if (target) {\n      if (canExecute === 'attach') {\n        setMarker(target, MARKER_ATTACH);\n      } else if (context.canExecute && target && target.id !== parent.id) {\n        setMarker(target, MARKER_NEW_PARENT);\n      } else {\n        setMarker(target, context.canExecute ? MARKER_OK : MARKER_NOT_OK);\n      }\n    }\n\n    translate(dragGroup, event.dx, event.dy);\n  });\n\n  eventBus.on([ 'shape.move.out', 'shape.move.cleanup' ], function(event) {\n    var context = event.context,\n        target = context.target;\n\n    if (target) {\n      setMarker(target, null);\n    }\n  });\n\n  // remove previews\n  eventBus.on('shape.move.cleanup', function(event) {\n\n    var context = event.context,\n        allDraggedElements = context.allDraggedElements,\n        dragGroup = context.dragGroup;\n\n\n    // remove dragging marker\n    forEach(allDraggedElements, function(e) {\n      canvas.removeMarker(e, MARKER_DRAGGING);\n    });\n\n    if (dragGroup) {\n      svgRemove(dragGroup);\n    }\n  });\n\n\n  // API //////////////////////\n\n  /**\n   * Make an element draggable.\n   *\n   * @param {Object} context\n   * @param {djs.model.Base} element\n   * @param {boolean} addMarker\n   */\n  this.makeDraggable = makeDraggable;\n}\n\nMovePreview.$inject = [\n  'eventBus',\n  'canvas',\n  'styles',\n  'previewSupport'\n];\n\n\n// helpers //////////////////////\n\n/**\n * returns elements minus all connections\n * where source or target is not elements\n */\nfunction removeEdges(elements) {\n\n  var filteredElements = filter(elements, function(element) {\n\n    if (!isConnection(element)) {\n      return true;\n    } else {\n\n      return (\n        find(elements, matchPattern({ id: element.source.id })) &&\n        find(elements, matchPattern({ id: element.target.id }))\n      );\n    }\n  });\n\n  return filteredElements;\n}\n\nfunction haveDifferentParents(elements) {\n  return size(groupBy(elements, function(e) { return e.parent && e.parent.id; })) !== 1;\n}\n\n/**\n * Checks if an element is a connection.\n */\nfunction isConnection(element) {\n  return element.waypoints;\n}\n","import InteractionEventsModule from '../interaction-events';\nimport SelectionModule from '../selection';\nimport OutlineModule from '../outline';\nimport RulesModule from '../rules';\nimport DraggingModule from '../dragging';\nimport PreviewSupportModule from '../preview-support';\n\nimport Move from './Move';\nimport MovePreview from './MovePreview';\n\nexport default {\n  __depends__: [\n    InteractionEventsModule,\n    SelectionModule,\n    OutlineModule,\n    RulesModule,\n    DraggingModule,\n    PreviewSupportModule\n  ],\n  __init__: [\n    'move',\n    'movePreview'\n  ],\n  move: [ 'type', Move ],\n  movePreview: [ 'type', MovePreview ]\n};\n","import {\n  isArray,\n  isFunction,\n  forEach\n} from 'min-dash';\n\nimport {\n  domify,\n  query as domQuery,\n  attr as domAttr,\n  clear as domClear,\n  classes as domClasses,\n  matches as domMatches,\n  delegate as domDelegate,\n  event as domEvent\n} from 'min-dom';\n\n\nvar TOGGLE_SELECTOR = '.djs-palette-toggle',\n    ENTRY_SELECTOR = '.entry',\n    ELEMENT_SELECTOR = TOGGLE_SELECTOR + ', ' + ENTRY_SELECTOR;\n\nvar PALETTE_OPEN_CLS = 'open',\n    PALETTE_TWO_COLUMN_CLS = 'two-column';\n\nvar DEFAULT_PRIORITY = 1000;\n\n\n/**\n * A palette containing modeling elements.\n */\nexport default function Palette(eventBus, canvas) {\n\n  this._eventBus = eventBus;\n  this._canvas = canvas;\n\n  var self = this;\n\n  eventBus.on('tool-manager.update', function(event) {\n    var tool = event.tool;\n\n    self.updateToolHighlight(tool);\n  });\n\n  eventBus.on('i18n.changed', function() {\n    self._update();\n  });\n\n  eventBus.on('diagram.init', function() {\n\n    self._diagramInitialized = true;\n\n    self._rebuild();\n  });\n}\n\nPalette.$inject = [ 'eventBus', 'canvas' ];\n\n\n/**\n * Register a provider with the palette\n *\n * @param  {number} [priority=1000]\n * @param  {PaletteProvider} provider\n *\n * @example\n * const paletteProvider = {\n *   getPaletteEntries: function() {\n *     return function(entries) {\n *       return {\n *         ...entries,\n *         'entry-1': {\n *           label: 'My Entry',\n *           action: function() { alert(\"I have been clicked!\"); }\n *         }\n *       };\n *     }\n *   }\n * };\n *\n * palette.registerProvider(800, paletteProvider);\n */\nPalette.prototype.registerProvider = function(priority, provider) {\n  if (!provider) {\n    provider = priority;\n    priority = DEFAULT_PRIORITY;\n  }\n\n  this._eventBus.on('palette.getProviders', priority, function(event) {\n    event.providers.push(provider);\n  });\n\n  this._rebuild();\n};\n\n\n/**\n * Returns the palette entries\n *\n * @return {Object<string, PaletteEntryDescriptor>} map of entries\n */\nPalette.prototype.getEntries = function() {\n  var providers = this._getProviders();\n\n  return providers.reduce(addPaletteEntries, {});\n};\n\nPalette.prototype._rebuild = function() {\n\n  if (!this._diagramInitialized) {\n    return;\n  }\n\n  var providers = this._getProviders();\n\n  if (!providers.length) {\n    return;\n  }\n\n  if (!this._container) {\n    this._init();\n  }\n\n  this._update();\n};\n\n/**\n * Initialize\n */\nPalette.prototype._init = function() {\n\n  var self = this;\n\n  var eventBus = this._eventBus;\n\n  var parentContainer = this._getParentContainer();\n\n  var container = this._container = domify(Palette.HTML_MARKUP);\n\n  parentContainer.appendChild(container);\n\n  domDelegate.bind(container, ELEMENT_SELECTOR, 'click', function(event) {\n\n    var target = event.delegateTarget;\n\n    if (domMatches(target, TOGGLE_SELECTOR)) {\n      return self.toggle();\n    }\n\n    self.trigger('click', event);\n  });\n\n  // prevent drag propagation\n  domEvent.bind(container, 'mousedown', function(event) {\n    event.stopPropagation();\n  });\n\n  // prevent drag propagation\n  domDelegate.bind(container, ENTRY_SELECTOR, 'dragstart', function(event) {\n    self.trigger('dragstart', event);\n  });\n\n  eventBus.on('canvas.resized', this._layoutChanged, this);\n\n  eventBus.fire('palette.create', {\n    container: container\n  });\n};\n\nPalette.prototype._getProviders = function(id) {\n\n  var event = this._eventBus.createEvent({\n    type: 'palette.getProviders',\n    providers: []\n  });\n\n  this._eventBus.fire(event);\n\n  return event.providers;\n};\n\n/**\n * Update palette state.\n *\n * @param  {Object} [state] { open, twoColumn }\n */\nPalette.prototype._toggleState = function(state) {\n\n  state = state || {};\n\n  var parent = this._getParentContainer(),\n      container = this._container;\n\n  var eventBus = this._eventBus;\n\n  var twoColumn;\n\n  var cls = domClasses(container);\n\n  if ('twoColumn' in state) {\n    twoColumn = state.twoColumn;\n  } else {\n    twoColumn = this._needsCollapse(parent.clientHeight, this._entries || {});\n  }\n\n  // always update two column\n  cls.toggle(PALETTE_TWO_COLUMN_CLS, twoColumn);\n\n  if ('open' in state) {\n    cls.toggle(PALETTE_OPEN_CLS, state.open);\n  }\n\n  eventBus.fire('palette.changed', {\n    twoColumn: twoColumn,\n    open: this.isOpen()\n  });\n};\n\nPalette.prototype._update = function() {\n\n  var entriesContainer = domQuery('.djs-palette-entries', this._container),\n      entries = this._entries = this.getEntries();\n\n  domClear(entriesContainer);\n\n  forEach(entries, function(entry, id) {\n\n    var grouping = entry.group || 'default';\n\n    var container = domQuery('[data-group=' + grouping + ']', entriesContainer);\n    if (!container) {\n      container = domify('<div class=\"group\" data-group=\"' + grouping + '\"></div>');\n      entriesContainer.appendChild(container);\n    }\n\n    var html = entry.html || (\n      entry.separator ?\n        '<hr class=\"separator\" />' :\n        '<div class=\"entry\" draggable=\"true\"></div>');\n\n\n    var control = domify(html);\n    container.appendChild(control);\n\n    if (!entry.separator) {\n      domAttr(control, 'data-action', id);\n\n      if (entry.title) {\n        domAttr(control, 'title', entry.title);\n      }\n\n      if (entry.className) {\n        addClasses(control, entry.className);\n      }\n\n      if (entry.imageUrl) {\n        control.appendChild(domify('<img src=\"' + entry.imageUrl + '\">'));\n      }\n    }\n  });\n\n  // open after update\n  this.open();\n};\n\n\n/**\n * Trigger an action available on the palette\n *\n * @param  {string} action\n * @param  {Event} event\n */\nPalette.prototype.trigger = function(action, event, autoActivate) {\n  var entries = this._entries,\n      entry,\n      handler,\n      originalEvent,\n      button = event.delegateTarget || event.target;\n\n  if (!button) {\n    return event.preventDefault();\n  }\n\n  entry = entries[domAttr(button, 'data-action')];\n\n  // when user clicks on the palette and not on an action\n  if (!entry) {\n    return;\n  }\n\n  handler = entry.action;\n\n  originalEvent = event.originalEvent || event;\n\n  // simple action (via callback function)\n  if (isFunction(handler)) {\n    if (action === 'click') {\n      handler(originalEvent, autoActivate);\n    }\n  } else {\n    if (handler[action]) {\n      handler[action](originalEvent, autoActivate);\n    }\n  }\n\n  // silence other actions\n  event.preventDefault();\n};\n\nPalette.prototype._layoutChanged = function() {\n  this._toggleState({});\n};\n\n/**\n * Do we need to collapse to two columns?\n *\n * @param {number} availableHeight\n * @param {Object} entries\n *\n * @return {boolean}\n */\nPalette.prototype._needsCollapse = function(availableHeight, entries) {\n\n  // top margin + bottom toggle + bottom margin\n  // implementors must override this method if they\n  // change the palette styles\n  var margin = 20 + 10 + 20;\n\n  var entriesHeight = Object.keys(entries).length * 46;\n\n  return availableHeight < entriesHeight + margin;\n};\n\n/**\n * Close the palette\n */\nPalette.prototype.close = function() {\n\n  this._toggleState({\n    open: false,\n    twoColumn: false\n  });\n};\n\n\n/**\n * Open the palette\n */\nPalette.prototype.open = function() {\n  this._toggleState({ open: true });\n};\n\n\nPalette.prototype.toggle = function(open) {\n  if (this.isOpen()) {\n    this.close();\n  } else {\n    this.open();\n  }\n};\n\nPalette.prototype.isActiveTool = function(tool) {\n  return tool && this._activeTool === tool;\n};\n\nPalette.prototype.updateToolHighlight = function(name) {\n  var entriesContainer,\n      toolsContainer;\n\n  if (!this._toolsContainer) {\n    entriesContainer = domQuery('.djs-palette-entries', this._container);\n\n    this._toolsContainer = domQuery('[data-group=tools]', entriesContainer);\n  }\n\n  toolsContainer = this._toolsContainer;\n\n  forEach(toolsContainer.children, function(tool) {\n    var actionName = tool.getAttribute('data-action');\n\n    if (!actionName) {\n      return;\n    }\n\n    var toolClasses = domClasses(tool);\n\n    actionName = actionName.replace('-tool', '');\n\n    if (toolClasses.contains('entry') && actionName === name) {\n      toolClasses.add('highlighted-entry');\n    } else {\n      toolClasses.remove('highlighted-entry');\n    }\n  });\n};\n\n\n/**\n * Return true if the palette is opened.\n *\n * @example\n *\n * palette.open();\n *\n * if (palette.isOpen()) {\n *   // yes, we are open\n * }\n *\n * @return {boolean} true if palette is opened\n */\nPalette.prototype.isOpen = function() {\n  return domClasses(this._container).has(PALETTE_OPEN_CLS);\n};\n\n/**\n * Get container the palette lives in.\n *\n * @return {Element}\n */\nPalette.prototype._getParentContainer = function() {\n  return this._canvas.getContainer();\n};\n\n\n/* markup definition */\n\nPalette.HTML_MARKUP =\n  '<div class=\"djs-palette\">' +\n    '<div class=\"djs-palette-entries\"></div>' +\n    '<div class=\"djs-palette-toggle\"></div>' +\n  '</div>';\n\n\n// helpers //////////////////////\n\nfunction addClasses(element, classNames) {\n\n  var classes = domClasses(element);\n\n  var actualClassNames = isArray(classNames) ? classNames : classNames.split(/\\s+/g);\n  actualClassNames.forEach(function(cls) {\n    classes.add(cls);\n  });\n}\n\nfunction addPaletteEntries(entries, provider) {\n\n  var entriesOrUpdater = provider.getPaletteEntries();\n\n  if (isFunction(entriesOrUpdater)) {\n    return entriesOrUpdater(entries);\n  }\n\n  forEach(entriesOrUpdater, function(entry, id) {\n    entries[id] = entry;\n  });\n\n  return entries;\n}","import Palette from './Palette';\n\nexport default {\n  __init__: [ 'palette' ],\n  palette: [ 'type', Palette ]\n};\n","import { values } from 'min-dash';\n\nimport { getEnclosedElements } from '../../util/Elements';\n\nimport {\n  hasSecondaryModifier\n} from '../../util/Mouse';\n\nimport {\n  append as svgAppend,\n  attr as svgAttr,\n  create as svgCreate,\n  remove as svgRemove\n} from 'tiny-svg';\n\nvar LASSO_TOOL_CURSOR = 'crosshair';\n\n\nexport default function LassoTool(\n    eventBus, canvas, dragging,\n    elementRegistry, selection, toolManager,\n    mouse) {\n\n  this._selection = selection;\n  this._dragging = dragging;\n  this._mouse = mouse;\n\n  var self = this;\n\n  // lasso visuals implementation\n\n  /**\n  * A helper that realizes the selection box visual\n  */\n  var visuals = {\n\n    create: function(context) {\n      var container = canvas.getDefaultLayer(),\n          frame;\n\n      frame = context.frame = svgCreate('rect');\n      svgAttr(frame, {\n        class: 'djs-lasso-overlay',\n        width:  1,\n        height: 1,\n        x: 0,\n        y: 0\n      });\n\n      svgAppend(container, frame);\n    },\n\n    update: function(context) {\n      var frame = context.frame,\n          bbox = context.bbox;\n\n      svgAttr(frame, {\n        x: bbox.x,\n        y: bbox.y,\n        width: bbox.width,\n        height: bbox.height\n      });\n    },\n\n    remove: function(context) {\n\n      if (context.frame) {\n        svgRemove(context.frame);\n      }\n    }\n  };\n\n  toolManager.registerTool('lasso', {\n    tool: 'lasso.selection',\n    dragging: 'lasso'\n  });\n\n  eventBus.on('lasso.selection.end', function(event) {\n    var target = event.originalEvent.target;\n\n    // only reactive on diagram click\n    // on some occasions, event.hover is not set and we have to check if the target is an svg\n    if (!event.hover && !(target instanceof SVGElement)) {\n      return;\n    }\n\n    eventBus.once('lasso.selection.ended', function() {\n      self.activateLasso(event.originalEvent, true);\n    });\n  });\n\n  // lasso interaction implementation\n\n  eventBus.on('lasso.end', function(event) {\n\n    var bbox = toBBox(event);\n\n    var elements = elementRegistry.filter(function(element) {\n      return element;\n    });\n\n    self.select(elements, bbox);\n  });\n\n  eventBus.on('lasso.start', function(event) {\n\n    var context = event.context;\n\n    context.bbox = toBBox(event);\n    visuals.create(context);\n  });\n\n  eventBus.on('lasso.move', function(event) {\n\n    var context = event.context;\n\n    context.bbox = toBBox(event);\n    visuals.update(context);\n  });\n\n  eventBus.on('lasso.cleanup', function(event) {\n\n    var context = event.context;\n\n    visuals.remove(context);\n  });\n\n\n  // event integration\n\n  eventBus.on('element.mousedown', 1500, function(event) {\n\n    if (!hasSecondaryModifier(event)) {\n      return;\n    }\n\n    self.activateLasso(event.originalEvent);\n\n    // we've handled the event\n    return true;\n  });\n}\n\nLassoTool.$inject = [\n  'eventBus',\n  'canvas',\n  'dragging',\n  'elementRegistry',\n  'selection',\n  'toolManager',\n  'mouse'\n];\n\n\nLassoTool.prototype.activateLasso = function(event, autoActivate) {\n\n  this._dragging.init(event, 'lasso', {\n    autoActivate: autoActivate,\n    cursor: LASSO_TOOL_CURSOR,\n    data: {\n      context: {}\n    }\n  });\n};\n\nLassoTool.prototype.activateSelection = function(event, autoActivate) {\n\n  this._dragging.init(event, 'lasso.selection', {\n    trapClick: false,\n    autoActivate: autoActivate,\n    cursor: LASSO_TOOL_CURSOR,\n    data: {\n      context: {}\n    }\n  });\n};\n\nLassoTool.prototype.select = function(elements, bbox) {\n  var selectedElements = getEnclosedElements(elements, bbox);\n\n  this._selection.select(values(selectedElements));\n};\n\nLassoTool.prototype.toggle = function() {\n  if (this.isActive()) {\n    return this._dragging.cancel();\n  }\n\n  var mouseEvent = this._mouse.getLastMoveEvent();\n\n  this.activateSelection(mouseEvent, !!mouseEvent);\n};\n\nLassoTool.prototype.isActive = function() {\n  var context = this._dragging.context();\n\n  return context && /^lasso/.test(context.prefix);\n};\n\n\n\nfunction toBBox(event) {\n\n  var start = {\n\n    x: event.x - event.dx,\n    y: event.y - event.dy\n  };\n\n  var end = {\n    x: event.x,\n    y: event.y\n  };\n\n  var bbox;\n\n  if ((start.x <= end.x && start.y < end.y) ||\n      (start.x < end.x && start.y <= end.y)) {\n\n    bbox = {\n      x: start.x,\n      y: start.y,\n      width:  end.x - start.x,\n      height: end.y - start.y\n    };\n  } else if ((start.x >= end.x && start.y < end.y) ||\n             (start.x > end.x && start.y <= end.y)) {\n\n    bbox = {\n      x: end.x,\n      y: start.y,\n      width:  start.x - end.x,\n      height: end.y - start.y\n    };\n  } else if ((start.x <= end.x && start.y > end.y) ||\n             (start.x < end.x && start.y >= end.y)) {\n\n    bbox = {\n      x: start.x,\n      y: end.y,\n      width:  end.x - start.x,\n      height: start.y - end.y\n    };\n  } else if ((start.x >= end.x && start.y > end.y) ||\n             (start.x > end.x && start.y >= end.y)) {\n\n    bbox = {\n      x: end.x,\n      y: end.y,\n      width:  start.x - end.x,\n      height: start.y - end.y\n    };\n  } else {\n\n    bbox = {\n      x: end.x,\n      y: end.y,\n      width:  0,\n      height: 0\n    };\n  }\n  return bbox;\n}\n","import ToolManagerModule from '../tool-manager';\nimport MouseModule from '../mouse';\n\nimport LassoTool from './LassoTool';\n\nexport default {\n  __depends__: [\n    ToolManagerModule,\n    MouseModule\n  ],\n  __init__: [ 'lassoTool' ],\n  lassoTool: [ 'type', LassoTool ]\n};\n","import {\n  hasPrimaryModifier\n} from '../../util/Mouse';\n\nimport { isKey } from '../../features/keyboard/KeyboardUtil';\n\nvar HIGH_PRIORITY = 1500;\nvar HAND_CURSOR = 'grab';\n\n\nexport default function HandTool(\n    eventBus, canvas, dragging,\n    injector, toolManager, mouse) {\n\n  this._dragging = dragging;\n  this._mouse = mouse;\n\n  var self = this,\n      keyboard = injector.get('keyboard', false);\n\n  toolManager.registerTool('hand', {\n    tool: 'hand',\n    dragging: 'hand.move'\n  });\n\n  eventBus.on('element.mousedown', HIGH_PRIORITY, function(event) {\n\n    if (!hasPrimaryModifier(event)) {\n      return;\n    }\n\n    self.activateMove(event.originalEvent, true);\n\n    return false;\n  });\n\n  keyboard && keyboard.addListener(HIGH_PRIORITY, function(e) {\n    if (!isSpace(e.keyEvent) || self.isActive()) {\n      return;\n    }\n\n    var mouseEvent = self._mouse.getLastMoveEvent();\n\n    self.activateMove(mouseEvent, !!mouseEvent);\n  }, 'keyboard.keydown');\n\n  keyboard && keyboard.addListener(HIGH_PRIORITY, function(e) {\n    if (!isSpace(e.keyEvent) || !self.isActive()) {\n      return;\n    }\n\n    self.toggle();\n  }, 'keyboard.keyup');\n\n  eventBus.on('hand.end', function(event) {\n    var target = event.originalEvent.target;\n\n    // only reactive on diagram click\n    // on some occasions, event.hover is not set and we have to check if the target is an svg\n    if (!event.hover && !(target instanceof SVGElement)) {\n      return false;\n    }\n\n    eventBus.once('hand.ended', function() {\n      self.activateMove(event.originalEvent, { reactivate: true });\n    });\n\n  });\n\n  eventBus.on('hand.move.move', function(event) {\n    var scale = canvas.viewbox().scale;\n\n    canvas.scroll({\n      dx: event.dx * scale,\n      dy: event.dy * scale\n    });\n  });\n\n  eventBus.on('hand.move.end', function(event) {\n    var context = event.context,\n        reactivate = context.reactivate;\n\n    // Don't reactivate if the user is using the keyboard keybinding\n    if (!hasPrimaryModifier(event) && reactivate) {\n\n      eventBus.once('hand.move.ended', function(event) {\n        self.activateHand(event.originalEvent, true, true);\n      });\n\n    }\n\n    return false;\n  });\n\n}\n\nHandTool.$inject = [\n  'eventBus',\n  'canvas',\n  'dragging',\n  'injector',\n  'toolManager',\n  'mouse'\n];\n\n\nHandTool.prototype.activateMove = function(event, autoActivate, context) {\n  if (typeof autoActivate === 'object') {\n    context = autoActivate;\n    autoActivate = false;\n  }\n\n  this._dragging.init(event, 'hand.move', {\n    autoActivate: autoActivate,\n    cursor: HAND_CURSOR,\n    data: {\n      context: context || {}\n    }\n  });\n};\n\nHandTool.prototype.activateHand = function(event, autoActivate, reactivate) {\n  this._dragging.init(event, 'hand', {\n    trapClick: false,\n    autoActivate: autoActivate,\n    cursor: HAND_CURSOR,\n    data: {\n      context: {\n        reactivate: reactivate\n      }\n    }\n  });\n};\n\nHandTool.prototype.toggle = function() {\n  if (this.isActive()) {\n    return this._dragging.cancel();\n  }\n\n  var mouseEvent = this._mouse.getLastMoveEvent();\n\n  this.activateHand(mouseEvent, !!mouseEvent);\n};\n\nHandTool.prototype.isActive = function() {\n  var context = this._dragging.context();\n\n  if (context) {\n    return /^(hand|hand\\.move)$/.test(context.prefix);\n  }\n\n  return false;\n};\n\n// helpers //////////\n\nfunction isSpace(keyEvent) {\n  return isKey(' ', keyEvent);\n}","import ToolManagerModule from '../tool-manager';\nimport MouseModule from '../mouse';\n\nimport HandTool from './HandTool';\n\nexport default {\n  __depends__: [\n    ToolManagerModule,\n    MouseModule\n  ],\n  __init__: [ 'handTool' ],\n  handTool: [ 'type', HandTool ]\n};\n","import {\n  assign\n} from 'min-dash';\n\nimport COLORS from '../../util/ColorUtil';\n\n\n/**\n * A palette provider for postit elements.\n */\nexport default function PaletteProvider(\n    palette, create, elementFactory,\n    spaceTool, lassoTool, handTool, translate) {\n\n  this._palette = palette;\n  this._create = create;\n  this._elementFactory = elementFactory;\n  this._spaceTool = spaceTool;\n  this._lassoTool = lassoTool;\n  this._handTool = handTool;\n  this._translate = translate;\n\n  palette.registerProvider(this);\n}\n\nPaletteProvider.$inject = [\n  'palette',\n  'create',\n  'elementFactory',\n  'spaceTool',\n  'lassoTool',\n  'handTool',\n  'translate'\n];\n\n\nPaletteProvider.prototype.getPaletteEntries = function(element) {\n\n  var actions = {},\n      create = this._create,\n      elementFactory = this._elementFactory,\n      spaceTool = this._spaceTool,\n      lassoTool = this._lassoTool,\n      handTool = this._handTool,\n      translate = this._translate;\n\n  function createAction(type, group, className, title, options) {\n\n    function createListener(event) {\n      var shape = elementFactory.createShape(assign({ type: type }, options));\n      create.start(event, shape);\n    }\n\n    var shortType = type.replace(/^postit:/, '');\n\n    return {\n      group: group,\n      className: className,\n      title: title || translate('Create {type}', { type: shortType }),\n      action: {\n        dragstart: createListener,\n        click: createListener\n      }\n    };\n  }\n\n  function createImage(event) {\n    var shape = elementFactory.createShape({\n      type: 'postit:Image'\n    });\n\n    create.start(event, shape, {\n      hints: { selectImage: true }\n    });\n  }\n\n  assign(actions, {\n    'hand-tool': {\n      group: 'tools',\n      className: 'bpmn-icon-hand-tool',\n      title: translate('Activate the hand tool'),\n      action: {\n        click: function(event) {\n          handTool.activateHand(event);\n        }\n      }\n    },\n    'lasso-tool': {\n      group: 'tools',\n      className: 'bpmn-icon-lasso-tool',\n      title: translate('Activate the lasso tool'),\n      action: {\n        click: function(event) {\n          lassoTool.activateSelection(event);\n        }\n      }\n    },\n    'space-tool': {\n      group: 'tools',\n      className: 'bpmn-icon-space-tool',\n      title: translate('Activate the create/remove space tool'),\n      action: {\n        click: function(event) {\n          spaceTool.activateSelection(event);\n        }\n      }\n    },\n    'tool-separator': {\n      group: 'tools',\n      separator: true\n    },\n    'create.square-postit': createAction(\n      'postit:SquarePostit', 'postits', 'pjs-postit-square',\n      translate('Create Square Postit'), { color: COLORS.GREEN }\n    ),\n    'create.circle-postit': createAction(\n      'postit:CirclePostit', 'postits', 'pjs-postit-circle',\n      translate('Create Circle Postit'), { color: COLORS.PINK }\n    ),\n    'postit-separator': {\n      group: 'postits',\n      separator: true\n    },\n    'create.image': {\n      group: 'artifact',\n      className: 'pjs-image',\n      title: translate('Create Image'),\n      action: {\n        click: createImage,\n        dragstart: createImage\n      }\n    },\n    'create.text-box': createAction(\n      'postit:TextBox', 'artifact', 'pjs-text-box',\n      translate('Create Text')\n    ),\n    'create.group': createAction(\n      'postit:Group', 'artifact', 'pjs-group',\n      translate('Create Group')\n    )\n  });\n\n  return actions;\n};\n","import PaletteModule from 'diagram-js/lib/features/palette';\nimport CreateModule from 'diagram-js/lib/features/create';\nimport SpaceToolModule from 'diagram-js/lib/features/space-tool';\nimport LassoToolModule from 'diagram-js/lib/features/lasso-tool';\nimport HandToolModule from 'diagram-js/lib/features/hand-tool';\nimport translate from 'diagram-js/lib/i18n/translate';\n\nimport PaletteProvider from './PaletteProvider';\n\nexport default {\n  __depends__: [\n    PaletteModule,\n    CreateModule,\n    SpaceToolModule,\n    LassoToolModule,\n    HandToolModule,\n    translate\n  ],\n  __init__: [ 'paletteProvider' ],\n  paletteProvider: [ 'type', PaletteProvider ]\n};\n","import CommandInterceptor from 'diagram-js/lib/command/CommandInterceptor';\n\nimport inherits from 'inherits';\n\nimport cssEscape from 'css.escape';\n\nimport {\n  assign,\n  forEach\n} from 'min-dash';\n\nimport {\n  query as domQuery\n} from 'min-dom';\n\nimport {\n  attr as svgAttr\n} from 'tiny-svg';\n\nvar LOW_PRIORITY = 250;\n\n\nexport default function PostitReplacePreview(\n    eventBus, elementRegistry, elementFactory,\n    canvas, previewSupport) {\n\n  CommandInterceptor.call(this, eventBus);\n\n  /**\n   * Replace the visuals of all elements in the context which can be replaced\n   *\n   * @param  {Object} context\n   */\n  function replaceVisual(context) {\n\n    var replacements = context.canExecute.replacements;\n\n    forEach(replacements, function(replacement) {\n\n      var id = replacement.oldElementId;\n\n      var newElement = {\n        type: replacement.newElementType\n      };\n\n      // if the visual of the element is already replaced\n      if (context.visualReplacements[id]) {\n        return;\n      }\n\n      var element = elementRegistry.get(id);\n\n      assign(newElement, { x: element.x, y: element.y });\n\n      // create a temporary shape\n      var tempShape = elementFactory.createShape(newElement);\n\n      canvas.addShape(tempShape, element.parent);\n\n      // select the original SVG element related to the element and hide it\n      var gfx = domQuery('[data-element-id=\"' + cssEscape(element.id) + '\"]', context.dragGroup);\n\n      if (gfx) {\n        svgAttr(gfx, { display: 'none' });\n      }\n\n      // clone the gfx of the temporary shape and add it to the drag group\n      var dragger = previewSupport.addDragger(tempShape, context.dragGroup);\n\n      context.visualReplacements[id] = dragger;\n\n      canvas.removeShape(tempShape);\n    });\n  }\n\n  /**\n   * Restore the original visuals of the previously replaced elements\n   *\n   * @param  {Object} context\n   */\n  function restoreVisual(context) {\n\n    var visualReplacements = context.visualReplacements;\n\n    forEach(visualReplacements, function(dragger, id) {\n\n      var originalGfx = domQuery('[data-element-id=\"' + cssEscape(id) + '\"]', context.dragGroup);\n\n      if (originalGfx) {\n        svgAttr(originalGfx, { display: 'inline' });\n      }\n\n      dragger.remove();\n\n      if (visualReplacements[id]) {\n        delete visualReplacements[id];\n      }\n    });\n  }\n\n  eventBus.on('shape.move.move', LOW_PRIORITY, function(event) {\n\n    var context = event.context,\n        canExecute = context.canExecute;\n\n    if (!context.visualReplacements) {\n      context.visualReplacements = {};\n    }\n\n    if (canExecute && canExecute.replacements) {\n      replaceVisual(context);\n    } else {\n      restoreVisual(context);\n    }\n  });\n}\n\nPostitReplacePreview.$inject = [\n  'eventBus',\n  'elementRegistry',\n  'elementFactory',\n  'canvas',\n  'previewSupport'\n];\n\ninherits(PostitReplacePreview, CommandInterceptor);","import PreviewSupportModule from 'diagram-js/lib/features/preview-support';\n\nimport PostitReplacePreview from './PostitReplacePreview';\n\nexport default {\n  __depends__: [\n    PreviewSupportModule\n  ],\n  __init__: [ 'postitReplacePreview' ],\n  postitReplacePreview: [ 'type', PostitReplacePreview ]\n};\n","import {\n  forEach\n} from 'min-dash';\n\nimport {\n  snapTo\n} from './SnapUtil';\n\n\n/**\n * A snap context, containing the (possibly incomplete)\n * mappings of drop targets (to identify the snapping)\n * to computed snap points.\n */\nexport default function SnapContext() {\n\n  /**\n   * Map<String, SnapPoints> mapping drop targets to\n   * a list of possible snappings.\n   *\n   * @type {Object}\n   */\n  this._targets = {};\n\n  /**\n   * Map<String, Point> initial positioning of element\n   * regarding various snap directions.\n   *\n   * @type {Object}\n   */\n  this._snapOrigins = {};\n\n  /**\n   * List of snap locations\n   *\n   * @type {Array<string>}\n   */\n  this._snapLocations = [];\n\n  /**\n   * Map<String, Array<Point>> of default snapping locations\n   *\n   * @type {Object}\n   */\n  this._defaultSnaps = {};\n}\n\n\nSnapContext.prototype.getSnapOrigin = function(snapLocation) {\n  return this._snapOrigins[snapLocation];\n};\n\n\nSnapContext.prototype.setSnapOrigin = function(snapLocation, initialValue) {\n  this._snapOrigins[snapLocation] = initialValue;\n\n  if (this._snapLocations.indexOf(snapLocation) === -1) {\n    this._snapLocations.push(snapLocation);\n  }\n};\n\n\nSnapContext.prototype.addDefaultSnap = function(type, point) {\n\n  var snapValues = this._defaultSnaps[type];\n\n  if (!snapValues) {\n    snapValues = this._defaultSnaps[type] = [];\n  }\n\n  snapValues.push(point);\n};\n\n/**\n * Return a number of initialized snaps, i.e. snap locations such as\n * top-left, mid, bottom-right and so forth.\n *\n * @return {Array<string>} snapLocations\n */\nSnapContext.prototype.getSnapLocations = function() {\n  return this._snapLocations;\n};\n\n/**\n * Set the snap locations for this context.\n *\n * The order of locations determines precedence.\n *\n * @param {Array<string>} snapLocations\n */\nSnapContext.prototype.setSnapLocations = function(snapLocations) {\n  this._snapLocations = snapLocations;\n};\n\n/**\n * Get snap points for a given target\n *\n * @param {Element|string} target\n */\nSnapContext.prototype.pointsForTarget = function(target) {\n\n  var targetId = target.id || target;\n\n  var snapPoints = this._targets[targetId];\n\n  if (!snapPoints) {\n    snapPoints = this._targets[targetId] = new SnapPoints();\n    snapPoints.initDefaults(this._defaultSnaps);\n  }\n\n  return snapPoints;\n};\n\n\n/**\n * Creates the snap points and initializes them with the\n * given default values.\n *\n * @param {Object<string, Array<Point>>} [defaultPoints]\n */\nexport function SnapPoints(defaultSnaps) {\n\n  /**\n   * Map<String, Map<(x|y), Array<number>>> mapping snap locations,\n   * i.e. top-left, bottom-right, center to actual snap values.\n   *\n   * @type {Object}\n   */\n  this._snapValues = {};\n}\n\nSnapPoints.prototype.add = function(snapLocation, point) {\n\n  var snapValues = this._snapValues[snapLocation];\n\n  if (!snapValues) {\n    snapValues = this._snapValues[snapLocation] = { x: [], y: [] };\n  }\n\n  if (snapValues.x.indexOf(point.x) === -1) {\n    snapValues.x.push(point.x);\n  }\n\n  if (snapValues.y.indexOf(point.y) === -1) {\n    snapValues.y.push(point.y);\n  }\n};\n\n\nSnapPoints.prototype.snap = function(point, snapLocation, axis, tolerance) {\n  var snappingValues = this._snapValues[snapLocation];\n\n  return snappingValues && snapTo(point[axis], snappingValues[axis], tolerance);\n};\n\n/**\n * Initialize a number of default snapping points.\n *\n * @param  {Object} defaultSnaps\n */\nSnapPoints.prototype.initDefaults = function(defaultSnaps) {\n\n  var self = this;\n\n  forEach(defaultSnaps || {}, function(snapPoints, snapLocation) {\n    forEach(snapPoints, function(point) {\n      self.add(snapLocation, point);\n    });\n  });\n};","import SnapContext from './SnapContext';\r\n\r\nimport {\r\n  getChildren,\r\n  isSnapped,\r\n  mid\r\n} from './SnapUtil';\r\n\r\nimport { isCmd } from '../keyboard/KeyboardUtil';\r\n\r\nimport {\r\n  forEach,\r\n  isNumber\r\n} from 'min-dash';\r\n\r\nvar HIGHER_PRIORITY = 1250;\r\n\r\n\r\n/**\r\n * Snap during create and move.\r\n *\r\n * @param {EventBus} elementRegistry\r\n * @param {EventBus} eventBus\r\n * @param {Snapping} snapping\r\n */\r\nexport default function CreateMoveSnapping(elementRegistry, eventBus, snapping) {\r\n  var self = this;\r\n\r\n  this._elementRegistry = elementRegistry;\r\n\r\n  eventBus.on([\r\n    'create.start',\r\n    'shape.move.start'\r\n  ], function(event) {\r\n    self.initSnap(event);\r\n  });\r\n\r\n  eventBus.on([\r\n    'create.move',\r\n    'create.end',\r\n    'shape.move.move',\r\n    'shape.move.end'\r\n  ], HIGHER_PRIORITY, function(event) {\r\n    var context = event.context,\r\n        shape = context.shape,\r\n        snapContext = context.snapContext,\r\n        target = context.target;\r\n\r\n    if (event.originalEvent && isCmd(event.originalEvent)) {\r\n      return;\r\n    }\r\n\r\n    if (isSnapped(event) || !target) {\r\n      return;\r\n    }\r\n\r\n    var snapPoints = snapContext.pointsForTarget(target);\r\n\r\n    if (!snapPoints.initialized) {\r\n      snapPoints = self.addSnapTargetPoints(snapPoints, shape, target);\r\n\r\n      snapPoints.initialized = true;\r\n    }\r\n\r\n    snapping.snap(event, snapPoints);\r\n  });\r\n\r\n  eventBus.on([\r\n    'create.cleanup',\r\n    'shape.move.cleanup'\r\n  ], function() {\r\n    snapping.hide();\r\n  });\r\n}\r\n\r\nCreateMoveSnapping.$inject = [\r\n  'elementRegistry',\r\n  'eventBus',\r\n  'snapping'\r\n];\r\n\r\nCreateMoveSnapping.prototype.initSnap = function(event) {\r\n  var elementRegistry = this._elementRegistry;\r\n\r\n  var context = event.context,\r\n      shape = context.shape,\r\n      snapContext = context.snapContext;\r\n\r\n  if (!snapContext) {\r\n    snapContext = context.snapContext = new SnapContext();\r\n  }\r\n\r\n  var shapeMid;\r\n\r\n  if (elementRegistry.get(shape.id)) {\r\n\r\n    // move\r\n    shapeMid = mid(shape, event);\r\n  } else {\r\n\r\n    // create\r\n    shapeMid = {\r\n      x: event.x + mid(shape).x,\r\n      y: event.y + mid(shape).y\r\n    };\r\n  }\r\n\r\n  var shapeTopLeft = {\r\n        x: shapeMid.x - shape.width / 2,\r\n        y: shapeMid.y - shape.height / 2\r\n      },\r\n      shapeBottomRight = {\r\n        x: shapeMid.x + shape.width / 2,\r\n        y: shapeMid.y + shape.height / 2\r\n      };\r\n\r\n  snapContext.setSnapOrigin('mid', {\r\n    x: shapeMid.x - event.x,\r\n    y: shapeMid.y - event.y\r\n  });\r\n\r\n  // snap labels to mid only\r\n  if (isLabel(shape)) {\r\n    return snapContext;\r\n  }\r\n\r\n  snapContext.setSnapOrigin('top-left', {\r\n    x: shapeTopLeft.x - event.x,\r\n    y: shapeTopLeft.y - event.y\r\n  });\r\n\r\n  snapContext.setSnapOrigin('bottom-right', {\r\n    x: shapeBottomRight.x - event.x,\r\n    y: shapeBottomRight.y - event.y\r\n  });\r\n\r\n  return snapContext;\r\n};\r\n\r\nCreateMoveSnapping.prototype.addSnapTargetPoints = function(snapPoints, shape, target) {\r\n  var snapTargets = this.getSnapTargets(shape, target);\r\n\r\n  forEach(snapTargets, function(snapTarget) {\r\n\r\n    // handle labels\r\n    if (isLabel(snapTarget)) {\r\n\r\n      if (isLabel(shape)) {\r\n        snapPoints.add('mid', mid(snapTarget));\r\n      }\r\n\r\n      return;\r\n    }\r\n\r\n    // handle connections\r\n    if (isConnection(snapTarget)) {\r\n\r\n      // ignore single segment connections\r\n      if (snapTarget.waypoints.length < 3) {\r\n        return;\r\n      }\r\n\r\n      // ignore first and last waypoint\r\n      var waypoints = snapTarget.waypoints.slice(1, -1);\r\n\r\n      forEach(waypoints, function(waypoint) {\r\n        snapPoints.add('mid', waypoint);\r\n      });\r\n\r\n      return;\r\n    }\r\n\r\n    // handle shapes\r\n    snapPoints.add('mid', mid(snapTarget));\r\n  });\r\n\r\n  if (!isNumber(shape.x) || !isNumber(shape.y)) {\r\n    return snapPoints;\r\n  }\r\n\r\n  // snap to original position when moving\r\n  if (this._elementRegistry.get(shape.id)) {\r\n    snapPoints.add('mid', mid(shape));\r\n  }\r\n\r\n  return snapPoints;\r\n};\r\n\r\nCreateMoveSnapping.prototype.getSnapTargets = function(shape, target) {\r\n  return getChildren(target).filter(function(child) {\r\n    return !isHidden(child);\r\n  });\r\n};\r\n\r\n// helpers //////////\r\n\r\nfunction isConnection(element) {\r\n  return !!element.waypoints;\r\n}\r\n\r\nfunction isHidden(element) {\r\n  return !!element.hidden;\r\n}\r\n\r\nfunction isLabel(element) {\r\n  return !!element.labelTarget;\r\n}","import inherits from 'inherits';\n\nimport CreateMoveSnapping from 'diagram-js/lib/features/snapping/CreateMoveSnapping';\n\n/**\n * Snap during create and move.\n *\n * @param {EventBus} eventBus\n * @param {Injector} injector\n */\nexport default function PostitCreateMoveSnapping(injector) {\n  injector.invoke(CreateMoveSnapping, this);\n}\n\ninherits(PostitCreateMoveSnapping, CreateMoveSnapping);\n\nPostitCreateMoveSnapping.$inject = [\n  'injector'\n];\n\nPostitCreateMoveSnapping.prototype.initSnap = function(event) {\n  return CreateMoveSnapping.prototype.initSnap.call(this, event);\n};\n\nPostitCreateMoveSnapping.prototype.addSnapTargetPoints = function(snapPoints, shape, target) {\n  return CreateMoveSnapping.prototype.addSnapTargetPoints.call(this, snapPoints, shape, target);\n};\n\nPostitCreateMoveSnapping.prototype.getSnapTargets = function(shape, target) {\n  return CreateMoveSnapping.prototype.getSnapTargets.call(this, shape, target);\n};\n","import SnapContext from './SnapContext';\r\n\r\nimport {\r\n  bottomRight,\r\n  getChildren,\r\n  isSnapped,\r\n  setSnapped,\r\n  topLeft,\r\n} from './SnapUtil';\r\n\r\nimport { isCmd } from '../keyboard/KeyboardUtil';\r\n\r\nimport {\r\n  asTRBL,\r\n  getMid\r\n} from '../../layout/LayoutUtil';\r\n\r\nimport { forEach } from 'min-dash';\r\n\r\nvar HIGHER_PRIORITY = 1250;\r\n\r\n\r\n/**\r\n * Snap during resize.\r\n *\r\n * @param {EventBus} eventBus\r\n * @param {Snapping} snapping\r\n */\r\nexport default function ResizeSnapping(eventBus, snapping) {\r\n  var self = this;\r\n\r\n  eventBus.on([ 'resize.start' ], function(event) {\r\n    self.initSnap(event);\r\n  });\r\n\r\n  eventBus.on([\r\n    'resize.move',\r\n    'resize.end',\r\n  ], HIGHER_PRIORITY, function(event) {\r\n    var context = event.context,\r\n        shape = context.shape,\r\n        parent = shape.parent,\r\n        direction = context.direction,\r\n        snapContext = context.snapContext;\r\n\r\n    if (event.originalEvent && isCmd(event.originalEvent)) {\r\n      return;\r\n    }\r\n\r\n    if (isSnapped(event)) {\r\n      return;\r\n    }\r\n\r\n    var snapPoints = snapContext.pointsForTarget(parent);\r\n\r\n    if (!snapPoints.initialized) {\r\n      snapPoints = self.addSnapTargetPoints(snapPoints, shape, parent, direction);\r\n\r\n      snapPoints.initialized = true;\r\n    }\r\n\r\n    if (isHorizontal(direction)) {\r\n      setSnapped(event, 'x', event.x);\r\n    }\r\n\r\n    if (isVertical(direction)) {\r\n      setSnapped(event, 'y', event.y);\r\n    }\r\n\r\n    snapping.snap(event, snapPoints);\r\n  });\r\n\r\n  eventBus.on([ 'resize.cleanup' ], function() {\r\n    snapping.hide();\r\n  });\r\n}\r\n\r\nResizeSnapping.prototype.initSnap = function(event) {\r\n  var context = event.context,\r\n      shape = context.shape,\r\n      direction = context.direction,\r\n      snapContext = context.snapContext;\r\n\r\n  if (!snapContext) {\r\n    snapContext = context.snapContext = new SnapContext();\r\n  }\r\n\r\n  var snapOrigin = getSnapOrigin(shape, direction);\r\n\r\n  snapContext.setSnapOrigin('corner', {\r\n    x: snapOrigin.x - event.x,\r\n    y: snapOrigin.y - event.y\r\n  });\r\n\r\n  return snapContext;\r\n};\r\n\r\nResizeSnapping.prototype.addSnapTargetPoints = function(snapPoints, shape, target, direction) {\r\n  var snapTargets = this.getSnapTargets(shape, target);\r\n\r\n  forEach(snapTargets, function(snapTarget) {\r\n    snapPoints.add('corner', bottomRight(snapTarget));\r\n    snapPoints.add('corner', topLeft(snapTarget));\r\n  });\r\n\r\n  snapPoints.add('corner', getSnapOrigin(shape, direction));\r\n\r\n  return snapPoints;\r\n};\r\n\r\nResizeSnapping.$inject = [\r\n  'eventBus',\r\n  'snapping'\r\n];\r\n\r\nResizeSnapping.prototype.getSnapTargets = function(shape, target) {\r\n  return getChildren(target).filter(function(child) {\r\n    return !isAttached(child, shape)\r\n      && !isConnection(child)\r\n      && !isHidden(child)\r\n      && !isLabel(child);\r\n  });\r\n};\r\n\r\n// helpers //////////\r\n\r\nfunction getSnapOrigin(shape, direction) {\r\n  var mid = getMid(shape),\r\n      trbl = asTRBL(shape);\r\n\r\n  var snapOrigin = {\r\n    x: mid.x,\r\n    y: mid.y\r\n  };\r\n\r\n  if (direction.indexOf('n') !== -1) {\r\n    snapOrigin.y = trbl.top;\r\n  } else if (direction.indexOf('s') !== -1) {\r\n    snapOrigin.y = trbl.bottom;\r\n  }\r\n\r\n  if (direction.indexOf('e') !== -1) {\r\n    snapOrigin.x = trbl.right;\r\n  } else if (direction.indexOf('w') !== -1) {\r\n    snapOrigin.x = trbl.left;\r\n  }\r\n\r\n  return snapOrigin;\r\n}\r\n\r\nfunction isAttached(element, host) {\r\n  return element.host === host;\r\n}\r\n\r\nfunction isConnection(element) {\r\n  return !!element.waypoints;\r\n}\r\n\r\nfunction isHidden(element) {\r\n  return !!element.hidden;\r\n}\r\n\r\nfunction isLabel(element) {\r\n  return !!element.labelTarget;\r\n}\r\n\r\nfunction isHorizontal(direction) {\r\n  return direction === 'n' || direction === 's';\r\n}\r\n\r\nfunction isVertical(direction) {\r\n  return direction === 'e' || direction === 'w';\r\n}","import {\n  bind,\n  debounce,\n  forEach,\n  isNumber,\n  isObject\n} from 'min-dash';\n\nimport {\n  isSnapped,\n  setSnapped\n} from './SnapUtil';\n\nimport {\n  append as svgAppend,\n  attr as svgAttr,\n  classes as svgClasses,\n  create as svgCreate\n} from 'tiny-svg';\n\nvar SNAP_TOLERANCE = 7;\n\nexport var SNAP_LINE_HIDE_DELAY = 1000;\n\n\n/**\n * Generic snapping feature.\n *\n * @param {EventBus} eventBus\n * @param {Canvas} canvas\n */\nexport default function Snapping(canvas) {\n  this._canvas = canvas;\n\n  // delay hide by 1000 seconds since last snap\n  this._asyncHide = debounce(bind(this.hide, this), SNAP_LINE_HIDE_DELAY);\n}\n\nSnapping.$inject = [ 'canvas' ];\n\n/**\n * Snap an event to given snap points.\n *\n * @param {Event} event\n * @param {SnapPoints} snapPoints\n */\nSnapping.prototype.snap = function(event, snapPoints) {\n  var context = event.context,\n      snapContext = context.snapContext,\n      snapLocations = snapContext.getSnapLocations();\n\n  var snapping = {\n    x: isSnapped(event, 'x'),\n    y: isSnapped(event, 'y')\n  };\n\n  forEach(snapLocations, function(location) {\n    var snapOrigin = snapContext.getSnapOrigin(location);\n\n    var snapCurrent = {\n      x: event.x + snapOrigin.x,\n      y: event.y + snapOrigin.y\n    };\n\n    // snap both axis if not snapped already\n    forEach([ 'x', 'y' ], function(axis) {\n      var locationSnapping;\n\n      if (!snapping[axis]) {\n        locationSnapping = snapPoints.snap(snapCurrent, location, axis, SNAP_TOLERANCE);\n\n        if (locationSnapping !== undefined) {\n          snapping[axis] = {\n            value: locationSnapping,\n            originValue: locationSnapping - snapOrigin[axis]\n          };\n        }\n      }\n    });\n\n    // no need to continue snapping\n    if (snapping.x && snapping.y) {\n      return false;\n    }\n  });\n\n  // show snap lines\n  this.showSnapLine('vertical', snapping.x && snapping.x.value);\n  this.showSnapLine('horizontal', snapping.y && snapping.y.value);\n\n  // snap event\n  forEach([ 'x', 'y' ], function(axis) {\n    var axisSnapping = snapping[axis];\n\n    if (isObject(axisSnapping)) {\n      setSnapped(event, axis, axisSnapping.originValue);\n    }\n  });\n};\n\nSnapping.prototype._createLine = function(orientation) {\n  var root = this._canvas.getLayer('snap');\n\n  var line = svgCreate('path');\n\n  svgAttr(line, { d: 'M0,0 L0,0' });\n\n  svgClasses(line).add('djs-snap-line');\n\n  svgAppend(root, line);\n\n  return {\n    update: function(position) {\n\n      if (!isNumber(position)) {\n        svgAttr(line, { display: 'none' });\n      } else {\n        if (orientation === 'horizontal') {\n          svgAttr(line, {\n            d: 'M-100000,' + position + ' L+100000,' + position,\n            display: ''\n          });\n        } else {\n          svgAttr(line, {\n            d: 'M ' + position + ',-100000 L ' + position + ', +100000',\n            display: ''\n          });\n        }\n      }\n    }\n  };\n};\n\nSnapping.prototype._createSnapLines = function() {\n  this._snapLines = {\n    horizontal: this._createLine('horizontal'),\n    vertical: this._createLine('vertical')\n  };\n};\n\nSnapping.prototype.showSnapLine = function(orientation, position) {\n\n  var line = this.getSnapLine(orientation);\n\n  if (line) {\n    line.update(position);\n  }\n\n  this._asyncHide();\n};\n\nSnapping.prototype.getSnapLine = function(orientation) {\n  if (!this._snapLines) {\n    this._createSnapLines();\n  }\n\n  return this._snapLines[orientation];\n};\n\nSnapping.prototype.hide = function() {\n  forEach(this._snapLines, function(snapLine) {\n    snapLine.update();\n  });\n};\n","import CreateMoveSnapping from './CreateMoveSnapping';\nimport ResizeSnapping from './ResizeSnapping';\nimport Snapping from './Snapping';\n\nexport default {\n  __init__: [\n    'createMoveSnapping',\n    'resizeSnapping',\n    'snapping'\n  ],\n  createMoveSnapping: [ 'type', CreateMoveSnapping ],\n  resizeSnapping: [ 'type', ResizeSnapping ],\n  snapping: [ 'type', Snapping ]\n};","import PostitCreateMoveSnapping from './PostitCreateMoveSnapping';\nimport SnappingModule from 'diagram-js/lib/features/snapping';\n\nexport default {\n  __depends__: [ SnappingModule ],\n  __init__: [\n    'createMoveSnapping'\n  ],\n  createMoveSnapping: [ 'type', PostitCreateMoveSnapping ]\n};","import inherits from 'inherits';\n\nimport BaseModeler from './BaseModeler';\n\nimport Viewer from './Viewer';\nimport NavigatedViewer from './NavigatedViewer';\n\nimport KeyboardMoveModule from 'diagram-js/lib/navigation/keyboard-move';\nimport MoveCanvasModule from 'diagram-js/lib/navigation/movecanvas';\nimport TouchModule from 'diagram-js/lib/navigation/touch';\nimport ZoomScrollModule from 'diagram-js/lib/navigation/zoomscroll';\n\nimport AlignElementsModule from 'diagram-js/lib/features/align-elements';\nimport AutoScrollModule from 'diagram-js/lib/features/auto-scroll';\nimport BendpointsModule from 'diagram-js/lib/features/bendpoints';\nimport CanvasCreate from './features/canvas-create';\nimport ConnectModule from 'diagram-js/lib/features/connect';\nimport ConnectionPreviewModule from 'diagram-js/lib/features/connection-preview';\nimport ContextPadModule from './features/context-pad';\nimport CopyPasteModule from './features/copy-paste';\nimport CreateModule from 'diagram-js/lib/features/create';\nimport EditorActionsModule from './features/editor-actions';\nimport ImageSelectionModule from './features/image-selection';\nimport KeyboardModule from './features/keyboard';\nimport KeyboardMoveSelectionModule from 'diagram-js/lib/features/keyboard-move-selection';\nimport LabelEditingModule from './features/label-editing';\nimport ModelingModule from './features/modeling';\nimport MoveModule from 'diagram-js/lib/features/move';\nimport PaletteModule from './features/palette';\nimport ReplacePreviewModule from './features/replace-preview';\nimport ResizeModule from 'diagram-js/lib/features/resize';\nimport SnappingModule from './features/snapping';\n\nvar initialDiagram =\n  `<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n  <postit:definitions xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:dc=\"http://www.omg.org/spec/DD/20100524/DC\" xmlns:di=\"http://www.omg.org/spec/DD/20100524/DI\" id=\"sample-diagram\">\n    <postit:PostitBoard id=\"Board_1\">\n    </postit:PostitBoard>\n    <postitDi:PostitRootBoard id=\"RootBoard_1\">\n      <postitDi:PostitPlane id=\"PositPlane_1\" boardElement=\"Board_1\">\n      </postitDi:PostitPlane>\n    </postitDi:PostitRootBoard>\n  </postit:definitions>`;\n\nexport default function Modeler(options) {\n  BaseModeler.call(this, options);\n}\n\ninherits(Modeler, BaseModeler);\n\n\nModeler.Viewer = Viewer;\nModeler.NavigatedViewer = NavigatedViewer;\n\n/**\n* The createDiagram result.\n*\n* @typedef {Object} CreateDiagramResult\n*\n* @property {Array<string>} warnings\n*/\n\n/**\n* The createDiagram error.\n*\n* @typedef {Error} CreateDiagramError\n*\n* @property {Array<string>} warnings\n*/\n\n/**\n * Create a new diagram to start modeling.\n *\n * @returns {Promise<CreateDiagramResult, CreateDiagramError>}\n *\n */\nModeler.prototype.createDiagram = function() {\n  return this.importXML(initialDiagram);\n};\n\n\nModeler.prototype._interactionModules = [\n\n  // non-modeling components\n  KeyboardMoveModule,\n  MoveCanvasModule,\n  TouchModule,\n  ZoomScrollModule\n];\n\nModeler.prototype._modelingModules = [\n\n  // modeling components\n  AlignElementsModule,\n  AutoScrollModule,\n  BendpointsModule,\n  CanvasCreate,\n  ConnectModule,\n  ConnectionPreviewModule,\n  ContextPadModule,\n  CopyPasteModule,\n  CreateModule,\n  EditorActionsModule,\n  ImageSelectionModule,\n  KeyboardModule,\n  KeyboardMoveSelectionModule,\n  LabelEditingModule,\n  ModelingModule,\n  MoveModule,\n  PaletteModule,\n  ReplacePreviewModule,\n  ResizeModule,\n  SnappingModule,\n];\n\n\n// modules the modeler is composed of\n//\n// - viewer modules\n// - interaction modules\n// - modeling modules\n\nModeler.prototype._modules = [].concat(\n  Viewer.prototype._modules,\n  Modeler.prototype._interactionModules,\n  Modeler.prototype._modelingModules\n);\n","'use strict';\n\nvar Modeler = require('./Modeler');\n\nmodule.exports = Modeler;\n","/*! https://mths.be/cssescape v1.5.1 by @mathias | MIT license */\n;(function(root, factory) {\n\t// https://github.com/umdjs/umd/blob/master/returnExports.js\n\tif (typeof exports == 'object') {\n\t\t// For Node.js.\n\t\tmodule.exports = factory(root);\n\t} else if (typeof define == 'function' && define.amd) {\n\t\t// For AMD. Register as an anonymous module.\n\t\tdefine([], factory.bind(root, root));\n\t} else {\n\t\t// For browser globals (not exposing the function separately).\n\t\tfactory(root);\n\t}\n}(typeof global != 'undefined' ? global : this, function(root) {\n\n\tif (root.CSS && root.CSS.escape) {\n\t\treturn root.CSS.escape;\n\t}\n\n\t// https://drafts.csswg.org/cssom/#serialize-an-identifier\n\tvar cssEscape = function(value) {\n\t\tif (arguments.length == 0) {\n\t\t\tthrow new TypeError('`CSS.escape` requires an argument.');\n\t\t}\n\t\tvar string = String(value);\n\t\tvar length = string.length;\n\t\tvar index = -1;\n\t\tvar codeUnit;\n\t\tvar result = '';\n\t\tvar firstCodeUnit = string.charCodeAt(0);\n\t\twhile (++index < length) {\n\t\t\tcodeUnit = string.charCodeAt(index);\n\t\t\t// Note: theres no need to special-case astral symbols, surrogate\n\t\t\t// pairs, or lone surrogates.\n\n\t\t\t// If the character is NULL (U+0000), then the REPLACEMENT CHARACTER\n\t\t\t// (U+FFFD).\n\t\t\tif (codeUnit == 0x0000) {\n\t\t\t\tresult += '\\uFFFD';\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\t// If the character is in the range [\\1-\\1F] (U+0001 to U+001F) or is\n\t\t\t\t// U+007F, []\n\t\t\t\t(codeUnit >= 0x0001 && codeUnit <= 0x001F) || codeUnit == 0x007F ||\n\t\t\t\t// If the character is the first character and is in the range [0-9]\n\t\t\t\t// (U+0030 to U+0039), []\n\t\t\t\t(index == 0 && codeUnit >= 0x0030 && codeUnit <= 0x0039) ||\n\t\t\t\t// If the character is the second character and is in the range [0-9]\n\t\t\t\t// (U+0030 to U+0039) and the first character is a `-` (U+002D), []\n\t\t\t\t(\n\t\t\t\t\tindex == 1 &&\n\t\t\t\t\tcodeUnit >= 0x0030 && codeUnit <= 0x0039 &&\n\t\t\t\t\tfirstCodeUnit == 0x002D\n\t\t\t\t)\n\t\t\t) {\n\t\t\t\t// https://drafts.csswg.org/cssom/#escape-a-character-as-code-point\n\t\t\t\tresult += '\\\\' + codeUnit.toString(16) + ' ';\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\t// If the character is the first character and is a `-` (U+002D), and\n\t\t\t\t// there is no second character, []\n\t\t\t\tindex == 0 &&\n\t\t\t\tlength == 1 &&\n\t\t\t\tcodeUnit == 0x002D\n\t\t\t) {\n\t\t\t\tresult += '\\\\' + string.charAt(index);\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// If the character is not handled by one of the above rules and is\n\t\t\t// greater than or equal to U+0080, is `-` (U+002D) or `_` (U+005F), or\n\t\t\t// is in one of the ranges [0-9] (U+0030 to U+0039), [A-Z] (U+0041 to\n\t\t\t// U+005A), or [a-z] (U+0061 to U+007A), []\n\t\t\tif (\n\t\t\t\tcodeUnit >= 0x0080 ||\n\t\t\t\tcodeUnit == 0x002D ||\n\t\t\t\tcodeUnit == 0x005F ||\n\t\t\t\tcodeUnit >= 0x0030 && codeUnit <= 0x0039 ||\n\t\t\t\tcodeUnit >= 0x0041 && codeUnit <= 0x005A ||\n\t\t\t\tcodeUnit >= 0x0061 && codeUnit <= 0x007A\n\t\t\t) {\n\t\t\t\t// the character itself\n\t\t\t\tresult += string.charAt(index);\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// Otherwise, the escaped character.\n\t\t\t// https://drafts.csswg.org/cssom/#escape-a-character\n\t\t\tresult += '\\\\' + string.charAt(index);\n\n\t\t}\n\t\treturn result;\n\t};\n\n\tif (!root.CSS) {\n\t\troot.CSS = {};\n\t}\n\n\troot.CSS.escape = cssEscape;\n\treturn cssEscape;\n\n}));\n","/*! Hammer.JS - v2.0.7 - 2016-04-22\n * http://hammerjs.github.io/\n *\n * Copyright (c) 2016 Jorik Tangelder;\n * Licensed under the MIT license */\n(function(window, document, exportName, undefined) {\n  'use strict';\n\nvar VENDOR_PREFIXES = ['', 'webkit', 'Moz', 'MS', 'ms', 'o'];\nvar TEST_ELEMENT = document.createElement('div');\n\nvar TYPE_FUNCTION = 'function';\n\nvar round = Math.round;\nvar abs = Math.abs;\nvar now = Date.now;\n\n/**\n * set a timeout with a given scope\n * @param {Function} fn\n * @param {Number} timeout\n * @param {Object} context\n * @returns {number}\n */\nfunction setTimeoutContext(fn, timeout, context) {\n    return setTimeout(bindFn(fn, context), timeout);\n}\n\n/**\n * if the argument is an array, we want to execute the fn on each entry\n * if it aint an array we don't want to do a thing.\n * this is used by all the methods that accept a single and array argument.\n * @param {*|Array} arg\n * @param {String} fn\n * @param {Object} [context]\n * @returns {Boolean}\n */\nfunction invokeArrayArg(arg, fn, context) {\n    if (Array.isArray(arg)) {\n        each(arg, context[fn], context);\n        return true;\n    }\n    return false;\n}\n\n/**\n * walk objects and arrays\n * @param {Object} obj\n * @param {Function} iterator\n * @param {Object} context\n */\nfunction each(obj, iterator, context) {\n    var i;\n\n    if (!obj) {\n        return;\n    }\n\n    if (obj.forEach) {\n        obj.forEach(iterator, context);\n    } else if (obj.length !== undefined) {\n        i = 0;\n        while (i < obj.length) {\n            iterator.call(context, obj[i], i, obj);\n            i++;\n        }\n    } else {\n        for (i in obj) {\n            obj.hasOwnProperty(i) && iterator.call(context, obj[i], i, obj);\n        }\n    }\n}\n\n/**\n * wrap a method with a deprecation warning and stack trace\n * @param {Function} method\n * @param {String} name\n * @param {String} message\n * @returns {Function} A new function wrapping the supplied method.\n */\nfunction deprecate(method, name, message) {\n    var deprecationMessage = 'DEPRECATED METHOD: ' + name + '\\n' + message + ' AT \\n';\n    return function() {\n        var e = new Error('get-stack-trace');\n        var stack = e && e.stack ? e.stack.replace(/^[^\\(]+?[\\n$]/gm, '')\n            .replace(/^\\s+at\\s+/gm, '')\n            .replace(/^Object.<anonymous>\\s*\\(/gm, '{anonymous}()@') : 'Unknown Stack Trace';\n\n        var log = window.console && (window.console.warn || window.console.log);\n        if (log) {\n            log.call(window.console, deprecationMessage, stack);\n        }\n        return method.apply(this, arguments);\n    };\n}\n\n/**\n * extend object.\n * means that properties in dest will be overwritten by the ones in src.\n * @param {Object} target\n * @param {...Object} objects_to_assign\n * @returns {Object} target\n */\nvar assign;\nif (typeof Object.assign !== 'function') {\n    assign = function assign(target) {\n        if (target === undefined || target === null) {\n            throw new TypeError('Cannot convert undefined or null to object');\n        }\n\n        var output = Object(target);\n        for (var index = 1; index < arguments.length; index++) {\n            var source = arguments[index];\n            if (source !== undefined && source !== null) {\n                for (var nextKey in source) {\n                    if (source.hasOwnProperty(nextKey)) {\n                        output[nextKey] = source[nextKey];\n                    }\n                }\n            }\n        }\n        return output;\n    };\n} else {\n    assign = Object.assign;\n}\n\n/**\n * extend object.\n * means that properties in dest will be overwritten by the ones in src.\n * @param {Object} dest\n * @param {Object} src\n * @param {Boolean} [merge=false]\n * @returns {Object} dest\n */\nvar extend = deprecate(function extend(dest, src, merge) {\n    var keys = Object.keys(src);\n    var i = 0;\n    while (i < keys.length) {\n        if (!merge || (merge && dest[keys[i]] === undefined)) {\n            dest[keys[i]] = src[keys[i]];\n        }\n        i++;\n    }\n    return dest;\n}, 'extend', 'Use `assign`.');\n\n/**\n * merge the values from src in the dest.\n * means that properties that exist in dest will not be overwritten by src\n * @param {Object} dest\n * @param {Object} src\n * @returns {Object} dest\n */\nvar merge = deprecate(function merge(dest, src) {\n    return extend(dest, src, true);\n}, 'merge', 'Use `assign`.');\n\n/**\n * simple class inheritance\n * @param {Function} child\n * @param {Function} base\n * @param {Object} [properties]\n */\nfunction inherit(child, base, properties) {\n    var baseP = base.prototype,\n        childP;\n\n    childP = child.prototype = Object.create(baseP);\n    childP.constructor = child;\n    childP._super = baseP;\n\n    if (properties) {\n        assign(childP, properties);\n    }\n}\n\n/**\n * simple function bind\n * @param {Function} fn\n * @param {Object} context\n * @returns {Function}\n */\nfunction bindFn(fn, context) {\n    return function boundFn() {\n        return fn.apply(context, arguments);\n    };\n}\n\n/**\n * let a boolean value also be a function that must return a boolean\n * this first item in args will be used as the context\n * @param {Boolean|Function} val\n * @param {Array} [args]\n * @returns {Boolean}\n */\nfunction boolOrFn(val, args) {\n    if (typeof val == TYPE_FUNCTION) {\n        return val.apply(args ? args[0] || undefined : undefined, args);\n    }\n    return val;\n}\n\n/**\n * use the val2 when val1 is undefined\n * @param {*} val1\n * @param {*} val2\n * @returns {*}\n */\nfunction ifUndefined(val1, val2) {\n    return (val1 === undefined) ? val2 : val1;\n}\n\n/**\n * addEventListener with multiple events at once\n * @param {EventTarget} target\n * @param {String} types\n * @param {Function} handler\n */\nfunction addEventListeners(target, types, handler) {\n    each(splitStr(types), function(type) {\n        target.addEventListener(type, handler, false);\n    });\n}\n\n/**\n * removeEventListener with multiple events at once\n * @param {EventTarget} target\n * @param {String} types\n * @param {Function} handler\n */\nfunction removeEventListeners(target, types, handler) {\n    each(splitStr(types), function(type) {\n        target.removeEventListener(type, handler, false);\n    });\n}\n\n/**\n * find if a node is in the given parent\n * @method hasParent\n * @param {HTMLElement} node\n * @param {HTMLElement} parent\n * @return {Boolean} found\n */\nfunction hasParent(node, parent) {\n    while (node) {\n        if (node == parent) {\n            return true;\n        }\n        node = node.parentNode;\n    }\n    return false;\n}\n\n/**\n * small indexOf wrapper\n * @param {String} str\n * @param {String} find\n * @returns {Boolean} found\n */\nfunction inStr(str, find) {\n    return str.indexOf(find) > -1;\n}\n\n/**\n * split string on whitespace\n * @param {String} str\n * @returns {Array} words\n */\nfunction splitStr(str) {\n    return str.trim().split(/\\s+/g);\n}\n\n/**\n * find if a array contains the object using indexOf or a simple polyFill\n * @param {Array} src\n * @param {String} find\n * @param {String} [findByKey]\n * @return {Boolean|Number} false when not found, or the index\n */\nfunction inArray(src, find, findByKey) {\n    if (src.indexOf && !findByKey) {\n        return src.indexOf(find);\n    } else {\n        var i = 0;\n        while (i < src.length) {\n            if ((findByKey && src[i][findByKey] == find) || (!findByKey && src[i] === find)) {\n                return i;\n            }\n            i++;\n        }\n        return -1;\n    }\n}\n\n/**\n * convert array-like objects to real arrays\n * @param {Object} obj\n * @returns {Array}\n */\nfunction toArray(obj) {\n    return Array.prototype.slice.call(obj, 0);\n}\n\n/**\n * unique array with objects based on a key (like 'id') or just by the array's value\n * @param {Array} src [{id:1},{id:2},{id:1}]\n * @param {String} [key]\n * @param {Boolean} [sort=False]\n * @returns {Array} [{id:1},{id:2}]\n */\nfunction uniqueArray(src, key, sort) {\n    var results = [];\n    var values = [];\n    var i = 0;\n\n    while (i < src.length) {\n        var val = key ? src[i][key] : src[i];\n        if (inArray(values, val) < 0) {\n            results.push(src[i]);\n        }\n        values[i] = val;\n        i++;\n    }\n\n    if (sort) {\n        if (!key) {\n            results = results.sort();\n        } else {\n            results = results.sort(function sortUniqueArray(a, b) {\n                return a[key] > b[key];\n            });\n        }\n    }\n\n    return results;\n}\n\n/**\n * get the prefixed property\n * @param {Object} obj\n * @param {String} property\n * @returns {String|Undefined} prefixed\n */\nfunction prefixed(obj, property) {\n    var prefix, prop;\n    var camelProp = property[0].toUpperCase() + property.slice(1);\n\n    var i = 0;\n    while (i < VENDOR_PREFIXES.length) {\n        prefix = VENDOR_PREFIXES[i];\n        prop = (prefix) ? prefix + camelProp : property;\n\n        if (prop in obj) {\n            return prop;\n        }\n        i++;\n    }\n    return undefined;\n}\n\n/**\n * get a unique id\n * @returns {number} uniqueId\n */\nvar _uniqueId = 1;\nfunction uniqueId() {\n    return _uniqueId++;\n}\n\n/**\n * get the window object of an element\n * @param {HTMLElement} element\n * @returns {DocumentView|Window}\n */\nfunction getWindowForElement(element) {\n    var doc = element.ownerDocument || element;\n    return (doc.defaultView || doc.parentWindow || window);\n}\n\nvar MOBILE_REGEX = /mobile|tablet|ip(ad|hone|od)|android/i;\n\nvar SUPPORT_TOUCH = ('ontouchstart' in window);\nvar SUPPORT_POINTER_EVENTS = prefixed(window, 'PointerEvent') !== undefined;\nvar SUPPORT_ONLY_TOUCH = SUPPORT_TOUCH && MOBILE_REGEX.test(navigator.userAgent);\n\nvar INPUT_TYPE_TOUCH = 'touch';\nvar INPUT_TYPE_PEN = 'pen';\nvar INPUT_TYPE_MOUSE = 'mouse';\nvar INPUT_TYPE_KINECT = 'kinect';\n\nvar COMPUTE_INTERVAL = 25;\n\nvar INPUT_START = 1;\nvar INPUT_MOVE = 2;\nvar INPUT_END = 4;\nvar INPUT_CANCEL = 8;\n\nvar DIRECTION_NONE = 1;\nvar DIRECTION_LEFT = 2;\nvar DIRECTION_RIGHT = 4;\nvar DIRECTION_UP = 8;\nvar DIRECTION_DOWN = 16;\n\nvar DIRECTION_HORIZONTAL = DIRECTION_LEFT | DIRECTION_RIGHT;\nvar DIRECTION_VERTICAL = DIRECTION_UP | DIRECTION_DOWN;\nvar DIRECTION_ALL = DIRECTION_HORIZONTAL | DIRECTION_VERTICAL;\n\nvar PROPS_XY = ['x', 'y'];\nvar PROPS_CLIENT_XY = ['clientX', 'clientY'];\n\n/**\n * create new input type manager\n * @param {Manager} manager\n * @param {Function} callback\n * @returns {Input}\n * @constructor\n */\nfunction Input(manager, callback) {\n    var self = this;\n    this.manager = manager;\n    this.callback = callback;\n    this.element = manager.element;\n    this.target = manager.options.inputTarget;\n\n    // smaller wrapper around the handler, for the scope and the enabled state of the manager,\n    // so when disabled the input events are completely bypassed.\n    this.domHandler = function(ev) {\n        if (boolOrFn(manager.options.enable, [manager])) {\n            self.handler(ev);\n        }\n    };\n\n    this.init();\n\n}\n\nInput.prototype = {\n    /**\n     * should handle the inputEvent data and trigger the callback\n     * @virtual\n     */\n    handler: function() { },\n\n    /**\n     * bind the events\n     */\n    init: function() {\n        this.evEl && addEventListeners(this.element, this.evEl, this.domHandler);\n        this.evTarget && addEventListeners(this.target, this.evTarget, this.domHandler);\n        this.evWin && addEventListeners(getWindowForElement(this.element), this.evWin, this.domHandler);\n    },\n\n    /**\n     * unbind the events\n     */\n    destroy: function() {\n        this.evEl && removeEventListeners(this.element, this.evEl, this.domHandler);\n        this.evTarget && removeEventListeners(this.target, this.evTarget, this.domHandler);\n        this.evWin && removeEventListeners(getWindowForElement(this.element), this.evWin, this.domHandler);\n    }\n};\n\n/**\n * create new input type manager\n * called by the Manager constructor\n * @param {Hammer} manager\n * @returns {Input}\n */\nfunction createInputInstance(manager) {\n    var Type;\n    var inputClass = manager.options.inputClass;\n\n    if (inputClass) {\n        Type = inputClass;\n    } else if (SUPPORT_POINTER_EVENTS) {\n        Type = PointerEventInput;\n    } else if (SUPPORT_ONLY_TOUCH) {\n        Type = TouchInput;\n    } else if (!SUPPORT_TOUCH) {\n        Type = MouseInput;\n    } else {\n        Type = TouchMouseInput;\n    }\n    return new (Type)(manager, inputHandler);\n}\n\n/**\n * handle input events\n * @param {Manager} manager\n * @param {String} eventType\n * @param {Object} input\n */\nfunction inputHandler(manager, eventType, input) {\n    var pointersLen = input.pointers.length;\n    var changedPointersLen = input.changedPointers.length;\n    var isFirst = (eventType & INPUT_START && (pointersLen - changedPointersLen === 0));\n    var isFinal = (eventType & (INPUT_END | INPUT_CANCEL) && (pointersLen - changedPointersLen === 0));\n\n    input.isFirst = !!isFirst;\n    input.isFinal = !!isFinal;\n\n    if (isFirst) {\n        manager.session = {};\n    }\n\n    // source event is the normalized value of the domEvents\n    // like 'touchstart, mouseup, pointerdown'\n    input.eventType = eventType;\n\n    // compute scale, rotation etc\n    computeInputData(manager, input);\n\n    // emit secret event\n    manager.emit('hammer.input', input);\n\n    manager.recognize(input);\n    manager.session.prevInput = input;\n}\n\n/**\n * extend the data with some usable properties like scale, rotate, velocity etc\n * @param {Object} manager\n * @param {Object} input\n */\nfunction computeInputData(manager, input) {\n    var session = manager.session;\n    var pointers = input.pointers;\n    var pointersLength = pointers.length;\n\n    // store the first input to calculate the distance and direction\n    if (!session.firstInput) {\n        session.firstInput = simpleCloneInputData(input);\n    }\n\n    // to compute scale and rotation we need to store the multiple touches\n    if (pointersLength > 1 && !session.firstMultiple) {\n        session.firstMultiple = simpleCloneInputData(input);\n    } else if (pointersLength === 1) {\n        session.firstMultiple = false;\n    }\n\n    var firstInput = session.firstInput;\n    var firstMultiple = session.firstMultiple;\n    var offsetCenter = firstMultiple ? firstMultiple.center : firstInput.center;\n\n    var center = input.center = getCenter(pointers);\n    input.timeStamp = now();\n    input.deltaTime = input.timeStamp - firstInput.timeStamp;\n\n    input.angle = getAngle(offsetCenter, center);\n    input.distance = getDistance(offsetCenter, center);\n\n    computeDeltaXY(session, input);\n    input.offsetDirection = getDirection(input.deltaX, input.deltaY);\n\n    var overallVelocity = getVelocity(input.deltaTime, input.deltaX, input.deltaY);\n    input.overallVelocityX = overallVelocity.x;\n    input.overallVelocityY = overallVelocity.y;\n    input.overallVelocity = (abs(overallVelocity.x) > abs(overallVelocity.y)) ? overallVelocity.x : overallVelocity.y;\n\n    input.scale = firstMultiple ? getScale(firstMultiple.pointers, pointers) : 1;\n    input.rotation = firstMultiple ? getRotation(firstMultiple.pointers, pointers) : 0;\n\n    input.maxPointers = !session.prevInput ? input.pointers.length : ((input.pointers.length >\n        session.prevInput.maxPointers) ? input.pointers.length : session.prevInput.maxPointers);\n\n    computeIntervalInputData(session, input);\n\n    // find the correct target\n    var target = manager.element;\n    if (hasParent(input.srcEvent.target, target)) {\n        target = input.srcEvent.target;\n    }\n    input.target = target;\n}\n\nfunction computeDeltaXY(session, input) {\n    var center = input.center;\n    var offset = session.offsetDelta || {};\n    var prevDelta = session.prevDelta || {};\n    var prevInput = session.prevInput || {};\n\n    if (input.eventType === INPUT_START || prevInput.eventType === INPUT_END) {\n        prevDelta = session.prevDelta = {\n            x: prevInput.deltaX || 0,\n            y: prevInput.deltaY || 0\n        };\n\n        offset = session.offsetDelta = {\n            x: center.x,\n            y: center.y\n        };\n    }\n\n    input.deltaX = prevDelta.x + (center.x - offset.x);\n    input.deltaY = prevDelta.y + (center.y - offset.y);\n}\n\n/**\n * velocity is calculated every x ms\n * @param {Object} session\n * @param {Object} input\n */\nfunction computeIntervalInputData(session, input) {\n    var last = session.lastInterval || input,\n        deltaTime = input.timeStamp - last.timeStamp,\n        velocity, velocityX, velocityY, direction;\n\n    if (input.eventType != INPUT_CANCEL && (deltaTime > COMPUTE_INTERVAL || last.velocity === undefined)) {\n        var deltaX = input.deltaX - last.deltaX;\n        var deltaY = input.deltaY - last.deltaY;\n\n        var v = getVelocity(deltaTime, deltaX, deltaY);\n        velocityX = v.x;\n        velocityY = v.y;\n        velocity = (abs(v.x) > abs(v.y)) ? v.x : v.y;\n        direction = getDirection(deltaX, deltaY);\n\n        session.lastInterval = input;\n    } else {\n        // use latest velocity info if it doesn't overtake a minimum period\n        velocity = last.velocity;\n        velocityX = last.velocityX;\n        velocityY = last.velocityY;\n        direction = last.direction;\n    }\n\n    input.velocity = velocity;\n    input.velocityX = velocityX;\n    input.velocityY = velocityY;\n    input.direction = direction;\n}\n\n/**\n * create a simple clone from the input used for storage of firstInput and firstMultiple\n * @param {Object} input\n * @returns {Object} clonedInputData\n */\nfunction simpleCloneInputData(input) {\n    // make a simple copy of the pointers because we will get a reference if we don't\n    // we only need clientXY for the calculations\n    var pointers = [];\n    var i = 0;\n    while (i < input.pointers.length) {\n        pointers[i] = {\n            clientX: round(input.pointers[i].clientX),\n            clientY: round(input.pointers[i].clientY)\n        };\n        i++;\n    }\n\n    return {\n        timeStamp: now(),\n        pointers: pointers,\n        center: getCenter(pointers),\n        deltaX: input.deltaX,\n        deltaY: input.deltaY\n    };\n}\n\n/**\n * get the center of all the pointers\n * @param {Array} pointers\n * @return {Object} center contains `x` and `y` properties\n */\nfunction getCenter(pointers) {\n    var pointersLength = pointers.length;\n\n    // no need to loop when only one touch\n    if (pointersLength === 1) {\n        return {\n            x: round(pointers[0].clientX),\n            y: round(pointers[0].clientY)\n        };\n    }\n\n    var x = 0, y = 0, i = 0;\n    while (i < pointersLength) {\n        x += pointers[i].clientX;\n        y += pointers[i].clientY;\n        i++;\n    }\n\n    return {\n        x: round(x / pointersLength),\n        y: round(y / pointersLength)\n    };\n}\n\n/**\n * calculate the velocity between two points. unit is in px per ms.\n * @param {Number} deltaTime\n * @param {Number} x\n * @param {Number} y\n * @return {Object} velocity `x` and `y`\n */\nfunction getVelocity(deltaTime, x, y) {\n    return {\n        x: x / deltaTime || 0,\n        y: y / deltaTime || 0\n    };\n}\n\n/**\n * get the direction between two points\n * @param {Number} x\n * @param {Number} y\n * @return {Number} direction\n */\nfunction getDirection(x, y) {\n    if (x === y) {\n        return DIRECTION_NONE;\n    }\n\n    if (abs(x) >= abs(y)) {\n        return x < 0 ? DIRECTION_LEFT : DIRECTION_RIGHT;\n    }\n    return y < 0 ? DIRECTION_UP : DIRECTION_DOWN;\n}\n\n/**\n * calculate the absolute distance between two points\n * @param {Object} p1 {x, y}\n * @param {Object} p2 {x, y}\n * @param {Array} [props] containing x and y keys\n * @return {Number} distance\n */\nfunction getDistance(p1, p2, props) {\n    if (!props) {\n        props = PROPS_XY;\n    }\n    var x = p2[props[0]] - p1[props[0]],\n        y = p2[props[1]] - p1[props[1]];\n\n    return Math.sqrt((x * x) + (y * y));\n}\n\n/**\n * calculate the angle between two coordinates\n * @param {Object} p1\n * @param {Object} p2\n * @param {Array} [props] containing x and y keys\n * @return {Number} angle\n */\nfunction getAngle(p1, p2, props) {\n    if (!props) {\n        props = PROPS_XY;\n    }\n    var x = p2[props[0]] - p1[props[0]],\n        y = p2[props[1]] - p1[props[1]];\n    return Math.atan2(y, x) * 180 / Math.PI;\n}\n\n/**\n * calculate the rotation degrees between two pointersets\n * @param {Array} start array of pointers\n * @param {Array} end array of pointers\n * @return {Number} rotation\n */\nfunction getRotation(start, end) {\n    return getAngle(end[1], end[0], PROPS_CLIENT_XY) + getAngle(start[1], start[0], PROPS_CLIENT_XY);\n}\n\n/**\n * calculate the scale factor between two pointersets\n * no scale is 1, and goes down to 0 when pinched together, and bigger when pinched out\n * @param {Array} start array of pointers\n * @param {Array} end array of pointers\n * @return {Number} scale\n */\nfunction getScale(start, end) {\n    return getDistance(end[0], end[1], PROPS_CLIENT_XY) / getDistance(start[0], start[1], PROPS_CLIENT_XY);\n}\n\nvar MOUSE_INPUT_MAP = {\n    mousedown: INPUT_START,\n    mousemove: INPUT_MOVE,\n    mouseup: INPUT_END\n};\n\nvar MOUSE_ELEMENT_EVENTS = 'mousedown';\nvar MOUSE_WINDOW_EVENTS = 'mousemove mouseup';\n\n/**\n * Mouse events input\n * @constructor\n * @extends Input\n */\nfunction MouseInput() {\n    this.evEl = MOUSE_ELEMENT_EVENTS;\n    this.evWin = MOUSE_WINDOW_EVENTS;\n\n    this.pressed = false; // mousedown state\n\n    Input.apply(this, arguments);\n}\n\ninherit(MouseInput, Input, {\n    /**\n     * handle mouse events\n     * @param {Object} ev\n     */\n    handler: function MEhandler(ev) {\n        var eventType = MOUSE_INPUT_MAP[ev.type];\n\n        // on start we want to have the left mouse button down\n        if (eventType & INPUT_START && ev.button === 0) {\n            this.pressed = true;\n        }\n\n        if (eventType & INPUT_MOVE && ev.which !== 1) {\n            eventType = INPUT_END;\n        }\n\n        // mouse must be down\n        if (!this.pressed) {\n            return;\n        }\n\n        if (eventType & INPUT_END) {\n            this.pressed = false;\n        }\n\n        this.callback(this.manager, eventType, {\n            pointers: [ev],\n            changedPointers: [ev],\n            pointerType: INPUT_TYPE_MOUSE,\n            srcEvent: ev\n        });\n    }\n});\n\nvar POINTER_INPUT_MAP = {\n    pointerdown: INPUT_START,\n    pointermove: INPUT_MOVE,\n    pointerup: INPUT_END,\n    pointercancel: INPUT_CANCEL,\n    pointerout: INPUT_CANCEL\n};\n\n// in IE10 the pointer types is defined as an enum\nvar IE10_POINTER_TYPE_ENUM = {\n    2: INPUT_TYPE_TOUCH,\n    3: INPUT_TYPE_PEN,\n    4: INPUT_TYPE_MOUSE,\n    5: INPUT_TYPE_KINECT // see https://twitter.com/jacobrossi/status/480596438489890816\n};\n\nvar POINTER_ELEMENT_EVENTS = 'pointerdown';\nvar POINTER_WINDOW_EVENTS = 'pointermove pointerup pointercancel';\n\n// IE10 has prefixed support, and case-sensitive\nif (window.MSPointerEvent && !window.PointerEvent) {\n    POINTER_ELEMENT_EVENTS = 'MSPointerDown';\n    POINTER_WINDOW_EVENTS = 'MSPointerMove MSPointerUp MSPointerCancel';\n}\n\n/**\n * Pointer events input\n * @constructor\n * @extends Input\n */\nfunction PointerEventInput() {\n    this.evEl = POINTER_ELEMENT_EVENTS;\n    this.evWin = POINTER_WINDOW_EVENTS;\n\n    Input.apply(this, arguments);\n\n    this.store = (this.manager.session.pointerEvents = []);\n}\n\ninherit(PointerEventInput, Input, {\n    /**\n     * handle mouse events\n     * @param {Object} ev\n     */\n    handler: function PEhandler(ev) {\n        var store = this.store;\n        var removePointer = false;\n\n        var eventTypeNormalized = ev.type.toLowerCase().replace('ms', '');\n        var eventType = POINTER_INPUT_MAP[eventTypeNormalized];\n        var pointerType = IE10_POINTER_TYPE_ENUM[ev.pointerType] || ev.pointerType;\n\n        var isTouch = (pointerType == INPUT_TYPE_TOUCH);\n\n        // get index of the event in the store\n        var storeIndex = inArray(store, ev.pointerId, 'pointerId');\n\n        // start and mouse must be down\n        if (eventType & INPUT_START && (ev.button === 0 || isTouch)) {\n            if (storeIndex < 0) {\n                store.push(ev);\n                storeIndex = store.length - 1;\n            }\n        } else if (eventType & (INPUT_END | INPUT_CANCEL)) {\n            removePointer = true;\n        }\n\n        // it not found, so the pointer hasn't been down (so it's probably a hover)\n        if (storeIndex < 0) {\n            return;\n        }\n\n        // update the event in the store\n        store[storeIndex] = ev;\n\n        this.callback(this.manager, eventType, {\n            pointers: store,\n            changedPointers: [ev],\n            pointerType: pointerType,\n            srcEvent: ev\n        });\n\n        if (removePointer) {\n            // remove from the store\n            store.splice(storeIndex, 1);\n        }\n    }\n});\n\nvar SINGLE_TOUCH_INPUT_MAP = {\n    touchstart: INPUT_START,\n    touchmove: INPUT_MOVE,\n    touchend: INPUT_END,\n    touchcancel: INPUT_CANCEL\n};\n\nvar SINGLE_TOUCH_TARGET_EVENTS = 'touchstart';\nvar SINGLE_TOUCH_WINDOW_EVENTS = 'touchstart touchmove touchend touchcancel';\n\n/**\n * Touch events input\n * @constructor\n * @extends Input\n */\nfunction SingleTouchInput() {\n    this.evTarget = SINGLE_TOUCH_TARGET_EVENTS;\n    this.evWin = SINGLE_TOUCH_WINDOW_EVENTS;\n    this.started = false;\n\n    Input.apply(this, arguments);\n}\n\ninherit(SingleTouchInput, Input, {\n    handler: function TEhandler(ev) {\n        var type = SINGLE_TOUCH_INPUT_MAP[ev.type];\n\n        // should we handle the touch events?\n        if (type === INPUT_START) {\n            this.started = true;\n        }\n\n        if (!this.started) {\n            return;\n        }\n\n        var touches = normalizeSingleTouches.call(this, ev, type);\n\n        // when done, reset the started state\n        if (type & (INPUT_END | INPUT_CANCEL) && touches[0].length - touches[1].length === 0) {\n            this.started = false;\n        }\n\n        this.callback(this.manager, type, {\n            pointers: touches[0],\n            changedPointers: touches[1],\n            pointerType: INPUT_TYPE_TOUCH,\n            srcEvent: ev\n        });\n    }\n});\n\n/**\n * @this {TouchInput}\n * @param {Object} ev\n * @param {Number} type flag\n * @returns {undefined|Array} [all, changed]\n */\nfunction normalizeSingleTouches(ev, type) {\n    var all = toArray(ev.touches);\n    var changed = toArray(ev.changedTouches);\n\n    if (type & (INPUT_END | INPUT_CANCEL)) {\n        all = uniqueArray(all.concat(changed), 'identifier', true);\n    }\n\n    return [all, changed];\n}\n\nvar TOUCH_INPUT_MAP = {\n    touchstart: INPUT_START,\n    touchmove: INPUT_MOVE,\n    touchend: INPUT_END,\n    touchcancel: INPUT_CANCEL\n};\n\nvar TOUCH_TARGET_EVENTS = 'touchstart touchmove touchend touchcancel';\n\n/**\n * Multi-user touch events input\n * @constructor\n * @extends Input\n */\nfunction TouchInput() {\n    this.evTarget = TOUCH_TARGET_EVENTS;\n    this.targetIds = {};\n\n    Input.apply(this, arguments);\n}\n\ninherit(TouchInput, Input, {\n    handler: function MTEhandler(ev) {\n        var type = TOUCH_INPUT_MAP[ev.type];\n        var touches = getTouches.call(this, ev, type);\n        if (!touches) {\n            return;\n        }\n\n        this.callback(this.manager, type, {\n            pointers: touches[0],\n            changedPointers: touches[1],\n            pointerType: INPUT_TYPE_TOUCH,\n            srcEvent: ev\n        });\n    }\n});\n\n/**\n * @this {TouchInput}\n * @param {Object} ev\n * @param {Number} type flag\n * @returns {undefined|Array} [all, changed]\n */\nfunction getTouches(ev, type) {\n    var allTouches = toArray(ev.touches);\n    var targetIds = this.targetIds;\n\n    // when there is only one touch, the process can be simplified\n    if (type & (INPUT_START | INPUT_MOVE) && allTouches.length === 1) {\n        targetIds[allTouches[0].identifier] = true;\n        return [allTouches, allTouches];\n    }\n\n    var i,\n        targetTouches,\n        changedTouches = toArray(ev.changedTouches),\n        changedTargetTouches = [],\n        target = this.target;\n\n    // get target touches from touches\n    targetTouches = allTouches.filter(function(touch) {\n        return hasParent(touch.target, target);\n    });\n\n    // collect touches\n    if (type === INPUT_START) {\n        i = 0;\n        while (i < targetTouches.length) {\n            targetIds[targetTouches[i].identifier] = true;\n            i++;\n        }\n    }\n\n    // filter changed touches to only contain touches that exist in the collected target ids\n    i = 0;\n    while (i < changedTouches.length) {\n        if (targetIds[changedTouches[i].identifier]) {\n            changedTargetTouches.push(changedTouches[i]);\n        }\n\n        // cleanup removed touches\n        if (type & (INPUT_END | INPUT_CANCEL)) {\n            delete targetIds[changedTouches[i].identifier];\n        }\n        i++;\n    }\n\n    if (!changedTargetTouches.length) {\n        return;\n    }\n\n    return [\n        // merge targetTouches with changedTargetTouches so it contains ALL touches, including 'end' and 'cancel'\n        uniqueArray(targetTouches.concat(changedTargetTouches), 'identifier', true),\n        changedTargetTouches\n    ];\n}\n\n/**\n * Combined touch and mouse input\n *\n * Touch has a higher priority then mouse, and while touching no mouse events are allowed.\n * This because touch devices also emit mouse events while doing a touch.\n *\n * @constructor\n * @extends Input\n */\n\nvar DEDUP_TIMEOUT = 2500;\nvar DEDUP_DISTANCE = 25;\n\nfunction TouchMouseInput() {\n    Input.apply(this, arguments);\n\n    var handler = bindFn(this.handler, this);\n    this.touch = new TouchInput(this.manager, handler);\n    this.mouse = new MouseInput(this.manager, handler);\n\n    this.primaryTouch = null;\n    this.lastTouches = [];\n}\n\ninherit(TouchMouseInput, Input, {\n    /**\n     * handle mouse and touch events\n     * @param {Hammer} manager\n     * @param {String} inputEvent\n     * @param {Object} inputData\n     */\n    handler: function TMEhandler(manager, inputEvent, inputData) {\n        var isTouch = (inputData.pointerType == INPUT_TYPE_TOUCH),\n            isMouse = (inputData.pointerType == INPUT_TYPE_MOUSE);\n\n        if (isMouse && inputData.sourceCapabilities && inputData.sourceCapabilities.firesTouchEvents) {\n            return;\n        }\n\n        // when we're in a touch event, record touches to  de-dupe synthetic mouse event\n        if (isTouch) {\n            recordTouches.call(this, inputEvent, inputData);\n        } else if (isMouse && isSyntheticEvent.call(this, inputData)) {\n            return;\n        }\n\n        this.callback(manager, inputEvent, inputData);\n    },\n\n    /**\n     * remove the event listeners\n     */\n    destroy: function destroy() {\n        this.touch.destroy();\n        this.mouse.destroy();\n    }\n});\n\nfunction recordTouches(eventType, eventData) {\n    if (eventType & INPUT_START) {\n        this.primaryTouch = eventData.changedPointers[0].identifier;\n        setLastTouch.call(this, eventData);\n    } else if (eventType & (INPUT_END | INPUT_CANCEL)) {\n        setLastTouch.call(this, eventData);\n    }\n}\n\nfunction setLastTouch(eventData) {\n    var touch = eventData.changedPointers[0];\n\n    if (touch.identifier === this.primaryTouch) {\n        var lastTouch = {x: touch.clientX, y: touch.clientY};\n        this.lastTouches.push(lastTouch);\n        var lts = this.lastTouches;\n        var removeLastTouch = function() {\n            var i = lts.indexOf(lastTouch);\n            if (i > -1) {\n                lts.splice(i, 1);\n            }\n        };\n        setTimeout(removeLastTouch, DEDUP_TIMEOUT);\n    }\n}\n\nfunction isSyntheticEvent(eventData) {\n    var x = eventData.srcEvent.clientX, y = eventData.srcEvent.clientY;\n    for (var i = 0; i < this.lastTouches.length; i++) {\n        var t = this.lastTouches[i];\n        var dx = Math.abs(x - t.x), dy = Math.abs(y - t.y);\n        if (dx <= DEDUP_DISTANCE && dy <= DEDUP_DISTANCE) {\n            return true;\n        }\n    }\n    return false;\n}\n\nvar PREFIXED_TOUCH_ACTION = prefixed(TEST_ELEMENT.style, 'touchAction');\nvar NATIVE_TOUCH_ACTION = PREFIXED_TOUCH_ACTION !== undefined;\n\n// magical touchAction value\nvar TOUCH_ACTION_COMPUTE = 'compute';\nvar TOUCH_ACTION_AUTO = 'auto';\nvar TOUCH_ACTION_MANIPULATION = 'manipulation'; // not implemented\nvar TOUCH_ACTION_NONE = 'none';\nvar TOUCH_ACTION_PAN_X = 'pan-x';\nvar TOUCH_ACTION_PAN_Y = 'pan-y';\nvar TOUCH_ACTION_MAP = getTouchActionProps();\n\n/**\n * Touch Action\n * sets the touchAction property or uses the js alternative\n * @param {Manager} manager\n * @param {String} value\n * @constructor\n */\nfunction TouchAction(manager, value) {\n    this.manager = manager;\n    this.set(value);\n}\n\nTouchAction.prototype = {\n    /**\n     * set the touchAction value on the element or enable the polyfill\n     * @param {String} value\n     */\n    set: function(value) {\n        // find out the touch-action by the event handlers\n        if (value == TOUCH_ACTION_COMPUTE) {\n            value = this.compute();\n        }\n\n        if (NATIVE_TOUCH_ACTION && this.manager.element.style && TOUCH_ACTION_MAP[value]) {\n            this.manager.element.style[PREFIXED_TOUCH_ACTION] = value;\n        }\n        this.actions = value.toLowerCase().trim();\n    },\n\n    /**\n     * just re-set the touchAction value\n     */\n    update: function() {\n        this.set(this.manager.options.touchAction);\n    },\n\n    /**\n     * compute the value for the touchAction property based on the recognizer's settings\n     * @returns {String} value\n     */\n    compute: function() {\n        var actions = [];\n        each(this.manager.recognizers, function(recognizer) {\n            if (boolOrFn(recognizer.options.enable, [recognizer])) {\n                actions = actions.concat(recognizer.getTouchAction());\n            }\n        });\n        return cleanTouchActions(actions.join(' '));\n    },\n\n    /**\n     * this method is called on each input cycle and provides the preventing of the browser behavior\n     * @param {Object} input\n     */\n    preventDefaults: function(input) {\n        var srcEvent = input.srcEvent;\n        var direction = input.offsetDirection;\n\n        // if the touch action did prevented once this session\n        if (this.manager.session.prevented) {\n            srcEvent.preventDefault();\n            return;\n        }\n\n        var actions = this.actions;\n        var hasNone = inStr(actions, TOUCH_ACTION_NONE) && !TOUCH_ACTION_MAP[TOUCH_ACTION_NONE];\n        var hasPanY = inStr(actions, TOUCH_ACTION_PAN_Y) && !TOUCH_ACTION_MAP[TOUCH_ACTION_PAN_Y];\n        var hasPanX = inStr(actions, TOUCH_ACTION_PAN_X) && !TOUCH_ACTION_MAP[TOUCH_ACTION_PAN_X];\n\n        if (hasNone) {\n            //do not prevent defaults if this is a tap gesture\n\n            var isTapPointer = input.pointers.length === 1;\n            var isTapMovement = input.distance < 2;\n            var isTapTouchTime = input.deltaTime < 250;\n\n            if (isTapPointer && isTapMovement && isTapTouchTime) {\n                return;\n            }\n        }\n\n        if (hasPanX && hasPanY) {\n            // `pan-x pan-y` means browser handles all scrolling/panning, do not prevent\n            return;\n        }\n\n        if (hasNone ||\n            (hasPanY && direction & DIRECTION_HORIZONTAL) ||\n            (hasPanX && direction & DIRECTION_VERTICAL)) {\n            return this.preventSrc(srcEvent);\n        }\n    },\n\n    /**\n     * call preventDefault to prevent the browser's default behavior (scrolling in most cases)\n     * @param {Object} srcEvent\n     */\n    preventSrc: function(srcEvent) {\n        this.manager.session.prevented = true;\n        srcEvent.preventDefault();\n    }\n};\n\n/**\n * when the touchActions are collected they are not a valid value, so we need to clean things up. *\n * @param {String} actions\n * @returns {*}\n */\nfunction cleanTouchActions(actions) {\n    // none\n    if (inStr(actions, TOUCH_ACTION_NONE)) {\n        return TOUCH_ACTION_NONE;\n    }\n\n    var hasPanX = inStr(actions, TOUCH_ACTION_PAN_X);\n    var hasPanY = inStr(actions, TOUCH_ACTION_PAN_Y);\n\n    // if both pan-x and pan-y are set (different recognizers\n    // for different directions, e.g. horizontal pan but vertical swipe?)\n    // we need none (as otherwise with pan-x pan-y combined none of these\n    // recognizers will work, since the browser would handle all panning\n    if (hasPanX && hasPanY) {\n        return TOUCH_ACTION_NONE;\n    }\n\n    // pan-x OR pan-y\n    if (hasPanX || hasPanY) {\n        return hasPanX ? TOUCH_ACTION_PAN_X : TOUCH_ACTION_PAN_Y;\n    }\n\n    // manipulation\n    if (inStr(actions, TOUCH_ACTION_MANIPULATION)) {\n        return TOUCH_ACTION_MANIPULATION;\n    }\n\n    return TOUCH_ACTION_AUTO;\n}\n\nfunction getTouchActionProps() {\n    if (!NATIVE_TOUCH_ACTION) {\n        return false;\n    }\n    var touchMap = {};\n    var cssSupports = window.CSS && window.CSS.supports;\n    ['auto', 'manipulation', 'pan-y', 'pan-x', 'pan-x pan-y', 'none'].forEach(function(val) {\n\n        // If css.supports is not supported but there is native touch-action assume it supports\n        // all values. This is the case for IE 10 and 11.\n        touchMap[val] = cssSupports ? window.CSS.supports('touch-action', val) : true;\n    });\n    return touchMap;\n}\n\n/**\n * Recognizer flow explained; *\n * All recognizers have the initial state of POSSIBLE when a input session starts.\n * The definition of a input session is from the first input until the last input, with all it's movement in it. *\n * Example session for mouse-input: mousedown -> mousemove -> mouseup\n *\n * On each recognizing cycle (see Manager.recognize) the .recognize() method is executed\n * which determines with state it should be.\n *\n * If the recognizer has the state FAILED, CANCELLED or RECOGNIZED (equals ENDED), it is reset to\n * POSSIBLE to give it another change on the next cycle.\n *\n *               Possible\n *                  |\n *            +-----+---------------+\n *            |                     |\n *      +-----+-----+               |\n *      |           |               |\n *   Failed      Cancelled          |\n *                          +-------+------+\n *                          |              |\n *                      Recognized       Began\n *                                         |\n *                                      Changed\n *                                         |\n *                                  Ended/Recognized\n */\nvar STATE_POSSIBLE = 1;\nvar STATE_BEGAN = 2;\nvar STATE_CHANGED = 4;\nvar STATE_ENDED = 8;\nvar STATE_RECOGNIZED = STATE_ENDED;\nvar STATE_CANCELLED = 16;\nvar STATE_FAILED = 32;\n\n/**\n * Recognizer\n * Every recognizer needs to extend from this class.\n * @constructor\n * @param {Object} options\n */\nfunction Recognizer(options) {\n    this.options = assign({}, this.defaults, options || {});\n\n    this.id = uniqueId();\n\n    this.manager = null;\n\n    // default is enable true\n    this.options.enable = ifUndefined(this.options.enable, true);\n\n    this.state = STATE_POSSIBLE;\n\n    this.simultaneous = {};\n    this.requireFail = [];\n}\n\nRecognizer.prototype = {\n    /**\n     * @virtual\n     * @type {Object}\n     */\n    defaults: {},\n\n    /**\n     * set options\n     * @param {Object} options\n     * @return {Recognizer}\n     */\n    set: function(options) {\n        assign(this.options, options);\n\n        // also update the touchAction, in case something changed about the directions/enabled state\n        this.manager && this.manager.touchAction.update();\n        return this;\n    },\n\n    /**\n     * recognize simultaneous with an other recognizer.\n     * @param {Recognizer} otherRecognizer\n     * @returns {Recognizer} this\n     */\n    recognizeWith: function(otherRecognizer) {\n        if (invokeArrayArg(otherRecognizer, 'recognizeWith', this)) {\n            return this;\n        }\n\n        var simultaneous = this.simultaneous;\n        otherRecognizer = getRecognizerByNameIfManager(otherRecognizer, this);\n        if (!simultaneous[otherRecognizer.id]) {\n            simultaneous[otherRecognizer.id] = otherRecognizer;\n            otherRecognizer.recognizeWith(this);\n        }\n        return this;\n    },\n\n    /**\n     * drop the simultaneous link. it doesnt remove the link on the other recognizer.\n     * @param {Recognizer} otherRecognizer\n     * @returns {Recognizer} this\n     */\n    dropRecognizeWith: function(otherRecognizer) {\n        if (invokeArrayArg(otherRecognizer, 'dropRecognizeWith', this)) {\n            return this;\n        }\n\n        otherRecognizer = getRecognizerByNameIfManager(otherRecognizer, this);\n        delete this.simultaneous[otherRecognizer.id];\n        return this;\n    },\n\n    /**\n     * recognizer can only run when an other is failing\n     * @param {Recognizer} otherRecognizer\n     * @returns {Recognizer} this\n     */\n    requireFailure: function(otherRecognizer) {\n        if (invokeArrayArg(otherRecognizer, 'requireFailure', this)) {\n            return this;\n        }\n\n        var requireFail = this.requireFail;\n        otherRecognizer = getRecognizerByNameIfManager(otherRecognizer, this);\n        if (inArray(requireFail, otherRecognizer) === -1) {\n            requireFail.push(otherRecognizer);\n            otherRecognizer.requireFailure(this);\n        }\n        return this;\n    },\n\n    /**\n     * drop the requireFailure link. it does not remove the link on the other recognizer.\n     * @param {Recognizer} otherRecognizer\n     * @returns {Recognizer} this\n     */\n    dropRequireFailure: function(otherRecognizer) {\n        if (invokeArrayArg(otherRecognizer, 'dropRequireFailure', this)) {\n            return this;\n        }\n\n        otherRecognizer = getRecognizerByNameIfManager(otherRecognizer, this);\n        var index = inArray(this.requireFail, otherRecognizer);\n        if (index > -1) {\n            this.requireFail.splice(index, 1);\n        }\n        return this;\n    },\n\n    /**\n     * has require failures boolean\n     * @returns {boolean}\n     */\n    hasRequireFailures: function() {\n        return this.requireFail.length > 0;\n    },\n\n    /**\n     * if the recognizer can recognize simultaneous with an other recognizer\n     * @param {Recognizer} otherRecognizer\n     * @returns {Boolean}\n     */\n    canRecognizeWith: function(otherRecognizer) {\n        return !!this.simultaneous[otherRecognizer.id];\n    },\n\n    /**\n     * You should use `tryEmit` instead of `emit` directly to check\n     * that all the needed recognizers has failed before emitting.\n     * @param {Object} input\n     */\n    emit: function(input) {\n        var self = this;\n        var state = this.state;\n\n        function emit(event) {\n            self.manager.emit(event, input);\n        }\n\n        // 'panstart' and 'panmove'\n        if (state < STATE_ENDED) {\n            emit(self.options.event + stateStr(state));\n        }\n\n        emit(self.options.event); // simple 'eventName' events\n\n        if (input.additionalEvent) { // additional event(panleft, panright, pinchin, pinchout...)\n            emit(input.additionalEvent);\n        }\n\n        // panend and pancancel\n        if (state >= STATE_ENDED) {\n            emit(self.options.event + stateStr(state));\n        }\n    },\n\n    /**\n     * Check that all the require failure recognizers has failed,\n     * if true, it emits a gesture event,\n     * otherwise, setup the state to FAILED.\n     * @param {Object} input\n     */\n    tryEmit: function(input) {\n        if (this.canEmit()) {\n            return this.emit(input);\n        }\n        // it's failing anyway\n        this.state = STATE_FAILED;\n    },\n\n    /**\n     * can we emit?\n     * @returns {boolean}\n     */\n    canEmit: function() {\n        var i = 0;\n        while (i < this.requireFail.length) {\n            if (!(this.requireFail[i].state & (STATE_FAILED | STATE_POSSIBLE))) {\n                return false;\n            }\n            i++;\n        }\n        return true;\n    },\n\n    /**\n     * update the recognizer\n     * @param {Object} inputData\n     */\n    recognize: function(inputData) {\n        // make a new copy of the inputData\n        // so we can change the inputData without messing up the other recognizers\n        var inputDataClone = assign({}, inputData);\n\n        // is is enabled and allow recognizing?\n        if (!boolOrFn(this.options.enable, [this, inputDataClone])) {\n            this.reset();\n            this.state = STATE_FAILED;\n            return;\n        }\n\n        // reset when we've reached the end\n        if (this.state & (STATE_RECOGNIZED | STATE_CANCELLED | STATE_FAILED)) {\n            this.state = STATE_POSSIBLE;\n        }\n\n        this.state = this.process(inputDataClone);\n\n        // the recognizer has recognized a gesture\n        // so trigger an event\n        if (this.state & (STATE_BEGAN | STATE_CHANGED | STATE_ENDED | STATE_CANCELLED)) {\n            this.tryEmit(inputDataClone);\n        }\n    },\n\n    /**\n     * return the state of the recognizer\n     * the actual recognizing happens in this method\n     * @virtual\n     * @param {Object} inputData\n     * @returns {Const} STATE\n     */\n    process: function(inputData) { }, // jshint ignore:line\n\n    /**\n     * return the preferred touch-action\n     * @virtual\n     * @returns {Array}\n     */\n    getTouchAction: function() { },\n\n    /**\n     * called when the gesture isn't allowed to recognize\n     * like when another is being recognized or it is disabled\n     * @virtual\n     */\n    reset: function() { }\n};\n\n/**\n * get a usable string, used as event postfix\n * @param {Const} state\n * @returns {String} state\n */\nfunction stateStr(state) {\n    if (state & STATE_CANCELLED) {\n        return 'cancel';\n    } else if (state & STATE_ENDED) {\n        return 'end';\n    } else if (state & STATE_CHANGED) {\n        return 'move';\n    } else if (state & STATE_BEGAN) {\n        return 'start';\n    }\n    return '';\n}\n\n/**\n * direction cons to string\n * @param {Const} direction\n * @returns {String}\n */\nfunction directionStr(direction) {\n    if (direction == DIRECTION_DOWN) {\n        return 'down';\n    } else if (direction == DIRECTION_UP) {\n        return 'up';\n    } else if (direction == DIRECTION_LEFT) {\n        return 'left';\n    } else if (direction == DIRECTION_RIGHT) {\n        return 'right';\n    }\n    return '';\n}\n\n/**\n * get a recognizer by name if it is bound to a manager\n * @param {Recognizer|String} otherRecognizer\n * @param {Recognizer} recognizer\n * @returns {Recognizer}\n */\nfunction getRecognizerByNameIfManager(otherRecognizer, recognizer) {\n    var manager = recognizer.manager;\n    if (manager) {\n        return manager.get(otherRecognizer);\n    }\n    return otherRecognizer;\n}\n\n/**\n * This recognizer is just used as a base for the simple attribute recognizers.\n * @constructor\n * @extends Recognizer\n */\nfunction AttrRecognizer() {\n    Recognizer.apply(this, arguments);\n}\n\ninherit(AttrRecognizer, Recognizer, {\n    /**\n     * @namespace\n     * @memberof AttrRecognizer\n     */\n    defaults: {\n        /**\n         * @type {Number}\n         * @default 1\n         */\n        pointers: 1\n    },\n\n    /**\n     * Used to check if it the recognizer receives valid input, like input.distance > 10.\n     * @memberof AttrRecognizer\n     * @param {Object} input\n     * @returns {Boolean} recognized\n     */\n    attrTest: function(input) {\n        var optionPointers = this.options.pointers;\n        return optionPointers === 0 || input.pointers.length === optionPointers;\n    },\n\n    /**\n     * Process the input and return the state for the recognizer\n     * @memberof AttrRecognizer\n     * @param {Object} input\n     * @returns {*} State\n     */\n    process: function(input) {\n        var state = this.state;\n        var eventType = input.eventType;\n\n        var isRecognized = state & (STATE_BEGAN | STATE_CHANGED);\n        var isValid = this.attrTest(input);\n\n        // on cancel input and we've recognized before, return STATE_CANCELLED\n        if (isRecognized && (eventType & INPUT_CANCEL || !isValid)) {\n            return state | STATE_CANCELLED;\n        } else if (isRecognized || isValid) {\n            if (eventType & INPUT_END) {\n                return state | STATE_ENDED;\n            } else if (!(state & STATE_BEGAN)) {\n                return STATE_BEGAN;\n            }\n            return state | STATE_CHANGED;\n        }\n        return STATE_FAILED;\n    }\n});\n\n/**\n * Pan\n * Recognized when the pointer is down and moved in the allowed direction.\n * @constructor\n * @extends AttrRecognizer\n */\nfunction PanRecognizer() {\n    AttrRecognizer.apply(this, arguments);\n\n    this.pX = null;\n    this.pY = null;\n}\n\ninherit(PanRecognizer, AttrRecognizer, {\n    /**\n     * @namespace\n     * @memberof PanRecognizer\n     */\n    defaults: {\n        event: 'pan',\n        threshold: 10,\n        pointers: 1,\n        direction: DIRECTION_ALL\n    },\n\n    getTouchAction: function() {\n        var direction = this.options.direction;\n        var actions = [];\n        if (direction & DIRECTION_HORIZONTAL) {\n            actions.push(TOUCH_ACTION_PAN_Y);\n        }\n        if (direction & DIRECTION_VERTICAL) {\n            actions.push(TOUCH_ACTION_PAN_X);\n        }\n        return actions;\n    },\n\n    directionTest: function(input) {\n        var options = this.options;\n        var hasMoved = true;\n        var distance = input.distance;\n        var direction = input.direction;\n        var x = input.deltaX;\n        var y = input.deltaY;\n\n        // lock to axis?\n        if (!(direction & options.direction)) {\n            if (options.direction & DIRECTION_HORIZONTAL) {\n                direction = (x === 0) ? DIRECTION_NONE : (x < 0) ? DIRECTION_LEFT : DIRECTION_RIGHT;\n                hasMoved = x != this.pX;\n                distance = Math.abs(input.deltaX);\n            } else {\n                direction = (y === 0) ? DIRECTION_NONE : (y < 0) ? DIRECTION_UP : DIRECTION_DOWN;\n                hasMoved = y != this.pY;\n                distance = Math.abs(input.deltaY);\n            }\n        }\n        input.direction = direction;\n        return hasMoved && distance > options.threshold && direction & options.direction;\n    },\n\n    attrTest: function(input) {\n        return AttrRecognizer.prototype.attrTest.call(this, input) &&\n            (this.state & STATE_BEGAN || (!(this.state & STATE_BEGAN) && this.directionTest(input)));\n    },\n\n    emit: function(input) {\n\n        this.pX = input.deltaX;\n        this.pY = input.deltaY;\n\n        var direction = directionStr(input.direction);\n\n        if (direction) {\n            input.additionalEvent = this.options.event + direction;\n        }\n        this._super.emit.call(this, input);\n    }\n});\n\n/**\n * Pinch\n * Recognized when two or more pointers are moving toward (zoom-in) or away from each other (zoom-out).\n * @constructor\n * @extends AttrRecognizer\n */\nfunction PinchRecognizer() {\n    AttrRecognizer.apply(this, arguments);\n}\n\ninherit(PinchRecognizer, AttrRecognizer, {\n    /**\n     * @namespace\n     * @memberof PinchRecognizer\n     */\n    defaults: {\n        event: 'pinch',\n        threshold: 0,\n        pointers: 2\n    },\n\n    getTouchAction: function() {\n        return [TOUCH_ACTION_NONE];\n    },\n\n    attrTest: function(input) {\n        return this._super.attrTest.call(this, input) &&\n            (Math.abs(input.scale - 1) > this.options.threshold || this.state & STATE_BEGAN);\n    },\n\n    emit: function(input) {\n        if (input.scale !== 1) {\n            var inOut = input.scale < 1 ? 'in' : 'out';\n            input.additionalEvent = this.options.event + inOut;\n        }\n        this._super.emit.call(this, input);\n    }\n});\n\n/**\n * Press\n * Recognized when the pointer is down for x ms without any movement.\n * @constructor\n * @extends Recognizer\n */\nfunction PressRecognizer() {\n    Recognizer.apply(this, arguments);\n\n    this._timer = null;\n    this._input = null;\n}\n\ninherit(PressRecognizer, Recognizer, {\n    /**\n     * @namespace\n     * @memberof PressRecognizer\n     */\n    defaults: {\n        event: 'press',\n        pointers: 1,\n        time: 251, // minimal time of the pointer to be pressed\n        threshold: 9 // a minimal movement is ok, but keep it low\n    },\n\n    getTouchAction: function() {\n        return [TOUCH_ACTION_AUTO];\n    },\n\n    process: function(input) {\n        var options = this.options;\n        var validPointers = input.pointers.length === options.pointers;\n        var validMovement = input.distance < options.threshold;\n        var validTime = input.deltaTime > options.time;\n\n        this._input = input;\n\n        // we only allow little movement\n        // and we've reached an end event, so a tap is possible\n        if (!validMovement || !validPointers || (input.eventType & (INPUT_END | INPUT_CANCEL) && !validTime)) {\n            this.reset();\n        } else if (input.eventType & INPUT_START) {\n            this.reset();\n            this._timer = setTimeoutContext(function() {\n                this.state = STATE_RECOGNIZED;\n                this.tryEmit();\n            }, options.time, this);\n        } else if (input.eventType & INPUT_END) {\n            return STATE_RECOGNIZED;\n        }\n        return STATE_FAILED;\n    },\n\n    reset: function() {\n        clearTimeout(this._timer);\n    },\n\n    emit: function(input) {\n        if (this.state !== STATE_RECOGNIZED) {\n            return;\n        }\n\n        if (input && (input.eventType & INPUT_END)) {\n            this.manager.emit(this.options.event + 'up', input);\n        } else {\n            this._input.timeStamp = now();\n            this.manager.emit(this.options.event, this._input);\n        }\n    }\n});\n\n/**\n * Rotate\n * Recognized when two or more pointer are moving in a circular motion.\n * @constructor\n * @extends AttrRecognizer\n */\nfunction RotateRecognizer() {\n    AttrRecognizer.apply(this, arguments);\n}\n\ninherit(RotateRecognizer, AttrRecognizer, {\n    /**\n     * @namespace\n     * @memberof RotateRecognizer\n     */\n    defaults: {\n        event: 'rotate',\n        threshold: 0,\n        pointers: 2\n    },\n\n    getTouchAction: function() {\n        return [TOUCH_ACTION_NONE];\n    },\n\n    attrTest: function(input) {\n        return this._super.attrTest.call(this, input) &&\n            (Math.abs(input.rotation) > this.options.threshold || this.state & STATE_BEGAN);\n    }\n});\n\n/**\n * Swipe\n * Recognized when the pointer is moving fast (velocity), with enough distance in the allowed direction.\n * @constructor\n * @extends AttrRecognizer\n */\nfunction SwipeRecognizer() {\n    AttrRecognizer.apply(this, arguments);\n}\n\ninherit(SwipeRecognizer, AttrRecognizer, {\n    /**\n     * @namespace\n     * @memberof SwipeRecognizer\n     */\n    defaults: {\n        event: 'swipe',\n        threshold: 10,\n        velocity: 0.3,\n        direction: DIRECTION_HORIZONTAL | DIRECTION_VERTICAL,\n        pointers: 1\n    },\n\n    getTouchAction: function() {\n        return PanRecognizer.prototype.getTouchAction.call(this);\n    },\n\n    attrTest: function(input) {\n        var direction = this.options.direction;\n        var velocity;\n\n        if (direction & (DIRECTION_HORIZONTAL | DIRECTION_VERTICAL)) {\n            velocity = input.overallVelocity;\n        } else if (direction & DIRECTION_HORIZONTAL) {\n            velocity = input.overallVelocityX;\n        } else if (direction & DIRECTION_VERTICAL) {\n            velocity = input.overallVelocityY;\n        }\n\n        return this._super.attrTest.call(this, input) &&\n            direction & input.offsetDirection &&\n            input.distance > this.options.threshold &&\n            input.maxPointers == this.options.pointers &&\n            abs(velocity) > this.options.velocity && input.eventType & INPUT_END;\n    },\n\n    emit: function(input) {\n        var direction = directionStr(input.offsetDirection);\n        if (direction) {\n            this.manager.emit(this.options.event + direction, input);\n        }\n\n        this.manager.emit(this.options.event, input);\n    }\n});\n\n/**\n * A tap is ecognized when the pointer is doing a small tap/click. Multiple taps are recognized if they occur\n * between the given interval and position. The delay option can be used to recognize multi-taps without firing\n * a single tap.\n *\n * The eventData from the emitted event contains the property `tapCount`, which contains the amount of\n * multi-taps being recognized.\n * @constructor\n * @extends Recognizer\n */\nfunction TapRecognizer() {\n    Recognizer.apply(this, arguments);\n\n    // previous time and center,\n    // used for tap counting\n    this.pTime = false;\n    this.pCenter = false;\n\n    this._timer = null;\n    this._input = null;\n    this.count = 0;\n}\n\ninherit(TapRecognizer, Recognizer, {\n    /**\n     * @namespace\n     * @memberof PinchRecognizer\n     */\n    defaults: {\n        event: 'tap',\n        pointers: 1,\n        taps: 1,\n        interval: 300, // max time between the multi-tap taps\n        time: 250, // max time of the pointer to be down (like finger on the screen)\n        threshold: 9, // a minimal movement is ok, but keep it low\n        posThreshold: 10 // a multi-tap can be a bit off the initial position\n    },\n\n    getTouchAction: function() {\n        return [TOUCH_ACTION_MANIPULATION];\n    },\n\n    process: function(input) {\n        var options = this.options;\n\n        var validPointers = input.pointers.length === options.pointers;\n        var validMovement = input.distance < options.threshold;\n        var validTouchTime = input.deltaTime < options.time;\n\n        this.reset();\n\n        if ((input.eventType & INPUT_START) && (this.count === 0)) {\n            return this.failTimeout();\n        }\n\n        // we only allow little movement\n        // and we've reached an end event, so a tap is possible\n        if (validMovement && validTouchTime && validPointers) {\n            if (input.eventType != INPUT_END) {\n                return this.failTimeout();\n            }\n\n            var validInterval = this.pTime ? (input.timeStamp - this.pTime < options.interval) : true;\n            var validMultiTap = !this.pCenter || getDistance(this.pCenter, input.center) < options.posThreshold;\n\n            this.pTime = input.timeStamp;\n            this.pCenter = input.center;\n\n            if (!validMultiTap || !validInterval) {\n                this.count = 1;\n            } else {\n                this.count += 1;\n            }\n\n            this._input = input;\n\n            // if tap count matches we have recognized it,\n            // else it has began recognizing...\n            var tapCount = this.count % options.taps;\n            if (tapCount === 0) {\n                // no failing requirements, immediately trigger the tap event\n                // or wait as long as the multitap interval to trigger\n                if (!this.hasRequireFailures()) {\n                    return STATE_RECOGNIZED;\n                } else {\n                    this._timer = setTimeoutContext(function() {\n                        this.state = STATE_RECOGNIZED;\n                        this.tryEmit();\n                    }, options.interval, this);\n                    return STATE_BEGAN;\n                }\n            }\n        }\n        return STATE_FAILED;\n    },\n\n    failTimeout: function() {\n        this._timer = setTimeoutContext(function() {\n            this.state = STATE_FAILED;\n        }, this.options.interval, this);\n        return STATE_FAILED;\n    },\n\n    reset: function() {\n        clearTimeout(this._timer);\n    },\n\n    emit: function() {\n        if (this.state == STATE_RECOGNIZED) {\n            this._input.tapCount = this.count;\n            this.manager.emit(this.options.event, this._input);\n        }\n    }\n});\n\n/**\n * Simple way to create a manager with a default set of recognizers.\n * @param {HTMLElement} element\n * @param {Object} [options]\n * @constructor\n */\nfunction Hammer(element, options) {\n    options = options || {};\n    options.recognizers = ifUndefined(options.recognizers, Hammer.defaults.preset);\n    return new Manager(element, options);\n}\n\n/**\n * @const {string}\n */\nHammer.VERSION = '2.0.7';\n\n/**\n * default settings\n * @namespace\n */\nHammer.defaults = {\n    /**\n     * set if DOM events are being triggered.\n     * But this is slower and unused by simple implementations, so disabled by default.\n     * @type {Boolean}\n     * @default false\n     */\n    domEvents: false,\n\n    /**\n     * The value for the touchAction property/fallback.\n     * When set to `compute` it will magically set the correct value based on the added recognizers.\n     * @type {String}\n     * @default compute\n     */\n    touchAction: TOUCH_ACTION_COMPUTE,\n\n    /**\n     * @type {Boolean}\n     * @default true\n     */\n    enable: true,\n\n    /**\n     * EXPERIMENTAL FEATURE -- can be removed/changed\n     * Change the parent input target element.\n     * If Null, then it is being set the to main element.\n     * @type {Null|EventTarget}\n     * @default null\n     */\n    inputTarget: null,\n\n    /**\n     * force an input class\n     * @type {Null|Function}\n     * @default null\n     */\n    inputClass: null,\n\n    /**\n     * Default recognizer setup when calling `Hammer()`\n     * When creating a new Manager these will be skipped.\n     * @type {Array}\n     */\n    preset: [\n        // RecognizerClass, options, [recognizeWith, ...], [requireFailure, ...]\n        [RotateRecognizer, {enable: false}],\n        [PinchRecognizer, {enable: false}, ['rotate']],\n        [SwipeRecognizer, {direction: DIRECTION_HORIZONTAL}],\n        [PanRecognizer, {direction: DIRECTION_HORIZONTAL}, ['swipe']],\n        [TapRecognizer],\n        [TapRecognizer, {event: 'doubletap', taps: 2}, ['tap']],\n        [PressRecognizer]\n    ],\n\n    /**\n     * Some CSS properties can be used to improve the working of Hammer.\n     * Add them to this method and they will be set when creating a new Manager.\n     * @namespace\n     */\n    cssProps: {\n        /**\n         * Disables text selection to improve the dragging gesture. Mainly for desktop browsers.\n         * @type {String}\n         * @default 'none'\n         */\n        userSelect: 'none',\n\n        /**\n         * Disable the Windows Phone grippers when pressing an element.\n         * @type {String}\n         * @default 'none'\n         */\n        touchSelect: 'none',\n\n        /**\n         * Disables the default callout shown when you touch and hold a touch target.\n         * On iOS, when you touch and hold a touch target such as a link, Safari displays\n         * a callout containing information about the link. This property allows you to disable that callout.\n         * @type {String}\n         * @default 'none'\n         */\n        touchCallout: 'none',\n\n        /**\n         * Specifies whether zooming is enabled. Used by IE10>\n         * @type {String}\n         * @default 'none'\n         */\n        contentZooming: 'none',\n\n        /**\n         * Specifies that an entire element should be draggable instead of its contents. Mainly for desktop browsers.\n         * @type {String}\n         * @default 'none'\n         */\n        userDrag: 'none',\n\n        /**\n         * Overrides the highlight color shown when the user taps a link or a JavaScript\n         * clickable element in iOS. This property obeys the alpha value, if specified.\n         * @type {String}\n         * @default 'rgba(0,0,0,0)'\n         */\n        tapHighlightColor: 'rgba(0,0,0,0)'\n    }\n};\n\nvar STOP = 1;\nvar FORCED_STOP = 2;\n\n/**\n * Manager\n * @param {HTMLElement} element\n * @param {Object} [options]\n * @constructor\n */\nfunction Manager(element, options) {\n    this.options = assign({}, Hammer.defaults, options || {});\n\n    this.options.inputTarget = this.options.inputTarget || element;\n\n    this.handlers = {};\n    this.session = {};\n    this.recognizers = [];\n    this.oldCssProps = {};\n\n    this.element = element;\n    this.input = createInputInstance(this);\n    this.touchAction = new TouchAction(this, this.options.touchAction);\n\n    toggleCssProps(this, true);\n\n    each(this.options.recognizers, function(item) {\n        var recognizer = this.add(new (item[0])(item[1]));\n        item[2] && recognizer.recognizeWith(item[2]);\n        item[3] && recognizer.requireFailure(item[3]);\n    }, this);\n}\n\nManager.prototype = {\n    /**\n     * set options\n     * @param {Object} options\n     * @returns {Manager}\n     */\n    set: function(options) {\n        assign(this.options, options);\n\n        // Options that need a little more setup\n        if (options.touchAction) {\n            this.touchAction.update();\n        }\n        if (options.inputTarget) {\n            // Clean up existing event listeners and reinitialize\n            this.input.destroy();\n            this.input.target = options.inputTarget;\n            this.input.init();\n        }\n        return this;\n    },\n\n    /**\n     * stop recognizing for this session.\n     * This session will be discarded, when a new [input]start event is fired.\n     * When forced, the recognizer cycle is stopped immediately.\n     * @param {Boolean} [force]\n     */\n    stop: function(force) {\n        this.session.stopped = force ? FORCED_STOP : STOP;\n    },\n\n    /**\n     * run the recognizers!\n     * called by the inputHandler function on every movement of the pointers (touches)\n     * it walks through all the recognizers and tries to detect the gesture that is being made\n     * @param {Object} inputData\n     */\n    recognize: function(inputData) {\n        var session = this.session;\n        if (session.stopped) {\n            return;\n        }\n\n        // run the touch-action polyfill\n        this.touchAction.preventDefaults(inputData);\n\n        var recognizer;\n        var recognizers = this.recognizers;\n\n        // this holds the recognizer that is being recognized.\n        // so the recognizer's state needs to be BEGAN, CHANGED, ENDED or RECOGNIZED\n        // if no recognizer is detecting a thing, it is set to `null`\n        var curRecognizer = session.curRecognizer;\n\n        // reset when the last recognizer is recognized\n        // or when we're in a new session\n        if (!curRecognizer || (curRecognizer && curRecognizer.state & STATE_RECOGNIZED)) {\n            curRecognizer = session.curRecognizer = null;\n        }\n\n        var i = 0;\n        while (i < recognizers.length) {\n            recognizer = recognizers[i];\n\n            // find out if we are allowed try to recognize the input for this one.\n            // 1.   allow if the session is NOT forced stopped (see the .stop() method)\n            // 2.   allow if we still haven't recognized a gesture in this session, or the this recognizer is the one\n            //      that is being recognized.\n            // 3.   allow if the recognizer is allowed to run simultaneous with the current recognized recognizer.\n            //      this can be setup with the `recognizeWith()` method on the recognizer.\n            if (session.stopped !== FORCED_STOP && ( // 1\n                    !curRecognizer || recognizer == curRecognizer || // 2\n                    recognizer.canRecognizeWith(curRecognizer))) { // 3\n                recognizer.recognize(inputData);\n            } else {\n                recognizer.reset();\n            }\n\n            // if the recognizer has been recognizing the input as a valid gesture, we want to store this one as the\n            // current active recognizer. but only if we don't already have an active recognizer\n            if (!curRecognizer && recognizer.state & (STATE_BEGAN | STATE_CHANGED | STATE_ENDED)) {\n                curRecognizer = session.curRecognizer = recognizer;\n            }\n            i++;\n        }\n    },\n\n    /**\n     * get a recognizer by its event name.\n     * @param {Recognizer|String} recognizer\n     * @returns {Recognizer|Null}\n     */\n    get: function(recognizer) {\n        if (recognizer instanceof Recognizer) {\n            return recognizer;\n        }\n\n        var recognizers = this.recognizers;\n        for (var i = 0; i < recognizers.length; i++) {\n            if (recognizers[i].options.event == recognizer) {\n                return recognizers[i];\n            }\n        }\n        return null;\n    },\n\n    /**\n     * add a recognizer to the manager\n     * existing recognizers with the same event name will be removed\n     * @param {Recognizer} recognizer\n     * @returns {Recognizer|Manager}\n     */\n    add: function(recognizer) {\n        if (invokeArrayArg(recognizer, 'add', this)) {\n            return this;\n        }\n\n        // remove existing\n        var existing = this.get(recognizer.options.event);\n        if (existing) {\n            this.remove(existing);\n        }\n\n        this.recognizers.push(recognizer);\n        recognizer.manager = this;\n\n        this.touchAction.update();\n        return recognizer;\n    },\n\n    /**\n     * remove a recognizer by name or instance\n     * @param {Recognizer|String} recognizer\n     * @returns {Manager}\n     */\n    remove: function(recognizer) {\n        if (invokeArrayArg(recognizer, 'remove', this)) {\n            return this;\n        }\n\n        recognizer = this.get(recognizer);\n\n        // let's make sure this recognizer exists\n        if (recognizer) {\n            var recognizers = this.recognizers;\n            var index = inArray(recognizers, recognizer);\n\n            if (index !== -1) {\n                recognizers.splice(index, 1);\n                this.touchAction.update();\n            }\n        }\n\n        return this;\n    },\n\n    /**\n     * bind event\n     * @param {String} events\n     * @param {Function} handler\n     * @returns {EventEmitter} this\n     */\n    on: function(events, handler) {\n        if (events === undefined) {\n            return;\n        }\n        if (handler === undefined) {\n            return;\n        }\n\n        var handlers = this.handlers;\n        each(splitStr(events), function(event) {\n            handlers[event] = handlers[event] || [];\n            handlers[event].push(handler);\n        });\n        return this;\n    },\n\n    /**\n     * unbind event, leave emit blank to remove all handlers\n     * @param {String} events\n     * @param {Function} [handler]\n     * @returns {EventEmitter} this\n     */\n    off: function(events, handler) {\n        if (events === undefined) {\n            return;\n        }\n\n        var handlers = this.handlers;\n        each(splitStr(events), function(event) {\n            if (!handler) {\n                delete handlers[event];\n            } else {\n                handlers[event] && handlers[event].splice(inArray(handlers[event], handler), 1);\n            }\n        });\n        return this;\n    },\n\n    /**\n     * emit event to the listeners\n     * @param {String} event\n     * @param {Object} data\n     */\n    emit: function(event, data) {\n        // we also want to trigger dom events\n        if (this.options.domEvents) {\n            triggerDomEvent(event, data);\n        }\n\n        // no handlers, so skip it all\n        var handlers = this.handlers[event] && this.handlers[event].slice();\n        if (!handlers || !handlers.length) {\n            return;\n        }\n\n        data.type = event;\n        data.preventDefault = function() {\n            data.srcEvent.preventDefault();\n        };\n\n        var i = 0;\n        while (i < handlers.length) {\n            handlers[i](data);\n            i++;\n        }\n    },\n\n    /**\n     * destroy the manager and unbinds all events\n     * it doesn't unbind dom events, that is the user own responsibility\n     */\n    destroy: function() {\n        this.element && toggleCssProps(this, false);\n\n        this.handlers = {};\n        this.session = {};\n        this.input.destroy();\n        this.element = null;\n    }\n};\n\n/**\n * add/remove the css properties as defined in manager.options.cssProps\n * @param {Manager} manager\n * @param {Boolean} add\n */\nfunction toggleCssProps(manager, add) {\n    var element = manager.element;\n    if (!element.style) {\n        return;\n    }\n    var prop;\n    each(manager.options.cssProps, function(value, name) {\n        prop = prefixed(element.style, name);\n        if (add) {\n            manager.oldCssProps[prop] = element.style[prop];\n            element.style[prop] = value;\n        } else {\n            element.style[prop] = manager.oldCssProps[prop] || '';\n        }\n    });\n    if (!add) {\n        manager.oldCssProps = {};\n    }\n}\n\n/**\n * trigger dom event\n * @param {String} event\n * @param {Object} data\n */\nfunction triggerDomEvent(event, data) {\n    var gestureEvent = document.createEvent('Event');\n    gestureEvent.initEvent(event, true, true);\n    gestureEvent.gesture = data;\n    data.target.dispatchEvent(gestureEvent);\n}\n\nassign(Hammer, {\n    INPUT_START: INPUT_START,\n    INPUT_MOVE: INPUT_MOVE,\n    INPUT_END: INPUT_END,\n    INPUT_CANCEL: INPUT_CANCEL,\n\n    STATE_POSSIBLE: STATE_POSSIBLE,\n    STATE_BEGAN: STATE_BEGAN,\n    STATE_CHANGED: STATE_CHANGED,\n    STATE_ENDED: STATE_ENDED,\n    STATE_RECOGNIZED: STATE_RECOGNIZED,\n    STATE_CANCELLED: STATE_CANCELLED,\n    STATE_FAILED: STATE_FAILED,\n\n    DIRECTION_NONE: DIRECTION_NONE,\n    DIRECTION_LEFT: DIRECTION_LEFT,\n    DIRECTION_RIGHT: DIRECTION_RIGHT,\n    DIRECTION_UP: DIRECTION_UP,\n    DIRECTION_DOWN: DIRECTION_DOWN,\n    DIRECTION_HORIZONTAL: DIRECTION_HORIZONTAL,\n    DIRECTION_VERTICAL: DIRECTION_VERTICAL,\n    DIRECTION_ALL: DIRECTION_ALL,\n\n    Manager: Manager,\n    Input: Input,\n    TouchAction: TouchAction,\n\n    TouchInput: TouchInput,\n    MouseInput: MouseInput,\n    PointerEventInput: PointerEventInput,\n    TouchMouseInput: TouchMouseInput,\n    SingleTouchInput: SingleTouchInput,\n\n    Recognizer: Recognizer,\n    AttrRecognizer: AttrRecognizer,\n    Tap: TapRecognizer,\n    Pan: PanRecognizer,\n    Swipe: SwipeRecognizer,\n    Pinch: PinchRecognizer,\n    Rotate: RotateRecognizer,\n    Press: PressRecognizer,\n\n    on: addEventListeners,\n    off: removeEventListeners,\n    each: each,\n    merge: merge,\n    extend: extend,\n    assign: assign,\n    inherit: inherit,\n    bindFn: bindFn,\n    prefixed: prefixed\n});\n\n// this prevents errors when Hammer is loaded in the presence of an AMD\n//  style loader but by script tag, not by the loader.\nvar freeGlobal = (typeof window !== 'undefined' ? window : (typeof self !== 'undefined' ? self : {})); // jshint ignore:line\nfreeGlobal.Hammer = Hammer;\n\nif (typeof define === 'function' && define.amd) {\n    define(function() {\n        return Hammer;\n    });\n} else if (typeof module != 'undefined' && module.exports) {\n    module.exports = Hammer;\n} else {\n    window[exportName] = Hammer;\n}\n\n})(window, document, 'Hammer');\n","if (typeof Object.create === 'function') {\n  // implementation from standard node.js 'util' module\n  module.exports = function inherits(ctor, superCtor) {\n    if (superCtor) {\n      ctor.super_ = superCtor\n      ctor.prototype = Object.create(superCtor.prototype, {\n        constructor: {\n          value: ctor,\n          enumerable: false,\n          writable: true,\n          configurable: true\n        }\n      })\n    }\n  };\n} else {\n  // old school shim for old browsers\n  module.exports = function inherits(ctor, superCtor) {\n    if (superCtor) {\n      ctor.super_ = superCtor\n      var TempCtor = function () {}\n      TempCtor.prototype = superCtor.prototype\n      ctor.prototype = new TempCtor()\n      ctor.prototype.constructor = ctor\n    }\n  }\n}\n","module.exports = require('./lib/refs');\n\nmodule.exports.Collection = require('./lib/collection');","'use strict';\n\n/**\n * An empty collection stub. Use {@link RefsCollection.extend} to extend a\n * collection with ref semantics.\n *\n * @class RefsCollection\n */\n\n/**\n * Extends a collection with {@link Refs} aware methods\n *\n * @memberof RefsCollection\n * @static\n *\n * @param  {Array<Object>} collection\n * @param  {Refs} refs instance\n * @param  {Object} property represented by the collection\n * @param  {Object} target object the collection is attached to\n *\n * @return {RefsCollection<Object>} the extended array\n */\nfunction extend(collection, refs, property, target) {\n\n  var inverseProperty = property.inverse;\n\n  /**\n   * Removes the given element from the array and returns it.\n   *\n   * @method RefsCollection#remove\n   *\n   * @param {Object} element the element to remove\n   */\n  Object.defineProperty(collection, 'remove', {\n    value: function(element) {\n      var idx = this.indexOf(element);\n      if (idx !== -1) {\n        this.splice(idx, 1);\n\n        // unset inverse\n        refs.unset(element, inverseProperty, target);\n      }\n\n      return element;\n    }\n  });\n\n  /**\n   * Returns true if the collection contains the given element\n   *\n   * @method RefsCollection#contains\n   *\n   * @param {Object} element the element to check for\n   */\n  Object.defineProperty(collection, 'contains', {\n    value: function(element) {\n      return this.indexOf(element) !== -1;\n    }\n  });\n\n  /**\n   * Adds an element to the array, unless it exists already (set semantics).\n   *\n   * @method RefsCollection#add\n   *\n   * @param {Object} element the element to add\n   * @param {Number} optional index to add element to\n   *                 (possibly moving other elements around)\n   */\n  Object.defineProperty(collection, 'add', {\n    value: function(element, idx) {\n\n      var currentIdx = this.indexOf(element);\n\n      if (typeof idx === 'undefined') {\n\n        if (currentIdx !== -1) {\n          // element already in collection (!)\n          return;\n        }\n\n        // add to end of array, as no idx is specified\n        idx = this.length;\n      }\n\n      // handle already in collection\n      if (currentIdx !== -1) {\n\n        // remove element from currentIdx\n        this.splice(currentIdx, 1);\n      }\n\n      // add element at idx\n      this.splice(idx, 0, element);\n\n      if (currentIdx === -1) {\n        // set inverse, unless element was\n        // in collection already\n        refs.set(element, inverseProperty, target);\n      }\n    }\n  });\n\n  // a simple marker, identifying this element\n  // as being a refs collection\n  Object.defineProperty(collection, '__refs_collection', {\n    value: true\n  });\n\n  return collection;\n}\n\n\nfunction isExtended(collection) {\n  return collection.__refs_collection === true;\n}\n\nmodule.exports.extend = extend;\n\nmodule.exports.isExtended = isExtended;","'use strict';\n\nvar Collection = require('./collection');\n\nfunction hasOwnProperty(e, property) {\n  return Object.prototype.hasOwnProperty.call(e, property.name || property);\n}\n\nfunction defineCollectionProperty(ref, property, target) {\n\n  var collection = Collection.extend(target[property.name] || [], ref, property, target);\n\n  Object.defineProperty(target, property.name, {\n    enumerable: property.enumerable,\n    value: collection\n  });\n\n  if (collection.length) {\n\n    collection.forEach(function(o) {\n      ref.set(o, property.inverse, target);\n    });\n  }\n}\n\n\nfunction defineProperty(ref, property, target) {\n\n  var inverseProperty = property.inverse;\n\n  var _value = target[property.name];\n\n  Object.defineProperty(target, property.name, {\n    configurable: property.configurable,\n    enumerable: property.enumerable,\n\n    get: function() {\n      return _value;\n    },\n\n    set: function(value) {\n\n      // return if we already performed all changes\n      if (value === _value) {\n        return;\n      }\n\n      var old = _value;\n\n      // temporary set null\n      _value = null;\n\n      if (old) {\n        ref.unset(old, inverseProperty, target);\n      }\n\n      // set new value\n      _value = value;\n\n      // set inverse value\n      ref.set(_value, inverseProperty, target);\n    }\n  });\n\n}\n\n/**\n * Creates a new references object defining two inversly related\n * attribute descriptors a and b.\n *\n * <p>\n *   When bound to an object using {@link Refs#bind} the references\n *   get activated and ensure that add and remove operations are applied\n *   reversely, too.\n * </p>\n *\n * <p>\n *   For attributes represented as collections {@link Refs} provides the\n *   {@link RefsCollection#add}, {@link RefsCollection#remove} and {@link RefsCollection#contains} extensions\n *   that must be used to properly hook into the inverse change mechanism.\n * </p>\n *\n * @class Refs\n *\n * @classdesc A bi-directional reference between two attributes.\n *\n * @param {Refs.AttributeDescriptor} a property descriptor\n * @param {Refs.AttributeDescriptor} b property descriptor\n *\n * @example\n *\n * var refs = Refs({ name: 'wheels', collection: true, enumerable: true }, { name: 'car' });\n *\n * var car = { name: 'toyota' };\n * var wheels = [{ pos: 'front-left' }, { pos: 'front-right' }];\n *\n * refs.bind(car, 'wheels');\n *\n * car.wheels // []\n * car.wheels.add(wheels[0]);\n * car.wheels.add(wheels[1]);\n *\n * car.wheels // [{ pos: 'front-left' }, { pos: 'front-right' }]\n *\n * wheels[0].car // { name: 'toyota' };\n * car.wheels.remove(wheels[0]);\n *\n * wheels[0].car // undefined\n */\nfunction Refs(a, b) {\n\n  if (!(this instanceof Refs)) {\n    return new Refs(a, b);\n  }\n\n  // link\n  a.inverse = b;\n  b.inverse = a;\n\n  this.props = {};\n  this.props[a.name] = a;\n  this.props[b.name] = b;\n}\n\n/**\n * Binds one side of a bi-directional reference to a\n * target object.\n *\n * @memberOf Refs\n *\n * @param  {Object} target\n * @param  {String} property\n */\nRefs.prototype.bind = function(target, property) {\n  if (typeof property === 'string') {\n    if (!this.props[property]) {\n      throw new Error('no property <' + property + '> in ref');\n    }\n    property = this.props[property];\n  }\n\n  if (property.collection) {\n    defineCollectionProperty(this, property, target);\n  } else {\n    defineProperty(this, property, target);\n  }\n};\n\nRefs.prototype.ensureRefsCollection = function(target, property) {\n\n  var collection = target[property.name];\n\n  if (!Collection.isExtended(collection)) {\n    defineCollectionProperty(this, property, target);\n  }\n\n  return collection;\n};\n\nRefs.prototype.ensureBound = function(target, property) {\n  if (!hasOwnProperty(target, property)) {\n    this.bind(target, property);\n  }\n};\n\nRefs.prototype.unset = function(target, property, value) {\n\n  if (target) {\n    this.ensureBound(target, property);\n\n    if (property.collection) {\n      this.ensureRefsCollection(target, property).remove(value);\n    } else {\n      target[property.name] = undefined;\n    }\n  }\n};\n\nRefs.prototype.set = function(target, property, value) {\n\n  if (target) {\n    this.ensureBound(target, property);\n\n    if (property.collection) {\n      this.ensureRefsCollection(target, property).add(value);\n    } else {\n      target[property.name] = value;\n    }\n  }\n};\n\nmodule.exports = Refs;\n\n\n/**\n * An attribute descriptor to be used specify an attribute in a {@link Refs} instance\n *\n * @typedef {Object} Refs.AttributeDescriptor\n * @property {String} name\n * @property {boolean} [collection=false]\n * @property {boolean} [enumerable=false]\n */","'use strict';\n\n/**\n * This file contains source code adapted from Snap.svg (licensed Apache-2.0).\n *\n * @see https://github.com/adobe-webplatform/Snap.svg/blob/master/src/path.js\n */\n\n/* eslint no-fallthrough: \"off\" */\n\nvar p2s = /,?([a-z]),?/gi,\n    toFloat = parseFloat,\n    math = Math,\n    PI = math.PI,\n    mmin = math.min,\n    mmax = math.max,\n    pow = math.pow,\n    abs = math.abs,\n    pathCommand = /([a-z])[\\s,]*((-?\\d*\\.?\\d*(?:e[-+]?\\d+)?[\\s]*,?[\\s]*)+)/ig,\n    pathValues = /(-?\\d*\\.?\\d*(?:e[-+]?\\d+)?)[\\s]*,?[\\s]*/ig;\n\nvar isArray = Array.isArray || function(o) { return o instanceof Array; };\n\nfunction hasProperty(obj, property) {\n  return Object.prototype.hasOwnProperty.call(obj, property);\n}\n\nfunction clone(obj) {\n\n  if (typeof obj == 'function' || Object(obj) !== obj) {\n    return obj;\n  }\n\n  var res = new obj.constructor;\n\n  for (var key in obj) {\n    if (hasProperty(obj, key)) {\n      res[key] = clone(obj[key]);\n    }\n  }\n\n  return res;\n}\n\nfunction repush(array, item) {\n  for (var i = 0, ii = array.length; i < ii; i++) if (array[i] === item) {\n    return array.push(array.splice(i, 1)[0]);\n  }\n}\n\nfunction cacher(f) {\n\n  function newf() {\n\n    var arg = Array.prototype.slice.call(arguments, 0),\n        args = arg.join('\\u2400'),\n        cache = newf.cache = newf.cache || {},\n        count = newf.count = newf.count || [];\n\n    if (hasProperty(cache, args)) {\n      repush(count, args);\n      return cache[args];\n    }\n\n    count.length >= 1e3 && delete cache[count.shift()];\n    count.push(args);\n    cache[args] = f.apply(0, arg);\n\n    return cache[args];\n  }\n  return newf;\n}\n\nfunction parsePathString(pathString) {\n\n  if (!pathString) {\n    return null;\n  }\n\n  var pth = paths(pathString);\n\n  if (pth.arr) {\n    return clone(pth.arr);\n  }\n\n  var paramCounts = { a: 7, c: 6, h: 1, l: 2, m: 2, q: 4, s: 4, t: 2, v: 1, z: 0 },\n      data = [];\n\n  if (isArray(pathString) && isArray(pathString[0])) { // rough assumption\n    data = clone(pathString);\n  }\n\n  if (!data.length) {\n\n    String(pathString).replace(pathCommand, function(a, b, c) {\n      var params = [],\n          name = b.toLowerCase();\n\n      c.replace(pathValues, function(a, b) {\n        b && params.push(+b);\n      });\n\n      if (name == 'm' && params.length > 2) {\n        data.push([b].concat(params.splice(0, 2)));\n        name = 'l';\n        b = b == 'm' ? 'l' : 'L';\n      }\n\n      while (params.length >= paramCounts[name]) {\n        data.push([b].concat(params.splice(0, paramCounts[name])));\n        if (!paramCounts[name]) {\n          break;\n        }\n      }\n    });\n  }\n\n  data.toString = paths.toString;\n  pth.arr = clone(data);\n\n  return data;\n}\n\nfunction paths(ps) {\n  var p = paths.ps = paths.ps || {};\n\n  if (p[ps]) {\n    p[ps].sleep = 100;\n  } else {\n    p[ps] = {\n      sleep: 100\n    };\n  }\n\n  setTimeout(function() {\n    for (var key in p) {\n      if (hasProperty(p, key) && key != ps) {\n        p[key].sleep--;\n        !p[key].sleep && delete p[key];\n      }\n    }\n  });\n\n  return p[ps];\n}\n\nfunction rectBBox(x, y, width, height) {\n\n  if (arguments.length === 1) {\n    y = x.y;\n    width = x.width;\n    height = x.height;\n    x = x.x;\n  }\n\n  return {\n    x: x,\n    y: y,\n    width: width,\n    height: height,\n    x2: x + width,\n    y2: y + height\n  };\n}\n\nfunction pathToString() {\n  return this.join(',').replace(p2s, '$1');\n}\n\nfunction pathClone(pathArray) {\n  var res = clone(pathArray);\n  res.toString = pathToString;\n  return res;\n}\n\nfunction findDotsAtSegment(p1x, p1y, c1x, c1y, c2x, c2y, p2x, p2y, t) {\n  var t1 = 1 - t,\n      t13 = pow(t1, 3),\n      t12 = pow(t1, 2),\n      t2 = t * t,\n      t3 = t2 * t,\n      x = t13 * p1x + t12 * 3 * t * c1x + t1 * 3 * t * t * c2x + t3 * p2x,\n      y = t13 * p1y + t12 * 3 * t * c1y + t1 * 3 * t * t * c2y + t3 * p2y;\n\n  return {\n    x: fixError(x),\n    y: fixError(y)\n  };\n}\n\nfunction bezierBBox(points) {\n\n  var bbox = curveBBox.apply(null, points);\n\n  return rectBBox(\n    bbox.x0,\n    bbox.y0,\n    bbox.x1 - bbox.x0,\n    bbox.y1 - bbox.y0\n  );\n}\n\nfunction isPointInsideBBox(bbox, x, y) {\n  return x >= bbox.x &&\n    x <= bbox.x + bbox.width &&\n    y >= bbox.y &&\n    y <= bbox.y + bbox.height;\n}\n\nfunction isBBoxIntersect(bbox1, bbox2) {\n  bbox1 = rectBBox(bbox1);\n  bbox2 = rectBBox(bbox2);\n  return isPointInsideBBox(bbox2, bbox1.x, bbox1.y)\n    || isPointInsideBBox(bbox2, bbox1.x2, bbox1.y)\n    || isPointInsideBBox(bbox2, bbox1.x, bbox1.y2)\n    || isPointInsideBBox(bbox2, bbox1.x2, bbox1.y2)\n    || isPointInsideBBox(bbox1, bbox2.x, bbox2.y)\n    || isPointInsideBBox(bbox1, bbox2.x2, bbox2.y)\n    || isPointInsideBBox(bbox1, bbox2.x, bbox2.y2)\n    || isPointInsideBBox(bbox1, bbox2.x2, bbox2.y2)\n    || (bbox1.x < bbox2.x2 && bbox1.x > bbox2.x\n        || bbox2.x < bbox1.x2 && bbox2.x > bbox1.x)\n    && (bbox1.y < bbox2.y2 && bbox1.y > bbox2.y\n        || bbox2.y < bbox1.y2 && bbox2.y > bbox1.y);\n}\n\nfunction base3(t, p1, p2, p3, p4) {\n  var t1 = -3 * p1 + 9 * p2 - 9 * p3 + 3 * p4,\n      t2 = t * t1 + 6 * p1 - 12 * p2 + 6 * p3;\n  return t * t2 - 3 * p1 + 3 * p2;\n}\n\nfunction bezlen(x1, y1, x2, y2, x3, y3, x4, y4, z) {\n\n  if (z == null) {\n    z = 1;\n  }\n\n  z = z > 1 ? 1 : z < 0 ? 0 : z;\n\n  var z2 = z / 2,\n      n = 12,\n      Tvalues = [-.1252,.1252,-.3678,.3678,-.5873,.5873,-.7699,.7699,-.9041,.9041,-.9816,.9816],\n      Cvalues = [0.2491,0.2491,0.2335,0.2335,0.2032,0.2032,0.1601,0.1601,0.1069,0.1069,0.0472,0.0472],\n      sum = 0;\n\n  for (var i = 0; i < n; i++) {\n    var ct = z2 * Tvalues[i] + z2,\n        xbase = base3(ct, x1, x2, x3, x4),\n        ybase = base3(ct, y1, y2, y3, y4),\n        comb = xbase * xbase + ybase * ybase;\n\n    sum += Cvalues[i] * math.sqrt(comb);\n  }\n\n  return z2 * sum;\n}\n\n\nfunction intersectLines(x1, y1, x2, y2, x3, y3, x4, y4) {\n\n  if (\n    mmax(x1, x2) < mmin(x3, x4) ||\n      mmin(x1, x2) > mmax(x3, x4) ||\n      mmax(y1, y2) < mmin(y3, y4) ||\n      mmin(y1, y2) > mmax(y3, y4)\n  ) {\n    return;\n  }\n\n  var nx = (x1 * y2 - y1 * x2) * (x3 - x4) - (x1 - x2) * (x3 * y4 - y3 * x4),\n      ny = (x1 * y2 - y1 * x2) * (y3 - y4) - (y1 - y2) * (x3 * y4 - y3 * x4),\n      denominator = (x1 - x2) * (y3 - y4) - (y1 - y2) * (x3 - x4);\n\n  if (!denominator) {\n    return;\n  }\n\n  var px = fixError(nx / denominator),\n      py = fixError(ny / denominator),\n      px2 = +px.toFixed(2),\n      py2 = +py.toFixed(2);\n\n  if (\n    px2 < +mmin(x1, x2).toFixed(2) ||\n      px2 > +mmax(x1, x2).toFixed(2) ||\n      px2 < +mmin(x3, x4).toFixed(2) ||\n      px2 > +mmax(x3, x4).toFixed(2) ||\n      py2 < +mmin(y1, y2).toFixed(2) ||\n      py2 > +mmax(y1, y2).toFixed(2) ||\n      py2 < +mmin(y3, y4).toFixed(2) ||\n      py2 > +mmax(y3, y4).toFixed(2)\n  ) {\n    return;\n  }\n\n  return { x: px, y: py };\n}\n\nfunction fixError(number) {\n  return Math.round(number * 100000000000) / 100000000000;\n}\n\nfunction findBezierIntersections(bez1, bez2, justCount) {\n  var bbox1 = bezierBBox(bez1),\n      bbox2 = bezierBBox(bez2);\n\n  if (!isBBoxIntersect(bbox1, bbox2)) {\n    return justCount ? 0 : [];\n  }\n\n  // As an optimization, lines will have only 1 segment\n\n  var l1 = bezlen.apply(0, bez1),\n      l2 = bezlen.apply(0, bez2),\n      n1 = isLine(bez1) ? 1 : ~~(l1 / 5) || 1,\n      n2 = isLine(bez2) ? 1 : ~~(l2 / 5) || 1,\n      dots1 = [],\n      dots2 = [],\n      xy = {},\n      res = justCount ? 0 : [];\n\n  for (var i = 0; i < n1 + 1; i++) {\n    var p = findDotsAtSegment.apply(0, bez1.concat(i / n1));\n    dots1.push({ x: p.x, y: p.y, t: i / n1 });\n  }\n\n  for (i = 0; i < n2 + 1; i++) {\n    p = findDotsAtSegment.apply(0, bez2.concat(i / n2));\n    dots2.push({ x: p.x, y: p.y, t: i / n2 });\n  }\n\n  for (i = 0; i < n1; i++) {\n\n    for (var j = 0; j < n2; j++) {\n      var di = dots1[i],\n          di1 = dots1[i + 1],\n          dj = dots2[j],\n          dj1 = dots2[j + 1],\n          ci = abs(di1.x - di.x) < .01 ? 'y' : 'x',\n          cj = abs(dj1.x - dj.x) < .01 ? 'y' : 'x',\n          is = intersectLines(di.x, di.y, di1.x, di1.y, dj.x, dj.y, dj1.x, dj1.y),\n          key;\n\n      if (is) {\n        key = is.x.toFixed(9) + '#' + is.y.toFixed(9);\n\n        if (xy[key]) {\n          continue;\n        }\n\n        xy[key] = true;\n\n        var t1 = di.t + abs((is[ci] - di[ci]) / (di1[ci] - di[ci])) * (di1.t - di.t),\n            t2 = dj.t + abs((is[cj] - dj[cj]) / (dj1[cj] - dj[cj])) * (dj1.t - dj.t);\n\n        if (t1 >= 0 && t1 <= 1 && t2 >= 0 && t2 <= 1) {\n\n          if (justCount) {\n            res++;\n          } else {\n            res.push({\n              x: is.x,\n              y: is.y,\n              t1: t1,\n              t2: t2\n            });\n          }\n        }\n      }\n    }\n  }\n\n  return res;\n}\n\n\n/**\n * Find or counts the intersections between two SVG paths.\n *\n * Returns a number in counting mode and a list of intersections otherwise.\n *\n * A single intersection entry contains the intersection coordinates (x, y)\n * as well as additional information regarding the intersecting segments\n * on each path (segment1, segment2) and the relative location of the\n * intersection on these segments (t1, t2).\n *\n * The path may be an SVG path string or a list of path components\n * such as `[ [ 'M', 0, 10 ], [ 'L', 20, 0 ] ]`.\n *\n * @example\n *\n * var intersections = findPathIntersections(\n *   'M0,0L100,100',\n *   [ [ 'M', 0, 100 ], [ 'L', 100, 0 ] ]\n * );\n *\n * // intersections = [\n * //   { x: 50, y: 50, segment1: 1, segment2: 1, t1: 0.5, t2: 0.5 }\n * // ]\n *\n * @param {String|Array<PathDef>} path1\n * @param {String|Array<PathDef>} path2\n * @param {Boolean} [justCount=false]\n *\n * @return {Array<Intersection>|Number}\n */\nfunction findPathIntersections(path1, path2, justCount) {\n  path1 = pathToCurve(path1);\n  path2 = pathToCurve(path2);\n\n  var x1, y1, x2, y2, x1m, y1m, x2m, y2m, bez1, bez2,\n      res = justCount ? 0 : [];\n\n  for (var i = 0, ii = path1.length; i < ii; i++) {\n    var pi = path1[i];\n\n    if (pi[0] == 'M') {\n      x1 = x1m = pi[1];\n      y1 = y1m = pi[2];\n    } else {\n\n      if (pi[0] == 'C') {\n        bez1 = [x1, y1].concat(pi.slice(1));\n        x1 = bez1[6];\n        y1 = bez1[7];\n      } else {\n        bez1 = [x1, y1, x1, y1, x1m, y1m, x1m, y1m];\n        x1 = x1m;\n        y1 = y1m;\n      }\n\n      for (var j = 0, jj = path2.length; j < jj; j++) {\n        var pj = path2[j];\n\n        if (pj[0] == 'M') {\n          x2 = x2m = pj[1];\n          y2 = y2m = pj[2];\n        } else {\n\n          if (pj[0] == 'C') {\n            bez2 = [x2, y2].concat(pj.slice(1));\n            x2 = bez2[6];\n            y2 = bez2[7];\n          } else {\n            bez2 = [x2, y2, x2, y2, x2m, y2m, x2m, y2m];\n            x2 = x2m;\n            y2 = y2m;\n          }\n\n          var intr = findBezierIntersections(bez1, bez2, justCount);\n\n          if (justCount) {\n            res += intr;\n          } else {\n\n            for (var k = 0, kk = intr.length; k < kk; k++) {\n              intr[k].segment1 = i;\n              intr[k].segment2 = j;\n              intr[k].bez1 = bez1;\n              intr[k].bez2 = bez2;\n            }\n\n            res = res.concat(intr);\n          }\n        }\n      }\n    }\n  }\n\n  return res;\n}\n\n\nfunction pathToAbsolute(pathArray) {\n  var pth = paths(pathArray);\n\n  if (pth.abs) {\n    return pathClone(pth.abs);\n  }\n\n  if (!isArray(pathArray) || !isArray(pathArray && pathArray[0])) { // rough assumption\n    pathArray = parsePathString(pathArray);\n  }\n\n  if (!pathArray || !pathArray.length) {\n    return [['M', 0, 0]];\n  }\n\n  var res = [],\n      x = 0,\n      y = 0,\n      mx = 0,\n      my = 0,\n      start = 0,\n      pa0;\n\n  if (pathArray[0][0] == 'M') {\n    x = +pathArray[0][1];\n    y = +pathArray[0][2];\n    mx = x;\n    my = y;\n    start++;\n    res[0] = ['M', x, y];\n  }\n\n  for (var r, pa, i = start, ii = pathArray.length; i < ii; i++) {\n    res.push(r = []);\n    pa = pathArray[i];\n    pa0 = pa[0];\n\n    if (pa0 != pa0.toUpperCase()) {\n      r[0] = pa0.toUpperCase();\n\n      switch (r[0]) {\n      case 'A':\n        r[1] = pa[1];\n        r[2] = pa[2];\n        r[3] = pa[3];\n        r[4] = pa[4];\n        r[5] = pa[5];\n        r[6] = +pa[6] + x;\n        r[7] = +pa[7] + y;\n        break;\n      case 'V':\n        r[1] = +pa[1] + y;\n        break;\n      case 'H':\n        r[1] = +pa[1] + x;\n        break;\n      case 'M':\n        mx = +pa[1] + x;\n        my = +pa[2] + y;\n      default:\n        for (var j = 1, jj = pa.length; j < jj; j++) {\n          r[j] = +pa[j] + ((j % 2) ? x : y);\n        }\n      }\n    } else {\n      for (var k = 0, kk = pa.length; k < kk; k++) {\n        r[k] = pa[k];\n      }\n    }\n    pa0 = pa0.toUpperCase();\n\n    switch (r[0]) {\n    case 'Z':\n      x = +mx;\n      y = +my;\n      break;\n    case 'H':\n      x = r[1];\n      break;\n    case 'V':\n      y = r[1];\n      break;\n    case 'M':\n      mx = r[r.length - 2];\n      my = r[r.length - 1];\n    default:\n      x = r[r.length - 2];\n      y = r[r.length - 1];\n    }\n  }\n\n  res.toString = pathToString;\n  pth.abs = pathClone(res);\n\n  return res;\n}\n\nfunction isLine(bez) {\n  return (\n    bez[0] === bez[2] &&\n    bez[1] === bez[3] &&\n    bez[4] === bez[6] &&\n    bez[5] === bez[7]\n  );\n}\n\nfunction lineToCurve(x1, y1, x2, y2) {\n  return [\n    x1, y1, x2,\n    y2, x2, y2\n  ];\n}\n\nfunction qubicToCurve(x1, y1, ax, ay, x2, y2) {\n  var _13 = 1 / 3,\n      _23 = 2 / 3;\n\n  return [\n    _13 * x1 + _23 * ax,\n    _13 * y1 + _23 * ay,\n    _13 * x2 + _23 * ax,\n    _13 * y2 + _23 * ay,\n    x2,\n    y2\n  ];\n}\n\nfunction arcToCurve(x1, y1, rx, ry, angle, large_arc_flag, sweep_flag, x2, y2, recursive) {\n\n  // for more information of where this math came from visit:\n  // http://www.w3.org/TR/SVG11/implnote.html#ArcImplementationNotes\n  var _120 = PI * 120 / 180,\n      rad = PI / 180 * (+angle || 0),\n      res = [],\n      xy,\n      rotate = cacher(function(x, y, rad) {\n        var X = x * math.cos(rad) - y * math.sin(rad),\n            Y = x * math.sin(rad) + y * math.cos(rad);\n\n        return { x: X, y: Y };\n      });\n\n  if (!recursive) {\n    xy = rotate(x1, y1, -rad);\n    x1 = xy.x;\n    y1 = xy.y;\n    xy = rotate(x2, y2, -rad);\n    x2 = xy.x;\n    y2 = xy.y;\n\n    var x = (x1 - x2) / 2,\n        y = (y1 - y2) / 2;\n\n    var h = (x * x) / (rx * rx) + (y * y) / (ry * ry);\n\n    if (h > 1) {\n      h = math.sqrt(h);\n      rx = h * rx;\n      ry = h * ry;\n    }\n\n    var rx2 = rx * rx,\n        ry2 = ry * ry,\n        k = (large_arc_flag == sweep_flag ? -1 : 1) *\n            math.sqrt(abs((rx2 * ry2 - rx2 * y * y - ry2 * x * x) / (rx2 * y * y + ry2 * x * x))),\n        cx = k * rx * y / ry + (x1 + x2) / 2,\n        cy = k * -ry * x / rx + (y1 + y2) / 2,\n        f1 = math.asin(((y1 - cy) / ry).toFixed(9)),\n        f2 = math.asin(((y2 - cy) / ry).toFixed(9));\n\n    f1 = x1 < cx ? PI - f1 : f1;\n    f2 = x2 < cx ? PI - f2 : f2;\n    f1 < 0 && (f1 = PI * 2 + f1);\n    f2 < 0 && (f2 = PI * 2 + f2);\n\n    if (sweep_flag && f1 > f2) {\n      f1 = f1 - PI * 2;\n    }\n    if (!sweep_flag && f2 > f1) {\n      f2 = f2 - PI * 2;\n    }\n  } else {\n    f1 = recursive[0];\n    f2 = recursive[1];\n    cx = recursive[2];\n    cy = recursive[3];\n  }\n\n  var df = f2 - f1;\n\n  if (abs(df) > _120) {\n    var f2old = f2,\n        x2old = x2,\n        y2old = y2;\n\n    f2 = f1 + _120 * (sweep_flag && f2 > f1 ? 1 : -1);\n    x2 = cx + rx * math.cos(f2);\n    y2 = cy + ry * math.sin(f2);\n    res = arcToCurve(x2, y2, rx, ry, angle, 0, sweep_flag, x2old, y2old, [f2, f2old, cx, cy]);\n  }\n\n  df = f2 - f1;\n\n  var c1 = math.cos(f1),\n      s1 = math.sin(f1),\n      c2 = math.cos(f2),\n      s2 = math.sin(f2),\n      t = math.tan(df / 4),\n      hx = 4 / 3 * rx * t,\n      hy = 4 / 3 * ry * t,\n      m1 = [x1, y1],\n      m2 = [x1 + hx * s1, y1 - hy * c1],\n      m3 = [x2 + hx * s2, y2 - hy * c2],\n      m4 = [x2, y2];\n\n  m2[0] = 2 * m1[0] - m2[0];\n  m2[1] = 2 * m1[1] - m2[1];\n\n  if (recursive) {\n    return [m2, m3, m4].concat(res);\n  } else {\n    res = [m2, m3, m4].concat(res).join().split(',');\n    var newres = [];\n\n    for (var i = 0, ii = res.length; i < ii; i++) {\n      newres[i] = i % 2 ? rotate(res[i - 1], res[i], rad).y : rotate(res[i], res[i + 1], rad).x;\n    }\n\n    return newres;\n  }\n}\n\n// Returns bounding box of cubic bezier curve.\n// Source: http://blog.hackers-cafe.net/2009/06/how-to-calculate-bezier-curves-bounding.html\n// Original version: NISHIO Hirokazu\n// Modifications: https://github.com/timo22345\nfunction curveBBox(x0, y0, x1, y1, x2, y2, x3, y3) {\n  var tvalues = [],\n      bounds = [[], []],\n      a, b, c, t, t1, t2, b2ac, sqrtb2ac;\n\n  for (var i = 0; i < 2; ++i) {\n\n    if (i == 0) {\n      b = 6 * x0 - 12 * x1 + 6 * x2;\n      a = -3 * x0 + 9 * x1 - 9 * x2 + 3 * x3;\n      c = 3 * x1 - 3 * x0;\n    } else {\n      b = 6 * y0 - 12 * y1 + 6 * y2;\n      a = -3 * y0 + 9 * y1 - 9 * y2 + 3 * y3;\n      c = 3 * y1 - 3 * y0;\n    }\n\n    if (abs(a) < 1e-12) {\n\n      if (abs(b) < 1e-12) {\n        continue;\n      }\n\n      t = -c / b;\n\n      if (0 < t && t < 1) {\n        tvalues.push(t);\n      }\n\n      continue;\n    }\n\n    b2ac = b * b - 4 * c * a;\n    sqrtb2ac = math.sqrt(b2ac);\n\n    if (b2ac < 0) {\n      continue;\n    }\n\n    t1 = (-b + sqrtb2ac) / (2 * a);\n\n    if (0 < t1 && t1 < 1) {\n      tvalues.push(t1);\n    }\n\n    t2 = (-b - sqrtb2ac) / (2 * a);\n\n    if (0 < t2 && t2 < 1) {\n      tvalues.push(t2);\n    }\n  }\n\n  var j = tvalues.length,\n      jlen = j,\n      mt;\n\n  while (j--) {\n    t = tvalues[j];\n    mt = 1 - t;\n    bounds[0][j] = (mt * mt * mt * x0) + (3 * mt * mt * t * x1) + (3 * mt * t * t * x2) + (t * t * t * x3);\n    bounds[1][j] = (mt * mt * mt * y0) + (3 * mt * mt * t * y1) + (3 * mt * t * t * y2) + (t * t * t * y3);\n  }\n\n  bounds[0][jlen] = x0;\n  bounds[1][jlen] = y0;\n  bounds[0][jlen + 1] = x3;\n  bounds[1][jlen + 1] = y3;\n  bounds[0].length = bounds[1].length = jlen + 2;\n\n  return {\n    x0: mmin.apply(0, bounds[0]),\n    y0: mmin.apply(0, bounds[1]),\n    x1: mmax.apply(0, bounds[0]),\n    y1: mmax.apply(0, bounds[1])\n  };\n}\n\nfunction pathToCurve(path) {\n\n  var pth = paths(path);\n\n  // return cached curve, if existing\n  if (pth.curve) {\n    return pathClone(pth.curve);\n  }\n\n  var curvedPath = pathToAbsolute(path),\n      attrs = { x: 0, y: 0, bx: 0, by: 0, X: 0, Y: 0, qx: null, qy: null },\n      processPath = function(path, d, pathCommand) {\n        var nx, ny;\n\n        if (!path) {\n          return ['C', d.x, d.y, d.x, d.y, d.x, d.y];\n        }\n\n        !(path[0] in { T: 1, Q: 1 }) && (d.qx = d.qy = null);\n\n        switch (path[0]) {\n        case 'M':\n          d.X = path[1];\n          d.Y = path[2];\n          break;\n        case 'A':\n          path = ['C'].concat(arcToCurve.apply(0, [d.x, d.y].concat(path.slice(1))));\n          break;\n        case 'S':\n          if (pathCommand == 'C' || pathCommand == 'S') {\n\n            // In 'S' case we have to take into account, if the previous command is C/S.\n            nx = d.x * 2 - d.bx;\n\n            // And reflect the previous\n            ny = d.y * 2 - d.by;\n\n            // command's control point relative to the current point.\n          }\n          else {\n\n            // or some else or nothing\n            nx = d.x;\n            ny = d.y;\n          }\n          path = ['C', nx, ny].concat(path.slice(1));\n          break;\n        case 'T':\n          if (pathCommand == 'Q' || pathCommand == 'T') {\n\n            // In 'T' case we have to take into account, if the previous command is Q/T.\n            d.qx = d.x * 2 - d.qx;\n\n            // And make a reflection similar\n            d.qy = d.y * 2 - d.qy;\n\n            // to case 'S'.\n          }\n          else {\n\n            // or something else or nothing\n            d.qx = d.x;\n            d.qy = d.y;\n          }\n          path = ['C'].concat(qubicToCurve(d.x, d.y, d.qx, d.qy, path[1], path[2]));\n          break;\n        case 'Q':\n          d.qx = path[1];\n          d.qy = path[2];\n          path = ['C'].concat(qubicToCurve(d.x, d.y, path[1], path[2], path[3], path[4]));\n          break;\n        case 'L':\n          path = ['C'].concat(lineToCurve(d.x, d.y, path[1], path[2]));\n          break;\n        case 'H':\n          path = ['C'].concat(lineToCurve(d.x, d.y, path[1], d.y));\n          break;\n        case 'V':\n          path = ['C'].concat(lineToCurve(d.x, d.y, d.x, path[1]));\n          break;\n        case 'Z':\n          path = ['C'].concat(lineToCurve(d.x, d.y, d.X, d.Y));\n          break;\n        }\n\n        return path;\n      },\n\n      fixArc = function(pp, i) {\n\n        if (pp[i].length > 7) {\n          pp[i].shift();\n          var pi = pp[i];\n\n          while (pi.length) {\n            pathCommands[i] = 'A'; // if created multiple C:s, their original seg is saved\n            pp.splice(i++, 0, ['C'].concat(pi.splice(0, 6)));\n          }\n\n          pp.splice(i, 1);\n          ii = curvedPath.length;\n        }\n      },\n\n      pathCommands = [], // path commands of original path p\n      pfirst = '', // temporary holder for original path command\n      pathCommand = ''; // holder for previous path command of original path\n\n  for (var i = 0, ii = curvedPath.length; i < ii; i++) {\n    curvedPath[i] && (pfirst = curvedPath[i][0]); // save current path command\n\n    if (pfirst != 'C') // C is not saved yet, because it may be result of conversion\n    {\n      pathCommands[i] = pfirst; // Save current path command\n      i && (pathCommand = pathCommands[i - 1]); // Get previous path command pathCommand\n    }\n    curvedPath[i] = processPath(curvedPath[i], attrs, pathCommand); // Previous path command is inputted to processPath\n\n    if (pathCommands[i] != 'A' && pfirst == 'C') pathCommands[i] = 'C'; // A is the only command\n    // which may produce multiple C:s\n    // so we have to make sure that C is also C in original path\n\n    fixArc(curvedPath, i); // fixArc adds also the right amount of A:s to pathCommands\n\n    var seg = curvedPath[i],\n        seglen = seg.length;\n\n    attrs.x = seg[seglen - 2];\n    attrs.y = seg[seglen - 1];\n    attrs.bx = toFloat(seg[seglen - 4]) || attrs.x;\n    attrs.by = toFloat(seg[seglen - 3]) || attrs.y;\n  }\n\n  // cache curve\n  pth.curve = pathClone(curvedPath);\n\n  return curvedPath;\n}\n\nmodule.exports = findPathIntersections;\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.g = (function() {\n\tif (typeof globalThis === 'object') return globalThis;\n\ttry {\n\t\treturn this || new Function('return this')();\n\t} catch (e) {\n\t\tif (typeof window === 'object') return window;\n\t}\n})();","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","// startup\n// Load entry module and return exports\n// This entry module is referenced by other modules so it can't be inlined\nvar __webpack_exports__ = __webpack_require__(568);\n"],"sourceRoot":""}